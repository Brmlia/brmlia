(this.webpackJsonpbrmlia=this.webpackJsonpbrmlia||[]).push([[0],{139:function(e,t,n){e.exports=n(337)},141:function(e,t,n){},149:function(e,t){},150:function(e,t){},151:function(e,t){},337:function(e,t,n){"use strict";n.r(t);n(140),n(141);var a=n(0),i=n.n(a),r=n(33),s=n.n(r),l=n(10),c=n(12),o=n(14),u=n(15),h={height:"100%",width:"100%",position:"relative"},f={flex:1,position:"relative"},p={width:"100%",flex:.1,justifyContent:"space-between",padding:0,position:"relative"},d={fluid:!0,maxWidth:"100%"},v=n(339),m=n(340),g=n(341),b=n(27),y=n(25),x=n(2),j=n(8),O=n(18),w={channels:[{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1},{selected:!1}],lastSelected:1,dev:0},S=Object(O.a)((function(e){return Object(x.a)({},w)})),k=Object(j.a)(S,2),E=(k[0],k[1]);var C={file:[],size:0,selected:0,total:0},I={file:[{name:"brom.jpeg",style:{display:"block",width:"auto",height:"100%"},type:"image/png"}],size:1,selected:0,total:0},L=Object(O.a)((function(e){return Object(x.a)({},E.getState().dev?I:C)})),z=Object(j.a)(L,2),A=(z[0],z[1]),M={annotations:[]},T={redoAnnotations:[]},D={undoAnnotations:[]},V=Object(O.a)((function(e){return Object(x.a)({},M)})),R=Object(j.a)(V,2),N=(R[0],R[1]),F=Object(O.a)((function(e){return Object(x.a)({},T)})),P=Object(j.a)(F,2),U=(P[0],P[1]),B=Object(O.a)((function(e){return Object(x.a)({},D)})),_=Object(j.a)(B,2),W=(_[0],_[1]),G=n(16),X=function(e){return(new G.TextureLoader).load(e)},Y={channels:[{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"255.0"},blackpoint:{value:"0.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"255.0"},blackpoint:{value:"0.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"255.0"},blackpoint:{value:"0.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"235.0"},blackpoint:{value:"16.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""},{uniforms:{brightness:{value:"0.0"},contrast:{value:"0.0"},whitepoint:{value:"255.0"},blackpoint:{value:"0.0"},opacity:{value:"0.0"},color:{value:""},image:{value:""}},texture:null,name:"",type:""}]},Z=Object(O.a)((function(e){return Object(x.a)(Object(x.a)({},Y),{},{update:function(t,n,a,i,r,s,l){return e((function(e){return Object(x.a)(Object(x.a)({},e),{},{uniforms:Object(x.a)(Object(x.a)({},e.uniforms),{},{brightness:Object(x.a)(Object(x.a)({},e.uniforms.brightness),{},{value:t}),contrast:Object(x.a)(Object(x.a)({},e.uniforms.contrast),{},{value:n}),whitepoint:Object(x.a)(Object(x.a)({},e.uniforms.whitepoint),{},{value:a}),blackpoint:Object(x.a)(Object(x.a)({},e.uniforms.blackpoint),{},{value:i}),opacity:Object(x.a)(Object(x.a)({},e.uniforms.opacity),{},{value:r}),color:Object(x.a)(Object(x.a)({},e.uniforms.color),{},{value:s}),image:Object(x.a)({},e.uniforms.image)}),texture:l,brightness:t})}))}})})),q=Object(j.a)(Z,2),H=(q[0],q[1]),J=A,K=H,Q={volumes:[null,null,null,null,null,null,null,null],sliceIndices:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],lengths:[0,0,0,0,0,0,0],type:1,order:0,channels:3,slices:0,stackSize:0},$=Object(O.a)((function(e){return Object(x.a)({},Q)})),ee=Object(j.a)($,2),te=(ee[0],ee[1]),ne=n(17);function ae(e){return console.debug("getVolume - index: %d, all volumes: {",e,te.getState().volumes,"}"),te.getState().volumes[e]}function ie(e,t){!function(e,t){te.setState((function(n){return{volumes:n.volumes.map((function(n,a){return a===e?t:n}))}}))}(e,t)}function re(e){te.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{type:e})}))}function se(){var e=te.getState();return{order:e.order,channels:e.channels,slices:e.slices,stackSize:e.stackSize}}var le=n(4),ce=n.n(le),oe=n(11),ue=function(){function e(t){Object(l.a)(this,e),this.context=t,this.cache=null}return Object(c.a)(e,[{key:"getImageData",value:function(e,t){return this.cache&&this.cache.width===e&&this.cache.height===t||(this.cache=this.context.createImageData(e,t)),this.cache}}]),e}();function he(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(oe.a)(ce.a.mark((function e(t){var n,a;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,caches.open("file-cache").then((function(e){n=e}));case 2:if(!n){e.next=5;break}return e.next=5,n.match(t).then((function(e){console.log("[Cache] response: ",e),a=e}));case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return de.apply(this,arguments)}function de(){return(de=Object(oe.a)(ce.a.mark((function e(t){var n,a;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(t);case 2:if(!(a=e.sent)){e.next=6;break}return e.next=6,a.arrayBuffer().then((function(e){n=e}));case 6:return console.log("[Cache] array buffer: ",n),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t,n){var a;return e&&navigator.storage&&navigator.storage.estimate().then((function(e){var t=e.quota,n=e.usage;console.debug("[Cache] storage - total available: %d, used: %d (%d)",t,n,n/t*100)})).catch((function(e){console.error("*** Unable to update quota ***",e)})).then((function(){setTimeout((function(){console.log(".")}),500)})),caches.open("file-cache").then((function(e){if(a=e){var i=new Response(n);console.log("[Cache] cache: ",a,i,n),a.put(t,i).catch((function(e){console.error("*** Cache API: '".concat(e.name,"' ***"),e),alert("Oops: Error writing to Cache API, check console.")}))}})),a}var me=function(){function e(t){Object(l.a)(this,e),this.bytes=t.bytes||1,this.size=t.size||{x:256,y:256,z:256},this.canvas_context=t.context,this.cube=this.materialize(),this.cached_imgdata=new ue(this.canvas_context),this.clean=!0,this.loaded=!1,this.faces={x:["y","z"],y:["x","z"],z:["x","y"]},this.sw=function(){var e=navigator.serviceWorker;return e&&window.addEventListener("load",(function(){e.register("/sw.js").then((function(){return e.ready})).then((function(){console.log("[Cache] Service Worker Ready")})).catch((function(e){console.log("[Cache] Service Worker ERROR",e)}))})),e}()}return Object(c.a)(e,[{key:"faceDimensions",value:function(e){var t=this.faces[e];return[this.size[t[0]],this.size[t[1]]]}},{key:"materialize",value:function(){var e=this.arrayType(),t=this.size;return new e(t.x*t.y*t.z)}},{key:"insertImageData",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r){var s,l,c,o,u,h,f;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this,l=new Uint32Array(t.buffer),c={true:{1:255,2:65535,4:4294967295},false:{1:4278190080,2:4294901760,4:4294967295}}[this.isLittleEndian()][this.bytes],o=0,u=0,h=0|s.size.x,f=r*s.size.x*s.size.y|0,u=n-1;u>=0;u--)for(o=n-1;o>=0;o--)s.cube[a+o+h*(i+u)+f]=l[o+u*n]&c;return s.clean=!1,e.abrupt("return",this);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,a,i,r){return e.apply(this,arguments)}}()},{key:"slice",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a){var i,r,s,l,c,o,u,h,f,p,d,v,m,g,b,y,x,j,O,w,S,k,E,C,I,L,z,A,M=arguments;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(M.length>3&&void 0!==M[3])||M[3],r=this,!this.cube){e.next=6;break}s=this.cube,e.next=10;break;case 6:return e.next=8,this.getCube();case 8:l=e.sent,s=new Uint8ClampedArray(l);case 10:if(!(n<0||n>=this.size[t])){e.next=12;break}throw new Error(n+" is out of bounds.");case 12:if(c=r.size.x,o=r.size.y,u=r.size.z,h=c*o,f=this.faces[t],p=this.arrayType(),d=new p(this.size[f[0]]*this.size[f[1]]),v=n*h*this.bytes,m=d.length-1,!a){e.next=32;break}if("z"!==t){e.next=29;break}if(!i){e.next=26;break}return g=s.buffer.slice(v,v+h*this.bytes),e.abrupt("return",new p(g));case 26:for(b=d.length-1,y=h*n,x=0;x<o-1;x++)for(j=c-1;j>=0;--j)d[b]=s[j+c*x+y],--b;case 29:if("x"===t)for(O=0;O<u-1;O++)for(w=o-1;w>=0;--w)d[m]=s[n+c*w+h*O],--m;else if("y"===t)for(S=c*n,k=0;k<u-1;k++)for(E=c-1;E>=0;--E)d[m]=s[E+S+h*k],--m;e.next=35;break;case 32:if("z"!==t){e.next=34;break}return e.abrupt("return",new p(s.buffer,v,h));case 34:if("x"===t)for(C=u-1;C>=0;--C)for(I=o-1;I>=0;--I)d[m]=s[n+c*I+h*C],--m;else if("y"===t)for(L=c*n,z=u-1;z>=0;--z)for(A=c-1;A>=0;--A)d[m]=s[A+L+h*z],--m;case 35:return e.abrupt("return",d);case 36:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"grayImageSlice",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a){var i,r,s,l,c,o,u,h,f=arguments;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f.length>3&&void 0!==f[3]&&f[3],r=!(f.length>4&&void 0!==f[4])||f[4],e.next=4,this.slice(t,n,a,!1);case 4:return s=e.sent,e.next=7,this.faceDimensions(t);case 7:if(l=e.sent,!r){e.next=14;break}return e.next=11,this.canvas_context.createImageData(l[0],l[1]);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,this.cached_imgdata.getImageData(l[0],l[1]);case 16:e.t0=e.sent;case 17:if(c=e.t0,o=new Uint32Array(c.data.buffer),u=this.isLittleEndian()?4278190080:255,h=0,i)for(h=s.length-1;h>=0;h--)o[h]=s[h]|s[h]<<8|s[h]<<16|(s[h]&&u);else for(h=s.length-1;h>=0;h--)o[h]=s[h]|s[h]<<8|s[h]<<16|u;return e.abrupt("return",c);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"isLittleEndian",value:function(){var e=new Uint32Array(1),t=new Uint8Array(e.buffer);e[0]=255;var n=255===t[0];return this.isLittleEndian=function(){return n},n}},{key:"getRenderMaskSet",value:function(){return{true:{r:255,g:65280,b:16711680,a:4278190080},false:{r:4278190080,g:16711680,b:65280,a:255}}[this.isLittleEndian()]}},{key:"arrayType",value:function(){var e={1:Uint8ClampedArray,2:Uint16Array,4:Uint32Array}[this.bytes];if(void 0===e)throw new Error(this.bytes+" is not a valid typed array byte count.");return e}},{key:"getImageData",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.faceDimensions("z");case 2:return t=e.sent,e.next=5,this.cached_imgdata.getImageData(t[0],t[1]);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cacheCube",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.cube.buffer?this.cube.buffer:this.cube,e.next=3,ve(this.sw,"samplecube-1.buf",t);case 3:this.cube=null;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCube",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe("samplecube-1.buf").then((function(e){t=e}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ge=function(){function e(t){Object(l.a)(this,e),console.debug("Volume() - args:",t),this.channel=t.channel}return Object(c.a)(e,[{key:"renderChannelSlice",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a,i){var r;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.grayImageSlice(n,a,i,!1,!1);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,a,i){return e.apply(this,arguments)}}()},{key:"drawImage",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.putImageData(n,0,0);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadVolume(this.channel,t,n,a);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"loadVolume",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t,n,a,i){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.insertImageData(n,a,0,0,i);case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,i){return e.apply(this,arguments)}}()},{key:"getImageData",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.getImageData();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),be=n(22);var ye=function(e){var t=Object(a.useRef)(),n=Object(a.useRef)(),r=Object(a.useMemo)((function(){return _n.getState().channels[e.channel-1].uniforms}),[e]);return Object(be.b)((function(t){n.current.uniforms.brightness.value=_n.getState().channels[e.channel-1].uniforms.brightness.value,n.current.uniforms.contrast.value=_n.getState().channels[e.channel-1].uniforms.contrast.value,n.current.uniforms.whitepoint.value=_n.getState().channels[e.channel-1].uniforms.whitepoint.value,n.current.uniforms.blackpoint.value=_n.getState().channels[e.channel-1].uniforms.blackpoint.value,n.current.uniforms.opacity.value=_n.getState().channels[e.channel-1].uniforms.opacity.value,n.current.uniforms.image.value=_n.getState().channels[e.channel-1].uniforms.image.value,n.current.uniforms.color.value=_n.getState().channels[e.channel-1].uniforms.color.value})),i.a.createElement("mesh",{ref:t,scale:[1,1,1]},i.a.createElement("planeBufferGeometry",{attach:"geometry",args:[5,5]}),i.a.createElement("shaderMaterial",{attach:"material",ref:n,fragmentShader:"\n  uniform sampler2D image;\n\n  uniform float brightness;\n  uniform float contrast;\n\n  uniform float blackpoint;\n  uniform float whitepoint;\n  uniform float opacity;\n  uniform vec3 color;\n\n  varying vec2 vUv;\n\n  vec4 setBrightness(in vec4 clr, in float br) {\n    clr.rgb += br;\n    return clr;\n  }\n\n  vec4 setContrast(in vec4 clr, in float ct) {\n    if (ct > 0.0) {\n      clr.rgb = (clr.rgb - 0.5) / (1.0 - ct) + 0.5;\n    } else {\n      clr.rgb = (clr.rgb - 0.5) * (1.0 + ct) + 0.5;\n    }\n    return clr;\n  }\n\n  vec4 setWpBp(in vec4 clr, in float bp, in float wp) {\n    float _blackpoint = bp / 255.0;\n    float _whitepoint = bp == wp ? (255.0 / 0.00025) : (255.0 / (wp - bp));\n    clr.rgb = clr.rgb * _whitepoint - (_whitepoint * _blackpoint);\n    return clr;\n  }\n\n  vec4 setOpacity(in vec3 clr, in float opc) {\n    vec4 _color = vec4(clr, opc);\n    return _color;\n  }\n\n  vec4 sampleColor() {\n    // red with 50% opacity\n    return vec4(1.0, 0.0, 0.0, 0.5);\n  }\n\n  vec4 toGrayscale(in vec4 color)\n  {\n    float average = (color.r + color.g + color.b) / 3.0;\n    return vec4(average, average, average, 1.0);\n  }\n\n  vec4 colorize(in vec4 grayscale, in vec4 color)\n  {\n    return (grayscale * color);\n  }\n\n  vec4 applyColorize(in vec4 color, in vec4 overlay) {\n    vec4 grayscale = toGrayscale(color);\n    vec4 colorizedOutput = colorize(grayscale, overlay);\n    return colorizedOutput;\n  }\n\n  vec4 applyOverlay(in vec4 color, in vec4 overlay) {\n    return (vec4(mix(color.rgb, overlay.rgb, overlay.a), color.a));\n  }\n\n  void main() {\n    vec4 tColor = texture2D(image, vUv);\n    tColor = setBrightness(tColor, brightness);\n    tColor = setContrast(tColor, contrast);\n    tColor = setWpBp(tColor, blackpoint, whitepoint);\n\n    vec4 oColor = setOpacity(color, opacity);\n\n    // tColor = applyColorize(tColor, oColor);\n    tColor = applyOverlay(tColor, oColor);\n    gl_FragColor = tColor;\n  }\n",vertexShader:"\n  varying vec2 vUv;\n\n  void main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",uniforms:r}))},xe={mesh:[i.a.createElement(ye,{channel:"1"}),i.a.createElement(ye,{channel:"2"}),i.a.createElement(ye,{channel:"3"}),i.a.createElement(ye,{channel:"4"}),i.a.createElement(ye,{channel:"5"}),i.a.createElement(ye,{channel:"6"}),i.a.createElement(ye,{channel:"7"}),i.a.createElement(ye,{channel:"8"}),i.a.createElement(ye,{channel:"9"}),i.a.createElement(ye,{channel:"10"}),i.a.createElement(ye,{channel:"11"})]},je=Object(O.a)((function(e){return Object(x.a)({},xe)})),Oe=Object(j.a)(je,2),we=(Oe[0],Oe[1],{canvas:[i.a.createElement(be.a,{className:"image-canvas-1"},xe.mesh[0]),i.a.createElement(be.a,{className:"image-canvas-2"},xe.mesh[1]),i.a.createElement(be.a,{className:"image-canvas-3"},xe.mesh[2]),i.a.createElement(be.a,{className:"image-canvas-4"},xe.mesh[3]),i.a.createElement(be.a,{className:"image-canvas-5"},xe.mesh[4]),i.a.createElement(be.a,{className:"image-canvas-6"},xe.mesh[5]),i.a.createElement(be.a,{className:"image-canvas-7"},xe.mesh[6]),i.a.createElement(be.a,{className:"image-canvas-8"},xe.mesh[7]),i.a.createElement(be.a,{className:"image-canvas-9"},xe.mesh[8]),i.a.createElement(be.a,{className:"image-canvas-10"},xe.mesh[9]),i.a.createElement(be.a,{className:"main-image-canvas"},xe.mesh[10])]}),Se=Object(O.a)((function(e){return Object(x.a)({},we)})),ke=Object(j.a)(Se,2),Ee=(ke[0],ke[1]);function Ce(e){return _n.getState()&&_n.getState().channels.length>0&&e>=1&&_n.getState().channels[e-1]&&_n.getState().channels[e-1].uniforms.contrast&&_n.getState().channels[e-1].uniforms.brightness&&_n.getState().channels[e-1].uniforms.color}function Ie(e,t,n){var a=e.name,i=e.image,r=_n.getState().channels[n-1];r.name===a&&r.imagepath===i&&r.uniforms.image.value===t||Le(t,a,i,n)}function Le(e,t,n,a){_n.setState((function(i){return{channels:i.channels.map((function(i,r){if(r===a-1){var s=i;return s.name=t,s.imagepath=n,s.uniforms.image.value=e,s}return i}))}}))}var ze=n(338),Ae={loaded:0},Me=Object(O.a)((function(e){return Object(x.a)({},Ae)})),Te=Object(j.a)(Me,2),De=(Te[0],Te[1]);function Ve(e,t,n,a,i,r,s){return Re.apply(this,arguments)}function Re(){return(Re=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r,s,l){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==s){e.next=5;break}return e.next=3,Be(t,n,a,i,r[l]);case 3:e.next=7;break;case 5:return e.next=7,We(t,n,a,i,r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t,n,a,i,r){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r,s){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&n&&i)){e.next=4;break}return e.next=3,n.renderChannelSlice(t,i[r],a,s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e,t,n){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(oe.a)(ce.a.mark((function e(t,n,a){var i,r,s;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<n.length)){e.next=10;break}return r=n[i],(s=Math.round(i/(n.length-1)*100))%10===0&&De.setState({loaded:s}),e.next=7,t.load(r,a,i);case 7:i++,e.next=1;break;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(e,t,n,a,i){return _e.apply(this,arguments)}function _e(){return(_e=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r&&r.pages&&r.pages.length>0)){e.next=3;break}return e.next=3,Pe(n,r.pages,r.image.width);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e,t,n,a,i){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r){var s,l,c,o,u,h;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0;case 1:if(!(s<r.length)){e.next=17;break}if(!((l=r[s])&&l.pages&&l.pages.length>0)){e.next=14;break}c=l.pages,o=0;case 6:if(!(o<c.length)){e.next=14;break}return u=c[o],h=s*c.length+o,e.next=11,n.load(u,l.image.width,h);case 11:o++,e.next=6;break;case 14:s++,e.next=1;break;case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xe=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={loaded:0},e.display=function(){return 100!==e.state.loaded?i.a.createElement(ze.a,{striped:!0,bar:!0,value:e.state.loaded}," ",e.state.loaded,"% "):i.a.createElement("div",null," ")},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return De.subscribe((function(t){e.state.loaded=t.loaded})),this.display()}}]),n}(a.Component),Ye={display:"block",width:"auto",height:"100%"},Ze=0;var qe=n(135),He=n.n(qe),Je=n(67),Ke=n.n(Je);var Qe={classes:[{name:"Annotation Class 1",enabled:!1}],lastSel:"class1"};function $e(e){nt.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{classes:[].concat(Object(ne.a)(t.classes),[{name:e||"class1",enabled:!1}])})}))}var et=Object(O.a)((function(e){return Object(x.a)({},Qe)})),tt=Object(j.a)(et,2),nt=(tt[0],tt[1]);function at(e){nt.setState((function(t){return{classes:t.classes.map((function(t,n){if(t.name===e){var a=t;return a.enabled=!0,a}return t}))}}))}function it(e){var t=nt.getState().classes;if(t&&0!==t.filter((function(t){return t.name===e})).length)return!0;return!1}var rt={menu:{displayon:!1,coords:{x:0,y:0},items:[{label:"Edit Annotation",callback:function(){tn(!1),an(1)}},{label:"Edit Class",callback:function(){tn(!1),an(2)}},{label:"Delete",callback:function(){tn(!1),an(3)}}],objects:[],select:0,canvas:null}},st=Object(O.a)((function(e){return Object(x.a)({},rt)})),lt=Object(j.a)(st,2),ct=(lt[0],lt[1]);function ot(e){ct.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{menu:Object(x.a)(Object(x.a)({},t.menu),{},{displayon:e})})}))}var ut=["rgb(200, 140, 140, 0.85)","rgb(140, 200, 140, 0.85)","rgb(140, 140, 200, 0.85)","rgb(100, 100, 100, 0.85)","rgb(255, 255, 255, .01)","rgb(240, 240, 240, 1)"];function ht(e,t){window.canvas=e,e.isMouseDown=!1,e.isDrawingMode=!0,e.freeDrawingBrush.color=ut[0],e.freeDrawingBrush.width=10}function ft(e,t,n,a){if(!(t.top<=0||t.left<=0||t.width<=0||t.height<=0)){var i=new y.fabric.Rect({left:parseInt(t.left),top:parseInt(t.top),width:parseInt(t.width),height:parseInt(t.height),fill:ut[4],stroke:ut[0],strokeLineJoin:"round",strokeWidth:2,objectCaching:!1}),r=y.fabric.util.object.clone(i);r.set({left:i.left-1,top:i.top-1,width:i.width+(2*i.strokeWidth-1),height:i.height+(2*i.strokeWidth-1),stroke:ut[5],strokeWidth:1});var s=new y.fabric.Group([r]);s.on("moving",(function(t){!function(e,t){var n=e.target,a=n._objects[3];n.left<0?(n.set("left",a.strokeWidth/2),n.setCoords()):n.left+n.width>t.width&&(n.set("left",t.width-n.width-a.strokeWidth/2),n.setCoords());n.top<0?(n.set("top",a.strokeWidth/2),n.setCoords()):n.top+n.height>t.height&&(n.set("top",t.height-n.height-a.strokeWidth/2),n.setCoords())}(t,e)}));var l=new y.fabric.IText(n,{fontSize:30,originX:"left",originY:"top",fontFamily:"Arial",fontWeight:"bold",fill:"white",textBackgroundColor:ut[0],top:s.top+i.strokeWidth,left:s.left+i.strokeWidth}),c=new y.fabric.IText(a||"class1",{fontSize:30,originX:"left",originY:"bottom",fontFamily:"Arial",fontWeight:"bold",fill:"white",textBackgroundColor:ut[0],top:s.top+s.height-r.strokeWidth,left:s.left+i.strokeWidth});return e&&(i.perPixelTargetFind=!0,e.add(s),e.setActiveObject(s),s.addWithUpdate(l),s.addWithUpdate(c),s.addWithUpdate(i)),s}}function pt(e,t){var n=e;n||(n=nn());var a="";if(n&&t){var i=n._objects;if(i&&i.length>0){vt(n);for(var r=0;i.length;r++){if(!i[r])return;if(1===r&&i[r].text)return a=i[r].text,i[r].text=t,Jt(a,t),rn().renderAll(),void xt(mt(n),t)}}}}function dt(e,t){var n=e;n||(n=nn());var a="";if(n&&t){var i=n._objects;if(i&&i.length>0){vt(n);for(var r=0;i.length;r++){if(!i[r])return;if(2===r&&i[r].text)return a=i[r].text,i[r].text=t,Kt(a,t),rn().renderAll(),void xt(mt(n),i[1].text)}}}}function vt(e){var t=rn(),n=e._objects;if(n.length>=2){e._restoreObjectsState(),t.remove(e);for(var a=0;a<n.length;a++)t.add(n[a]),t.item(t.size()-1).hasControls=!0;t.renderAll()}}function mt(e){if(e&&4===e._objects.length){var t=e._objects,n=t[0],a=t[1],i=t[2],r=t[3],s=new y.fabric.Group([n,a,i,r]),l=rn();return l&&(l.add(s),l.remove(n),l.remove(a),l.remove(i),l.remove(r),l.setActiveObject(s)),s}}function gt(e,t){for(var n=rn(),a=n.getObjects(),i=0;i<a.length;i++){var r=a[i];if(r)if(r._objects){var s=r._objects[2],l=r._objects[1];s&&s.text&&s.text===e&&(t?bt(r,l.text):(yt(r),n.discardActiveObject()))}}n.renderAll()}function bt(e,t){vt(e);for(var n=e._objects,a=0;a<n.length;a++){jt(n[a],!0)}xt(mt(e),t)}function yt(e){vt(e);for(var t=e._objects,n=0;n<t.length;n++){jt(t[n],!1)}mt(e)}function xt(e,t){for(var n=N.getState().annotations,a=0;a<n.length;a++)n[a].label===t&&(n[a].group=e)}function jt(e,t){e.visible=t,e.dirty=!0,rn().renderAll()}function Ot(e){var t=e;if(!e){var n=nn();if(n&&n._objects.length>0){var a=n._objects[1].text,i=en(a);i&&(t={id:i.id})}}for(var r=N.getState().annotations,s=W.getState().undoAnnotations,l=null,c=null,o=0;o<r.length;o++)t&&r[o]&&r[o].id===t.id&&(St(r[o]),l=o),t&&s[o]&&s[o].id===t.id&&(c=o);return fn(r[l]),Yt(s[c]),pn(l),dn(c),null}function wt(e,t){var n=rn();e.group.set({top:t.rect.top,left:t.rect.left,width:t.rect.width,height:t.rect.height,scaleX:t.rect.scaleX,scaleY:t.rect.scaleY}),e.group.setCoords(),n.requestRenderAll(),n.setActiveObject(e.group)}function St(e){var t=rn();t.remove(e.group),t.requestRenderAll()}var kt=ft,Et=ht,Ct=function(){return ct.getState().menu.displayon},It=ot,Lt=function(e,t){ct.setState((function(n){return Object(x.a)(Object(x.a)({},n),{},{menu:Object(x.a)(Object(x.a)({},n.menu),{},{coords:{x:e,y:t}})})}))},zt=function(e){ct.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{menu:Object(x.a)(Object(x.a)({},t.menu),{},{objects:e})})}))},At=un,Mt=vn,Tt=function(){return nt.getState().lastSel},Dt={RECT:"rectangle",FREE:"free draw",SELECT:"select",NONE:"none"},Vt={layers:[],mouse:{x:0,y:0,down:!1},origin:{x:0,y:0},drawMode:Dt.RECT,nextId:1,canvas:null},Rt=Object(O.a)((function(e){return Object(x.a)({},Vt)})),Nt=Object(j.a)(Rt,2),Ft=(Nt[0],Nt[1]);function Pt(e){Ft.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{drawMode:e})})),Ft.getState().canvas.isDrawingMode=e===Dt.FREE}function Ut(e,t){Bt(e,t);var n=Ft.getState();if(n.origin.x&&n.origin.y&&e&&t){var a=n.mouse.x-n.origin.x,i=n.mouse.y-n.origin.y;if(Math.abs(a)>=10){var r={width:a>=0?a:-a,height:i>=0?i:-i,top:i>=0?n.origin.y:n.mouse.y,left:a>=0?n.origin.x:n.mouse.x},s="label"+(Mt()+1),l=Tt()||"class1",c=kt(Ft.getState().canvas,r,s,l),o=Ft.getState().nextId;hn(on(o)),At(cn(c,s,l,r,o)),Ft.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{nextId:o+1})}))}U.setState({redoAnnotations:[]}),zt(Ft.getState().canvas.getActiveObjects()[0])}}function Bt(e,t){var n=Ft.getState().canvas._offset.left,a=Ft.getState().canvas._offset.left+Ft.getState().canvas.width,i=Ft.getState().canvas._offset.top,r=Ft.getState().canvas._offset.top+Ft.getState().canvas.height,s=e<n?n:e>a?a:e-n,l=t<i?i:t>r?r:t-i;Ft.setState((function(e){return{mouse:{x:s,y:l}}}))}var _t=A,Wt=N,Gt=W,Xt=U,Yt=un,Zt=function(e){for(var t=0;t<e.length;t++)(n=e[t])&&n.rect.left>0&&n.rect.left<1e3&&n.rect.top>0&&n.rect.top<1e3&&n.rect.width>0&&n.rect.width<1e3&&n.rect.height>0&&n.rect.height<1e3&&n.label.length>0&&function(){var n=sn(rn(),e[t].rect,e[t].label,e[t].class),a=ln.getState().nextId;hn(on(a)),un(cn(n,e[t].label,e[t].class,e[t].rect,a)),ln.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{nextId:a+1})}))}();var n;console.log(Wt.getState().annotations)},qt=function(e){(function(e){Xt.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{redoAnnotations:[].concat(Object(ne.a)(t.redoAnnotations),[e])})}))})(Wt.getState().annotations[e]),pn(e);var t=mn();dn(gn()),un(t)},Ht=mn,Jt=function(e,t){Wt.setState((function(n){return{annotations:n.annotations.map((function(n,a){if(n.label===e){var i=n;return i.label=t,i}return n}))}}))},Kt=function(e,t){Wt.setState((function(n){return{annotations:n.annotations.map((function(n,a){if(n&&n.class===e){var i=n;return i.class=t,i}return n}))}}))},Qt=function(){for(var e=[],t=Wt.getState().annotations,n=0;n<t.length;n++)e.push(t[n].class);return e},$t=function(e){for(var t=Xt.getState().redoAnnotations[e],n=Wt.getState().annotations,a=0;a<n.length;a++)n[a].id===t.id&&(fn(n[a]),pn(a));un(t),function(e){Xt.setState((function(t){return t.redoAnnotations.splice(e,1)}))}(e)},en=function(e){for(var t=Wt.getState().annotations,n=0;n<t.length;n++)if(t[n]&&t[n].label===e)return t[n]},tn=ot,nn=function(){return ct.getState().menu.objects},an=function(e){ct.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{menu:Object(x.a)(Object(x.a)({},t.menu),{},{select:e})})}))},rn=function(){return ct.getState().canvas},sn=ft,ln=Ft;function cn(e,t,n,a,i){return{id:i,group:e,label:t,class:n||"class1",rect:{top:a.top,left:a.left,width:a.width,height:a.height,scaleX:e.scaleX,scaleY:e.scaleY}}}function on(e){return{id:e}}function un(e){Wt.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{annotations:[].concat(Object(ne.a)(t.annotations),[e])})}))}function hn(e){fn(e)}function fn(e){Gt.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{undoAnnotations:[].concat(Object(ne.a)(t.undoAnnotations),[e])})}))}function pn(e){Wt.setState((function(t){return t.annotations.splice(e,1)}))}function dn(e){Gt.setState((function(t){return t.undoAnnotations.splice(e,1)}))}function vn(){return Wt.getState().annotations.length-1}function mn(){return Gt.getState().undoAnnotations[Gt.getState().undoAnnotations.length-1]}function gn(){return Gt.getState().undoAnnotations.length-1}function bn(e){for(var t=Wt.getState().annotations,n=0;n<t.length;n++)if(e===t[n].group){fn(t[n]);var a={width:e.width,height:e.height,top:e.top,left:e.left};un(cn(e,e._objects[1].text,e._objects[2].text,a,t[n].id)),pn(n)}}var yn=A,xn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[{name:e.name,image:e.preview,style:Ye,type:e.type,texture:Nn(e.preview)}],size:t.size+1})})),Ze=yn.getState().size-1},jn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[].concat(Object(ne.a)(t.file),[{name:e.name,image:e.preview,style:Ye,type:e.type,texture:Nn(e.preview)}]),size:t.size+1})})),Ze=yn.getState().size-1},On=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[].concat(Object(ne.a)(t.file),[{name:e.name,image:e.preview,style:Ye,type:e.type}]),size:t.size+1})})),Vn(e),Ze=yn.getState().size-1},wn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[].concat(Object(ne.a)(t.file),[{name:e.name,image:e.preview,style:Ye,type:e.type}]),size:t.size+1})})),Vn(e),Ze=yn.getState().size-1},Sn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[{name:e.name,type:e.type,json:Tn(e)}],size:t.size+1})})),Ze=yn.getState().size-1},kn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[].concat(Object(ne.a)(t.file),[{name:e.name,type:e.type,json:Tn(e)}]),size:t.size+1})})),Ze=yn.getState().size-1},En=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[{name:e.name,type:e.type,json:Dn(e)}],size:t.size+1})})),Ze=yn.getState().size-1},Cn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{file:[].concat(Object(ne.a)(t.file),[{name:e.name,type:e.type,json:Dn(e)}]),size:t.size+1})})),Ze=yn.getState().size-1},In=function(){return 0===yn.getState().size},Ln=function(e){var t=!1,n=yn.getState().file;return n&&0===n.filter((function(t){return t.name===e})).length&&(t=!0),t},zn=function(e){yn.setState((function(t){return t.file.map((function(t,n){if(n===Ze){var a=t;return t.json=e,a}return t}))}))},An=function(e,t,n,a){var i=yn.getState().file.findIndex((function(t){return t.name===e})),r=Object(ne.a)(yn.getState().file),s=r[i];s.pages=t,s.image=n,s.metadata=a,r[i]=s},Mn=function(e){yn.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{total:e})}))},Tn=function(e){var t=new FileReader;t.onload=function(){var e=t.result;He()({noheader:!0,output:"json"}).fromString(e).then((function(e){var t=[];e.forEach((function(n,a){if(0!==a){var i={};Object.keys(n).forEach((function(t){var a=n[t],r=e[0][t];i[r]=a})),t.push(i)}})),zn(t)}))},t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.readAsText(e,"ISO-8859-1")},Dn=function(e){var t,n=new FileReader;n.onload=function(){t=JSON.parse(n.result),zn(t.annotations)},n.readAsText(e)},Vn=function(e){var t=new FileReader;e&&(t.onload=function(){"image/tiff"===e.type&&console.debug("importer::importTiff() - Loading TIFF image...",e.name)},t.onloadend=function(t){console.debug("importer::importTiff() - Parsing TIFF image...",e.name),function(e,t){for(var n=[],a=Ke.a.decode(t),i=0;i<a.length;i++){var r=i;Ke.a.decodeImage(t,a[r]);var s=Ke.a.toRGBA8(a[r]);n.push(s)}for(var l=new Image(a[0].width,a[0].height),c=String(a[0].t270).split(/\s+/),o={},u=0;u<c.length;u++){var h=c[u].split(/=/),f=h[0],p=h[1];o[f]=p}An(e,n,l,o)}(e.name,t.target.result)},t.onprogress=function(){console.log("importer::importTiff()","Still Loading...",e.name)},t.readAsArrayBuffer(e))},Rn=N,Nn=X,Fn=function(e){te.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{stackSize:e})}))};function Pn(e,t){var n=t.channels,a=e.length,i=e[0].pages.length,r=parseInt(n||1);return Fn(a*i),function(e,t,n){var a=0;return 1===e&&3===n&&t>1?a=1:3===e&&1===n&&t>1?a=2:e>1&&3===t?a=3:e>1&&1===t&&(a=4),console.log("determineType() - type, file, page, channel lengths: ",a,e,t,n),a}(a,i,r)}function Un(e,t){return e&&e.file.length>0&&e.file.length!==t&&e.total===e.size}function Bn(e,t,n){return e.length>0&&e[t]&&e[t].pages&&e[t].pages.length>0&&e.length!==n}var _n=K,Wn=J,Gn=Ee,Xn=te,Yn=function(e,t){var n=e.name,a=e.image,i=e.texture;""===i&&("image/tiff"===e.type||(i=qn(a)));var r=_n.getState().channels[t-1];r.name===n&&r.imagepath===a&&r.uniforms.image.value===i||Le(i,n,a,t)},Zn=Ie,qn=X,Hn=ie,Jn=ae,Kn=function(e,t){te.setState((function(n){return{lengths:n.lengths.map((function(n,a){return a===e?t:n}))}}))},Qn=re,$n=se,ea=oa,ta=la,na=Ve,aa=Ne,ia=Pn,ra=Un,sa=Bn;function la(e,t,n,a,i,r,s,l,c){return ca.apply(this,arguments)}function ca(){return(ca=Object(oe.a)(ce.a.mark((function e(t,n,a,i,r,s,l,c,o){var u,h;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jn(t)){e.next=12;break}return(u={x:256,y:256,z:256}).x=l,u.y=c,u.z=o,h=new ge({channel:new me({bytes:1,size:u,context:n})}),Hn(t,h),e.next=9,na(n,h,r,2,a,s,i);case 9:return e.next=11,h.channel.cacheCube();case 11:console.debug("initializeVolume: volume initialized with params: idx: %d fileIdx: %d type: %d width: %d height: %d length: %d",t,i,s,l,c,o);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oa(e,t,n){var a=new Uint8Array(e),i=new G.DataTexture(a,t,n,G.RGBAFormat);return i.needsUpdate=!0,i}var ua,ha=A,fa=N,pa=te,da=ae,va=la,ma=function(e,t){te.setState((function(n){return{sliceIndices:n.sliceIndices.map((function(n,a){return a===e?t:n}))}}))},ga=re,ba=function(e,t,n){var a=function(e,t){if(0===A.getState().file.length)return 1;if(te.getState().stackSize!==e*t)return 2;if(e<=0||e>10)return 3;if(t<=0)return 4;return 0}(t,n);return 0===a&&(te.setState((function(a){return Object(x.a)(Object(x.a)({},a),{},{order:e,channels:t,slices:n})})),se()),a},ya=se,xa={display:"inline-flex",borderRadius:2,border:"1px solid #eaeaea",marginBottom:8,marginRight:8,width:50,height:50,padding:4,boxSizing:"border-box"},ja={display:"flex",minWidth:0,overflow:"hidden"},Oa={position:"absolute",height:"100%",width:"100%",zIndex:"3",opacity:"0.5"},wa={position:"absolute",height:"100%",width:"100%",zIndex:"5",opacity:"0.5"},Sa={position:"absolute",height:"100%",width:"100%",zIndex:"7",opacity:"0.5"},ka={justify:"center",alignContent:"center",alignItems:"center",textAlign:"center",width:"100%",fluid:!0,fontSize:"12px",height:"100%"},Ea={width:"95%",height:"100%",fontSize:"20px"},Ca={position:"center",height:"100px",width:"100%",zIndex:"3"},Ia={},La={flex:.1,position:"relative"},za={justify:"center",alignContent:"center",alignItems:"center",textAlign:"center",width:"100%",fluid:!0,marginBottom:"15px",overflowX:"scroll"},Aa={},Ma={flex:.1,position:"relative"},Ta={justify:"center",alignContent:"center",alignItems:"center",textAlign:"center",width:"100%",fluid:!0,fontSize:"20px",marginBottom:"15px"},Da={flex:.1,position:"relative"},Va={justify:"center",alignContent:"center",alignItems:"center",textAlign:"center",width:"100%",fluid:!0,fontSize:"12px",flexWrap:"wrap",marginBottom:"15px"},Ra={width:"95%",height:"100%"},Na=function(){for(var e=Qt(),t=0;t<e.length;t++){var n=e[t];n&&!it(n)&&($e(n),at(n))}},Fa=function(){return nt.getState().classes},Pa=function(e){nt.setState((function(t){return{classes:t.classes.map((function(t,n){if(n===e){var a=t;return a.enabled=!t.enabled,a}return t}))}}));var t=nt.getState().classes[e];t.enabled&&nt.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{lastSel:t.name})}))},Ua=nt,Ba=function(e){gt(e.name,e.enabled)},_a=gt,Wa=function(){for(var e=rn().getObjects(),t=0;t<e.length;t++){var n=e[t];n&&bt(n)}},Ga=ht,Xa=function(){var e=rn(),t=N.getState().annotations,n=Ht();if(!n)return null;for(var a=0;a<t.length;a++)t[a]&&n&&t[a].id===n.id&&(t[a].group&&n.group?wt(t[a],n):n.group&&!t[a].group?e.add(n.group):St(t[a]),qt(a))},Ya=function(){var e=rn(),t=Xt.getState().redoAnnotations.length-1,n=N.getState().annotations;if(t>=0){var a=Xt.getState().redoAnnotations[Xt.getState().redoAnnotations.length-1];if(!a)return null;if(a.group){a.group.set({top:a.rect.top,left:a.rect.left,width:a.rect.width,height:a.rect.height,scaleX:a.rect.scaleX,scaleY:a.rect.scaleY});for(var i=rn()._objects,r=0;r<i.length;r++)i[r]&&i[r]._objects&&i[r]._objects[1].text&&i[r]._objects[1].text===a.label&&e.remove(i[r]);e.add(a.group),e.requestRenderAll(),e.setActiveObject(a.group)}else for(var s=0;s<n.length;s++)n[s].id===a.id&&(e.add(n[s].group),e.requestRenderAll());$t(t)}},Za=Ot,qa=pt,Ha=dt,Ja=function(e){ct.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{canvas:e})}))},Ka=Ne,Qa=function(e,t){return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.brightness.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.brightness.value=e,i}return n}))}}))}(e,t),!0):(console.log("CanvasControl::UpdateBrighness() - null state",_n.getState()," channel: ",t," value: ",e),!1)},$a=function(e,t){return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.contrast.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.contrast.value=e,i}return n}))}}))}(e,t),!0):(console.log("CanvasControl::updateContrast() - null state",_n.getState()," channel: ",t," value: ",e),!1)},ei=function(e,t){return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.whitepoint.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.whitepoint.value=e,i}return n}))}}))}(e,t),!0):(console.log("CanvasControl::updateWhitepoint() - null state",_n.getState()," channel: ",t," value: ",e),!1)},ti=function(e,t){return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.blackpoint.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.blackpoint.value=e,i}return n}))}}))}(e,t),!0):(console.log("CanvasControl::updateBlackpoint() - null state",_n.getState()," channel: ",t," value: ",e),!1)},ni=function(e,t){var n=new G.Color(e.color);return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.color.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.color.value=e,i}return n}))}}))}(n,t),!0):(console.log("CanvasControl::updateColor() - null state",_n.getState()," channel: ",t," value: ",e),!1)},ai=function(e,t){return Ce(t)?(e!==_n.getState().channels[t-1].uniforms.opacity.value&&function(e,t){_n.setState((function(n){return{channels:n.channels.map((function(n,a){if(a===t-1){var i=n;return i.uniforms.opacity.value=e,i}return n}))}}))}(e,t),!0):(console.log("CanvasControl::updateOpacity() - null state",_n.getState()," channel: ",t," value: ",e),!1)},ii=function(e,t){if(!Ct()){It(!0);var n=Ft.getState().canvas;Lt(e-n._offset.left,t-n._offset.top)}},ri=function(e,t){Ft.getState().canvas.isDrawingMode?Et(Ft.getState().canvas):function(e,t){!function(e,t){Ft.setState((function(n){return Object(x.a)(Object(x.a)({},n),{},{origin:{x:e-Ft.getState().canvas._offset.left,y:t-Ft.getState().canvas._offset.top}})}))}(e,t)}(e,t)},si=function(){Pt(Dt.SELECT)},li=function(e,t){Ft.getState().drawMode===Dt.SELECT?Pt(Dt.RECT):Ft.getState().drawMode===Dt.RECT&&Ut(e,t)},ci=function(){var e=Ft.getState().annotations;if(e.length>Ft.getState().canvas.getObjects().length){var t=e[e.length-1],n={left:parseInt(t.rect.left),top:parseInt(t.rect.top),width:parseInt(t.rect.width),height:parseInt(t.rect.height)};kt(Ft.getState().canvas,n,t.label,t.class)}},oi=function(e){Ft.setState((function(t){return{canvas:e}}))},ui=Pt,hi=Ft,fi=Dt,pi=function(e){E.getState().channels.filter((function(e){return!0===e.selected})).length<3&&E.setState((function(t){return{channels:t.channels.map((function(n,a){if(a===e-1){var i=n;return i.selected=!t.channels[a].selected,i}return n}))}}))},di=function(e){E.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{lastSelected:e})}))},vi=function(){var e=document.createElement("a"),t=function(){for(var e=Rn.getState().annotations,t={annotations:[]},n=0;n<e.length;n++){var a=e[n],i={class:a.class,id:a.id,label:a.label,rect:a.rect};t.annotations[n]=i}return JSON.stringify(t,null,2)}(),n=new Blob([t],{type:"text/plain"});e.href=URL.createObjectURL(n),e.download="annotations.json",document.body.appendChild(e),e.click()},mi=Pn,gi=Un,bi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).canvasRef=i.a.createRef(),a.handleMouseDown=a.handleMouseDown.bind(Object(b.a)(a)),a.handleMouseUp=a.handleMouseUp.bind(Object(b.a)(a)),a.handleMouseDoubleClick=a.handleMouseDoubleClick.bind(Object(b.a)(a)),a.handleDrag=a.handleDrag.bind(Object(b.a)(a)),a.selectClass1=a.selectClass1.bind(Object(b.a)(a)),a.showAll=a.showAllClasses.bind(Object(b.a)(a)),a.handleMoveAnnotation=a.handleMoveAnnotation.bind(Object(b.a)(a)),a.handleModifyAnnotation=a.handleModifyAnnotation.bind(Object(b.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){(ua=new y.fabric.Canvas(this.canvasRef.current,{fireRightClick:!0})).on({"mouse:down":this.handleMouseDown,"mouse:up":this.handleMouseUp,"mouse:dblclick":this.handleMouseDoubleClick,"object:modified":this.handleModifyAnnotation,"object:moving":this.handleMoveAnnotation,"object:rotating":this.handleDrag,"object:scaling":this.handleDrag}),Ja(ua),oi(ua)}},{key:"handleDrag",value:function(e){si()}},{key:"handleMoveAnnotation",value:function(e){ui(fi.SELECT)}},{key:"handleModifyAnnotation",value:function(e){!function e(t){for(var n=t._objects,a=0;a<n.length;a++){if(!n[a]._objects){t.setCoords(),bn(t);break}e(n[a])}U.setState({redoAnnotations:[]})}(e.target)}},{key:"handleLeftMouseDown",value:function(e){var t=hi.getState().drawMode;t===fi.RECT?ri(e.e.clientX,e.e.clientY):t===fi.FREE&&Ga(ua)}},{key:"handleRightMouseDown",value:function(e){ii(e.e.clientX,e.e.clientY)}},{key:"handleLeftMouseUp",value:function(e){li(e.e.clientX,e.e.clientY)}},{key:"handleRightMouseUp",value:function(e){}},{key:"handleMouseDown",value:function(e){3===e.button?this.handleRightMouseDown(e):this.handleLeftMouseDown(e)}},{key:"handleMouseUp",value:function(e){3===e.button?this.handleRightMouseUp(e):this.handleLeftMouseUp(e)}},{key:"handleObjectSelect",value:function(e){}},{key:"handleObjectResize",value:function(e){}},{key:"handleMouseDoubleClick",value:function(e){si()}},{key:"displayMenu",value:function(){}},{key:"selectClass1",value:function(){_a("class1"),this.forceUpdate()}},{key:"showAllClasses",value:function(){Wa(),this.forceUpdate()}},{key:"render",value:function(){return fa.subscribe((function(e){e&&ci(e.annotations,ua)})),i.a.createElement("div",{id:"annotationLayer",style:Aa,onContextMenu:function(e){return e.preventDefault()}},i.a.createElement("canvas",{ref:this.canvasRef,width:.6*window.innerWidth,height:.48*window.innerHeight}),this.displayMenu())}}]),n}(i.a.Component),yi={views:[{name:"main",zoomPct:"1",zoomZppPct:"1",reset:"0"},{name:"xy",zoomPct:"1",zoomZppPct:"1",reset:"0"},{name:"yz",zoomPct:"1",zoomZppPct:"1",reset:"0"},{name:"xz",zoomPct:"1",zoomZppPct:"1",reset:"0"}],last:"0"},xi=Object(O.a)((function(e){return Object(x.a)({},yi)})),ji=Object(j.a)(xi,2),Oi=(ji[0],ji[1]),wi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).initSlider={initial:0,min:0,max:0,step:0,value:0},a.handleSliderChange=function(e){e.persist();var t=a.state.slider;t.value=e.target.value,a.setState({slider:t}),a.updateStatus(!0),a.notifyValue()},a.state={updated:!1,slider:a.initSlider,setSlider:null,sync:!0},a}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(){return!!this.state.updated}},{key:"updateStatus",value:function(e){this.setState({updated:!0})}},{key:"notifyValue",value:function(){var e=this.props.sliderValue,t=this.props.type;e(this.state.slider.value,t)}},{key:"displayValue",value:function(){return"1"===this.props.raw?i.a.createElement("span",null," ",Math.round(this.state.slider.value*this.props.multiplier)):i.a.createElement("span",null," ",Math.round(this.state.slider.value*this.props.multiplier),"%")}},{key:"render",value:function(){var e=this;Oi.subscribe((function(t){if(e.props.type>=0&&e.props.type<t.views.length){var n=e.state.slider;n.value=t.views[e.props.type].zoomPct,e.setState({slider:n})}}));var t=this.state.slider,n=this.props,a=n.label,r=n.min,s=n.max,l=n.initial,c=n.step;return i.a.createElement("div",{className:"slider-settings"},i.a.createElement("span",null,a)," ",i.a.createElement("br",null),i.a.createElement("span",null,r," "),i.a.createElement("input",{type:"range",className:"slider",value:t.value||l,id:"customRange1",initial:l,min:r,max:s,step:c,onChange:function(t){return e.handleSliderChange(t)}}),i.a.createElement("span",null," ",s),i.a.createElement("span",null," ",this.displayValue()))}}]),n}(a.Component),Si=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).canvas=i.a.createRef(),a.state={axes:["x","y","z"],cntxt:null},a.customSettings={order:"0",channels:0,slices:0},a.fileLength=0,a.sliceLength=0,a.channelLength=0,a.sliceIdx=0,a.slice=0,a.axisIdx=e.axis,a.channel=1,a.type=1,a.typeIsDefault=!0,a.files=e.files,a.order="0",a.width=.6*window.innerWidth,a.height=.5*window.innerHeight,a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){if(this.cntxt=this.canvas.current.getContext("2d"),this.files){var e=Math.max(this.files.length-1,0);if(this.isValidTiffFile(this.files,e)){var t=this.files[e],n=t.image.width,a=t.image.height,i=this.files.length,r=t.pages.length;this.setType(this.files,t.metadata),this.setSlider(i,r),this.setVolume(this.files,n,a,r*i),this.updateSlice(),this.fileLength=i,this.forceUpdate()}else this.isValidPNGFile(this.files,e)&&(this.updateFileList(this.files),this.drawPNG(this.files[e].image),this.type=5,this.setSlider(this.files.length,0),this.forceUpdate())}}},{key:"isValidTiffFile",value:function(e,t){return e.length>0&&e[t]&&e[t].pages&&e[t].pages.length>0&&e.length!==this.fileLength}},{key:"isValidPNGFile",value:function(e,t){return e.length>0&&e[t]&&e.length!==this.fileLength&&"image/png"===e[t].type}},{key:"drawPNG",value:function(e){var t=new Image;t.src=e,this.cntxt.drawImage(t,0,0)}},{key:"setSlider",value:function(e,t){"2"===this.props.axis&&(1===this.type?this.sliceLength=t/3:2===this.type?this.sliceLength=t:3===this.type?this.sliceLength=e:4===this.type?this.sliceLength=e/3:5===this.type?this.sliceLength=e:this.sliceLength=t,this.channelLength=3)}},{key:"setVolume",value:function(e,t,n,a){va(0,this.cntxt,e,0,this.state.axes,this.type,t,n,a),this.volume||(this.volume=da(0))}},{key:"setType",value:function(e,t){this.typeIsDefault&&(this.type=mi(e,t),ga(this.type),this.typeIsDefault=!1)}},{key:"refreshImage",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cntxt.clearRect(0,0,this.canvas.current.width,this.canvas.current.height),this.volume||(this.volume=da(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateFileList",value:function(e){for(var t=e.filter((function(e){return"image/png"===e.type})),n=this.files.length;n<t.length;n++)this.files.push(t[n])}},{key:"updateForFile",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t){var n,a,i,r,s,l,c;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:gi(t,this.fileLength)&&(n=t.file,t&&n&&(a=Math.max(n.length-1,0),this.isValidTiffFile(t.file,a)?(i=n[a],r=i.image.width,s=i.image.height,l=n.length,c=i.pages.length,i&&r&&s&&l&&c&&(this.setType(n,i.metadata),this.setSlider(l,c),this.setVolume(n,r,s,c*l),this.updateSlice(),this.fileLength=l,this.forceUpdate())):this.isValidPNGFile(t.file,a)&&(this.updateFileList(t.file),this.drawPNG(t.file[a].image),this.type=5,this.setSlider(n.length,0),this.forceUpdate())));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeSlice",value:function(e){return"1"===this.order?e*this.channelLength+(this.channel-1):"2"===this.order?e+(this.channel-1)*this.sliceLength:1===this.type?3*e+(this.channel-1):2===this.type?e+(this.channel-1)*this.sliceLength:3===this.type||4===this.type?3*e+(this.channel-1):(this.type,e)}},{key:"scaleImage",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t,n,a,i,r,s;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.volume.getImageData();case 2:(t=e.sent)&&(n=this.width,a=this.height,i=t.width,r=t.height,(s=document.createElement("canvas")).width=i,s.height=r,s.getContext("2d").putImageData(t,0,0),this.cntxt.drawImage(s,0,0,n,a));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateSlice",value:function(){this.type<5&&this.slice<this.sliceLength?(this.refreshImage(),Ka(this.cntxt,this.volume,this.sliceIdx,this.state.axes,this.axisIdx,!1)):5===this.type&&this.drawPNG(this.files[this.sliceIdx].image),this.scaleImage(),this.forceUpdate()}},{key:"updateCustomSettings",value:function(){this.customSettings=ya(),0!==this.customSettings.order&&(this.order=this.customSettings.order,this.channelLength=this.customSettings.channels,this.sliceLength=this.customSettings.slices,this.channel=1,this.slice=0,this.forceUpdate())}},{key:"sliderValueSlice",value:function(e){this.slice=parseInt(e),this.sliceIdx=this.computeSlice(this.slice),this.updateSlice()}},{key:"sliderValueChannel",value:function(e){this.channel=parseInt(e),this.sliceIdx=this.computeSlice(this.slice),this.updateSlice()}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}},{key:"drawSliceSlider",value:function(){return i.a.createElement("div",{className:"slice-slider-container"},i.a.createElement(wi,{label:"",width:"40%",min:"0",max:Math.max(this.sliceLength-1,0),step:"1",initial:"0",multiplier:"1",raw:"1",sliderValue:this.sliderValueSlice.bind(this)}),i.a.createElement("div",null," Slice: ",this.slice," "))}},{key:"drawChannelSlider",value:function(){return this.type<5?i.a.createElement("div",null,i.a.createElement("div",{className:"channel-slider-container"},i.a.createElement(wi,{label:"",width:"40%",min:"1",max:this.channelLength,step:"1",initial:"1",multiplier:"1",raw:"1",sliderValue:this.sliderValueChannel.bind(this)}),i.a.createElement("div",null," Channel: ",this.channel," "))):5===this.type?i.a.createElement("div",null):void 0}},{key:"render",value:function(){var e=this;return ha.subscribe((function(t){e.updateForFile(t)})),pa.subscribe((function(t){e.updateCustomSettings()})),i.a.createElement("div",{style:{color:"black",height:"100%"}},i.a.createElement("canvas",{id:"canvas-1",ref:this.canvas,width:this.width,height:this.height}),i.a.createElement(Xe,null),this.drawSliceSlider(),this.drawChannelSlider())}}]),n}(a.Component),ki=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).views=[],a.activeChannels=[],a}return Object(c.a)(n,[{key:"canvasView",value:function(){var e=i.a.createElement(Si,{axis:"2",className:"annot-view",alt:"main-canvas",width:.6*window.innerWidth,height:"100%",channel:"0",files:this.files}),t=.6*window.innerWidth,n=.6*window.innerHeight;return i.a.createElement("div",{id:"main-canvas-view",style:{width:t,height:n}},e)}},{key:"updateViews",value:function(){for(var e=[],t=[],n=0;n<E.getState().channels.length;n++){E.getState().channels[n].selected&&(e.push(Ee.getState().canvas[n]),t.push(n+1),t.push(" "))}this.views=e,this.activeChannels=t}},{key:"channelViews",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{style:Oa},this.views[0]),i.a.createElement("div",{style:wa},this.views[1]),i.a.createElement("div",{style:Sa},this.views[2]," "))}},{key:"updateForFile",value:function(e){this.files=e.file}},{key:"display",value:function(){return 0===this.views.length?this.canvasView():this.channelViews()}},{key:"render",value:function(){var e=this;E.subscribe((function(t){e.updateViews(),e.forceUpdate()})),ha.subscribe((function(t){e.updateForFile(t)}));var t=.6*window.innerWidth,n=.6*window.innerHeight;return i.a.createElement("div",{className:"main-view",style:Ma},i.a.createElement(v.a,{className:"main-card",style:Ta},i.a.createElement(m.a,{className:"main-card-body"},i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Image View ")," "),"Active Channels: ",this.activeChannels,i.a.createElement("div",{id:"main-canvas-container",style:{width:t,height:n,position:"relative"}},this.display(),i.a.createElement(bi,null)))))}}]),n}(i.a.Component),Ei=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).canvas=i.a.createRef(),a.state={axes:["x","y","z"],cntxt:null},a.fileLength=0,a.length=0,a.sliceIdx=0,a.axisIdx=e.axis,a.channel=1,a.type=1,a.typeIsDefault=!0,a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setState((function(t){return{cntxt:e.canvas.current.getContext("2d")}}))}},{key:"isValidFile",value:function(e,t){return e.length>0&&e[t]&&e[t].pages&&e[t].pages.length>0&&e.length!==this.fileLength}},{key:"setSlider",value:function(e,t,n,a){"0"===this.props.axis&&(this.sliceLength=e),"1"===this.props.axis&&(this.sliceLength=t),"2"===this.props.axis&&(1===this.type?(this.sliceLength=a/3,this.channelLength=3):2===this.type?(this.sliceLength=a,this.channelLength=1):3===this.type?(this.sliceLength=n,this.channelLength=3):4===this.type?(this.sliceLength=n/3,this.channelLength=1):(this.sliceLength=a,this.channelLength=1))}},{key:"setVolume",value:function(e,t,n,a){va(0,this.state.cntxt,e,0,this.state.axes,this.type,t,n,a),this.volume||(this.volume=da(0))}},{key:"setType",value:function(e,t){this.typeIsDefault&&(this.type=mi(e,t),ga(this.type),this.typeIsDefault=!1)}},{key:"updateForFile",value:function(){var e=Object(oe.a)(ce.a.mark((function e(t){var n,a,i,r,s,l,c;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:gi(t,this.fileLength)&&(n=t.file,t&&n&&(a=Math.max(n.length-1,0),this.isValidFile(n,a)&&(i=n[a],r=i.image.width,s=i.image.height,l=n.length,c=i.pages.length,this.setType(n,i.metadata),this.setSlider(r,s,l,c),this.setVolume(n,r,s,c*l),this.updateSlice(),this.fileLength=l,this.forceUpdate())));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeSlice",value:function(e){return"2"===this.props.axis?"1"===this.order?e*this.channelLength+(this.channel-1):"2"===this.order?e+(this.channel-1)*this.sliceLength:1===this.type?3*e+(this.channel-1):2===this.type?e+(this.channel-1)*this.sliceLength:3===this.type||4===this.type?3*e+(this.channel-1):(this.type,e):e}},{key:"updateSlice",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t,n;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="2"!==this.axisIdx,!(this.slice<this.sliceLength)){e.next=6;break}return e.next=4,Ka(this.state.cntxt,this.volume,this.sliceIdx,this.state.axes,this.axisIdx,t);case 4:(n=e.sent)&&(this.volume.drawImage(this.state.cntxt,n),this.updatedtexture=!1,this.forceUpdate());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextSlice",value:function(e){this.sliceIdx=e?this.clamp(parseInt(this.sliceIdx)-1,0,Math.max(0,this.length-1)):this.clamp(parseInt(this.sliceIdx)+1,0,Math.max(0,this.length-1)),this.updateSlice()}},{key:"updateCustomSettings",value:function(){this.customSettings=ya(),0!==this.customSettings.order&&(this.order=this.customSettings.order,this.channelLength=this.customSettings.channels,this.sliceLength=this.customSettings.slices,this.channel=1,this.slice=0,this.forceUpdate())}},{key:"sliderValueSlice",value:function(e){this.slice=parseInt(e||0),this.sliceIdx=this.computeSlice(this.slice),this.updateSlice()}},{key:"sliderValueChannel",value:function(e){this.channel=parseInt(e),this.sliceIdx=this.computeSlice(this.slice),this.updateSlice()}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(e,t),n)}},{key:"drawSliceSlider",value:function(){var e=this;return i.a.createElement("div",{className:"axis-slice-slider-container"},i.a.createElement(wi,{label:"",width:"40%",min:"0",max:Math.max(this.sliceLength-1,0),step:"1",initial:"0",multiplier:"1",raw:"1",sliderValue:this.sliderValueSlice.bind(this)}),i.a.createElement("button",{id:"prevSliceBtn",onClick:function(){e.nextSlice(!0)}},"<<"),i.a.createElement("button",{id:"resetSliceBtn",onClick:function(){e.sliderValueSlice(0)}},"Go to Slice 0"),i.a.createElement("button",{id:"nextSliceBtn",onClick:function(){e.nextSlice(!1)}},">>"),"\xa0",i.a.createElement("label",null,"Slice #: \xa0",i.a.createElement("input",{type:"text",style:{width:"50px"},value:this.slice,onChange:function(t){return e.sliderValueSlice(t.target.value)}})))}},{key:"drawChannelInput",value:function(){var e=this;return i.a.createElement("label",null,"Channel #: \xa0",i.a.createElement("input",{type:"text",style:{width:"50px"},value:this.channel,onChange:function(t){return e.sliderValueChannel(t.target.value)}}))}},{key:"render",value:function(){var e=this;return ha.subscribe((function(t){e.updateForFile(t)})),pa.subscribe((function(t){e.updateCustomSettings()})),i.a.createElement("div",null,i.a.createElement("canvas",{id:"canvas-1",ref:this.canvas,height:"280"}),i.a.createElement(Xe,null),this.drawSliceSlider(),"2"===this.props.axis&&this.drawChannelInput())}}]),n}(a.Component),Ci=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).view1=i.a.createElement(Ei,{axis:"2"}),e.view2=i.a.createElement(Ei,{axis:"0"}),e.view3=i.a.createElement(Ei,{axis:"1"}),e}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"card-axis-xy",style:Da},i.a.createElement(v.a,{style:Va},i.a.createElement(m.a,{style:Ra},i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Axis XY ")," "),this.view1))),i.a.createElement("div",{className:"card-axis-yz",style:Da},i.a.createElement(v.a,{style:Va},i.a.createElement(m.a,{style:Ra},i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Axis YZ ")," "),this.view2))),i.a.createElement("div",{className:"card-axis-xz",style:Da},i.a.createElement(v.a,{style:Va},i.a.createElement(m.a,{style:Ra},i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Axis XZ ")," "),this.view3))))}}]),n}(i.a.Component),Ii=n(342),Li=n(354),zi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).futureClass=[],a.futureAnnotClass=[],a.state={classes:[],annotClasses:[]},a.enables=[],a}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(e){for(var t=0;t<e.classes;t++){var n=e.classes[t];if(n&&this.state.classes[t]!==n.name&&this.enables[t]!==n.enabled)return!0}for(t=0;t<e.annotClasses;t++){var a=e.annotClasses[t];if(a&&this.state.annotClasses[t]!==a)return!0}return!1}},{key:"filter",value:function(e){var t=Fa();Pa(e),Ba(t[e])}},{key:"updateAnnotClasses",value:function(e){for(var t=this,n=function(){var n=e[a];t.state.annotClasses.includes(n.class)||t.futureAnnotClass.includes(n.class)||(t.futureAnnotClass.push(n.class),t.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{annotClasses:[].concat(Object(ne.a)(e.annotClasses),[n.class])})})))},a=0;a<e.length;a++)n()}},{key:"updateClasses",value:function(e){for(var t=this,n=function(){var n=e[a];t.state.classes.includes(n.name)||t.futureClass.includes(n.name)||(t.futureClass.push(n.name),t.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{classes:[].concat(Object(ne.a)(e.classes),[n.name])})})))},a=0;a<e.length;a++)n()}},{key:"updateEnables",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.enables.length!==e.length?this.enables[t]=n.enabled:n&&this.enables[t]!==n.enabled&&(this.enables[t]=n.enabled,this.forceUpdate())}}},{key:"display",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"annotations-class",style:La},i.a.createElement(v.a,{style:za},i.a.createElement(m.a,null,i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Annotation Classes ")," ")),i.a.createElement(Ii.a,{className:"viewBtn",outline:!0,color:"secondary",id:"annotator-class-list"},"Class List"),i.a.createElement("br",null),i.a.createElement(Li.a,{toggler:"annotator-class-list"},this.displayClassList()))))}},{key:"displayClassList",value:function(){for(var e=this,t=Fa(),n=[],a=function(){var a=r,s=t[a].enabled;n.push(i.a.createElement(Ii.a,{outline:!0,color:"primary",id:"annot1Btn",onClick:function(){e.filter(a)},active:s},t[a].name))},r=0;r<t.length;r++)a();return i.a.createElement("div",null,n)}},{key:"render",value:function(){var e=this;return fa.subscribe((function(t){t&&(Na(),e.updateAnnotClasses(t.annotations))})),Ua.subscribe((function(t){t&&e.state.classes.length!==t.classes.length&&e.updateClasses(t.classes),t&&t.classes&&e.updateEnables(t.classes)})),i.a.createElement("div",null,this.display())}}]),n}(i.a.Component),Ai=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).classicImage=function(e,t){return i.a.createElement("div",{style:xa,key:e.name},i.a.createElement("div",{style:ja},i.a.createElement("img",{src:e.image,style:e.style,alt:e.name,onClick:function(){return a.setSelected(t)}})))},a.allThumbs=function(){var e=[];return ha.getState().file&&ha.getState().file.map((function(t,n){return"image/png"===t.type&&e.push(a.classicImage(t,n)),null})),i.a.createElement("div",null,e)},a.allTiffsCanvas=function(){return a.canvas&&a.loadTiff(a.canvas.getContext("2d")),i.a.createElement("div",null,i.a.createElement("canvas",{ref:a.canvasRef,width:"500px",height:"500px",margin:"0px",id:"tiff-canvas"}))},a.selected=0,a.files=[],a.canvasRef=i.a.createRef(),a.canvas=null,a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.canvas=new y.fabric.Canvas(this.canvasRef.current)}},{key:"setSelected",value:function(e){this.selected!==e&&(ha.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{selected:e})})),this.selected=e)}},{key:"updateForFile",value:function(e){if(e&&e.file.length>0&&e.file.length!==this.files.length){for(var t=e.file.filter((function(e){return"image/tiff"===e.type})),n=this.files.length;n<t.length;n++){var a=t[t.length-1],i={rgba:a.rgba,width:a.image.width,height:a.image.height,page:a.pages[0],name:a.name,type:a.type};this.files.push(i)}this.forceUpdate()}}},{key:"shrinkTiff",value:function(e,t,n){var a=t.width,i=t.height,r=document.createElement("canvas");r.width=a,r.height=i,r.getContext("2d").putImageData(t,0,0);var s=60*n;e.drawImage(r,s,0,50,50)}},{key:"loadTiff",value:function(e){for(var t=0;t<this.files.length;t++){var n=this.files[t],a=null;if(n&&(a=n.page),a&&n.width>0&&n.height>0){for(var i=e.createImageData(n.width,n.height),r=0;r<a.length;r++)i.data[r]=a[r];this.shrinkTiff(e,i,t)}}}},{key:"display",value:function(){return i.a.createElement("div",null,this.allThumbs(),this.allTiffsCanvas())}},{key:"render",value:function(){var e=this;return ha.subscribe((function(t){e.updateForFile(t),e.forceUpdate()})),i.a.createElement("div",{id:"thumbsContainer"},this.display())}}]),n}(i.a.Component),Mi=n(343),Ti=n(355),Di=n(344),Vi=n(345),Ri=n(138);function Ni(e){var t=Object(a.useState)([]),n=Object(j.a)(t,2),r=n[0],s=n[1],l=Object(Ri.a)({accept:"image/png, image/tiff, .csv, .json",onDrop:function(e){s(e.map((function(e){return Object.assign(e,{preview:URL.createObjectURL(e)})})))}}),c=l.getRootProps,o=l.getInputProps,u=r.map((function(e){return Ln(e.name)&&(In()?function(e){"image/png"===e.type?xn(e):"image/tiff"===e.type?On(e):"text/csv"===e.type?Sn(e):"application/json"===e.type&&En(e)}(e):function(e){"image/png"===e.type?jn(e):"image/tiff"===e.type?wn(e):"text/csv"===e.type?kn(e):"application/json"===e.type&&Cn(e)}(e)),null}));return Object(a.useEffect)((function(){return function(){r.forEach((function(e){return URL.revokeObjectURL(e.preview)}))}}),[r]),i.a.createElement("section",{className:"container"},i.a.createElement("div",c({className:"dropzone"}),i.a.createElement("input",o()),e.name,Mn(r.length),u))}var Fi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={labelModalOpen:!1,classModalOpen:!1,imagePropModalOpen:!1,labelText:"",classText:"",imPropZText:"",imPropChText:"",imPropOrder:"1",alert:!1,alertType:0},a}return Object(c.a)(n,[{key:"displayFileMenu",value:function(){return i.a.createElement("div",null,i.a.createElement(Ii.a,{color:"primary",className:"import-btn"}," ",i.a.createElement(Ni,{name:"Import File"})," ")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"export-btn",onClick:vi}," ","Export Annotations"," ")," ","\xa0")}},{key:"displayDrawMenu",value:function(){return i.a.createElement("div",null,i.a.createElement(Ii.a,{color:"primary",className:"draw-rectangle-btn",onClick:function(e){return ui(fi.RECT)}},"Draw Rectangle")," ","\xa0")}},{key:"toggleLabel",value:function(){this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{labelModalOpen:!e.labelModalOpen})}))}},{key:"handleChangeLabel",value:function(e){if(e&&e.target&&(e.target.value||""===e.target.value)){var t=e.target.value;this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{labelText:t})}))}}},{key:"changeLabel",value:function(){qa(null,this.state.labelText),this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{labelText:""})})),this.toggleLabel()}},{key:"toggleClassLabel",value:function(){this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{classModalOpen:!e.classModalOpen})}))}},{key:"handleChangeClassLabel",value:function(e){if(e&&e.target&&(e.target.value||""===e.target.value)){var t=e.target.value;this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{classText:t})}))}}},{key:"changeClassLabel",value:function(){Ha(null,this.state.classText),this.toggleClassLabel(),this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{classText:""})}))}},{key:"toggleImageProp",value:function(){this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{imagePropModalOpen:!e.imagePropModalOpen,alert:!1})}))}},{key:"handleChangeImagePropZ",value:function(e){if(e&&e.target&&(e.target.value||""===e.target.value)){var t=e.target.value;this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{imPropZText:t})}))}}},{key:"handleChangeImagePropCh",value:function(e){if(e&&e.target&&(e.target.value||""===e.target.value)){var t=e.target.value;this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{imPropChText:t})}))}}},{key:"changeImageProp",value:function(){var e=ba(this.state.imPropOrder,parseInt(this.state.imPropChText),parseInt(this.state.imPropZText));0===e?(this.toggleImageProp(),this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{imPropChText:"",imPropZText:"",alert:!1})}))):this.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{alert:!0,alertType:e})}))}},{key:"handleChangeImageOption",value:function(e){if(e&&e.target&&(e.target.value||""===e.target.value)){var t=e.target.value;this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{imPropOrder:t})}))}}},{key:"displayAlert",value:function(){return 1===this.state.alertType?i.a.createElement(Mi.a,{color:"danger",isOpen:this.state.alert},"There are no images opened"):2===this.state.alertType?i.a.createElement(Mi.a,{color:"danger",isOpen:this.state.alert},"channels x slices != stack size"):3===this.state.alertType?i.a.createElement(Mi.a,{color:"danger",isOpen:this.state.alert},"channels must be between 1 and 10"):4===this.state.alertType?i.a.createElement(Mi.a,{color:"danger",isOpen:this.state.alert},"slices must be greater than 0"):void 0}},{key:"displayEditAnnotationLabel",value:function(){var e=this;return i.a.createElement(Ti.a,{isOpen:this.state.labelModalOpen,toggle:function(){return e.toggleLabel()},className:"label-modal"},i.a.createElement(Di.a,null,i.a.createElement("input",{type:"text",value:this.state.labelText,onChange:function(t){return e.handleChangeLabel(t)}}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(Ii.a,{onClick:function(){return e.changeLabel()}}," ","Change Label"," ")))}},{key:"displayEditAnnotationClass",value:function(){var e=this;return i.a.createElement(Ti.a,{isOpen:this.state.classModalOpen,toggle:function(){return e.toggleClassLabel()},className:"class-label-modal"},i.a.createElement(Di.a,null,i.a.createElement("input",{type:"text",value:this.state.classText,onChange:function(t){return e.handleChangeClassLabel(t)}}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(Ii.a,{onClick:function(){return e.changeClassLabel()}}," ","Change Class"," ")))}},{key:"displayEditImageProperties",value:function(){var e=this;return i.a.createElement(Ti.a,{isOpen:this.state.imagePropModalOpen,toggle:function(){return e.toggleImageProp()},className:"edit-image-properties-modal"},i.a.createElement(Di.a,null,this.state.alert&&this.displayAlert(),"Order:",i.a.createElement("select",{name:"im-prop-select-menu",value:this.state.imPropOrder,onChange:function(t){return e.handleChangeImageOption(t)}},i.a.createElement("option",{value:"1"}," xycz (default) "),i.a.createElement("option",{value:"2"}," xyzc ")),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("label",{for:"im-prop-ch-text"}," Channels (c): 1-10"),i.a.createElement("br",null),i.a.createElement("input",{id:"im-prop-ch-text",style:{boxSizing:"unset"},type:"text",value:this.state.imPropChText,onChange:function(t){return e.handleChangeImagePropCh(t)}}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("label",{for:"im-prop-z-text"}," Slices (z): "),i.a.createElement("br",null),i.a.createElement("input",{id:"im-prop-z-text",style:{boxSizing:"unset"},type:"text",value:this.state.imPropZText,onChange:function(t){return e.handleChangeImagePropZ(t)}}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(Ii.a,{onClick:function(){return e.changeImageProp()}}," ","OK "," ")))}},{key:"displayEditMenu",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement(Ii.a,{color:"primary",className:"undo-btn",onClick:function(e){return Xa()}},"Undo")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"redo-btn",onClick:function(e){return Ya()}},"Redo")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"delete-btn",onClick:function(e){return Za()}},"Delete")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"edit-label-btn",onClick:function(t){return e.toggleLabel()}},"Edit Label")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"edit-class-btn",onClick:function(t){return e.toggleClassLabel()}},"Edit Class")," ","\xa0",i.a.createElement(Ii.a,{color:"primary",className:"edit-image-properties-btn",onClick:function(t){return e.toggleImageProp()}},"Edit Image Properties")," ","\xa0",this.displayEditAnnotationLabel(),this.displayEditAnnotationClass(),this.displayEditImageProperties())}},{key:"render",value:function(){return i.a.createElement("div",{style:{padding:"15px 7px"}},i.a.createElement(Vi.a,{color:"light",light:!0,className:"navbar shadow-sm p-3 mb-0 bg-white rounded",expand:"md"},this.displayFileMenu(),this.displayDrawMenu(),this.displayEditMenu()))}}]),n}(i.a.Component),Pi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).file_size=0,e.annotations={},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return _t.subscribe((function(t){if(t&&e.file_size!==t.size)for(var n=0;n<t.file.length;n++){var a=t.file[n].json;a&&(Zt(a),e.file_size=t.size)}})),Wt.subscribe((function(t){e.annotations!==t.annotations&&(e.annotations=t.annotations)})),i.a.createElement("div",{id:"annotator-div"})}}]),n}(i.a.Component),Ui=n(346),Bi=n(347),_i=n(348),Wi=n(349),Gi=n(350),Xi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).files=[],a.canvasRef=i.a.createRef(),a.state={axes:["x","y","z"]},a.customSettings={order:"0",channels:0,slices:0},a.init(),a}return Object(c.a)(n,[{key:"init",value:function(){this.setState((function(e){return Object(x.a)(Object(x.a)({},e),{},{cntxt:null,rgb:0})})),this.fileLength=0,this.type=1,this.typeIsDefault=!0,this.sliceIdx=0,this.computedSlicedIdx=0,this.axisIdx=2,this.length=0,this.imgdata=null,this.updatedtexture=!0,this.volType=0,this.texture=null}},{key:"componentDidMount",value:function(){var e=new y.fabric.Canvas(this.canvasRef.current).getContext("2d");this.setState((function(t){return{cntxt:e}})),this.updateForFile(Wn.getState())}},{key:"updateFileList",value:function(e){for(var t=e.filter((function(e){return"image/tiff"===e.type})),n=this.files.length;n<t.length;n++){var a=t[t.length-1],i={rgba:a.rgba,width:a.image.width,height:a.image.height,length:a.pages.length,page:a.pages[0],name:a.name,type:a.type};this.files.push(i)}for(var r=e.filter((function(e){return"image/png"===e.type})),s=this.files.length;s<r.length;s++)this.files.push(r[s])}},{key:"updateLength",value:function(e,t){1===this.type?this.length=t/3:2===this.type?this.length=t:3===this.type?this.length=e:4===this.type?this.length=e/3:5===this.type?this.length=e:this.length=t}},{key:"getIdx",value:function(e){return 1===this.type?Math.max(e-1,0):2===this.type?parseInt(this.props.channel)-1:3===this.type||4===this.type||5===this.type?Math.max(e-1,0):void 0}},{key:"setVolume",value:function(e,t,n,a){ta(0,this.state.cntxt,e,0,this.state.axes,this.type,t,n,a),this.volume||(this.volume=Jn(0))}},{key:"setType",value:function(e,t){this.typeIsDefault&&(this.type=ia(e,t),Qn(this.type),this.typeIsDefault=!1)}},{key:"isValidPNGFile",value:function(e,t){return e.length>0&&e[t]&&e.length!==this.fileLength&&"image/png"===e[t].type}},{key:"updateForFile",value:function(e){if(ra(e,this.files.length)){var t=this.getIdx(e.file.length),n=e.file;if(sa(n,t,this.fileLength)){var a=n[t],i=a.image.width,r=a.image.height,s=n.length,l=a.pages.length;this.updateFileList(n),this.setType(n,a.metadata),this.updateLength(s,l),this.setVolume(n,i,r,l),this.fileLength=this.files.length,this.file=a,Yn(n[e.selected],this.props.channel),Kn(parseInt(this.props.channel)+3,this.length)}else this.isValidPNGFile(n,t)&&(this.updateFileList(n),this.type=5,this.updateLength(n.length,0),Yn(this.files[this.sliceIdx],this.props.channel),Kn(parseInt(this.props.channel)+3,this.length))}this.forceUpdate()}},{key:"updateForControls",value:function(e){var t=e.channels[this.props.channel-1].uniforms.image.value;t&&this.texture!==t&&(this.texture=t,this.forceUpdate())}},{key:"updateForSlice",value:function(e){if(e){this.updateCustomSettings();var t=e.sliceIndices[parseInt(this.props.channel)+3];this.sliceIdx!==t&&(this.computedSlicedIdx=this.computeSlice(parseInt(t)),this.type<5?(this.updateSlice(),this.loadTiff()):5===this.type&&Yn(this.files[parseInt(t)],this.props.channel),this.forceUpdate(),this.sliceIdx=t)}}},{key:"updateCustomSettings",value:function(){this.customSettings=$n(),0!==this.customSettings.order&&(this.order=this.customSettings.order,this.channelLength=this.customSettings.channels,this.sliceLength=this.customSettings.slices,this.length=this.sliceLength,this.channel=1,this.slice=0,this.forceUpdate())}},{key:"computeSlice",value:function(e){return"1"===this.order?e*this.channelLength+(this.props.channel-1):"2"===this.order?e+(this.props.channel-1)*this.sliceLength:1===this.type?3*e+(parseInt(this.props.channel)-1):2===this.type?e+(parseInt(this.props.channel)-1)*this.length:3===this.type||4===this.type?3*e+(parseInt(this.props.channel)-1):(this.type,e)}},{key:"updateSlice",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){var t;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.sliceIdx<this.length)){e.next=5;break}return e.next=3,aa(this.state.cntxt,this.volume,this.computedSlicedIdx,this.state.axes,this.axisIdx,!0);case 3:(t=e.sent)&&(this.volume.drawImage(this.state.cntxt,t),this.updatedtexture=!1,this.forceUpdate());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setImageData",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.volume||(this.volume=Jn(0)),!this.volume){e.next=5;break}return e.next=4,this.volume.getImageData();case 4:this.imgdata=e.sent;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setTexture",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.texture=ea(this.imgdata.data,this.imgdata.width,this.imgdata.height),Zn(this.file,this.texture,this.props.channel);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadTiff",value:function(){var e=Object(oe.a)(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updatedtexture||(this.setImageData(),this.imgdata&&this.imgdata.data.length>0&&(this.setTexture(),this.updatedtexture=!0));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"displayCanvas",value:function(){return this.loadTiff(),Gn.getState().canvas[this.props.channel-1]}},{key:"render",value:function(){var e=this;return Wn.subscribe((function(t){e.updateForFile(t),e.forceUpdate()})),_n.subscribe((function(t){e.updateForControls(t)})),Xn.subscribe((function(t){e.updateForSlice(t)})),this.displayCanvas()}}]),n}(i.a.Component),Yi=n(137),Zi=n(9),qi=n.n(Zi),Hi=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={displayColorPicker:!1,color:{r:"241",g:"112",b:"19",a:"1"}},e.handleClick=function(){e.setState({displayColorPicker:!e.state.displayColorPicker})},e.handleClose=function(){e.setState({displayColorPicker:!1})},e.handleChange=function(t){e.setState({color:t.rgb})},e.handleChangeComplete=function(t){e.setState({color:t.rgb}),e.props.onClick({color:t.hex})},e}return Object(c.a)(n,[{key:"render",value:function(){var e=qi()({default:{color:{width:"36px",height:"14px",borderRadius:"2px",background:"rgba(".concat(this.state.color.r,", ").concat(this.state.color.g,", ").concat(this.state.color.b,", ").concat(this.state.color.a,")")},swatch:{padding:"5px",background:"#fff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"absolute",zIndex:"2"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}}});return i.a.createElement("div",null,i.a.createElement("div",{style:e.swatch,onClick:this.handleClick},i.a.createElement("div",{style:e.color})),this.state.displayColorPicker?i.a.createElement("div",{style:e.popover},i.a.createElement("div",{style:e.cover,onClick:this.handleClose}),i.a.createElement(Yi.SketchPicker,{color:this.state.color,onChange:this.handleChange,onChangeComplete:this.handleChangeComplete})):null)}}]),n}(i.a.Component),Ji=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).updateSelection=function(){pi(e.props.ch),di(e.props.ch),e.forceUpdate()},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.channelSliceIdx=0,this.channelSliceLen=0}},{key:"sliderValueSlice",value:function(e){this.channelSliceIdx=e,ma(parseInt(this.props.ch)+3,e)}},{key:"updateForSliceLen",value:function(e){var t=0===e.slices?e.lengths[parseInt(this.props.ch)+3]:e.slices;this.channelSliceLen!==t&&(this.channelSliceLen=t,this.forceUpdate())}},{key:"sliderValueBr",value:function(e){Qa(e,this.props.ch)}},{key:"sliderValueCt",value:function(e){$a(e,this.props.ch)}},{key:"sliderValueWp",value:function(e){ei(e,this.props.ch)}},{key:"sliderValueBp",value:function(e){ti(e,this.props.ch)}},{key:"sliderValueOpc",value:function(e){ai(e,this.props.ch)}},{key:"colorValue",value:function(e){ni(e,this.props.ch)}},{key:"resetBrightness",value:function(){Qa("0.0",this.props.ch)}},{key:"resetContrast",value:function(){$a("0.0",this.props.ch)}},{key:"resetWhitepoint",value:function(){ei("255.0",this.props.ch)}},{key:"resetBlackpoint",value:function(){ti("0.0",this.props.ch)}},{key:"resetOpacity",value:function(){ai("0.0",this.props.ch)}},{key:"render",value:function(){var e=this;pa.subscribe((function(t){e.updateForSliceLen(t)}));var t=this.sliderValueBr,n=this.sliderValueCt,a=this.sliderValueWp,r=this.sliderValueBp,s=this.sliderValueOpc,l=this.colorValue,c="Ch"+this.props.ch+" Histogram",o=i.a.createElement(Xi,{className:"annot-view",alt:c,height:"200px",channel:this.props.ch,style:Ia}),u=E.getState().channels[this.props.ch-1].selected;return console.log("Channel "+this.props.ch+" : "+u),i.a.createElement("div",null,i.a.createElement(Ii.a,{className:"channelBtn",outline:!0,color:"primary",id:"channel-btn",onClick:function(){e.updateSelection()},active:u},"Channel ","".concat(this.props.ch)),"\xa0",i.a.createElement(Ii.a,{className:"viewBtn",outline:!0,color:"secondary",id:"view".concat(this.props.ch)},"View"),i.a.createElement(Li.a,{toggler:"#view".concat(this.props.ch)},i.a.createElement(v.a,{style:ka},i.a.createElement(m.a,{style:Ea},i.a.createElement("div",{className:"channel-slice-slider-container"},i.a.createElement(wi,{label:"",width:"40%",min:"0",max:Math.max(this.channelSliceLen-1,0),step:"1",initial:"0",multiplier:"1",raw:"1",sliderValue:this.sliderValueSlice.bind(this)})),i.a.createElement("div",null," Slice: ",this.channelSliceIdx," "),i.a.createElement("div",null,"Channel Color"),i.a.createElement(Hi,{color:l.bind(this),onClick:l.bind(this)}),i.a.createElement("br",null),i.a.createElement("div",{className:"opacity-slider-container"},i.a.createElement(wi,{label:"Opacity",width:"40%",min:"0.0",max:"1.0",step:"0.1",initial:"0",multiplier:"100",raw:"0",sliderValue:s.bind(this)}),i.a.createElement("button",{id:"resetOpcBtn",onClick:function(){e.resetOpacity()}},"Reset Channel Opacity")),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("div",{className:"brightness-slider-container"},i.a.createElement(wi,{label:"Brightness",width:"40%",min:"0",max:"1",step:"0.1",initial:"0",multiplier:"100",raw:"0",sliderValue:t.bind(this)}),i.a.createElement("button",{id:"resetBrBtn",onClick:function(){e.resetBrightness()}},"Reset Brightness")),i.a.createElement("div",{className:"contrast-slider-container"},i.a.createElement(wi,{label:"Contrast",width:"40%",min:"0",max:"10",step:"1",initial:"0",multiplier:"10",raw:"0",sliderValue:n.bind(this)}),i.a.createElement("button",{id:"resetCtBtn",onClick:function(){e.resetContrast()}},"Reset Contrast")),i.a.createElement("div",{className:"whitepoint-slider-container"},i.a.createElement(wi,{label:"Whitepoint",width:"40%",min:"0",max:"255",step:"1",initial:"255",multiplier:"1",raw:"1",sliderValue:a.bind(this)}),i.a.createElement("button",{id:"resetWpBtn",onClick:function(){e.resetWhitepoint()}},"Reset Whitepoint")),i.a.createElement("div",{className:"blackpoint-slider-container"},i.a.createElement(wi,{label:"Blackpoint",width:"40%",min:"0",max:"255",step:"1",initial:"0",multiplier:"1",raw:"1",sliderValue:r.bind(this)}),i.a.createElement("button",{id:"resetBpBtn",onClick:function(){e.resetBlackpoint()}},"Reset Blackpoint")),i.a.createElement("div",{style:Ca},o)))))}}]),n}(i.a.Component),Ki=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={active:"1",channels:3},a}return Object(c.a)(n,[{key:"toggle",value:function(e){this.setState({active:e})}},{key:"navs",value:function(){for(var e=this,t=[],n=function(){var n=(a+1).toString();t.push(i.a.createElement(Ui.a,null,i.a.createElement(Bi.a,{active:e.state.active===n,onClick:function(){e.toggle(n)}},"Channel ",n)))},a=0;a<this.state.channels;a++)n();return t}},{key:"content",value:function(){for(var e=[],t=0;t<this.state.channels;t++){var n=(t+1).toString();e.push(i.a.createElement(_i.a,{tabId:n},i.a.createElement(v.a,{style:ka},i.a.createElement(m.a,{style:Ea},i.a.createElement(g.a,null," ",i.a.createElement("h5",null," Channel ",n," ")," "),i.a.createElement(Ji,{ch:n})))))}return e}},{key:"updateCustomSettings",value:function(e){this.setState((function(t){return Object(x.a)(Object(x.a)({},t),{},{channels:e})}))}},{key:"render",value:function(){var e=this;return pa.subscribe((function(t){e.updateCustomSettings(t.channels)})),i.a.createElement("div",{className:"annotations-channel"},i.a.createElement(Wi.a,{tabs:!0,style:{color:"white"}},this.navs()),i.a.createElement(Gi.a,{activeTab:this.state.active},this.content()))}}]),n}(i.a.Component),Qi=n(351),$i=n(352),er=n(353),tr=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement("div",{className:"main",style:h},i.a.createElement(Qi.a,{fluid:!0,style:p},i.a.createElement($i.a,{style:{justifyContent:"space-between"}},i.a.createElement(er.a,{xs:"auto"},i.a.createElement(Fi,null)),i.a.createElement(er.a,{xs:"auto"},i.a.createElement("h3",{style:{color:"#fff",verticalAlign:"center",padding:"15px 7px"}},"BRMLIA")))),i.a.createElement(Qi.a,{style:d},i.a.createElement($i.a,{style:f},i.a.createElement(er.a,{xs:"4"},i.a.createElement(Ci,null),i.a.createElement(Ai,null)),i.a.createElement(er.a,{xs:"8"},i.a.createElement(zi,null),i.a.createElement(ki,null),i.a.createElement(Ki,null)))),i.a.createElement(Pi,null))}}]),n}(i.a.Component);function nr(){return i.a.createElement("div",null,i.a.createElement(tr,null))}var ar=document.getElementById("root");s.a.render(i.a.createElement(nr,null),ar)}},[[139,1,2]]]);
//# sourceMappingURL=main.6095bd4c.chunk.js.map