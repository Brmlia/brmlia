{"version":3,"sources":["ui/styles/style.js","mainSettings.js","fileuploader/fileStore.js","annotator/annotationStore.js","imagecanvas/ImageStore.js","utils/index.js","datacube/volumeStore.js","datacube/volumeControl.js","datacube/cachedImageData.js","cache/cache.js","datacube/datacube.js","datacube/volume.js","imagecanvas/Mesh.js","imagecanvas/canvasStore.js","imagecanvas/CanvasControl.js","datacube/datacubeControls.js","fileuploader/fileParser.js","imagecanvas/index.js","imagecanvas/canvasUtils.js","annotator/annotationControl.js","annotator/annotationSettings.js","annotator/index.js","annotator/annotationMenuOptions.js","annotator/annotationEditor.js","fabric/index.js","annotator/annotationClass.js","fabric/fabricControl.js","fileuploader/fileControl.js","fileuploader/index.js","fileuploader/fileImporter.js","ui/components/index.js","ui/components/FabricLayer.js","ui/styles/thumbnailStyle.js","ui/styles/mainStyle.js","ui/styles/channelStyle.js","ui/styles/annotatorStyle.js","ui/styles/axisStyle.js","fileuploader/fileExporter.js","ui/components/zoom/zoomSettings.js","ui/components/slider.js","ui/components/mainTiffViewer.js","ui/components/mainViewer.js","ui/components/axisTiffViewer.js","ui/components/axesViewer.js","ui/components/annotatorViewer.js","ui/components/thumbnails.js","fileuploader/fileUploader.js","ui/components/menus.js","annotator/annotator.js","imagecanvas/ImageCanvas.js","ui/components/colorPicker.js","ui/components/channel.js","ui/components/channelViewer.js","ui/index.js","index.js"],"names":["mainStyle","height","width","position","rowStyle","flex","mainMenuStyle","justifyContent","padding","containerStyle","fluid","maxWidth","initState","channels","selected","lastSelected","dev","create","set","settingsApi","prodState","file","size","total","devState","name","style","display","type","getState","fileApi","annotations","redoState","redoAnnotations","undoState","undoAnnotations","annotApi","redoApi","undoApi","createTexture","image","THREE","load","uniforms","brightness","value","contrast","whitepoint","blackpoint","opacity","color","texture","update","state","uniApi","fApi","uApi","volumes","sliceIndices","lengths","volApi","getVolume","index","console","debug","saveVolume","volume","setState","prevState","map","vol","j","updateVolume","updateType","CachedImageData","context","this","cache","createImageData","getFiles","filename","a","caches","open","then","cacheObj","match","response","log","resp","getArrayBuffer","arrayBuffer","content","saveFiles","sw","text","navigator","storage","estimate","quota","tQuota","usage","catch","err","error","setTimeout","Response","put","alert","DataCube","args","bytes","x","y","z","canvas_context","cube","materialize","cached_imgdata","clean","loaded","faces","serviceWorker","window","addEventListener","register","ready","registerWorker","axis","face","ArrayType","arrayType","imgdata","offsetx","offsety","offsetz","_this","data32","Uint32Array","buffer","mask","true","1","2","4","false","isLittleEndian","sizex","zadj","invertV","copy","_cube","getCube","_cached_cube","Uint8ClampedArray","Error","xsize","ysize","zsize","xysize","square","byteoffset","i","length","buf","slice","zoffset","yoffset","transparency","faceDimensions","sizes","getImageData","data","alpha","arr32","arr8","Uint8Array","islittle","r","g","b","Uint16Array","undefined","ctnt","Volume","channel","ctx","grayImageSlice","pixels","slice32","putImageData","loadVolume","insertImageData","Mesh","props","ref","useRef","material","useMemo","useFrame","current","scale","attach","fragmentShader","vertexShader","meshState","mesh","canvasState","canvas","className","canvasApi","isValidChannel","updateTexture","blob","prevStateCh","imagepath","updateUniformImage","ch","newChannel","stateApi","loadSlices","cntxt","axes","files","fileIdx","_loadSlicesFromMultipageFile","_loadSlicesFromMultipleFiles","updateChannelSlice","renderChannelSlice","_loadVolumes","pages","pIdx","page","pct","Math","round","fIdx","ProgressBar","Progress","striped","bar","subscribe","Component","parseMetadata","metadata","fileLength","pageLength","channelLength","tType","determineType","parseInt","filesNeedUpdate","areFilesValid","idx","cvsApi","vApi","updateImage","updText","createT","saveVol","getVol","updateSliceLength","len","updType","generateTexture","genText","initializeVolume","initVol","ldSlices","updSlice","parseMd","filesNeedUpd","areFilesVal","cacheCube","imageData","needsUpdate","createAnnotation","group","label","classLabel","rect","id","class","top","left","scaleX","scaleY","createDummyAnnotation","addAnnotation","annotation","addDummyUndoAnnotation","addAnnotationToUndoState","deleteAnnotation","splice","deleteUndoAnnotation","getLastAnnotIdx","getLastUndoAnnot","getLastUndoAnnotIdx","updateAnnotationCoords","annotationGroup","_objects","menu","displayon","coords","items","callback","setDisplay","updateSelect","objects","select","AnnotationMenuApi","colors","drawFreeStyle","isMouseDown","isDrawingMode","freeDrawingBrush","drawRect","fRect","fabric","Rect","fill","stroke","strokeLineJoin","strokeWidth","objectCaching","outerRect","util","object","clone","Group","on","e","o","target","setCoords","constrain","IText","fontSize","originX","originY","fontFamily","fontWeight","textBackgroundColor","classText","perPixelTargetFind","add","setActiveObject","addWithUpdate","updateLabel","obj","getSelectedObjects","oldLabel","ungroup","objs","updateAnnotationLabel","getCanvas","renderAll","updateGroup","regroup","updateClassLabel","updateAnnotClassLabel","_restoreObjectsState","remove","item","hasControls","outline","filterAnnotations","enabled","getObjects","class_element","label_element","markGroupVisible","markGroupInvisible","discardActiveObject","markVisible","visible","dirty","delAnnot","annot","tAnnot","getAnnotationByLabel","idxToRemoveFromUndo","idxToRemoveFromAnnotations","removeFromCanvas","moveAnnotation","annotationTo","annotationFrom","requestRenderAll","dRect","dFreeSty","isDisplayOn","setDisp","setMenuCoords","setSelectedObjects","addAnnot","getLastAnnot","getLastSelectedClass","annotClassApi","lastSel","modes","RECT","FREE","SELECT","NONE","layers","mouse","down","origin","drawMode","nextId","fabricApi","setMode","newMode","finishDrawingRect","setFabricCoords","abs","getActiveObjects","canvasLeft","_offset","canvasRight","canvasTop","canvasBottom","relX","relY","aApi","unApi","reApi","addAnnotationFromJson","json","undoAnnotation","addAnnotationToRedoState","lastUndoAnno","getLstCdAnt","newAnnot","getAnnotationClasses","classes","push","redoAnnotation","deleteRedoAnnotation","sel","drawR","fabApi","addClass","enableClass","cls","newCls","isDuplicateClass","filter","img","initPng","preview","addPng","initTiff","importTiff","addTiff","initCsv","importCsv","addCsv","initJson","importJson","addJson","isFirstFile","isValidFile","validFile","saveJson","result","f","newFile","updateTiffPages","findIndex","saveTotalNumOfFiles","reader","FileReader","onload","fileAsBinaryString","csv","noheader","output","fromString","csvRows","toJson","forEach","aCsvRow","builtObject","Object","keys","aKey","valueToAddInBuiltObject","keyToAddInBuiltObject","onabort","onerror","readAsText","JSON","parse","onloadend","event","ifds","UTIF","decode","decodeImage","rgba","toRGBA8","Image","tlines","String","t270","split","tSpl","key","parseMultiTiff","onprogress","readAsArrayBuffer","updateSliceIndex","sliceIdx","thumbStyle","borderRadius","border","marginBottom","marginRight","boxSizing","thumbInnerStyle","minWidth","overflow","mainCanvasStyle1","zIndex","mainCanvasStyle2","mainCanvasStyle3","channelViewStyle","channelCardStyle","justify","alignContent","alignItems","textAlign","channelCardBodyStyle","channelCanvasStyle","channelImageCanvasStyle","annotViewStyle","annotCardStyle","overflowX","annotLayerStyle","mainViewStyle","mainCardStyle","axisViewStyle","axisCardStyle","flexWrap","axisCardBodyStyle","updateClasses","getClasses","toggleClassEnable","num","annotClsApi","filterClasses","filtAnnot","showAll","drawFr","undo","redo","redoAnnot","del","updLbl","updClsLbl","setCanvas","updateBrightness","updateUniformBrightness","updateContrast","updateUniformContrast","updateWhitepoint","updateUniformWhitepoint","updateBlackpoint","updateUniformBlackpoint","updateColor","updateUniformColor","updateOpacity","updateUniformOpacity","openMenu","startDrawing","setOrigin","startDrawingRect","startSelecting","finish","addToFabric","annots","setFabricCanvas","setMd","mds","updateChannelSel","updateLastSel","exportJson","element","document","createElement","newAnnots","stringify","convertToExportableJson","Blob","href","URL","createObjectURL","download","body","appendChild","click","FabricLayer","canvasRef","React","createRef","handleMouseDown","bind","handleMouseUp","handleMouseDoubleClick","handleDrag","selectClass1","showAllClasses","handleMoveAnnotation","handleModifyAnnotation","Canvas","fireRightClick","options","finishMoving","selection","mode","clientX","clientY","button","handleRightMouseDown","handleLeftMouseDown","handleRightMouseUp","handleLeftMouseUp","forceUpdate","onContextMenu","preventDefault","innerWidth","innerHeight","displayMenu","zoomState","views","zoomPct","zoomZppPct","reset","last","useZoomApi","Slider","initSlider","initial","min","max","step","handleSliderChange","persist","slider","updateStatus","notifyValue","updated","setSlider","sync","status","sliderValue","raw","multiplier","onChange","displayValue","mainTiffViewer","axisIdx","channelSliceIdx","typeIsDefault","getContext","isValidTiffFile","setType","setVolume","updateSlice","isValidPNGFile","updateFileList","drawPNG","src","drawImage","clearRect","pngFiles","refreshImage","computeSlice","val","sliderValueChannel","updateForFile","sliderValueSlice","drawChannelSlider","mainViewer","alt","view1","view2","view3","channelViews","canvasView","Card","CardBody","CardTitle","TiffViewer","dec","clamp","onClick","nextSlice","AxesViewer","AnnotatorViewer","futureClass","futureAnnotClass","annotClasses","enables","annotCls","includes","Button","UncontrolledCollapse","toggler","displayClassList","divs","active","updateAnnotClasses","updateEnables","Thumbnails","classicImage","setSelected","allThumbs","elements","allTiffsCanvas","loadTiff","margin","tiffFiles","imgW","imgH","newC","shrinkTiff","FileUpload","useState","setFiles","useDropzone","accept","onDrop","acceptedFiles","assign","getRootProps","getInputProps","initFile","addFile","useEffect","revokeObjectURL","Menus","labelModalOpen","classModalOpen","labelText","newStr","toggleLabel","toggleClassLabel","Modal","isOpen","toggle","ModalBody","handleChangeLabel","changeLabel","handleChangeClassLabel","changeClassLabel","displayEditAnnotationLabel","displayEditAnnotationClass","Navbar","light","expand","displayFileMenu","displayDrawMenu","displayEditMenu","Annotator","file_size","ImageCanvas","init","rgb","computedSlicedIdx","updatedtexture","volType","getIdx","updateLength","setImageData","setTexture","updateForControls","updateForSlice","displayCanvas","ColorPicker","displayColorPicker","handleClick","handleClose","handleChange","handleChangeComplete","hex","styles","reactCSS","default","background","swatch","boxShadow","cursor","popover","cover","right","bottom","onChangeComplete","Channel","updateSelection","channelSliceLen","updateForSliceLen","sliderValueBr","sliderValueCt","sliderValueWp","sliderValueBp","sliderValueOpc","colorValue","resetOpacity","resetBrightness","resetContrast","resetWhitepoint","resetBlackpoint","ChannelViewer","Row","Col","sm","UI","Container","xs","verticalAlign","Application","rootElement","getElementById","ReactDOM","render"],"mappings":"kTAAaA,EAAY,CACvBC,OAAQ,OACRC,MAAO,OACPC,SAAU,YAECC,EAAW,CACtBC,KAAM,EACNF,SAAU,YAcCG,EAAgB,CAC3BJ,MAAO,OACPG,KAAM,GACNE,eAAgB,gBAChBC,QAAS,EACTL,SAAU,YAGCM,EAAiB,CAC5BC,OAAO,EACPC,SAAU,Q,iEC7BCC,EAAY,CACvBC,SAAU,CACR,CACEC,UAAU,GAEZ,CACEA,UAAU,GAEZ,CACEA,UAAU,IAGdC,aAAc,EACdC,IAAK,G,EAGuCC,aAAO,SAAAC,GAAG,sBACnDN,M,mBAD0BO,G,WCZxB,IAIMC,EAAY,CACvBC,KAAM,GACNC,KAAM,EACNR,SAAU,EACVS,MAAO,GAGIC,EAAW,CACtBH,KAAM,CACJ,CACEI,KAAM,YAENC,MAAO,CACLC,QAAS,QACTzB,MAAO,OACPD,OAAQ,QAEV2B,KAAM,cAGVN,KAAM,EACNR,SAAU,EACVS,MAAO,G,EAG8BN,aAAO,SAAAC,GAAG,sBA5BxCC,EAAYU,WAAWb,IAAMQ,EAAWJ,M,mBA4BrBU,G,WCjCtBlB,EAAY,CAChBmB,YAAa,IAGTC,EAAY,CAChBC,gBAAiB,IAGbC,EAAY,CAChBC,gBAAiB,I,EAGsBlB,aAAO,SAAAC,GAAG,sBAC9CN,M,mBADwBwB,G,aAIUnB,aAAO,SAAAC,GAAG,sBAC5Cc,M,mBADuBK,G,aAIYpB,aAAO,SAAAC,GAAG,sBAC7CgB,M,mBADwBI,G,mBCnBhBC,EAAgB,SAAAC,GAC3B,OAAO,IAAIC,iBAAsBC,KAAKF,IAYlC5B,EAAY,CAChBC,SAAU,CACR,CACE8B,SAAU,CACRC,WAAY,CACVC,MAAO,OAETC,SAAU,CACRD,MAAO,OAETE,WAAY,CACVF,MAAO,SAETG,WAAY,CACVH,MAAO,OAETI,QAAS,CACPJ,MAAO,OAETK,MAAO,CACLL,MAAO,IAETL,MAAO,CACLK,MAAO,KAGXM,QAAS,KACT1B,KAAM,GACNG,KAAM,IAER,CACEe,SAAU,CACRC,WAAY,CACVC,MAAO,OAETC,SAAU,CACRD,MAAO,OAETE,WAAY,CACVF,MAAO,SAETG,WAAY,CACVH,MAAO,QAETI,QAAS,CACPJ,MAAO,OAETK,MAAO,CACLL,MAAO,IAETL,MAAO,CACLK,MAAO,KAGXM,QAAS,KACT1B,KAAM,GACNG,KAAM,IAER,CACEe,SAAU,CACRC,WAAY,CACVC,MAAO,OAETC,SAAU,CACRD,MAAO,OAETE,WAAY,CACVF,MAAO,SAETG,WAAY,CACVH,MAAO,QAETI,QAAS,CACPJ,MAAO,OAETK,MAAO,CACLL,MAAO,IAETL,MAAO,CACLK,MAAO,KAGXM,QAAS,KACT1B,KAAM,GACNG,KAAM,IAER,CACEe,SAAU,CACRC,WAAY,CACVC,MAAO,OAETC,SAAU,CACRD,MAAO,OAETE,WAAY,CACVF,MAAO,SAETG,WAAY,CACVH,MAAO,QAETI,QAAS,CACPJ,MAAO,OAETK,MAAO,CACLL,MAAO,IAETL,MAAO,CACLK,MAAO,KAGXM,QAAS,KACT1B,KAAM,GACNG,KAAM,M,EAK6BX,aAAO,SAAAC,GAAG,kCAC9CN,GAD8C,IAEjDwC,OAAQ,SACNR,EACAE,EACAC,EACAC,EACAC,EACAC,EACAV,GAPM,OASNtB,GAAI,SAAAmC,GAAK,kCACJA,GADI,IAEPV,SAAS,2BACJU,EAAMV,UADH,IAENC,WAAW,2BACNS,EAAMV,SAASC,YADV,IAERC,MAAOD,IAETE,SAAS,2BACJO,EAAMV,SAASG,UADZ,IAEND,MAAOC,IAETC,WAAW,2BACNM,EAAMV,SAASI,YADV,IAERF,MAAOE,IAETC,WAAW,2BACNK,EAAMV,SAASK,YADV,IAERH,MAAOG,IAETC,QAAQ,2BACHI,EAAMV,SAASM,SADb,IAELJ,MAAOI,IAETC,MAAM,2BACDG,EAAMV,SAASO,OADf,IAEHL,MAAOK,IAETV,MAAM,eACDa,EAAMV,SAASH,SAGtBW,QAASX,EACTI,WAAYA,a,mBA5CaU,G,WChIlBC,EAAOzB,EACP0B,EAAOF,ECCd1C,EAAY,CAEhB6C,QAAS,CACP,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFC,aAAc,CACZ,EACA,EACA,EACA,EACA,EACA,EACA,GAEFC,QAAS,CACP,EACA,EACA,EACA,EACA,EACA,EACA,GAEF/B,KAAM,G,EAGgCX,aAAO,SAAAC,GAAG,sBAC7CN,M,oBADyBgD,I,sBCtCvB,SAASC,GAAUC,GAExB,OADAC,QAAQC,MAAM,wCAAyCF,EAAOF,GAAO/B,WAAW4B,QAAS,KAClFG,GAAO/B,WAAW4B,QAAQK,GA4B5B,SAASG,GAAWH,EAAOI,IAf3B,SAAsBJ,EAAOI,GAClCN,GAAOO,UAAS,SAAAC,GAQd,MAAO,CACLX,QARcW,EAAUX,QAAQY,KAAI,SAACC,EAAKC,GAC1C,OAAIA,IAAMT,EACDI,EAEAI,SAUbE,CAAaV,EAAOI,GAiCf,SAASO,GAAW7C,GACzBgC,GAAOO,UAAS,SAAAC,GAAS,kCACpBA,GADoB,IAEvBxC,KAAMA,O,gCClDK8C,G,WAlBb,WAAYC,GAAU,oBACpBC,KAAKD,QAAUA,EACfC,KAAKC,MAAQ,K,yDAGF3E,EAAOD,GASlB,OAPG2E,KAAKC,OACND,KAAKC,MAAM3E,QAAUA,GACrB0E,KAAKC,MAAM5E,SAAWA,IAEtB2E,KAAKC,MAAQD,KAAKD,QAAQG,gBAAgB5E,EAAOD,IAG5C2E,KAAKC,U,cCKDE,G,mFAAf,WAAwBC,GAAxB,kBAAAC,EAAA,sEAGQC,OAAOC,KAAK,cAAcC,MAAK,SAACP,GACpCQ,EAAWR,KAJf,WAMMQ,EANN,gCAOUA,EAASC,MAAMN,GAClBI,MAAK,SAASG,GACbxB,QAAQyB,IAAI,qBAAsBD,GAClCE,EAAOF,KAVf,gCAaSE,GAbT,4C,sBA0CO,SAAeC,GAAtB,mC,gDAAO,WAA8BV,GAA9B,kBAAAC,EAAA,sEAEcF,GAASC,GAFvB,YAECS,EAFD,wCAIGA,EAAKE,cACRP,MAAK,SAACO,GACLC,EAAUD,KANX,cASL5B,QAAQyB,IAAI,yBAA0BI,GATjC,kBAWEA,GAXF,4C,sBA4BA,SAASC,GAAUC,EAAId,EAAUe,GAkBtC,IAAIV,EAcJ,OA9BIS,GAAME,UAAUC,SAClBD,UAAUC,QAAQC,WAAWd,MAAK,SAACe,GACjC,IAAMC,EAASD,EAAMA,MACfE,EAAQF,EAAME,MACpBtC,QAAQC,MAAM,uDAAwDoC,EAAQC,EAAQA,EAAMD,EAAS,QAEpGE,OAAM,SAACC,GACNxC,QAAQyC,MAAM,iCAAkCD,MAEjDnB,MAAK,WACJqB,YAAW,WACT1C,QAAQyB,IAAI,OACX,QAKTN,OAAOC,KAAK,cAAcC,MAAK,SAACP,GAE9B,GADAQ,EAAWR,EACG,CACZ,IAAMU,EAAW,IAAImB,SAASX,GAE9BhC,QAAQyB,IAAI,kBAAmBH,EAAUE,EAAUQ,GACnDV,EAASsB,IAAI3B,EAAUO,GACpBe,OAAM,SAACC,GACNxC,QAAQyC,MAAR,0BAAiCD,EAAI9E,KAArC,SAAkD8E,GAClDK,MAAM,2DAIPvB,E,ICsKMwB,G,WA5Rb,WAAaC,GAAO,oBAClBlC,KAAKmC,MAAQD,EAAKC,OAAS,EAC3BnC,KAAKtD,KAAOwF,EAAKxF,MAAQ,CAAE0F,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAC9CtC,KAAKuC,eAAiBL,EAAKnC,QAC3BC,KAAKwC,KAAOxC,KAAKyC,cAEjBzC,KAAK0C,eAAiB,IAAI5C,GAAgBE,KAAKuC,gBAC/CvC,KAAK2C,OAAQ,EACb3C,KAAK4C,QAAS,EAEd5C,KAAK6C,MAAQ,CACXT,EAAG,CAAE,IAAK,KACVC,EAAG,CAAE,IAAK,KACVC,EAAG,CAAE,IAAK,MAEZtC,KAAKkB,GDlBF,WACL,IAAMA,EAAKE,UAAU0B,cAerB,OAbI5B,GACF6B,OAAOC,iBAAiB,QAAQ,WAC9B9B,EAAG+B,SAAS,UACTzC,MAAK,kBAAMU,EAAGgC,SACd1C,MAAK,WACJrB,QAAQyB,IAAI,mCAEbc,OAAO,SAAAE,GACNzC,QAAQyB,IAAI,+BAAgCgB,SAK7CV,ECEKiC,G,2DAGIC,GACd,IAAIC,EAAOrD,KAAK6C,MAAMO,GACtB,MAAO,CACLpD,KAAKtD,KAAK2G,EAAK,IACfrD,KAAKtD,KAAK2G,EAAK,O,oCAKjB,IAAIC,EAAYtD,KAAKuD,YAEjB7G,EAAOsD,KAAKtD,KAEhB,OAAO,IAAI4G,EAAU5G,EAAK0F,EAAI1F,EAAK2F,EAAI3F,EAAK4F,K,iFAGvBkB,EAASlI,EAAOmI,EAASC,EAASC,G,oFAkCvD,IAhCIC,EAAQ5D,KAOR6D,EAAS,IAAIC,YALJN,EAKuBO,QAkB9BC,EAbM,CACVC,KAAM,CACJC,EAAG,IACHC,EAAG,MACHC,EAAG,YAELC,MAAO,CACLH,EAAG,WACHC,EAAG,WACHC,EAAG,aAIYpE,KAAKsE,kBAAkBtE,KAAKmC,OAE3CC,EAAI,EAAGC,EAAI,EAETkC,EAAuB,EAAfX,EAAMlH,KAAK0F,EACvBoC,EAAQb,EAAUC,EAAMlH,KAAK0F,EAAIwB,EAAMlH,KAAK2F,EAAK,EAE9CA,EAAI/G,EAAQ,EAAG+G,GAAK,EAAGA,IAC1B,IAAKD,EAAI9G,EAAQ,EAAG8G,GAAK,EAAGA,IAE1BwB,EAAMpB,KACHiB,EAAUrB,EAAKmC,GAASb,EAAUrB,GAAKmC,GACtCX,EAAQzB,EAAIC,EAAI/G,GAAU0I,E,OAIlCJ,EAAMjB,OAAQ,E,kBAEP3C,M,uLAGIoD,EAAMlE,EAAOuF,G,6IAASC,I,iCAC7Bd,EAAQ5D,MAGRA,KAAKwC,K,gBACPmC,EAAQ3E,KAAKwC,K,uCAGYxC,KAAK4E,U,OAA1BC,E,OACJF,EAAQ,IAAIG,kBAAkBD,G,aAE5B3F,EAAQ,GAAKA,GAASc,KAAKtD,KAAK0G,I,uBAC5B,IAAI2B,MAAM7F,EAAQ,sB,WAGpB8F,EAAQpB,EAAMlH,KAAK0F,EACvB6C,EAAQrB,EAAMlH,KAAK2F,EACnB6C,EAAQtB,EAAMlH,KAAK4F,EAEf6C,EAASH,EAAQC,EAEnB5B,EAAOrD,KAAK6C,MAAMO,GAClBE,EAAYtD,KAAKuD,YAEjB6B,EAAS,IAAI9B,EAAUtD,KAAKtD,KAAK2G,EAAK,IAAMrD,KAAKtD,KAAK2G,EAAK,KAC3DgC,EAAanG,EAAQiG,EAASnF,KAAKmC,MAKnCmD,EAAIF,EAAOG,OAAS,GACpBd,E,oBACW,MAATrB,E,qBACEsB,E,wBACEc,EAAMb,EAAMZ,OAAO0B,MAAMJ,EAAYA,EAAaF,EAASnF,KAAKmC,O,kBAC7D,IAAImB,EAAUkC,I,QAKrB,IAFIF,EAAIF,EAAOG,OAAS,EAClBG,EAAUP,EAASjG,EAChBmD,EAAI,EAAGA,EAAI4C,EAAQ,EAAG5C,IAC7B,IAASD,EAAI4C,EAAQ,EAAG5C,GAAK,IAAKA,EAChCgD,EAAOE,GAAKX,EAAMvC,EAAI4C,EAAQ3C,EAAIqD,KAChCJ,E,QAKV,GAAa,MAATlC,EACF,IAASd,EAAI,EAAGA,EAAI4C,EAAQ,EAAG5C,IAC7B,IAASD,EAAI4C,EAAQ,EAAG5C,GAAK,IAAKA,EAChC+C,EAAOE,GAAKX,EAAMzF,EAAQ8F,EAAQ3C,EAAI8C,EAAS7C,KAC7CgD,OAIH,GAAa,MAATlC,EAIP,IADMuC,EAAUX,EAAQ9F,EACfoD,EAAI,EAAGA,EAAI4C,EAAQ,EAAG5C,IAC7B,IAASF,EAAI4C,EAAQ,EAAG5C,GAAK,IAAKA,EAChCgD,EAAOE,GAAKX,EAAMvC,EAAIuD,EAAUR,EAAS7C,KACvCgD,E,2BAMK,MAATlC,E,0CACK,IAAIE,EAAUqB,EAAMZ,OAAQsB,EAAYF,I,QAEjD,GAAa,MAAT/B,EACF,IAASd,EAAI4C,EAAQ,EAAG5C,GAAK,IAAMA,EACjC,IAASD,EAAI4C,EAAQ,EAAG5C,GAAK,IAAKA,EAChC+C,EAAOE,GAAKX,EAAMzF,EAAQ8F,EAAQ3C,EAAI8C,EAAS7C,KAC7CgD,OAIH,GAAa,MAATlC,EAIL,IADIuC,EAAUX,EAAQ9F,EACboD,EAAI4C,EAAQ,EAAG5C,GAAK,IAAMA,EACnC,IAASF,EAAI4C,EAAQ,EAAG5C,GAAK,IAAKA,EAChCgD,EAAOE,GAAKX,EAAMvC,EAAIuD,EAAUR,EAAS7C,KACvCgD,E,iCAKHF,G,4LAGahC,EAAMlE,EAAOuF,G,yGAASmB,E,gCAAoBlB,I,0CAE3C1E,KAAKyF,MAAMrC,EAAMlE,EAAOuF,GAAkB,G,cAAzDW,E,gBAEcpF,KAAK6F,eAAezC,G,UAAlC0C,E,QAEUpB,E,kCACJ1E,KAAKuC,eAAerC,gBAAgB4F,EAAM,GAAIA,EAAM,I,6DACpD9F,KAAK0C,eAAeqD,aAAaD,EAAM,GAAIA,EAAM,I,4BAU3D,GAZItC,E,KAIAK,EAAS,IAAIC,YAAYN,EAAQwC,KAAKjC,QAEpCkC,EAAQjG,KAAKsE,iBACf,WACA,IAEAgB,EAAI,EAEJM,EACF,IAAKN,EAAIF,EAAOG,OAAS,EAAGD,GAAK,EAAGA,IAClCzB,EAAOyB,GAAMF,EAAOE,GAAMF,EAAOE,IAAM,EAAMF,EAAOE,IAAM,IAAOF,EAAOE,IAAMW,QAIhF,IAAKX,EAAIF,EAAOG,OAAS,EAAGD,GAAK,EAAGA,IAClCzB,EAAOyB,GAAMF,EAAOE,GAAMF,EAAOE,IAAM,EAAMF,EAAOE,IAAM,GAAMW,E,yBAI7DzC,G,mJAKP,IAAI0C,EAAQ,IAAIpC,YAAY,GACxBqC,EAAO,IAAIC,WAAWF,EAAMnC,QAChCmC,EAAM,GAAK,IAEX,IAAIG,EAAwB,MAAZF,EAAK,GAIrB,OAFAnG,KAAKsE,eAAiB,kBAAM+B,GAErBA,I,yCAqBP,MAfe,CACbpC,KAAM,CACJqC,EAAG,IACHC,EAAG,MACHC,EAAG,SACHnG,EAAG,YAELgE,MAAO,CACLiC,EAAG,WACHC,EAAG,SACHC,EAAG,MACHnG,EAAG,MAISL,KAAKsE,oB,kCAGrB,IAMIhB,EANU,CACZY,EAAGY,kBACHX,EAAGsC,YACHrC,EAAGN,aAGmB9D,KAAKmC,OAE7B,QAAkBuE,IAAdpD,EACF,MAAM,IAAIyB,MAAM/E,KAAKmC,MAAQ,2CAG/B,OAAOmB,I,wKAIWtD,KAAK6F,eAAe,K,cAAlCC,E,gBACS9F,KAAK0C,eAAeqD,aAAaD,EAAM,GAAIA,EAAM,I,0SAM5DN,EADExF,KAAKwC,KAAKuB,OACN/D,KAAKwC,KAAKuB,OAGV/D,KAAKwC,K,SAEPvB,GAAUjB,KAAKkB,GAAI,mBAAoBsE,G,OAC7CxF,KAAKwC,KAAO,K,yQAKN1B,GAAe,oBAAoBN,MAAK,SAACmG,GAC7C3F,EAAU2F,K,gCAEL3F,G,wGC3RE4F,GAAb,WACE,WAAa1E,GAAO,oBAClB/C,QAAQC,MAAM,mBAAoB8C,GAClClC,KAAK6G,QAAU3E,EAAK2E,QAHxB,0GAM4BC,EAAK1D,EAAMqC,EAAOhB,GAN9C,qFAOQb,EAAQ5D,KAPhB,SASuB4D,EAAMiD,QAAQE,eAAe3D,EAAMqC,EAAOhB,GAA0B,GAAgB,GAT3G,cASQuC,EATR,gBAUwB,IAAIlD,YAAYkD,EAAOhB,KAAKjC,QAVpD,OAYI,IAFIkD,EAVR,OAYa3B,EAAI2B,EAAQ1B,OAAS,EAAGD,GAAK,EAAGA,IACvC2B,EAAQ3B,GAAoB,SAAb2B,EAAQ3B,IAAoB2B,EAAQ3B,GAbzD,iBAgBUwB,EAAII,aAAaF,EAAQ,EAAG,GAhBtC,iCAiBWhH,MAjBX,oLAmBc+D,EAAQzI,EAAOmK,GAnB7B,kFAoBUzF,KAAKmH,WAAWnH,KAAK6G,QAAS9C,EAAQzI,EAAOmK,GApBvD,uLAsBoBjD,EAAMuB,EAAQzI,EAAOmK,GAtBzC,kFAuBUjD,EAAK4E,gBAAgBrD,EAAQzI,EAAO,EAAG,EAAGmK,GAvBpD,0QA2BiBzF,KAAK6G,QAAQd,eA3B9B,qJ,SCgJesB,OAlDf,SAAcC,GACZ,IAAMC,EAAMC,mBACNC,EAAWD,mBACbzJ,EAAW2J,mBACb,kBAAM9I,GAAK3B,WAAWhB,SAASqL,EAAMT,QAAU,GAAG9I,WAClD,CAACuJ,IA+BH,OAJAK,cAAS,SAAAlJ,GAvBPgJ,EAASG,QAAQ7J,SAASC,WAAWC,MAAQW,GAAK3B,WAAWhB,SAC3DqL,EAAMT,QAAU,GAChB9I,SAASC,WAAWC,MACtBwJ,EAASG,QAAQ7J,SAASG,SAASD,MAAQW,GAAK3B,WAAWhB,SACzDqL,EAAMT,QAAU,GAChB9I,SAASG,SAASD,MACpBwJ,EAASG,QAAQ7J,SAASI,WAAWF,MAAQW,GAAK3B,WAAWhB,SAC3DqL,EAAMT,QAAU,GAChB9I,SAASI,WAAWF,MACtBwJ,EAASG,QAAQ7J,SAASK,WAAWH,MAAQW,GAAK3B,WAAWhB,SAC3DqL,EAAMT,QAAU,GAChB9I,SAASK,WAAWH,MACtBwJ,EAASG,QAAQ7J,SAASM,QAAQJ,MAAQW,GAAK3B,WAAWhB,SACxDqL,EAAMT,QAAU,GAChB9I,SAASM,QAAQJ,MACnBwJ,EAASG,QAAQ7J,SAASH,MAAMK,MAAQW,GAAK3B,WAAWhB,SACtDqL,EAAMT,QAAU,GAChB9I,SAASH,MAAMK,MACjBwJ,EAASG,QAAQ7J,SAASO,MAAML,MAAQW,GAAK3B,WAAWhB,SACtDqL,EAAMT,QAAU,GAChB9I,SAASO,MAAML,SAQjB,0BAAMsJ,IAAKA,EAAKM,MAAO,CAAC,EAAK,EAAK,IAChC,yCAAqBC,OAAO,WAAW5F,KAAM,CAAC,EAAK,KACnD,oCACE4F,OAAO,WACPP,IAAKE,EACLM,eAlIY,g7DAmIZC,aApDU,gJAqDVjK,SAAUA,MCtILkK,GAAY,CACvBC,KAAM,CAAC,kBAAC,GAAD,CAAMrB,QAAQ,MAAQ,kBAAC,GAAD,CAAMA,QAAQ,MAAQ,kBAAC,GAAD,CAAMA,QAAQ,MAAQ,kBAAC,GAAD,CAAMA,QAAQ,Q,GAGlDxK,aAAO,SAAAC,GAAG,sBAC5C2L,O,qBAGQE,I,YAAc,CACzBC,OAAQ,CACN,kBAAC,KAAD,CAAQC,UAAW,kBAAmBJ,GAAUC,KAAK,IACrD,kBAAC,KAAD,CAAQG,UAAW,kBAAmBJ,GAAUC,KAAK,IACrD,kBAAC,KAAD,CAAQG,UAAW,kBAAmBJ,GAAUC,KAAK,IACrD,kBAAC,KAAD,CAAQG,UAAW,qBAAsBJ,GAAUC,KAAK,O,GAIjB7L,aAAO,SAAAC,GAAG,sBAChD6L,O,qBADyBG,I,aCf9B,SAASC,GAAe1B,GACtB,OACEjI,GAAK3B,YACL2B,GAAK3B,WAAWhB,SAASsJ,OAAS,GAClCsB,GAAW,GACXjI,GAAK3B,WAAWhB,SAAS4K,EAAU,IACnCjI,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASG,UAC/CU,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASC,YAC/CY,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASO,MAiI5C,SAASkK,GAAc/L,EAAM8B,EAASsI,GAC3C,IAAIhK,EAAOJ,EAAKI,KACZ4L,EAAOhM,EAAKmB,MAEV8K,EAAc9J,GAAK3B,WAAWhB,SAAS4K,EAAU,GAGrD6B,EAAY7L,OAASA,GACrB6L,EAAYC,YAAcF,GAC1BC,EAAY3K,SAASH,MAAMK,QAAUM,GAErCqK,GAAmBrK,EAAS1B,EAAM4L,EAAM5B,GAIrC,SAAS+B,GAAmBrK,EAAS1B,EAAM8L,EAAW9B,GAC3DjI,GAAKW,UAAS,SAAAC,GAaZ,MAAO,CACLvD,SAbeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAKjB,OAHAC,EAAWjM,KAAOA,EAClBiM,EAAWH,UAAYA,EACvBG,EAAW/K,SAASH,MAAMK,MAAQM,EAC3BuK,EAEP,OAAOD,S,cCpKTpK,GAAQ,CACZmE,OAAQ,G,GAEmBvG,aAAQ,SAAAC,GAAG,sBACnCmC,O,qBADYsK,I,aAIV,SAAeC,GAAtB,+C,gDAAO,WAA0BC,EAAO3J,EAAQ4J,EAAM9F,EAAM+F,EAAOnM,EAAMoM,GAAlE,UAAA/I,EAAA,yDACQ,IAATrD,EADC,gCAEGqM,GAA6BJ,EAAO3J,EAAQ4J,EAAM9F,EAAM+F,EAAMC,IAFjE,6CAKGE,GAA6BL,EAAO3J,EAAQ4J,EAAM9F,EAAM+F,GAL3D,4C,sBASA,SAAeI,GAAtB,6C,gDAAO,WAAkCN,EAAO3J,EAAQmG,EAAOyD,EAAM9F,EAAMqB,GAApE,UAAApE,EAAA,2DACD4I,GAAS3J,GAAU4J,GADlB,gCAEG5J,EAAOkK,mBAAmBP,EAAOC,EAAK9F,GAAOqC,EAAOhB,GAFvD,4C,+BAMQgF,G,uFAAf,WAA4BnK,EAAQoK,EAAOpO,GAA3C,oBAAA+E,EAAA,sDACWsJ,EAAO,EADlB,YACqBA,EAAOD,EAAMnE,QADlC,wBAEUqE,EAAOF,EAAMC,IAEbE,EAAMC,KAAKC,MAAOJ,GAAMD,EAAMnE,OAAO,GAAI,MACpC,KAAQ,GACjBwD,GAASxJ,SAAS,CAChBqD,OAAQiH,IAPhB,SAYUvK,EAAOxB,KAAK8L,EAAMtO,EAAOqO,GAZnC,OAC0CA,IAD1C,4D,+BAgBeN,G,2FAAf,WAA4CJ,EAAO3J,EAAQ4J,EAAM9F,EAAM3G,GAAvE,UAAA4D,EAAA,2DACM5D,GAASA,EAAKiN,OAAWjN,EAAKiN,MAAMnE,OAAS,GADnD,gCAEUkE,GAAanK,EAAQ7C,EAAKiN,MAAOjN,EAAKmB,MAAMtC,OAFtD,OAKEiO,GAAmBN,EAAO3J,EAAQ,EAAG4J,EAAM9F,GAAM,GALnD,4C,+BAQekG,G,2FAAf,WAA4CL,EAAO3J,EAAQ4J,EAAM9F,EAAM+F,GAAvE,0BAAA9I,EAAA,sDACW2J,EAAO,EADlB,YACqBA,EAAOb,EAAM5D,QADlC,uBAEU9I,EAAO0M,EAAMa,KACNvN,EAAKiN,OAAWjN,EAAKiN,MAAMnE,OAAS,GAHrD,iBAIYmE,EAAQjN,EAAKiN,MACVC,EAAO,EALtB,YAKyBA,EAAOD,EAAMnE,QALtC,wBAMcqE,EAAOF,EAAMC,GACbjE,EAAWsE,EAAQN,EAAMnE,OAAUoE,EAPjD,UAQcrK,EAAOxB,KAAK8L,EAAMnN,EAAKmB,MAAMtC,MAAOoK,GARlD,QAK8CiE,IAL9C,uBAUMJ,GAAmBN,EAAO3J,EAAQ,EAAG4J,EAAM9F,GAAM,GAVvD,QAC0C4G,IAD1C,4D,0BA4CeC,G,4MA3BbxL,MAAQ,CACNmE,OAAQ,G,EAGV7F,QAAU,WACR,OAA0B,MAAtB,EAAK0B,MAAMmE,OAEX,kBAACsH,GAAA,EAAD,CAAUC,SAAO,EAACC,KAAG,EAACnM,MAAO,EAAKQ,MAAMmE,QAAxC,IAAkD,EAAKnE,MAAMmE,OAA7D,MAKA,mC,uDAKI,IAAD,OAIP,OAHAmG,GAASsB,WAAU,SAAA5L,GACjB,EAAKA,MAAMmE,OAASnE,EAAMmE,UAG1B5C,KAAKjD,c,GAxBeuN,aCvDnB,SAASC,GAAc9N,EAAM+N,GAAW,IAG3CvO,EAEEuO,EAFFvO,SA6BF,OA5CF,SAAuBwO,EAAYC,EAAYC,GAC7C,IAAIC,EAAQ,EAQZ,OAN0B,IAAfH,GAAwC,IAAlBE,GAAyBD,EAAe,EAAKE,EAAQ,EAC5D,IAAfH,GAAwC,IAAlBE,GAAyBD,EAAe,EAAKE,EAAQ,EAC3EH,EAAe,GAA+C,IAAfC,EAAoBE,EAAQ,EAC3EH,EAAe,GAA+C,IAAfC,IAAoBE,EAAQ,GAEtFzL,QAAQyB,IAAI,wDAAyDgK,EAAOH,EAAYC,EAAYC,GAC7FC,EAmCAC,CAzBYpO,EAAK8I,OACL9I,EAAK,GAAGiN,MAAMnE,OACXuF,SAAS7O,GAAY,IA0BtC,SAAS8O,GAAgBtM,EAAO8G,GACrC,OACE9G,GACIA,EAAMhC,KAAK8I,OAAS,GACpB9G,EAAMhC,KAAK8I,SAAWA,GACtB9G,EAAM9B,QAAU8B,EAAM/B,KAIvB,SAASsO,GAAc7B,EAAO8B,EAAK1F,GACxC,OACG4D,EAAM5D,OAAS,GACf4D,EAAM8B,IACN9B,EAAM8B,GAAKvB,OACXP,EAAM8B,GAAKvB,MAAMnE,OAAS,GAC1B4D,EAAM5D,SAAWA,ECff,IAAM3G,GAAwBF,EACxBC,GAAwBzB,EACxBoL,GAAwB4C,GACxBlM,GAAwBmM,GACxBC,GHsEN,SAAqB3O,EAAMoK,GAChC,IAAIhK,EAAOJ,EAAKI,KACZ4L,EAAOhM,EAAKmB,MACZW,EAAU9B,EAAK8B,QAEH,KAAZA,IACgB,eAAd9B,EAAKO,OAGPuB,EAAUZ,GAAc8K,KAG5B,IAAMC,EAAc9J,GAAK3B,WAAWhB,SAAS4K,EAAU,GAGrD6B,EAAY7L,OAASA,GACrB6L,EAAYC,YAAcF,GAC1BC,EAAY3K,SAASH,MAAMK,QAAUM,GAErCqK,GAAmBrK,EAAS1B,EAAM4L,EAAM5B,IGxF/B2B,GAAwB6C,GACxB1N,GAAwB2N,EAExBjM,GAAwBkM,GACxBtM,GAAwBuM,GACxBC,GVNN,SAA2B5E,EAAStB,GACzCvG,GAAOO,UAAS,SAAAC,GAQd,MAAO,CACLT,QARcS,EAAUT,QAAQU,KAAI,SAACiM,EAAK/L,GAC1C,OAAIA,IAAMkH,EACDtB,EAEAmG,UUCF7L,GAAwB8L,GACxBC,GAAwBC,GAExBC,GAAwBC,GACxB/C,GAAwBgD,GACxBzC,GAAwB0C,GACxB1B,GAAwB2B,GACxBnB,GAAwBoB,GACxBnB,GAAwBoB,GCpD9B,SAAeN,GAAtB,mD,gDAAO,WAAgCb,EAAKhC,EAAOE,EAAOC,EAASF,EAAMlM,EAAM1B,EAAOD,EAAQkK,GAAvF,kBAAAlF,EAAA,yDAEApB,GAAUgM,GAFV,wBAGCzI,EAAO,CACTJ,EAAG,IACHC,EAAG,IACHC,EAAG,MAEAF,EAAI9G,EACTkH,EAAKH,EAAIhH,EACTmH,EAAKF,EAAIiD,EAELjG,EAAS,IAAIsH,GAAO,CACtBC,QAAS,IAAI5E,GAAS,CACpBE,MAAO,EACPzF,KAAM8F,EACNzC,QAASkJ,MAGb5J,GAAW4L,EAAK3L,GAnBb,SAqBG0J,GACJC,EACA3J,EACA4J,EACA,EACAC,EACAnM,EACAoM,GA5BC,wBA+BG9J,EAAOuH,QAAQwF,YA/BlB,QAgCHlN,QAAQC,MAAM,iHAAkH6L,EAAK7B,EAASpM,EAAM1B,EAAOD,EAAQkK,GAhChK,6C,sBA2CA,SAASqG,GAAgBU,EAAWhR,EAAOD,GAChD,IAAM2K,EAAO,IAAII,WAAWkG,GAExB/N,EAAW,IAAIV,cAAkBmI,EAAM1K,EAAOD,EAAQwC,cAE1D,OADAU,EAAQgO,aAAc,EACfhO,ECrDF,SAASiO,GAAiBC,EAAOC,EAAOC,EAAYC,EAAMC,GAE/D,MAAO,CACLA,GAAIA,EACJJ,MAAOA,EACPC,MAAOA,EACPI,MAAOH,GALa,SAMpBC,KAAM,CACJG,IAAKH,EAAKG,IACVC,KAAMJ,EAAKI,KACX1R,MAAOsR,EAAKtR,MACZD,OAAQuR,EAAKvR,OACb4R,OAAQR,EAAMQ,OACdC,OAAQT,EAAMS,SAKb,SAASC,GAAsBN,GACpC,MAAO,CAAEA,GAAIA,GAGR,SAASO,GAAcC,GAC5B7P,GAAS+B,UAAS,SAAAC,GAAS,kCACtBA,GADsB,IAEzBrC,YAAY,GAAD,oBAAMqC,EAAUrC,aAAhB,CAA6BkQ,SAkCrC,SAASC,GAAuBD,GACrCE,GAAyBF,GAGpB,SAASE,GAAyBF,GACvC3P,GAAQ6B,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExBjC,gBAAgB,GAAD,oBAAMiC,EAAUjC,iBAAhB,CAAiC8P,SAW7C,SAASG,GAAiBtO,GAC/B1B,GAAS+B,UAAS,SAAAC,GAChB,OAAOA,EAAUrC,YAAYsQ,OAAOvO,EAAO,MAIxC,SAASwO,GAAqBxO,GACnCxB,GAAQ6B,UAAS,SAAAC,GACf,OAAOA,EAAUjC,gBAAgBkQ,OAAOvO,EAAO,MAmC5C,SAASyO,KACd,OAAOnQ,GAASP,WAAWE,YAAYoI,OAAS,EAG3C,SAASqI,KACd,OAAOlQ,GAAQT,WAAWM,gBACxBG,GAAQT,WAAWM,gBAAgBgI,OAAS,GAIzC,SAASsI,KACd,OAAOnQ,GAAQT,WAAWM,gBAAgBgI,OAAS,EAa9C,SAASuI,GAAuBC,GAErC,IADA,IAAM5Q,EAAcK,GAASP,WAAWE,YAC/BmI,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IACtC,GAAIyI,IAAoB5Q,EAAYmI,GAAGmH,MAAO,CAC5Cc,GAAyBpQ,EAAYmI,IACrC,IAAMsH,EAAO,CACXtR,MAAOyS,EAAgBzS,MACvBD,OAAQ0S,EAAgB1S,OACxB0R,IAAKgB,EAAgBhB,IACrBC,KAAMe,EAAgBf,MAGxBI,GACEZ,GACEuB,EACAA,EAAgBC,SAAS,GAAG7M,KAC5B4M,EAAgBC,SAAS,GAAG7M,KAC5ByL,EACAzP,EAAYmI,GAAGuH,KAInBW,GAAiBlI,IC3KhB,IAAMtJ,GAAY,CACvBiS,KAAM,CACJC,WAAW,EACXC,OAAQ,CACN/L,EAAG,EACHC,EAAG,GAEL+L,MAAO,CACL,CACE1B,MAAO,kBACP2B,SCsED,WCzELC,IAAW,GACXC,GAAa,KFIT,CACE7B,MAAO,aACP2B,SCqED,WCxELC,IAAW,GACXC,GAAa,KFIT,CACE7B,MAAO,SACP2B,SCoED,WCtELC,IAAW,GACXC,GAAa,MFIXC,QAAS,GACTC,OAAQ,EACRrG,OAAQ,O,GAI0C/L,aAAO,SAAAC,GAAG,sBAC3DN,O,qBAD4B0S,I,aAmB1B,SAASJ,GAAWrQ,GACzByQ,GAAkBnP,UAAS,SAAAC,GAAS,kCAC/BA,GAD+B,IAElCyO,KAAK,2BACAzO,EAAUyO,MADX,IAEFC,UAAWjQ,SG9BV,IAAM0Q,GAAS,CACpB,2BACA,2BACA,2BACA,2BACA,0BACA,yBAGK,SAASC,GAAcxG,EAAQ9J,GACpCyE,OAAOqF,OAASA,EAChBA,EAAOyG,aAAc,EAErBzG,EAAO0G,eAAgB,EACvB1G,EAAO2G,iBAAiBzQ,MAAQqQ,GAAO,GACvCvG,EAAO2G,iBAAiBzT,MAAQ,GAG3B,SAAS0T,GAAS5G,EAAQwE,EAAMF,EAAOC,GAC5C,KAAIC,EAAKG,KAAO,GAAKH,EAAKI,MAAQ,GAAKJ,EAAKtR,OAAS,GAAKsR,EAAKvR,QAAU,GAAzE,CAIA,IAAI4T,EAAQ,IAAIC,SAAOC,KAAK,CAC1BnC,KAAMlC,SAAS8B,EAAKI,MACpBD,IAAKjC,SAAS8B,EAAKG,KACnBzR,MAAOwP,SAAS8B,EAAKtR,OACrBD,OAAQyP,SAAS8B,EAAKvR,QACtB+T,KAAMT,GAAO,GACbU,OAAQV,GAAO,GACfW,eAAgB,QAChBC,YAAa,EACbC,eAAe,IAGbC,EAAYP,SAAOQ,KAAKC,OAAOC,MAAMX,GACzCQ,EAAUnT,IAAI,CACZ0Q,KAAMiC,EAAMjC,KAAO,EACnBD,IAAKkC,EAAMlC,IAAM,EACjBzR,MAAO2T,EAAM3T,OAA6B,EAApB2T,EAAMM,YAAkB,GAC9ClU,OAAQ4T,EAAM5T,QAA8B,EAApB4T,EAAMM,YAAkB,GAChDF,OAAQV,GAAO,GACfY,YAAa,IAGf,IAAI9C,EAAQ,IAAIyC,SAAOW,MAAM,CAACJ,IAC9BhD,EAAMqD,GAAG,UAAU,SAASC,IAyC9B,SAAmBC,EAAG5H,GACpB,IAAMqE,EAAQuD,EAAEC,OACVR,EAAYhD,EAAMuB,SAAS,GAE7BvB,EAAMO,KAAO,GACfP,EAAMnQ,IAAI,OAAQmT,EAAUF,YAAc,GAC1C9C,EAAMyD,aACGzD,EAAMO,KAAOP,EAAMnR,MAAQ8M,EAAO9M,QAC3CmR,EAAMnQ,IAAI,OAAQ8L,EAAO9M,MAAQmR,EAAMnR,MAAQmU,EAAUF,YAAc,GACvE9C,EAAMyD,aAGJzD,EAAMM,IAAM,GACdN,EAAMnQ,IAAI,MAAOmT,EAAUF,YAAc,GACzC9C,EAAMyD,aACGzD,EAAMM,IAAMN,EAAMpR,OAAS+M,EAAO/M,SAC3CoR,EAAMnQ,IAAI,MAAO8L,EAAO/M,OAASoR,EAAMpR,OAASoU,EAAUF,YAAc,GACxE9C,EAAMyD,aAzDNC,CAAUJ,EAAG3H,MAGf,IAAIjH,EAAO,IAAI+N,SAAOkB,MAAM1D,EAAO,CACjC2D,SAAU,GACVC,QAAS,OACTC,QAAS,MACTC,WAAY,QACZC,WAAY,OACZrB,KAAM,QACNsB,oBAAqB/B,GAAO,GAC5B5B,IAAKN,EAAMM,IAAMkC,EAAMM,YACvBvC,KAAMP,EAAMO,KAAOiC,EAAMM,cAIvBoB,EAAY,IAAIzB,SAAOkB,MAAMzD,GADX,SACwC,CAC5D0D,SAAU,GACVC,QAAS,OACTC,QAAS,SACTC,WAAY,QACZC,WAAY,OACZrB,KAAM,QACNsB,oBAAqB/B,GAAO,GAC5B5B,IAAKN,EAAMM,IAAMN,EAAMpR,OAASoU,EAAUF,YAC1CvC,KAAMP,EAAMO,KAAOiC,EAAMM,cAY3B,OATInH,IACF6G,EAAM2B,oBAAqB,EAC3BxI,EAAOyI,IAAIpE,GACXrE,EAAO0I,gBAAgBrE,GACvBA,EAAMsE,cAAc5P,GACpBsL,EAAMsE,cAAcJ,GACpBlE,EAAMsE,cAAc9B,IAGfxC,GAwBF,SAASuE,GAAYC,EAAKvE,GAC/B,IAAIiD,EAASsB,EACRtB,IACHA,EAASuB,MAGX,IAAIC,EAAW,GACf,GAAIxB,GAAUjD,IACZ0E,GAAQzB,GAEJA,GAAQ,CACV,IAAI0B,EAAO1B,EAAO3B,SAClB,GAAIqD,GAAQA,EAAK9L,OAAS,EACxB,IAAK,IAAID,EAAI,EAAG+L,EAAK9L,OAAQD,IAAK,CAChC,IAAI+L,EAAK/L,GAaP,OAZA,GAAU,IAANA,GACE+L,EAAK/L,GAAGnE,KAOV,OANAgQ,EAAWE,EAAK/L,GAAGnE,KACnBkQ,EAAK/L,GAAGnE,KAAOuL,EACf4E,GAAsBH,EAAUzE,GAChC6E,KAAYC,iBAEZC,GADiBC,GAAQ/B,GACHjD,KAa/B,SAASiF,GAAiBV,EAAKvE,GACpC,IAAIiD,EAASsB,EACRtB,IACHA,EAASuB,MAGX,IAAIC,EAAW,GACf,GAAIxB,GAAUjD,IACZ0E,GAAQzB,GAEJA,GAAQ,CACV,IAAI0B,EAAO1B,EAAO3B,SAClB,GAAIqD,GAAQA,EAAK9L,OAAS,EACxB,IAAK,IAAID,EAAI,EAAG+L,EAAK9L,OAAQD,IAAK,CAChC,IAAI+L,EAAK/L,GAaP,OAZA,GAAU,IAANA,GACE+L,EAAK/L,GAAGnE,KAOV,OANAgQ,EAAWE,EAAK/L,GAAGnE,KACnBkQ,EAAK/L,GAAGnE,KAAOuL,EACfkF,GAAsBT,EAAUzE,GAChC6E,KAAYC,iBAEZC,GADiBC,GAAQ/B,GACH0B,EAAK,GAAGlQ,QAavC,SAASiQ,GAAQzB,GACtB,IAAIvH,EAASmJ,KACTnD,EAAQuB,EAAO3B,SACnB,GAAII,GAAUA,EAAM7I,QAAU,EAAI,CAChCoK,EAAOkC,uBACPzJ,EAAO0J,OAAOnC,GACd,IAAK,IAAIrK,EAAI,EAAGA,EAAI8I,EAAM7I,OAAQD,IAChC8C,EAAOyI,IAAIzC,EAAM9I,IACjB8C,EAAO2J,KAAK3J,EAAO1L,OAAS,GAAGsV,aAAc,EAE/C5J,EAAOoJ,aAIJ,SAASE,GAAQ/B,GACtB,GAAIA,GAAqC,IAA3BA,EAAO3B,SAASzI,OAAc,CAC1C,IAAI8L,EAAO1B,EAAO3B,SAEdiE,EAAUZ,EAAK,GACf3E,EAAQ2E,EAAK,GACb1E,EAAa0E,EAAK,GAClBzE,EAAOyE,EAAK,GAEZ5E,EAAQ,IAAIyC,SAAOW,MAAM,CAACoC,EAASvF,EAAOC,EAAYC,IACtDxE,EAASmJ,KASb,OARInJ,IACFA,EAAOyI,IAAIpE,GACXrE,EAAO0J,OAAOG,GACd7J,EAAO0J,OAAOpF,GACdtE,EAAO0J,OAAOnF,GACdvE,EAAO0J,OAAOlF,GACdxE,EAAO0I,gBAAgBrE,IAElBA,GAQJ,SAASyF,GAAkBvF,EAAYwF,GAG5C,IAFA,IAAI/J,EAASmJ,KACTF,EAAOjJ,EAAOgK,aACT9M,EAAI,EAAGA,EAAI+L,EAAK9L,OAAQD,IAAK,CACpC,IAAImH,EAAQ4E,EAAK/L,GACjB,GAAImH,EAEF,GADqBA,EAAMuB,SACP,CAClB,IAAIqE,EAAgB5F,EAAMuB,SAAS,GAC/BsE,EAAgB7F,EAAMuB,SAAS,GAC/BqE,GAAiBA,EAAclR,MAC7BkR,EAAclR,OAASwL,IACrBwF,EACFI,GAAiB9F,EAAO6F,EAAcnR,OAEtCqR,GAAmB/F,GACnBrE,EAAOqK,yBAOnBrK,EAAOoJ,YAsBF,SAASe,GAAiB9F,EAAOC,GACtC0E,GAAQ3E,GAGR,IADA,IAAI4E,EAAO5E,EAAMuB,SACR1I,EAAI,EAAGA,EAAI+L,EAAK9L,OAAQD,IAAK,CAEpCoN,GADUrB,EAAK/L,IACE,GAInBmM,GADiBC,GAAQjF,GACHC,GAGjB,SAAS8F,GAAmB/F,GACjC2E,GAAQ3E,GAGR,IADA,IAAI4E,EAAO5E,EAAMuB,SACR1I,EAAI,EAAGA,EAAI+L,EAAK9L,OAAQD,IAAK,CAEpCoN,GADUrB,EAAK/L,IACE,GAEnBoM,GAAQjF,GAGV,SAASgF,GAAYhF,EAAOC,GAE1B,IADA,IAAIvP,EAAcK,EAASP,WAAWE,YAC7BmI,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IAClCnI,EAAYmI,GAAGoH,QAAUA,IAC3BvP,EAAYmI,GAAGmH,MAAQA,GAK7B,SAASiG,GAAYzB,EAAK0B,GACxB1B,EAAI0B,QAAUA,EACd1B,EAAI2B,OAAQ,EACZrB,KAAYC,YAGP,SAASqB,GAASxF,GACvB,IAAIyF,EAAQzF,EACZ,IAAKA,EAAY,CACf,IAAM4D,EAAMC,KACZ,GAAID,GAAOA,EAAIjD,SAASzI,OAAS,EAAG,CAClC,IAAMmH,EAAQuE,EAAIjD,SAAS,GAAG7M,KACxB4R,EAASC,GAAqBtG,GAChCqG,IACFD,EAAQ,CAAC,GAAMC,EAAOlG,MAU5B,IALA,IAAM1P,EAAcK,EAASP,WAAWE,YAClCI,EAAkBG,EAAQT,WAAWM,gBACvC0V,EAAsB,KACtBC,EAA6B,KAExB5N,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IAClCwN,GAAS3V,EAAYmI,IAAOnI,EAAYmI,GAAGuH,KAAOiG,EAAMjG,KAC1DsG,GAAiBhW,EAAYmI,IAC7B2N,EAAsB3N,GAEpBwN,GAASvV,EAAgB+H,IAAO/H,EAAgB+H,GAAGuH,KAAOiG,EAAMjG,KAClEqG,EAA6B5N,GAQjC,OAJAiI,GAAyBpQ,EAAY8V,IACrC7F,GAAc7P,EAAgB2V,IAC9B1F,GAAiByF,GACjBvF,GAAqBwF,GACd,KAGT,SAASE,GAAeC,EAAcC,GACpC,IAAIlL,EAASmJ,KAEb8B,EAAa5G,MAAMnQ,IAAI,CACrByQ,IAAKuG,EAAe1G,KAAKG,IACzBC,KAAMsG,EAAe1G,KAAKI,KAC1B1R,MAAOgY,EAAe1G,KAAKtR,MAC3BD,OAAQiY,EAAe1G,KAAKvR,OAC5B4R,OAAQqG,EAAe1G,KAAKK,OAC5BC,OAAQoG,EAAe1G,KAAKM,SAE9BmG,EAAa5G,MAAMyD,YACnB9H,EAAOmL,mBACPnL,EAAO0I,gBAAgBuC,EAAa5G,OAGtC,SAAS0G,GAAiB9F,GACxB,IAAIjF,EAASmJ,KACbnJ,EAAO0J,OAAOzE,EAAWZ,OACzBrE,EAAOmL,mBC5WF,IAAMvE,GAAWwE,GACX5E,GAAgB6E,GAChBC,GJeN,WACL,OAAOhF,GAAkBzR,WAAWgR,KAAKC,WIf9BI,GAAaqF,GACbC,GJ0CN,SAAuBxR,EAAGC,GAC/BqM,GAAkBnP,UAAS,SAAAC,GAAS,kCAC/BA,GAD+B,IAElCyO,KAAK,2BACAzO,EAAUyO,MADX,IAEFE,OAAQ,CACN/L,EAAGA,EACHC,EAAGA,WIhDEwR,GJ0DN,SAA4BrF,GACjCE,GAAkBnP,UAAS,SAAAC,GAAS,kCAC/BA,GAD+B,IAElCyO,KAAK,2BACAzO,EAAUyO,MADX,IAEFO,QAASA,UI9DFpB,GAAgB0G,GAChBnG,GAAkBoG,GAClBC,GCuFN,WACL,OAAOC,GAAchX,WAAWiX,SC3FrBC,GAAQ,CACnBC,KAAM,YACNC,KAAM,YACNC,OAAQ,SACRC,KAAM,QAGFvY,GAAY,CAChBwY,OAAQ,GACRC,MAAO,CACLrS,EAAG,EACHC,EAAG,EACHqS,MAAM,GAERC,OAAQ,CACNvS,EAAG,EACHC,EAAG,GAELuS,SAAUT,GAAMC,KAChBS,OAAQ,EACRzM,OAAQ,M,GAG4B/L,aAAO,SAAAC,GAAG,sBAC3CN,O,qBADoB8Y,I,aAkBlB,SAASC,GAAQC,GACtBF,GAAUvV,UAAS,SAAAC,GAAS,kCACvBA,GADuB,IAE1BoV,SAAUI,OAIVF,GAAU7X,WAAWmL,OAAO0G,cAD1BkG,IAAYb,GAAME,KAgEjB,SAASY,GAAkB7S,EAAGC,GACnC6S,GAAgB9S,EAAGC,GACnB,IAAM5D,EAAQqW,GAAU7X,WACxB,GAAIwB,EAAMkW,OAAOvS,GAAK3D,EAAMkW,OAAOtS,GAAKD,GAAKC,EAAG,CAC9C,IAAM/G,EAAQmD,EAAMgW,MAAMrS,EAAI3D,EAAMkW,OAAOvS,EACrC/G,EAASoD,EAAMgW,MAAMpS,EAAI5D,EAAMkW,OAAOtS,EAE5C,GAAIyH,KAAKqL,IAAI7Z,IAAU,GAAI,CACzB,IAAMsR,EAAO,CACXtR,MAAOA,GAAS,EAAIA,GAASA,EAC7BD,OAAQA,GAAU,EAAIA,GAAUA,EAChC0R,IAAK1R,GAAU,EAAIoD,EAAMkW,OAAOtS,EAAI5D,EAAMgW,MAAMpS,EAChD2K,KAAM1R,GAAS,EAAImD,EAAMkW,OAAOvS,EAAI3D,EAAMgW,MAAMrS,GAE5CsK,EAAQ,SAAWiB,KAAoB,GACvChB,EAAaqH,MAA0B,SACvC/E,EAAQD,GACZ8F,GAAU7X,WAAWmL,OACrBwE,EACAF,EACAC,GAGEkI,EAASC,GAAU7X,WAAW4X,OAClCvH,GAAuBH,GAAsB0H,IAC7CzH,GAAcZ,GAAiByC,EAAOvC,EAAOC,EAAYC,EAAMiI,IAE/DC,GAAUvV,UAAS,SAAAC,GAAS,kCACvBA,GADuB,IAE1BqV,OAAQA,EAAS,OAIrBpX,EAAQ8B,SAAS,CACflC,gBAAiB,KAGnBwW,GAAmBiB,GAAU7X,WAAWmL,OAAOgN,mBAAmB,KAkB/D,SAASF,GAAgB9S,EAAGC,GACjC,IAAIgT,EAAaP,GAAU7X,WAAWmL,OAAOkN,QAAQtI,KACjDuI,EACFT,GAAU7X,WAAWmL,OAAOkN,QAAQtI,KACpC8H,GAAU7X,WAAWmL,OAAO9M,MAC1Bka,EAAYV,GAAU7X,WAAWmL,OAAOkN,QAAQvI,IAChD0I,EACFX,GAAU7X,WAAWmL,OAAOkN,QAAQvI,IACpC+H,GAAU7X,WAAWmL,OAAO/M,OAC1Bqa,EACFtT,EAAIiT,EACAA,EACAjT,EAAImT,EACJA,EACAnT,EAAIiT,EACNM,EACFtT,EAAImT,EAAYA,EAAYnT,EAAIoT,EAAeA,EAAepT,EAAImT,EAEpEV,GAAUvV,UAAS,SAAAC,GAAS,MAAK,CAC/BiV,MAAO,CACLrS,EAAGsT,EACHrT,EAAGsT,OL9JF,IAAMzY,GAAUyB,EACVnB,GAAWoY,EACXlY,GAAUmY,EACVpY,GAAUqY,EACV1I,GAAgB0G,GAChBiC,GFnBN,SAA+BC,GACpC,IAAK,IAAI1Q,EAAI,EAAGA,EAAI0Q,EAAKzQ,OAAQD,KAiMZ+H,EAhMD2I,EAAK1Q,KAmMvB+H,EAAWT,KAAKI,KAAO,GACvBK,EAAWT,KAAKI,KAAO,KACvBK,EAAWT,KAAKG,IAAM,GACtBM,EAAWT,KAAKG,IAAM,KACtBM,EAAWT,KAAKtR,MAAQ,GACxB+R,EAAWT,KAAKtR,MAAQ,KACxB+R,EAAWT,KAAKvR,OAAS,GACzBgS,EAAWT,KAAKvR,OAAS,KACzBgS,EAAWX,MAAMnH,OAAS,GA3MG,WAC3B,IAAMqH,EAAOoC,GACXuC,KACAyE,EAAK1Q,GAAGsH,KACRoJ,EAAK1Q,GAAGoH,MACRsJ,EAAK1Q,GAAGwH,OAEN+H,EAASC,GAAU7X,WAAW4X,OAClCvH,GAAuBH,GAAsB0H,IAC7CzH,GACEZ,GACEI,EACAoJ,EAAK1Q,GAAGoH,MACRsJ,EAAK1Q,GAAGwH,MACRkJ,EAAK1Q,GAAGsH,KACRiI,IAIJC,GAAUvV,UAAS,SAAAC,GAAS,kCACvBA,GADuB,IAE1BqV,OAAQA,EAAS,OArBQ,GAgMjC,IAAuBxH,EAvKrBlO,QAAQyB,IAAIpD,GAASP,WAAWE,cEPrB8Y,GF8CN,SAAwB/W,IAzBxB,SAAkCmO,GACvC5P,GAAQ8B,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExBnC,gBAAgB,GAAD,oBAAMmC,EAAUnC,iBAAhB,CAAiCgQ,SAwBlD6I,CADmB1Y,GAASP,WAAWE,YAAY+B,IAEnDsO,GAAiBtO,GAEjB,IAAMiX,EAAevI,KAErBF,GADwBG,MAExBT,GAAc+I,IEpDHvI,GAAmBwI,GAGnB9E,GFqHN,SAA+BH,EAAUzE,GAC9ClP,GAAS+B,UAAS,SAAAC,GAUhB,MAAO,CACLrC,YAVkBqC,EAAUrC,YAAYsC,KAAI,SAACqT,EAAOnT,GACpD,GAAImT,EAAMpG,QAAUyE,EAAU,CAC5B,IAAIkF,EAAWvD,EAEf,OADAuD,EAAS3J,MAAQA,EACV2J,EAEP,OAAOvD,UE5HFlB,GFqIN,SAA+BT,EAAUzE,GAC9ClP,GAAS+B,UAAS,SAAAC,GAUhB,MAAO,CACLrC,YAVkBqC,EAAUrC,YAAYsC,KAAI,SAACqT,EAAOnT,GACpD,GAAImT,GAAUA,EAAMhG,QAAUqE,EAAW,CACvC,IAAIkF,EAAWvD,EAEf,OADAuD,EAASvJ,MAAQJ,EACV2J,EAEP,OAAOvD,UE5IFwD,GFqJN,WAGL,IAFA,IAAIC,EAAU,GACRpZ,EAAcK,GAASP,WAAWE,YAC/BmI,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IACtCiR,EAAQC,KAAKrZ,EAAYmI,GAAGwH,OAE9B,OAAOyJ,GE1JIE,GFiDN,SAAwBvX,GAG7B,IAFA,IAAMuX,EAAiBhZ,GAAQR,WAAWI,gBAAgB6B,GACpD/B,EAAcK,GAASP,WAAWE,YAC/BmI,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IAClCnI,EAAYmI,GAAGuH,KAAO4J,EAAe5J,KACvCU,GAAyBpQ,EAAYmI,IACrCkI,GAAiBlI,IAIrB8H,GAAcqJ,GA3BT,SAA8BvX,GACnCzB,GAAQ8B,UAAS,SAAAC,GACf,OAAOA,EAAUnC,gBAAgBoQ,OAAOvO,EAAO,MA0BjDwX,CAAqBxX,IE3DV8T,GF4JN,SAA8BtG,GAEnC,IADA,IAAMvP,EAAcK,GAASP,WAAWE,YAC/BmI,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IACtC,GAAInI,EAAYmI,IAAOnI,EAAYmI,GAAGoH,QAAUA,EAC9C,OAAOvP,EAAYmI,IE5JZgJ,GAAaqF,GACbzC,GDmBN,WACL,OAAOxC,GAAkBzR,WAAWgR,KAAKO,SCnB9BD,GDsBN,SAAsBoI,GAC3BjI,GAAkBnP,UAAS,SAAAC,GAAS,kCAC/BA,GAD+B,IAElCyO,KAAK,2BACAzO,EAAUyO,MADX,IAEFQ,OAAQkI,UC1BDpF,GD5BN,WACL,OAAO7C,GAAkBzR,WAAWmL,QC8BzB4G,GAAW4H,GAKX9B,GAAY+B,GI9EzB,IAAM7a,GAAY,CAChBua,QAAS,CACP,CACE1Z,KAAM,qBACNsV,SAAS,IAGb+B,QAAS,UAGX,SAAS4C,GAASnK,GAEhBsH,GAAc1U,UAAS,SAAAC,GAAS,kCAC3BA,GAD2B,IAE9B+W,QAAQ,GAAD,oBACF/W,EAAU+W,SADR,CAEL,CACE1Z,KAAM8P,GANU,SAOhBwF,SAAS,U,OAM6B9V,aAAO,SAAAC,GAAG,sBACnDN,O,qBADwBiY,I,aAetB,SAAS8C,GAAYrK,GAC1BuH,GAAc1U,UAAS,SAAAC,GAUrB,MAAO,CACL+W,QAVc/W,EAAU+W,QAAQ9W,KAAI,SAACuX,EAAKrX,GAC1C,GAAIqX,EAAIna,OAAS6P,EAAO,CACtB,IAAIuK,EAASD,EAEb,OADAC,EAAO9E,SAAU,EACV8E,EAEP,OAAOD,SAiCR,SAASE,GAAiBra,GAC/B,IAAM0Z,EAAUtC,GAAchX,WAAWsZ,QACzC,GAAIA,GAEe,IADPA,EAAQY,QAAO,SAAAH,GAAG,OAAIA,EAAIna,OAASA,KACvC0I,OACJ,OAAO,EAGX,OAAO,EEpFT,IAAM6R,GAAM,CACVra,QAAS,QACTzB,MAAO,OACPD,OAAQ,QAGN4P,GAAM,E,6CCiCH,IAAM/N,GAAwByB,EACxB0Y,GDdN,SAAiB5a,GACtBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAM,CACJ,CACEI,KAAMJ,EAAKI,KACXe,MAAOnB,EAAK6a,QACZxa,MAAOsa,GACPpa,KAAMP,EAAKO,KACXuB,QAASZ,GAAclB,EAAK6a,WAGhC5a,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GCCrB6a,GDEN,SAAgB9a,GACrBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAK,GAAD,oBACC+C,EAAU/C,MADX,CAEF,CACEI,KAAMJ,EAAKI,KACXe,MAAOnB,EAAK6a,QACZxa,MAAOsa,GACPpa,KAAMP,EAAKO,KACXuB,QAASZ,GAAclB,EAAK6a,YAGhC5a,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GChBrB8a,GDmBN,SAAkB/a,GACvBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAK,GAAD,oBACC+C,EAAU/C,MADX,CAEF,CACEI,KAAMJ,EAAKI,KACXe,MAAOnB,EAAK6a,QACZxa,MAAOsa,GACPpa,KAAMP,EAAKO,QAGfN,KAAM8C,EAAU9C,KAAO,OAEzB+a,GAAWhb,GACXwO,GAAM/N,GAAQD,WAAWP,KAAO,GCjCrBgb,GDoCN,SAAiBjb,GACtBS,GAAQqC,UAAU,SAAAC,GAAS,kCACtBA,GADsB,IAEzB/C,KAAK,GAAD,oBAAM+C,EAAU/C,MAAhB,CAAsB,CACtBI,KAAMJ,EAAKI,KACXe,MAAOnB,EAAK6a,QACZxa,MAAOsa,GACTpa,KAAMP,EAAKO,QAEbN,KAAM8C,EAAU9C,KAAO,OAEzB+a,GAAWhb,GACXwO,GAAM/N,GAAQD,WAAWP,KAAO,GC/CrBib,GD4DN,SAAiBlb,GACtBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAM,CACJ,CACEI,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,KACXgZ,KAAM4B,GAAUnb,KAGpBC,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GCvErBmb,GD0EN,SAAgBpb,GACrBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAK,GAAD,oBACC+C,EAAU/C,MADX,CAEF,CACEI,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,KACXgZ,KAAM4B,GAAUnb,MAGpBC,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GCtFrBob,GDyFN,SAAkBrb,GACvBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAM,CACJ,CACEI,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,KACXgZ,KAAM+B,GAAWtb,KAGrBC,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GCpGrBsb,GDuGN,SAAiBvb,GACtBS,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB/C,KAAK,GAAD,oBACC+C,EAAU/C,MADX,CAEF,CACEI,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,KACXgZ,KAAM+B,GAAWtb,MAGrBC,KAAM8C,EAAU9C,KAAO,OAEzBuO,GAAM/N,GAAQD,WAAWP,KAAO,GCnHrBub,GDxCN,WACL,OAAmC,IAA5B/a,GAAQD,WAAWP,MCwCfwb,GDrCN,SAAqBrb,GAE1B,IAAIsb,GAAY,EAEVhP,EAAQjM,GAAQD,WAAWR,KAOjC,OANI0M,GAEe,IADPA,EAAMgO,QAAO,SAAA1a,GAAI,OAAIA,EAAKI,OAASA,KACvC0I,SACJ4S,GAAY,GAGTA,GC2BIC,GDoHN,SAAkBC,GACvBnb,GAAQqC,UAAS,SAAAC,GAUf,OATaA,EAAU/C,KAAKgD,KAAI,SAAC6Y,EAAGhT,GAClC,GAAIA,IAAM2F,GAAK,CACb,IAAIsN,EAAUD,EAEd,OADAA,EAAEtC,KAAOqC,EACFE,EAEP,OAAOD,SC1HFE,GD0CN,SAAyB3b,EAAM6M,EAAO9L,EAAO4M,GAClD,IAAMtL,EAAQhC,GAAQD,WAAWR,KAAKgc,WAAU,SAAAhc,GAAI,OAAIA,EAAKI,OAASA,KAClEsM,EAAK,aAAOjM,GAAQD,WAAWR,MAC7B8b,EAAUpP,EAAMjK,GACtBqZ,EAAQ7O,MAAQA,EAChB6O,EAAQ3a,MAAQA,EAChB2a,EAAQ/N,SAAWA,EACnBrB,EAAMjK,GAASqZ,GChDJG,GDgIN,SAA6B/b,GAClCO,GAAQqC,UAAS,SAAAC,GAAS,kCACrBA,GADqB,IAExB7C,MAAOA,QClIEib,GCvDN,SAAmBnb,GACxB,IAAMkc,EAAS,IAAIC,WAEnBD,EAAOE,OAAS,WACd,IAAMC,EAAqBH,EAAON,OAElCU,KAAI,CACFC,UAAU,EACVC,OAAQ,SAEPC,WAAWJ,GACXtY,MAAK,SAAA2Y,GACJ,IAAMC,EAAS,GACfD,EAAQE,SAAQ,SAACC,EAAShU,GACxB,GAAU,IAANA,EAAS,CACX,IAAMiU,EAAc,GAEpBC,OAAOC,KAAKH,GAASD,SAAQ,SAAAK,GAC3B,IAAMC,EAA0BL,EAAQI,GAClCE,EAAwBT,EAAQ,GAAGO,GACzCH,EAAYK,GAAyBD,KAGvCP,EAAO5C,KAAK+C,OAGhBnB,GAASgB,OAIfT,EAAOkB,QAAU,kBAAM1a,QAAQyB,IAAI,6BACnC+X,EAAOmB,QAAU,kBAAM3a,QAAQyB,IAAI,4BAEnC+X,EAAOoB,WAAWtd,EAAM,eDuBbsb,GCpBN,SAAoBtb,GACzB,IACIuZ,EADE2C,EAAS,IAAIC,WAEnBD,EAAOE,OAAS,WACd7C,EAAOgE,KAAKC,MAAMtB,EAAON,QACzBD,GAASpC,EAAK7Y,cAEhBwb,EAAOoB,WAAWtd,IDcPgb,GCXN,SAAoBhb,GACzB,IAAMkc,EAAS,IAAIC,WAEfnc,IACFkc,EAAOE,OAAS,WACc,eAAdpc,EAAKO,MAEjBmC,QAAQC,MACN,iDACA3C,EAAKI,OAIX8b,EAAOuB,UAAY,SAAAC,GACjBhb,QAAQC,MACN,iDACA3C,EAAKI,MAWN,SAAwBA,EAAMkH,GAInC,IAHA,IAAI2F,EAAQ,GACN0Q,EAAOC,KAAKC,OAAOvW,GAEhBuB,EAAI,EAAGA,EAAI8U,EAAK7U,OAAQD,IAAK,CACpC,IAAM2F,EAAM3F,EACZ+U,KAAKE,YAAYxW,EAAQqW,EAAKnP,IAC9B,IAAIuP,EAAOH,KAAKI,QAAQL,EAAKnP,IAC7BvB,EAAM8M,KAAKgE,GAOb,IAJA,IAAI5c,EAAQ,IAAI8c,MAAMN,EAAK,GAAG9e,MAAO8e,EAAK,GAAG/e,QACvCsf,EAASC,OAAOR,EAAK,GAAGS,MAAMC,MAAM,OAEtCtQ,EAAW,GACN7K,EAAI,EAAGA,EAAIgb,EAAOpV,OAAQ5F,IAAK,CACtC,IAAMob,EAAOJ,EAAOhb,GAAGmb,MAAM,KACvBE,EAAMD,EAAK,GACX9c,EAAQ8c,EAAK,GACnBvQ,EAASwQ,GAAO/c,EAIlBua,GAAgB3b,EAAM6M,EAAO9L,EAAO4M,GAhChCyQ,CAAexe,EAAKI,KAAMsd,EAAMlK,OAAOoI,SAEzCM,EAAOuC,WAAa,WAClB/b,QAAQyB,IAAI,yBAA0B,mBAAoBnE,EAAKI,OAEjE8b,EAAOwC,kBAAkB1e,KDVhBe,GAAwBoY,EAExBjY,GAAwB2N,EE2E9B,ICxHHlD,GDwHSzJ,GAA0BzB,EAC1BM,GAA0BoY,EAC1B5W,GAA0BmM,GAE1BlM,GAA0BuM,GAG1BM,GAA0BC,GAG1BqP,GvBrHN,SAA0BvU,EAASoE,GACxCjM,GAAOO,UAAS,SAAAC,GAQd,MAAO,CACLV,aARmBU,EAAUV,aAAaW,KAAI,SAAC4b,EAAU1b,GACzD,OAAIA,IAAMkH,EACDoE,EAEAoQ,UuBgHFxb,GAA0B8L,GAG1B2P,GE7Ja,CACxBve,QAAS,cACTwe,aAAc,EACdC,OAAQ,oBACRC,aAAc,EACdC,YAAa,EACbpgB,MAAO,GACPD,OAAQ,GACRO,QAAS,EACT+f,UAAW,cFqJAC,GElJkB,CAC7B7e,QAAS,OACT8e,SAAU,EACVC,SAAU,UFiJCC,GGhImB,CAC9BxgB,SAAU,WACVF,OAAQ,OACRC,MAAO,OACP0gB,OAAQ,IACR3d,QAAS,OH4HE4d,GG1HmB,CAC9B1gB,SAAU,WACVF,OAAQ,OACRC,MAAO,OACP0gB,OAAQ,IACR3d,QAAS,OHsHE6d,GGpHmB,CAC9B3gB,SAAU,WACVF,OAAQ,OACRC,MAAO,OACP0gB,OAAQ,IACR3d,QAAS,OHgHE8d,GInKmB,CAC9B1gB,KAAM,GACNF,SAAU,YJkKC6gB,GI/JmB,CAC9BC,QAAS,SACTC,aAAc,SACdC,WAAY,SACZC,UAAW,SACXlhB,MAAO,OACPQ,OAAO,EACPuU,SAAU,OACVhV,OAAQ,QJwJGohB,GIrJuB,CAClCnhB,MAAO,MACPD,OAAQ,QJoJGqhB,GIjJqB,CAChCnhB,SAAU,SACVF,OAAQ,QACRC,MAAO,OACP0gB,OAAQ,KJ8IGW,GI3I0B,GJ4I1BC,GKxKiB,CAC5BnhB,KAAM,GACNF,SAAU,YLuKCshB,GKpKiB,CAC5BR,QAAS,SACTC,aAAc,SACdC,WAAY,SACZC,UAAW,SACXlhB,MAAO,OACPQ,OAAO,EACP2f,aAAc,OACdqB,UAAW,UL6JAC,GK1JkB,GL2JlBC,GG3KgB,CAC3BvhB,KAAM,GACNF,SAAU,YH2KC0hB,GGnKgB,CAC3BZ,QAAS,SACTC,aAAc,SACdC,WAAY,SACZC,UAAW,SACXlhB,MAAO,OACPQ,OAAO,EACPuU,SAAU,OACVoL,aAAc,QH8JHyB,GMhLgB,CAC3BzhB,KAAM,GACNF,SAAU,YN+KC4hB,GM5KgB,CAC3Bd,QAAS,SACTC,aAAc,SACdC,WAAY,SACZC,UAAW,SACXlhB,MAAO,OACPQ,OAAO,EACPuU,SAAU,OACV+M,SAAU,OACV3B,aAAc,QNoKH4B,GMjKoB,CAC/B/hB,MAAO,MACPD,OAAQ,QNgKGiiB,GLnJN,WAEL,IADA,IAAM/G,EAAUD,KACPhR,EAAI,EAAGA,EAAIiR,EAAQhR,OAAQD,IAAK,CACvC,IAAM0R,EAAMT,EAAQjR,GAChB0R,IAAQE,GAAiBF,KAC3BF,GAASE,GACTD,GAAYC,MK8ILuG,GLrFN,WACL,OAAOtJ,GAAchX,WAAWsZ,SKqFrBiH,GLzHN,SAA2BC,GAChCxJ,GAAc1U,UAAS,SAAAC,GAUrB,MAAO,CACL+W,QAVc/W,EAAU+W,QAAQ9W,KAAI,SAACuX,EAAKrX,GAC1C,GAAIA,IAAM8d,EAAK,CACb,IAAIxG,EAASD,EAEb,OADAC,EAAO9E,SAAW6E,EAAI7E,QACf8E,EAEP,OAAOD,SAOb,IAAMA,EAAM/C,GAAchX,WAAWsZ,QAAQkH,GACzCzG,EAAI7E,SACN8B,GAAc1U,UAAS,SAAAC,GAAS,kCAC3BA,GAD2B,IAE9B0U,QAAS8C,EAAIna,WKuGNoX,GAAqByJ,GACrBC,GPyDN,SAAuB3G,GAC5B9E,GAAkB8E,EAAIna,KAAMma,EAAI7E,UOzDrBD,GAAqB0L,GACrBC,GP6FN,WAGL,IAFA,IACIxM,EADSE,KACKa,aACT9M,EAAI,EAAGA,EAAI+L,EAAK9L,OAAQD,IAAK,CACpC,IAAImH,EAAQ4E,EAAK/L,GACbmH,GACF8F,GAAiB9F,KOlGVmC,GAAqBkP,GAErBC,GPqMN,WACL,IAAI3V,EAASmJ,KACPpU,EAAcK,EAASP,WAAWE,YACpCgZ,EAAevI,KAEnB,IAAKuI,EACH,OAAO,KAGT,IAAK,IAAI7Q,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IAClCnI,EAAYmI,IAAM6Q,GAAgBhZ,EAAYmI,GAAGuH,KAAOsJ,EAAatJ,KACnE1P,EAAYmI,GAAGmH,OAAS0J,EAAa1J,MACvC2G,GAAejW,EAAYmI,GAAI6Q,GACtBA,EAAa1J,QAAUtP,EAAYmI,GAAGmH,MAC/CrE,EAAOyI,IAAIsF,EAAa1J,OAExB0G,GAAiBhW,EAAYmI,IAE/B2Q,GAAe3Q,KOtNR0Y,GP2NN,WACL,IAAI5V,EAASmJ,KACPtG,EJpQCxN,GAAQR,WAAWI,gBAAgBkI,OAAS,EIqQ7CpI,EAAcK,EAASP,WAAWE,YAExC,GAAI8N,GAAO,EAAG,CAEZ,IAAMgT,EJ/QDxgB,GAAQR,WAAWI,gBACxBI,GAAQR,WAAWI,gBAAgBkI,OAAS,GIgR5C,IAAK0Y,EACH,OAAO,KAGT,GAAIA,EAAUxR,MAAO,CACnBwR,EAAUxR,MAAMnQ,IAAI,CAClByQ,IAAKkR,EAAUrR,KAAKG,IACpBC,KAAMiR,EAAUrR,KAAKI,KACrB1R,MAAO2iB,EAAUrR,KAAKtR,MACtBD,OAAQ4iB,EAAUrR,KAAKvR,OACvB4R,OAAQgR,EAAUrR,KAAKK,OACvBC,OAAQ+Q,EAAUrR,KAAKM,SAIzB,IADA,IAAMmE,EAAOE,KAAYvD,SAChBrO,EAAI,EAAGA,EAAI0R,EAAK9L,OAAQ5F,IAC3B0R,EAAK1R,IAAM0R,EAAK1R,GAAGqO,UAAYqD,EAAK1R,GAAGqO,SAAS,GAAG7M,MAASkQ,EAAK1R,GAAGqO,SAAS,GAAG7M,OAAS8c,EAAUvR,OACrGtE,EAAO0J,OAAOT,EAAK1R,IAGvByI,EAAOyI,IAAIoN,EAAUxR,OACrBrE,EAAOmL,mBACPnL,EAAO0I,gBAAgBmN,EAAUxR,YAEjC,IAAK,IAAInH,EAAI,EAAGA,EAAInI,EAAYoI,OAAQD,IAClCnI,EAAYmI,GAAGuH,KAAOoR,EAAUpR,KAClCzE,EAAOyI,IAAI1T,EAAYmI,GAAGmH,OAC1BrE,EAAOmL,oBAMbkD,GAAexL,KOpQN4H,GAAqBqL,GACrBlN,GAAqBmN,GACrBxM,GAAqByM,GACrBC,GV1JN,SAAmBjW,GACxBsG,GAAkBnP,UAAS,SAAAC,GAAS,kCAC/BA,GAD+B,IAElC4I,OAAQA,QU2JCmB,GAAqB0C,GACrBqS,GhBnBN,SAA0BrgB,EAAO4I,GACtC,OAAI0B,GAAe1B,IAEf5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASC,WAAWC,OAnK1E,SAAiCA,EAAO4I,GACtCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASC,WAAWC,MAAQA,EAChC6K,EAEP,OAAOD,SA6JT0V,CAAwBtgB,EAAO4I,IAE1B,IAEP1H,QAAQyB,IACN,gDACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgBEIugB,GhBCN,SAAwBvgB,EAAO4I,GACpC,OAAI0B,GAAe1B,IAEf5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASG,SAASD,OAvKxE,SAA+BA,EAAO4I,GACpCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASG,SAASD,MAAQA,EAC9B6K,EAEP,OAAOD,SAiKT4V,CAAsBxgB,EAAO4I,IAExB,IAEP1H,QAAQyB,IACN,+CACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgBlBIygB,GhBqBN,SAA0BzgB,EAAO4I,GACtC,OAAI0B,GAAe1B,IAEf5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASI,WAAWF,OA3K1E,SAAiCA,EAAO4I,GACtCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASI,WAAWF,MAAQA,EAChC6K,EAEP,OAAOD,SAqKT8V,CAAwB1gB,EAAO4I,IAE1B,IAEP1H,QAAQyB,IACN,iDACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgBtCI2gB,GhByCN,SAA0B3gB,EAAO4I,GACtC,OAAI0B,GAAe1B,IAEf5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASK,WAAWH,OA/K1E,SAAiCA,EAAO4I,GACtCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASK,WAAWH,MAAQA,EAChC6K,EAEP,OAAOD,SAyKTgW,CAAwB5gB,EAAO4I,IAE1B,IAEP1H,QAAQyB,IACN,iDACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgB1DI6gB,GhBkFN,SAAqB7gB,EAAO4I,GACjC,IAAIvI,EAAQ,IAAIT,QAAYI,EAAMK,OAElC,OAAIiK,GAAe1B,IACb5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASO,MAAML,OAxLvE,SAA4BA,EAAO4I,GACjCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASO,MAAML,MAAQA,EAC3B6K,EAEP,OAAOD,SAiLTkW,CAAmBzgB,EAAOuI,IAErB,IAEP1H,QAAQyB,IACN,4CACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgBnGI+gB,GhB4DN,SAAuB/gB,EAAO4I,GACnC,OAAI0B,GAAe1B,IAEf5I,IAAUW,GAAK3B,WAAWhB,SAAS4K,EAAU,GAAG9I,SAASM,QAAQJ,OAnLvE,SAA8BA,EAAO4I,GACnCjI,GAAKW,UAAS,SAAAC,GAUZ,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW/K,SAASM,QAAQJ,MAAQA,EAC7B6K,EAEP,OAAOD,SA6KToW,CAAqBhhB,EAAO4I,IAEvB,IAEP1H,QAAQyB,IACN,8CACAhC,GAAK3B,WACL,aACA4J,EACA,WACA5I,IAGG,IgB5EIihB,GJUN,SAAkB9c,EAAGC,GAC1B,IAAKqR,KAAe,CAClBpF,IAAW,GACX,IAAIlG,EAAS0M,GAAU7X,WAAWmL,OAClCwL,GAAcxR,EAAIgG,EAAOkN,QAAQtI,KAAM3K,EAAI+F,EAAOkN,QAAQvI,OIbjDoS,GJvGN,SAAsB/c,EAAGC,GAC1ByS,GAAU7X,WAAWmL,OAAO0G,cAQhCF,GAAckG,GAAU7X,WAAWmL,QAW9B,SAA0BhG,EAAGC,IAwD7B,SAAmBD,EAAGC,GAC3ByS,GAAUvV,UAAS,SAAAC,GAAS,kCACvBA,GADuB,IAE1BmV,OAAQ,CACNvS,EAAGA,EAAI0S,GAAU7X,WAAWmL,OAAOkN,QAAQtI,KAC3C3K,EAAGA,EAAIyS,GAAU7X,WAAWmL,OAAOkN,QAAQvI,UA5D/CqS,CAAUhd,EAAGC,GAjBXgd,CAAiBjd,EAAGC,IIoGXid,GJhHN,WACLvK,GAAQZ,GAAMG,SIgHHiL,GJ7FN,SAAgBnd,EAAGC,GACpByS,GAAU7X,WAAW2X,WAAaT,GAAMG,OAhB5CS,GAAQZ,GAAMC,MAkBHU,GAAU7X,WAAW2X,WAAaT,GAAMC,MACjDa,GAAkB7S,EAAGC,II0FZmd,GJcN,WACL,IAAIC,EAAS3K,GAAU7X,WAAWE,YAElC,GAAIsiB,EAAOla,OAASuP,GAAU7X,WAAWmL,OAAOgK,aAAa7M,OAAQ,CACnE,IACIuN,EAAQ2M,EADOA,EAAOla,OAAS,GAG/B8Q,EAAW,CACbrJ,KAAMlC,SAASgI,EAAMlG,KAAKI,MAC1BD,IAAKjC,SAASgI,EAAMlG,KAAKG,KACzBzR,MAAOwP,SAASgI,EAAMlG,KAAKtR,OAC3BD,OAAQyP,SAASgI,EAAMlG,KAAKvR,SAG9B2T,GAAS8F,GAAU7X,WAAWmL,OAAQiO,EAAUvD,EAAMpG,MAAOoG,EAAMhG,SI3B1D4S,GJxJN,SAAyBtX,GAC9B0M,GAAUvV,UAAS,SAAAC,GAAS,MAAK,CAC/B4I,OAAQA,OIuJC2M,GAAqB4K,GACrB7K,GAAqB+B,GAErB1C,GAAqByL,GACrBC,G7BjMN,SAA0BhZ,GAC/BtK,EAAYgD,UAAS,SAAAC,GAUnB,MAAO,CACLvD,SAVeuD,EAAUvD,SAASwD,KAAI,SAACoJ,EAAIlJ,GAC3C,GAAIA,IAAMkH,EAAU,EAAG,CACrB,IAAIiC,EAAaD,EAEjB,OADAC,EAAW5M,UAAYsD,EAAUvD,SAAS0D,GAAGzD,SACtC4M,EAEP,OAAOD,U6B0LFiX,G7BjLN,SAAuBjZ,GAC5BtK,EAAYgD,UAAS,SAAAC,GAAS,kCACzBA,GADyB,IAE5BrD,aAAc0K,Q6B+KLkZ,GOrNN,WACL,IAAMC,EAAUC,SAASC,cAAc,KAEjClK,EAWR,WAIE,IAHA,IAAMyJ,EAASjiB,GAASP,WAAWE,YAC/BgjB,EAAY,CAAC,YAAe,IAEvB7a,EAAI,EAAGA,EAAIma,EAAOla,OAAQD,IAAK,CACtC,IAAMwN,EAAQ2M,EAAOna,GACf+Q,EAAW,CACf,MAASvD,EAAMhG,MACf,GAAMgG,EAAMjG,GACZ,MAASiG,EAAMpG,MACf,KAAQoG,EAAMlG,MAEhBuT,EAAUhjB,YAAYmI,GAAK+Q,EAG7B,OAAO2D,KAAKoG,UAAUD,EAAW,KAAM,GA1B1BE,GAEP5jB,EAAO,IAAI6jB,KAAK,CAACtK,GAAO,CAC5BhZ,KAAM,eAERgjB,EAAQO,KAAOC,IAAIC,gBAAgBhkB,GACnCujB,EAAQU,SAAW,mBACnBT,SAASU,KAAKC,YAAYZ,GAC1BA,EAAQa,SP2MGtW,GAAqB2B,GACrBnB,GAAwBoB,GCxDtB2U,G,kDAzIb,WAAYxZ,GAAQ,IAAD,8BACjB,cAAMA,IACDyZ,UAAYC,IAAMC,YAEvB,EAAKC,gBAAkB,EAAKA,gBAAgBC,KAArB,gBACvB,EAAKC,cAAgB,EAAKA,cAAcD,KAAnB,gBACrB,EAAKE,uBAAyB,EAAKA,uBAAuBF,KAA5B,gBAC9B,EAAKG,WAAa,EAAKA,WAAWH,KAAhB,gBAClB,EAAKI,aAAe,EAAKA,aAAaJ,KAAlB,gBACpB,EAAKtD,QAAU,EAAK2D,eAAeL,KAApB,gBACf,EAAKM,qBAAuB,EAAKA,qBAAqBN,KAA1B,gBAC5B,EAAKO,uBAAyB,EAAKA,uBAAuBP,KAA5B,gBAXb,E,iEAejB/Y,GAAS,IAAI8G,SAAOyS,OAAO3hB,KAAK+gB,UAAUnZ,QAAS,CACjDga,gBAAgB,KAEX9R,GAAG,CACR,aAAc9P,KAAKkhB,gBACnB,WAAYlhB,KAAKohB,cACjB,iBAAkBphB,KAAKqhB,uBACvB,kBAAmBrhB,KAAK0hB,uBACxB,gBAAiB1hB,KAAKyhB,qBACtB,kBAAmBzhB,KAAKshB,WACxB,iBAAkBthB,KAAKshB,aAEzBjD,GAAUjW,IACVsX,GAAgBtX,M,iCAGP2H,GACTuP,O,2CAGmBvP,GACnBgF,GAAQZ,GAAMG,U,6CAGOuN,ILYlB,SAASC,EAAaC,GAE3B,IADA,IAAM1Q,EAAO0Q,EAAU/T,SACd1I,EAAI,EAAGA,EAAI+L,EAAK9L,OAAQD,IAAK,CAEpC,IADc+L,EAAK/L,GAAG0I,SAGf,CACL+T,EAAU7R,YACVpC,GAAuBiU,GACvB,MAJAD,EAAazQ,EAAK/L,IAQtB7H,EAAQ8B,SAAS,CACflC,gBAAiB,KKzBjBykB,CAAaD,EAAQ5R,U,0CAGH4R,GAClB,IAAMG,EAAOlN,GAAU7X,WAAW2X,SAC9BoN,IAAS7N,GAAMC,KACjB+K,GAAa0C,EAAQ9R,EAAEkS,QAASJ,EAAQ9R,EAAEmS,SACjCF,IAAS7N,GAAME,MACxBzF,GAAcxG,M,2CAIGyZ,GACnB3C,GAAS2C,EAAQ9R,EAAEkS,QAASJ,EAAQ9R,EAAEmS,W,wCAGtBL,GAChBtC,GAAOsC,EAAQ9R,EAAEkS,QAASJ,EAAQ9R,EAAEmS,W,yCAGnBL,M,sCAEHA,GACS,IAAnBA,EAAQM,OACVniB,KAAKoiB,qBAAqBP,GAE1B7hB,KAAKqiB,oBAAoBR,K,oCAIfA,GACW,IAAnBA,EAAQM,OACVniB,KAAKsiB,mBAAmBT,GAExB7hB,KAAKuiB,kBAAkBV,K,yCAIR9R,M,yCAOAA,M,6CAKIA,GAGrBuP,O,4EASApN,GAAkB,UAClBlS,KAAKwiB,gB,uCAGL3E,KACA7d,KAAKwiB,gB,+BAaL,OATAhlB,GAAS6M,WAAU,SAAA5L,GACbA,GACF+gB,GAAY/gB,EAAMtB,YAAaiL,OAQjC,yBACEyE,GAAG,kBACH/P,MAAOigB,GACP0F,cAAe,SAAA1S,GAAC,OAAIA,EAAE2S,mBAEtB,4BACEnb,IAAKvH,KAAK+gB,UACVzlB,MAA2B,GAApByH,OAAO4f,WACdtnB,OAA6B,IAArB0H,OAAO6f,cAEhB5iB,KAAK6iB,mB,GApIY7B,IAAM1W,WOvBnBwY,GAAY,CACvBC,MAAO,CACL,CACElmB,KAAM,OACNmmB,QAAS,IACTC,WAAY,IACZC,MAAO,KAET,CACErmB,KAAM,KACNmmB,QAAS,IACTC,WAAY,IACZC,MAAO,KAET,CACErmB,KAAM,KACNmmB,QAAS,IACTC,WAAY,IACZC,MAAO,KAET,CACErmB,KAAM,KACNmmB,QAAS,IACTC,WAAY,IACZC,MAAO,MAGXC,KAAM,K,GAGkC9mB,aAAO,SAAAC,GAAG,sBAC/CwmB,O,qBADuBM,I,aCuEbC,G,kDA3Fb,WAAY/b,GAAQ,IAAD,8BACjB,cAAMA,IATRgc,WAAa,CACXC,QAAS,EACTC,IAAK,EACLC,IAAK,EACLC,KAAM,EACNzlB,MAAO,GAGU,EA8CnB0lB,mBAAqB,SAAA5T,GACnBA,EAAE6T,UAEF,IAAIC,EAAS,EAAKplB,MAAMolB,OACxBA,EAAO5lB,MAAQ8R,EAAEE,OAAOhS,MACxB,EAAKsB,SAAS,CAAEskB,OAAQA,IAExB,EAAKC,cAAa,GAClB,EAAKC,eApDL,EAAKtlB,MAAQ,CACXulB,SAAS,EACTH,OAAQ,EAAKP,WACbW,UAAW,KACXC,MAAM,GANS,E,iEAWjB,QAAIlkB,KAAKvB,MAAMulB,U,mCAMJG,GAEXnkB,KAAKT,SAAS,CAAEykB,SADF,M,oCAKd,IAAII,EAAcpkB,KAAKsH,MAAM8c,YACvBpnB,EAAOgD,KAAKsH,MAAMtK,KACxBonB,EAAYpkB,KAAKvB,MAAMolB,OAAO5lB,MAAOjB,K,qCAIrC,MAAuB,MAAnBgD,KAAKsH,MAAM+c,IAEX,8BACG,IACAva,KAAKC,MAAM/J,KAAKvB,MAAMolB,OAAO5lB,MAAQ+B,KAAKsH,MAAMgd,aAKnD,8BACG,IACAxa,KAAKC,MAAM/J,KAAKvB,MAAMolB,OAAO5lB,MAAQ+B,KAAKsH,MAAMgd,YAFnD,O,+BAmBI,IAAD,OACPlB,GAAW/Y,WAAU,SAAA5L,GACnB,GAAI,EAAK6I,MAAMtK,MAAQ,GAAK,EAAKsK,MAAMtK,KAAOyB,EAAMskB,MAAMxd,OAAQ,CAChE,IAAIse,EAAS,EAAKplB,MAAMolB,OACxBA,EAAO5lB,MAAQQ,EAAMskB,MAAM,EAAKzb,MAAMtK,MAAMgmB,QAC5C,EAAKzjB,SAAS,CAAEskB,OAAQA,QAI5B,IAAMA,EAAS7jB,KAAKvB,MAAMolB,OATnB,EAUoC7jB,KAAKsH,MAAxCoF,EAVD,EAUCA,MAAO8W,EAVR,EAUQA,IAAKC,EAVb,EAUaA,IAAKF,EAVlB,EAUkBA,QAASG,EAV3B,EAU2BA,KAElC,OACE,yBAAKrb,UAAU,mBACb,8BAAOqE,GADT,IACuB,6BACrB,8BAAO8W,EAAP,KACA,2BACExmB,KAAK,QACLqL,UAAU,SACVpK,MAAO4lB,EAAO5lB,OAASslB,EACvB1W,GAAG,eACH0W,QAASA,EACTC,IAAKA,EACLC,IAAKA,EACLC,KAAMA,EACNa,SAAU,SAAAxU,GAAC,OAAI,EAAK4T,mBAAmB5T,MAEzC,kCAAQ0T,GACR,kCAAQzjB,KAAKwkB,qB,GA9FAla,aCkTNma,G,kDAtSb,WAAYnd,GAAQ,IAAD,8BACjB,cAAMA,IAEDc,OAAS4Y,IAAMC,YACpB,EAAKxiB,MAAQ,CACXyK,KAAM,CAAC,IAAK,IAAK,KACjBD,MAAO,MAET,EAAKwB,WAAkB,EACvB,EAAKlF,OAAkB,EACvB,EAAK8V,SAAkB,EACvB,EAAKqJ,QAAkBpd,EAAMlE,KAC7B,EAAKyD,QAAkB,EACvB,EAAK8d,gBAAkB,EAOvB,EAAK3nB,KAAO,EACZ,EAAK4nB,eAAgB,EACrB,EAAKzb,MAAQ7B,EAAM6B,MAtBF,E,gEA4BjB,GAFAnJ,KAAKiJ,MAAQjJ,KAAKoI,OAAOR,QAAQid,WAAW,MAExC7kB,KAAKmJ,MAAO,CACd,IAAM8B,EAAMnB,KAAK2Z,IAAKzjB,KAAKmJ,MAAM5D,OAAS,EAAI,GAC9C,GACEvF,KAAK8kB,gBAAgB9kB,KAAKmJ,MAAO8B,GACjC,CACA,IAAMxO,EAAOuD,KAAKmJ,MAAM8B,GAClB3P,EAAQmB,EAAKmB,MAAMtC,MACnBD,EAASoB,EAAKmB,MAAMvC,OACpBoP,EAAazK,KAAKmJ,MAAM5D,OACxBmF,EAAajO,EAAKiN,MAAMnE,OAE9BvF,KAAK+kB,QAAQ/kB,KAAKmJ,MAAO1M,EAAK+N,UAC9BxK,KAAKikB,UAAU3oB,EAAOD,EAAQoP,EAAYC,GAC1C1K,KAAKglB,UAAUhlB,KAAKmJ,MAAO7N,EAAOD,EAAQqP,EAAaD,GACvDzK,KAAKilB,cACLjlB,KAAKyK,WAAaA,EAClBzK,KAAKwiB,mBAGLxiB,KAAKklB,eAAellB,KAAKmJ,MAAO8B,KAEhCjL,KAAKmlB,eAAenlB,KAAKmJ,OACzBnJ,KAAKolB,QAAQplB,KAAKmJ,MAAM8B,GAAKrN,OAC7BoC,KAAKhD,KAAO,EACZgD,KAAKikB,UAAU,EAAG,EAAGjkB,KAAKmJ,MAAM5D,OAAQ,GAExCvF,KAAKwiB,kB,sCAKK/lB,EAAMwO,GAEpB,OACGxO,EAAK8I,OAAS,GACd9I,EAAKwO,IACLxO,EAAKwO,GAAKvB,OACVjN,EAAKwO,GAAKvB,MAAMnE,OAAS,GACzB9I,EAAK8I,SAAWvF,KAAKyK,a,qCAIXhO,EAAMwO,GACnB,OACGxO,EAAK8I,OAAS,GACd9I,EAAKwO,IACLxO,EAAK8I,SAAWvF,KAAKyK,YACF,cAAnBhO,EAAKwO,GAAKjO,O,8BAIPqoB,GACN,IAAIznB,EAAQ,IAAI8c,MAChB9c,EAAMynB,IAAMA,EACZrlB,KAAKiJ,MAAMqc,UAAU1nB,EAAO,EAAG,K,gCAGvBtC,EAAOD,EAAQkK,EAAQmF,GAGP,MAApB1K,KAAKsH,MAAMlE,OACK,IAAdpD,KAAKhD,KACPgD,KAAKuF,OAASmF,EAAa,EAEN,IAAd1K,KAAKhD,KACZgD,KAAKuF,OAASmF,EAEO,IAAd1K,KAAKhD,KACZgD,KAAKuF,OAASA,EAEO,IAAdvF,KAAKhD,KACZgD,KAAKuF,OAASA,EAAS,EAEF,IAAdvF,KAAKhD,OACZgD,KAAKuF,OAASA,M,gCAKV4D,EAAO7N,EAAOD,EAAQkK,GAC9BuG,GAAiB,EAAG9L,KAAKiJ,MAAOE,EAAO,EAAGnJ,KAAKvB,MAAMyK,KAAMlJ,KAAKhD,KAAM1B,EAAOD,EAAQkK,GAChFvF,KAAKV,SACRU,KAAKV,OAASL,GAAU,M,8BAIpBkK,EAAOqB,GACTxK,KAAK4kB,gBACP5kB,KAAKhD,KAAOuN,GAAcpB,EAAOqB,GACjC3K,GAAWG,KAAKhD,MAChBgD,KAAK4kB,eAAgB,K,kJAKvB5kB,KAAKiJ,MAAMsc,UAAU,EAAG,EAAGvlB,KAAKoI,OAAOR,QAAQtM,MAAO0E,KAAKoI,OAAOR,QAAQvM,QACrE2E,KAAKV,SACRU,KAAKV,OAASL,GAAU,I,2IAIbkK,GAEb,IADA,IAAMqc,EAAWrc,EAAMgO,QAAO,SAAA1a,GAAI,MAAkB,cAAdA,EAAKO,QAClCsI,EAAItF,KAAKmJ,MAAM5D,OAAQD,EAAIkgB,EAASjgB,OAAQD,IACnDtF,KAAKmJ,MAAMqN,KAAKgP,EAASlgB,M,+EAIT7G,G,oFACdsM,GAAgBtM,EAAOuB,KAAKyK,cACxBtB,EAAQ1K,EAAMhC,KAChBgC,GAAS0K,IACL8B,EAAMnB,KAAK2Z,IAAKta,EAAM5D,OAAS,EAAI,GAEvCvF,KAAK8kB,gBAAgBrmB,EAAMhC,KAAMwO,IAE3BxO,EAAO0M,EAAM8B,GACb3P,EAAQmB,EAAKmB,MAAMtC,MACnBD,EAASoB,EAAKmB,MAAMvC,OACpBoP,EAAatB,EAAM5D,OACnBmF,EAAajO,EAAKiN,MAAMnE,OAE9BvF,KAAK+kB,QAAQ5b,EAAO1M,EAAK+N,UACzBxK,KAAKikB,UAAU3oB,EAAOD,EAAQoP,EAAYC,GAC1C1K,KAAKglB,UAAU7b,EAAO7N,EAAOD,EAAQqP,EAAaD,GAClDzK,KAAKilB,cACLjlB,KAAKyK,WAAaA,EAClBzK,KAAKwiB,eAGLxiB,KAAKklB,eAAezmB,EAAMhC,KAAMwO,KAEhCjL,KAAKmlB,eAAe1mB,EAAMhC,MAC1BuD,KAAKolB,QAAQ3mB,EAAMhC,KAAKwO,GAAKrN,OAC7BoC,KAAKhD,KAAO,EACZgD,KAAKikB,UAAU,EAAG,EAAG9a,EAAM5D,OAAQ,GAEnCvF,KAAKwiB,iB,0IAMAvkB,GAEX,OAAkB,IAAd+B,KAAKhD,KACU,EAARiB,GAAc+B,KAAK6G,QAAQ,GAGf,IAAd7G,KAAKhD,KACHiB,GAAU+B,KAAK6G,QAAQ,GAAK7G,KAAKuF,OAGrB,IAAdvF,KAAKhD,MAIS,IAAdgD,KAAKhD,KAHK,EAARiB,GAAc+B,KAAK6G,QAAQ,GAMf,IAAd7G,KAAKhD,KACLiB,OADJ,I,oCAMD+B,KAAKhD,KAAO,GACdgD,KAAKylB,eACLlc,GACEvJ,KAAKiJ,MACLjJ,KAAKV,OACLU,KAAKqb,SACLrb,KAAKvB,MAAMyK,KACXlJ,KAAK0kB,SACL,IAGmB,IAAd1kB,KAAKhD,MACZgD,KAAKolB,QAAQplB,KAAKmJ,MAAMnJ,KAAKqb,UAAUzd,OAEzCoC,KAAKwiB,gB,uCAGUvkB,GACf+B,KAAK2kB,gBAAkB7Z,SAAS7M,GAChC+B,KAAKqb,SAAWrb,KAAK0lB,aAAa1lB,KAAK2kB,iBACvC3kB,KAAKilB,gB,yCAGYhnB,GACjB+B,KAAK6G,QAAUiE,SAAS7M,GACxB+B,KAAKqb,SAAWrb,KAAK0lB,aAAa1lB,KAAK2kB,iBACvC3kB,KAAKilB,gB,4BAGDU,EAAKnC,EAAKC,GACd,OAAO3Z,KAAK0Z,IAAI1Z,KAAK2Z,IAAIkC,EAAKnC,GAAMC,K,0CAIpC,OAAIzjB,KAAKhD,KAAO,EAEZ,6BACE,yBAAKqL,UAAU,4BACb,kBAAC,GAAD,CACEqE,MAAM,GACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAI,IACJC,KAAK,IACLH,QAAQ,IACRe,WAAW,IACXD,IAAI,IACJD,YAAapkB,KAAK4lB,mBAAmBzE,KAAKnhB,QAE5C,0CAAgBA,KAAK6G,QAArB,OAKe,IAAd7G,KAAKhD,KAEV,mCAFC,I,+BAQG,IAAD,OACP2B,GAAK0L,WAAU,SAAA5L,GACb,EAAKonB,cAAcpnB,MAGrB,IAAInD,EAA4B,EAApByH,OAAO4f,WACftnB,EAA8B,EAArB0H,OAAO6f,YAGpB,OACE,yBAAK9lB,MAAO,CAAC,MAAS,QAAS,OAAU,SACvC,4BACE+P,GAAG,WACHtF,IAAKvH,KAAKoI,OACV9M,MAAOA,EACPD,OAAQA,IAEV,kBAAC,GAAD,MACA,yBAAKgN,UAAU,0BACb,kBAAC,GAAD,CACEqE,MAAM,GACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAK3Z,KAAK2Z,IAAIzjB,KAAKuF,OAAS,EAAG,GAC/Bme,KAAK,IACLH,QAAQ,IACRe,WAAW,IACXD,IAAI,IACJD,YAAapkB,KAAK8lB,iBAAiB3E,KAAKnhB,QAE1C,wCAAcA,KAAK2kB,gBAAnB,MAED3kB,KAAK+lB,yB,GAjSezb,aCuGd0b,G,2KAjGX,IAAI5d,EACF,kBAAC,GAAD,CACEhF,KAAK,IACLiF,UAAU,aACV4d,IAAI,cACJ3qB,MAA2B,GAApByH,OAAO4f,WACdtnB,OAAO,OACPwL,QAAQ,IACRsC,MAAOnJ,KAAKmJ,QAIZ7N,EAA4B,GAApByH,OAAO4f,WACftnB,EAA8B,GAArB0H,OAAO6f,YAEpB,OACE,yBAAK/V,GAAG,mBAAmB/P,MAAO,CAAExB,MAAOA,EAAOD,OAAQA,IACvD+M,K,qCAML,IAAI8d,EACAC,EACAC,EAcJ,OAZI7pB,EAAYU,WAAWhB,SAAS,GAAGC,WACrCiD,QAAQyB,IAAI,gBACZslB,EAAQ5d,GAAUrL,WAAWmL,OAAO,IAElC7L,EAAYU,WAAWhB,SAAS,GAAGC,WACrCiD,QAAQyB,IAAI,gBACZulB,EAAQ7d,GAAUrL,WAAWmL,OAAO,IAElC7L,EAAYU,WAAWhB,SAAS,GAAGC,WACrCiD,QAAQyB,IAAI,gBACZwlB,EAAQ9d,GAAUrL,WAAWmL,OAAO,IAGpC,6BACE,yBAAKtL,MAAOif,IAAmBmK,GAC/B,yBAAKppB,MAAOmf,IAAmBkK,GAC/B,yBAAKrpB,MAAOof,IAAmBkK,EAA/B,Q,oCAKQ3nB,GACZuB,KAAKmJ,MAAQ1K,EAAMhC,O,gCAInB,OACGF,EAAYU,WAAWhB,SAAS,GAAGC,UACnCK,EAAYU,WAAWhB,SAAS,GAAGC,UACnCK,EAAYU,WAAWhB,SAAS,GAAGC,SAI7B8D,KAAKqmB,eAFLrmB,KAAKsmB,e,+BAMN,IAAD,OACP/pB,EAAY8N,WAAU,SAAA5L,GACpB,EAAK+jB,iBAEP7jB,GAAK0L,WAAU,SAAA5L,GACb,EAAKonB,cAAcpnB,MAGrB,IAAInD,EAA4B,GAApByH,OAAO4f,WACftnB,EAA8B,GAArB0H,OAAO6f,YAEpB,OACE,yBAAKva,UAAU,YAAYvL,MAAOkgB,IAChC,kBAACuJ,EAAA,EAAD,CAAMle,UAAU,YAAYvL,MAAOmgB,IACjC,kBAACuJ,EAAA,EAAD,CAAUne,UAAU,kBAClB,kBAACoe,EAAA,EAAD,KACG,IACD,4CAAsB,KAExB,yBACE5Z,GAAG,wBACH/P,MAAO,CAAExB,MAAOA,EAAOD,OAAQA,EAAQE,SAAU,aAEhDyE,KAAKjD,UACN,kBAAC,GAAD,c,GA1FWikB,IAAM1W,WCgNhBoc,G,kDAnNb,WAAYpf,GAAQ,IAAD,8BACjB,cAAMA,IAEDc,OAAS4Y,IAAMC,YACpB,EAAKxiB,MAAQ,CACXyK,KAAM,CAAC,IAAK,IAAK,KACjBD,MAAO,MAET,EAAKwB,WAAa,EAClB,EAAKlF,OAAS,EACd,EAAK8V,SAAW,EAChB,EAAKqJ,QAAUpd,EAAMlE,KACrB,EAAKyD,QAAU,EACf,EAAK8d,gBAAkB,EAMvB,EAAK3nB,KAAO,EACZ,EAAK4nB,eAAgB,EApBJ,E,gEAuBE,IAAD,OAClB5kB,KAAKT,UAAS,SAAAC,GAAS,MAAK,CAC1ByJ,MAAO,EAAKb,OAAOR,QAAQid,WAAW,Y,kCAI9BpoB,EAAMwO,GAChB,OACExO,EAAK8I,OAAS,GACd9I,EAAKwO,IACLxO,EAAKwO,GAAKvB,OACVjN,EAAKwO,GAAKvB,MAAMnE,OAAS,GACzB9I,EAAK8I,SAAWvF,KAAKyK,a,gCAIfnP,EAAOD,EAAQkK,EAAQmF,GACP,MAApB1K,KAAKsH,MAAMlE,OAAcpD,KAAKuF,OAASjK,GACnB,MAApB0E,KAAKsH,MAAMlE,OAAcpD,KAAKuF,OAASlK,GACnB,MAApB2E,KAAKsH,MAAMlE,OACK,IAAdpD,KAAKhD,KACPgD,KAAKuF,OAASmF,GACS,IAAd1K,KAAKhD,MAES,IAAdgD,KAAKhD,MAES,IAAdgD,KAAKhD,QAHdgD,KAAKuF,OAASmF,EAAanF,M,gCASvB4D,EAAO7N,EAAOD,EAAQkK,GAC9BuG,GACE,EACA9L,KAAKvB,MAAMwK,MACXE,EACA,EACAnJ,KAAKvB,MAAMyK,KACXlJ,KAAKhD,KACL1B,EACAD,EACAkK,GAEGvF,KAAKV,SACRU,KAAKV,OAASL,GAAU,M,8BAIpBkK,EAAOqB,GACTxK,KAAK4kB,gBACP5kB,KAAKhD,KAAOuN,GAAcpB,EAAOqB,GACjC3K,GAAWG,KAAKhD,MAChBgD,KAAK4kB,eAAgB,K,+EAILnmB,G,oFACdsM,GAAgBtM,EAAOuB,KAAKyK,cACxBtB,EAAQ1K,EAAMhC,KAChBgC,GAAS0K,IACL8B,EAAMnB,KAAK2Z,IAAIta,EAAM5D,OAAS,EAAG,GACnCvF,KAAKkY,YAAY/O,EAAO8B,KACpBxO,EAAO0M,EAAM8B,GACb3P,EAAQmB,EAAKmB,MAAMtC,MACnBD,EAASoB,EAAKmB,MAAMvC,OACpBoP,EAAatB,EAAM5D,OACnBmF,EAAajO,EAAKiN,MAAMnE,OAC9BvF,KAAK+kB,QAAQ5b,EAAO1M,EAAK+N,UACzBxK,KAAKikB,UAAU3oB,EAAOD,EAAQoP,EAAYC,GAC1C1K,KAAKglB,UAAU7b,EAAO7N,EAAOD,EAAQqP,EAAaD,GAClDzK,KAAKilB,cACLjlB,KAAKyK,WAAaA,EAClBzK,KAAKwiB,iB,wQAOLjZ,GACJvJ,KAAKvB,MAAMwK,MACXjJ,KAAKV,OACLU,KAAKqb,SACLrb,KAAKvB,MAAMyK,KACXlJ,KAAK0kB,SACL,G,OAEF1kB,KAAKwiB,c,sIAGGmE,GACJA,EACF3mB,KAAKyF,MAAMzF,KAAKqb,SAAS,GAOzBrb,KAAKyF,MAAMzF,KAAKqb,SAAS,GAM3Brb,KAAKilB,gB,4BAGDhnB,GACJ+B,KAAKqb,SAAWrb,KAAK4mB,MACnB9b,SAAS7M,GACT,EACA6L,KAAK2Z,IAAI,EAAGzjB,KAAKuF,OAAS,IAE5BvF,KAAKilB,gB,4BAGDU,EAAKnC,EAAKC,GACd,OAAO3Z,KAAK0Z,IAAI1Z,KAAK2Z,IAAIkC,EAAKnC,GAAMC,K,+BAG5B,IAAD,OAIP,OAHA9kB,GAAK0L,WAAU,SAAA5L,GACb,EAAKonB,cAAcpnB,MAGnB,6BACE,4BACEoO,GAAG,WACHtF,IAAKvH,KAAKoI,OAEV/M,OAAO,QAET,kBAAC,GAAD,MACA,yBAAKgN,UAAU,+BACb,kBAAC,GAAD,CACEqE,MAAM,GACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAK3Z,KAAK2Z,IAAIzjB,KAAKuF,OAAS,EAAG,GAC/Bme,KAAK,IACLH,QAAQ,IACRe,WAAW,IACXD,IAAI,IACJD,YAAapkB,KAAKyF,MAAM0b,KAAKnhB,QAE/B,4BACE6M,GAAG,eACHga,QAAS,WACP,EAAKC,WAAU,KAGhB,MAEH,4BACEja,GAAG,gBACHga,QAAS,WACP,EAAKphB,MAAM,KAHf,iBAQA,4BACEoH,GAAG,eACHga,QAAS,WACP,EAAKC,WAAU,KAGhB,MAlCL,OAqCE,8CAEE,2BACE9pB,KAAK,OACLF,MAAO,CAAExB,MAAO,QAChB2C,MAAO+B,KAAKqb,SACZkJ,SAAU,SAAApK,GAAK,OAAI,EAAK1U,MAAM0U,EAAMlK,OAAOhS,WAG/C,wCAAc+B,KAAKqb,SAAnB,W,GA7Me/Q,aCyCVyc,G,4MA/Cbb,MAAS,kBAAC,GAAD,CAAgB9iB,KAAK,M,EAC9B+iB,MAAS,kBAAC,GAAD,CAAgB/iB,KAAK,M,EAC9BgjB,MAAS,kBAAC,GAAD,CAAgBhjB,KAAK,M,uDAG5B,OACE,6BACE,yBAAKiF,UAAU,eAAevL,MAAOogB,IACnC,kBAACqJ,EAAA,EAAD,CAAMzpB,MAAOqgB,IACX,kBAACqJ,EAAA,EAAD,CAAU1pB,MAAOugB,IACf,kBAACoJ,EAAA,EAAD,KACG,IACD,yCAAmB,KAEpBzmB,KAAKkmB,SAKZ,yBAAK7d,UAAU,eAAevL,MAAOogB,IACnC,kBAACqJ,EAAA,EAAD,CAAMzpB,MAAOqgB,IACX,kBAACqJ,EAAA,EAAD,CAAU1pB,MAAOugB,IACf,kBAACoJ,EAAA,EAAD,KACG,IACD,yCAAmB,KAEpBzmB,KAAKmmB,SAKZ,yBAAK9d,UAAU,eAAevL,MAAOogB,IACnC,kBAACqJ,EAAA,EAAD,CAAMzpB,MAAOqgB,IACX,kBAACqJ,EAAA,EAAD,CAAU1pB,MAAOugB,IACf,kBAACoJ,EAAA,EAAD,KACG,IACD,yCAAmB,KAEpBzmB,KAAKomB,c,GAvCKpF,IAAM1W,W,oBC0KhB0c,G,kDA5Jb,WAAY1f,GAAQ,IAAD,8BACjB,cAAMA,IASR2f,YAAc,GAVK,EAWnBC,iBAAmB,GARjB,EAAKzoB,MAAQ,CACX8X,QAAS,GACT4Q,aAAc,IAEhB,EAAKC,QAAU,GAPE,E,+DAaA5nB,GACjB,IAAK,IAAI8F,EAAI,EAAGA,EAAI9F,EAAU+W,QAASjR,IAAK,CAC1C,IAAM0R,EAAMxX,EAAU+W,QAAQjR,GAC9B,GACE0R,GACAhX,KAAKvB,MAAM8X,QAAQjR,KAAO0R,EAAIna,MAC9BmD,KAAKonB,QAAQ9hB,KAAO0R,EAAI7E,QAExB,OAAO,EAGX,IAAK7M,EAAI,EAAGA,EAAI9F,EAAU2nB,aAAc7hB,IAAK,CAC3C,IAAM+hB,EAAW7nB,EAAU2nB,aAAa7hB,GACxC,GAAI+hB,GAAYrnB,KAAKvB,MAAM0oB,aAAa7hB,KAAO+hB,EAC7C,OAAO,EAGX,OAAO,I,6BAGF1Q,GACL,IAAMJ,EAAUgH,KAChBC,GAAkB7G,GAClBgH,GAAcpH,EAAQI,M,yCAGL8I,GACjB,IAD0B,IAAD,oBAEvB,IAAMzI,EAAMyI,EAAOna,GAEhB,EAAK7G,MAAM0oB,aAAaG,SAAStQ,EAAIlK,QACrC,EAAKoa,iBAAiBI,SAAStQ,EAAIlK,SAEpC,EAAKoa,iBAAiB1Q,KAAKQ,EAAIlK,OAC/B,EAAKvN,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErB2nB,aAAa,GAAD,oBAAM3nB,EAAU2nB,cAAhB,CAA8BnQ,EAAIlK,eAT3CxH,EAAI,EAAGA,EAAIma,EAAOla,OAAQD,IAAM,M,oCAe7BiR,GACZ,IADsB,IAAD,oBAEnB,IACMS,EAAMT,EADAjR,GAGT,EAAK7G,MAAM8X,QAAQ+Q,SAAStQ,EAAIna,OAChC,EAAKoqB,YAAYK,SAAStQ,EAAIna,QAE/B,EAAKoqB,YAAYzQ,KAAKQ,EAAIna,MAC1B,EAAK0C,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErB+W,QAAQ,GAAD,oBAAM/W,EAAU+W,SAAhB,CAAyBS,EAAIna,cAVjCyI,EAAI,EAAGA,EAAIiR,EAAQhR,OAAQD,IAAM,M,oCAgB9BiR,GACZ,IAAK,IAAIjR,EAAI,EAAGA,EAAIiR,EAAQhR,OAAQD,IAAK,CACvC,IACM0R,EAAMT,EADAjR,GAERtF,KAAKonB,QAAQ7hB,SAAWgR,EAAQhR,OAClCvF,KAAKonB,QAAQ9hB,GAAK0R,EAAI7E,QACb6E,GAAOhX,KAAKonB,QAAQ9hB,KAAO0R,EAAI7E,UACxCnS,KAAKonB,QAAQ9hB,GAAK0R,EAAI7E,QACtBnS,KAAKwiB,kB,gCAMT,OACE,6BACE,yBAAKna,UAAU,oBAAoBvL,MAAO8f,IACxC,kBAAC2J,EAAA,EAAD,CAAMzpB,MAAO+f,IACX,kBAAC2J,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACG,IACD,oDAA8B,MAGlC,kBAACc,GAAA,EAAD,CACElf,UAAU,UACV4J,SAAO,EACP3T,MAAM,YACNuO,GAAG,wBAJL,cAQA,6BACA,kBAAC2a,GAAA,EAAD,CAAsBC,QAAS,wBAC5BznB,KAAK0nB,yB,yCAWhB,IAHkB,IAAD,OACXnR,EAAUgH,KACZoK,EAAO,GAFM,aAIf,IAAMhR,EAAMrR,EACN6M,EAAUoE,EAAQI,GAAKxE,QAC7BwV,EAAKnR,KACH,kBAAC+Q,GAAA,EAAD,CACEtV,SAAO,EACP3T,MAAM,UACNuO,GAAG,YACHga,QAAS,WACP,EAAK1P,OAAOR,IAEdiR,OAAQzV,GAEPoE,EAAQI,GAAK9Z,QAbXyI,EAAI,EAAGA,EAAIiR,EAAQhR,OAAQD,IAAM,IAiB1C,OAAO,6BAAMqiB,K,+BAGL,IAAD,OAeP,OAdAnqB,GAAS6M,WAAU,SAAA5L,GACbA,IACF6e,KACA,EAAKuK,mBAAmBppB,EAAMtB,iBAGlC8W,GAAc5J,WAAU,SAAA5L,GAClBA,GAAS,EAAKA,MAAM8X,QAAQhR,SAAW9G,EAAM8X,QAAQhR,QACvD,EAAK+X,cAAc7e,EAAM8X,SAEvB9X,GAASA,EAAM8X,SACjB,EAAKuR,cAAcrpB,EAAM8X,YAGtB,6BAAMvW,KAAKjD,e,GAzJQikB,IAAM1W,WCyIrByd,G,kDAnJb,WAAYzgB,GAAQ,IAAD,8BACjB,cAAMA,IA+CR0gB,aAAe,SAACvrB,EAAMwO,GACpB,OACE,yBAAKnO,MAAOwe,GAAYN,IAAKve,EAAKI,MAChC,yBAAKC,MAAO8e,IACV,yBACEyJ,IAAK5oB,EAAKmB,MACVd,MAAOL,EAAKK,MACZmpB,IAAKxpB,EAAKI,KACVgqB,QAAS,kBAAM,EAAKoB,YAAYhd,SAxDvB,EA+DnBid,UAAY,WACV,IAAIC,EAAW,GAWf,OATIxpB,GAAK1B,WAAWR,MAClBkC,GAAK1B,WAAWR,KAAKgD,KAAI,SAAChD,EAAMwO,GAI9B,MAHkB,cAAdxO,EAAKO,MACPmrB,EAAS3R,KAAK,EAAKwR,aAAavrB,EAAMwO,IAEjC,QAIJ,6BAAMkd,IA3EI,EAiHnBC,eAAiB,WAEf,OADI,EAAKhgB,QAAQ,EAAKigB,SAAS,EAAKjgB,OAAOyc,WAAW,OAEpD,6BACE,4BACEtd,IAAK,EAAKwZ,UACVzlB,MAAM,QACND,OAAO,QACPitB,OAAO,MACPzb,GAAG,kBAxHT,EAAK3Q,SAAW,EAChB,EAAKiN,MAAQ,GACb,EAAK4X,UAAYC,IAAMC,YACvB,EAAK7Y,OAAS,KALG,E,gEASjBpI,KAAKoI,OAAS,IAAI8G,SAAOyS,OAAO3hB,KAAK+gB,UAAUnZ,W,kCAGrCqD,GACNjL,KAAK9D,WAAa+O,IACpBtM,GAAKY,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErBtD,SAAU+O,OAEZjL,KAAK9D,SAAW+O,K,oCAINxM,GACZ,GACEA,GACAA,EAAMhC,KAAK8I,OAAS,GACpB9G,EAAMhC,KAAK8I,SAAWvF,KAAKmJ,MAAM5D,OACjC,CAEA,IADA,IAAMgjB,EAAY9pB,EAAMhC,KAAK0a,QAAO,SAAA1a,GAAI,MAAkB,eAAdA,EAAKO,QACxCsI,EAAItF,KAAKmJ,MAAM5D,OAAQD,EAAIijB,EAAUhjB,OAAQD,IAAK,CACzD,IACM7I,EAAO8rB,EADDA,EAAUhjB,OAAS,GAGzBgT,EAAU,CACdiC,KAAM/d,EAAK+d,KACXlf,MAAOmB,EAAKmB,MAAMtC,MAClBD,OAAQoB,EAAKmB,MAAMvC,OACnBuO,KAAMnN,EAAKiN,MAAM,GACjB7M,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,MAGbgD,KAAKmJ,MAAMqN,KAAK+B,GAElBvY,KAAKwiB,iB,iCAkCEziB,EAASuM,EAAWrB,GAC7B,IAEMud,EAAOlc,EAAUhR,MACjBmtB,EAAOnc,EAAUjR,OAEnBqtB,EAAOzI,SAASC,cAAc,UAClCwI,EAAKptB,MAAQktB,EACbE,EAAKrtB,OAASotB,EACdC,EAAK7D,WAAW,MAAM3d,aAAaoF,EAAW,EAAG,GAEjD,IAAIlK,EAAI,GAAY6I,EAEpBlL,EAAQulB,UAAUoD,EAAMtmB,EADhB,EAXG,GACA,M,+BAcJrC,GACP,IAAK,IAAIuY,EAAI,EAAGA,EAAItY,KAAKmJ,MAAM5D,OAAQ+S,IAAK,CAC1C,IAAM7b,EAAOuD,KAAKmJ,MAAMmP,GACpB1O,EAAO,KAIX,GAHInN,IACFmN,EAAOnN,EAAKmN,MAEVA,GAAQnN,EAAKnB,MAAQ,GAAKmB,EAAKpB,OAAS,EAAG,CAG7C,IAFA,IAAMiR,EAAYvM,EAAQG,gBAAgBzD,EAAKnB,MAAOmB,EAAKpB,QAElD4P,EAAM,EAAGA,EAAMrB,EAAKrE,OAAQ0F,IACnCqB,EAAUtG,KAAKiF,GAAOrB,EAAKqB,GAG7BjL,KAAK2oB,WAAW5oB,EAASuM,EAAWgM,O,gCAqBxC,OACE,6BACGtY,KAAKkoB,YACLloB,KAAKooB,oB,+BAKF,IAAD,OAMP,OALAzpB,GAAK0L,WAAU,SAAA5L,GACb,EAAKonB,cAAcpnB,GACnB,EAAK+jB,iBAGA,yBAAK3V,GAAG,mBAAmB7M,KAAKjD,e,GAhJlBikB,IAAM1W,W,wCC+BxB,SAASse,GAAWthB,GAAQ,IAAD,EACNuhB,mBAAS,IADH,mBACzB1f,EADyB,KAClB2f,EADkB,OAEQC,aAAY,CAClDC,OAAQ,qCACRC,OAAQ,SAAAC,GACNJ,EACEI,EAAczpB,KAAI,SAAAhD,GAAI,OACpB+c,OAAO2P,OAAO1sB,EAAM,CAClB6a,QAASkJ,IAAIC,gBAAgBhkB,YAN/B2sB,EAFwB,EAExBA,aAAcC,EAFU,EAEVA,cAahB7qB,EAAS2K,EAAM1J,KAAI,SAAAhD,GAQvB,OAPIyb,GAAYzb,EAAKI,QACfob,KA7BV,SAAkBxb,GACE,cAAdA,EAAKO,KACPqa,GAAQ5a,GACe,eAAdA,EAAKO,KACdwa,GAAS/a,GACc,aAAdA,EAAKO,KACd2a,GAAQlb,GACe,qBAAdA,EAAKO,MACd8a,GAASrb,GAsBL6sB,CAAS7sB,GA1CjB,SAAiBA,GACG,cAAdA,EAAKO,KACPua,GAAO9a,GACgB,eAAdA,EAAKO,KACd0a,GAAQjb,GACe,aAAdA,EAAKO,KACd6a,GAAOpb,GACgB,qBAAdA,EAAKO,MACdgb,GAAQvb,GAoCJ8sB,CAAQ9sB,IAGL,QAWT,OARA+sB,qBACE,kBAAM,WAEJrgB,EAAMkQ,SAAQ,SAAA5c,GAAI,OAAI+jB,IAAIiJ,gBAAgBhtB,EAAK6a,eAEjD,CAACnO,IAID,6BAASd,UAAU,aACjB,wBAAS+gB,EAAa,CAAE/gB,UAAW,aACjC,0BAAWghB,KACV/hB,EAAMzK,KACN6b,GAAoBvP,EAAM5D,QAC1B/G,I,ICkIMkrB,G,kDAxMb,WAAYpiB,GAAQ,IAAD,8BACjB,cAAMA,IACD7I,MAAQ,CACXkrB,gBAAgB,EAChBC,gBAAgB,EAChBC,UAAW,GACXlZ,UAAW,IANI,E,8DAWjB,OACE,6BACE,kBAAC4W,GAAA,EAAD,CAAQjpB,MAAM,UAAU+J,UAAU,cAC/B,IACD,kBAACugB,GAAD,CAAY/rB,KAAK,gBAAiB,KAC1B,IAJZ,OAME,kBAAC0qB,GAAA,EAAD,CAAQjpB,MAAM,UAAU+J,UAAU,aAAawe,QAAS9G,IACrD,IADH,qBAEqB,KACX,IATZ,U,wCAgBF,OACE,6BACE,kBAACwH,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,qBACVwe,QAAS,SAAA9W,GAAC,OAAIgF,GAAQZ,GAAMC,QAH9B,kBAMU,IAPZ,U,oCAsBFpU,KAAKT,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErBmqB,gBAAiBnqB,EAAUmqB,sB,wCAIbxP,GAChB,GAAIA,GAASA,EAAMlK,QAAUkK,EAAMlK,OAAOhS,MAAO,CAC/C,IAAI6rB,EAAS3P,EAAMlK,OAAOhS,MAC1B+B,KAAKT,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErBqqB,UAAWC,U,oCAMf9Y,GAAY,KAAMhR,KAAKvB,MAAMorB,WAC7B7pB,KAAK+pB,gB,yCAIL/pB,KAAKT,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErBoqB,gBAAiBpqB,EAAUoqB,sB,6CAIRzP,GACrB,GAAIA,GAASA,EAAMlK,QAAUkK,EAAMlK,OAAOhS,MAAO,CAC/C,IAAI6rB,EAAS3P,EAAMlK,OAAOhS,MAC1B+B,KAAKT,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErBmR,UAAWmZ,U,yCAMfnY,GAAiB,KAAM3R,KAAKvB,MAAMkS,WAClC3Q,KAAKgqB,qB,mDAGwB,IAAD,OAC5B,OACE,kBAACC,GAAA,EAAD,CAAOC,OAAQlqB,KAAKvB,MAAMkrB,eAAgBQ,OAAQ,kBAAM,EAAKJ,eAAe1hB,UAAU,eACpF,kBAAC+hB,GAAA,EAAD,KACE,2BACEptB,KAAK,OACLiB,MAAO+B,KAAKvB,MAAMorB,UAClBtF,SAAU,SAACxU,GAAD,OAAO,EAAKsa,kBAAkBta,MAJ5C,QAME,kBAACwX,GAAA,EAAD,CAAQV,QAAS,kBAAM,EAAKyD,gBAEzB,IAFH,eAGe,S,mDAOQ,IAAD,OAC5B,OACE,kBAACL,GAAA,EAAD,CAAOC,OAAQlqB,KAAKvB,MAAMmrB,eAAgBO,OAAQ,kBAAM,EAAKH,oBAAoB3hB,UAAU,qBACzF,kBAAC+hB,GAAA,EAAD,KACE,2BACEptB,KAAK,OACLiB,MAAO+B,KAAKvB,MAAMkS,UAClB4T,SAAU,SAACxU,GAAD,OAAO,EAAKwa,uBAAuBxa,MAJjD,QAME,kBAACwX,GAAA,EAAD,CAAQV,QAAS,kBAAM,EAAK2D,qBAEzB,IAFH,qBAGqB,S,wCAQV,IAAD,OAChB,OACE,6BACE,kBAACjD,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,WACVwe,QAAS,SAAA9W,GAAC,OAAIgO,OAHhB,QAMU,IAPZ,OASE,kBAACwJ,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,WACVwe,QAAS,SAAA9W,GAAC,OAAIiO,OAHhB,QAMU,IAfZ,OAiBE,kBAACuJ,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,aACVwe,QAAS,SAAA9W,GAAC,OAAI8C,OAHhB,UAMU,IAvBZ,OAyBE,kBAAC0U,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,iBACVwe,QAAS,SAAA9W,GAAC,OAAI,EAAKga,gBAHrB,cAMU,IA/BZ,OAiCE,kBAACxC,GAAA,EAAD,CACEjpB,MAAM,UACN+J,UAAU,iBACVwe,QAAS,SAAA9W,GAAC,OAAI,EAAKia,qBAHrB,cAMU,IAvCZ,OAyCGhqB,KAAKyqB,6BACLzqB,KAAK0qB,gC,+BAMV,OACE,yBAAK5tB,MAAO,CAAElB,QAAS,aACrB,kBAAC+uB,GAAA,EAAD,CACErsB,MAAM,QACNssB,OAAK,EACLviB,UAAU,6CACVwiB,OAAO,MAEN7qB,KAAK8qB,kBACL9qB,KAAK+qB,kBACL/qB,KAAKgrB,wB,GAnMIhK,IAAM1W,WCqBX2gB,G,4MAxBbC,UAAY,E,EACZ/tB,YAAc,G,uDAEJ,IAAD,OAiBP,OAhBAD,GAAQmN,WAAU,SAAA5L,GAChB,GAAIA,GAAS,EAAKysB,YAAczsB,EAAM/B,KACpC,IAAK,IAAI4I,EAAI,EAAGA,EAAI7G,EAAMhC,KAAK8I,OAAQD,IAAK,CAC1C,IAAM0Q,EAAOvX,EAAMhC,KAAK6I,GAAG0Q,KACvBA,IACFD,GAAsBC,GACtB,EAAKkV,UAAYzsB,EAAM/B,UAK/Bc,GAAS6M,WAAU,SAAA5L,GACb,EAAKtB,cAAgBsB,EAAMtB,cAC7B,EAAKA,YAAcsB,EAAMtB,gBAGtB,yBAAK0P,GAAG,sB,GArBKmU,IAAM1W,W,oBCiSf6gB,G,kDA/Qb,WAAa7jB,GAAQ,IAAD,8BAClB,cAAMA,IACD6B,MAAQ,GACb,EAAK4X,UAAYC,IAAMC,YACvB,EAAKxiB,MAAQ,CACXyK,KAAM,CAAC,IAAK,IAAK,MAEnB,EAAKkiB,OAPa,E,mDAWlBprB,KAAKT,UAAS,SAAAC,GAAS,kCAClBA,GADkB,IAErByJ,MAAO,KAEPoiB,IAAK,OAEPrrB,KAAKyK,WAAa,EAOlBzK,KAAKhD,KAAO,EACZgD,KAAK4kB,eAAgB,EAErB5kB,KAAKqb,SAAiB,EACtBrb,KAAKsrB,kBAAoB,EACzBtrB,KAAK0kB,QAAiB,EACtB1kB,KAAKuF,OAAiB,EAEtBvF,KAAKwD,QAAiB,KACtBxD,KAAKurB,gBAAiB,EACtBvrB,KAAKwrB,QAAU,EACfxrB,KAAKzB,QAAU,O,0CAIf,IACM0K,EADS,IAAIiG,SAAOyS,OAAO3hB,KAAK+gB,UAAUnZ,SAC3Bid,WAAW,MAEhC7kB,KAAKT,UAAS,SAAAC,GAAS,MAAK,CAC1ByJ,MAAOA,Q,qCAIIE,GAEb,IADA,IAAMof,EAAYpf,EAAMgO,QAAO,SAAA1a,GAAI,MAAkB,eAAdA,EAAKO,QACnCsI,EAAItF,KAAKmJ,MAAM5D,OAAQD,EAAIijB,EAAUhjB,OAAQD,IAAK,CACzD,IACM7I,EAAO8rB,EADDA,EAAUhjB,OAAS,GAGzBgT,EAAU,CACdiC,KAAM/d,EAAK+d,KACXlf,MAAOmB,EAAKmB,MAAMtC,MAClBD,OAAQoB,EAAKmB,MAAMvC,OACnBkK,OAAQ9I,EAAKiN,MAAMnE,OACnBqE,KAAMnN,EAAKiN,MAAM,GACjB7M,KAAMJ,EAAKI,KACXG,KAAMP,EAAKO,MAGbgD,KAAKmJ,MAAMqN,KAAK+B,GAGlB,IADA,IAAMiN,EAAWrc,EAAMgO,QAAO,SAAA1a,GAAI,MAAkB,cAAdA,EAAKO,QAClC2C,EAAIK,KAAKmJ,MAAM5D,OAAQ5F,EAAI6lB,EAASjgB,OAAQ5F,IACnDK,KAAKmJ,MAAMqN,KAAKgP,EAAS7lB,M,mCAIhB8K,EAAYC,GACL,IAAd1K,KAAKhD,KACPgD,KAAKuF,OAASmF,EAAW,EAEJ,IAAd1K,KAAKhD,KACZgD,KAAKuF,OAASmF,EAEO,IAAd1K,KAAKhD,KACZgD,KAAKuF,OAASkF,EAEO,IAAdzK,KAAKhD,KACZgD,KAAKuF,OAASkF,EAAa,EAEN,IAAdzK,KAAKhD,OACZgD,KAAKuF,OAASkF,K,6BAIXA,GACL,OAAkB,IAAdzK,KAAKhD,KACA8M,KAAK2Z,IAAKhZ,EAAa,EAAI,GAEb,IAAdzK,KAAKhD,KACJ8N,SAAS9K,KAAKsH,MAAMT,SAAS,EAEhB,IAAd7G,KAAKhD,MAGS,IAAdgD,KAAKhD,MAGS,IAAdgD,KAAKhD,KALL8M,KAAK2Z,IAAKhZ,EAAa,EAAI,QAK/B,I,gCAKGtB,EAAO7N,EAAOD,EAAQkK,GAC9BuG,GAAiB,EAAG9L,KAAKvB,MAAMwK,MAAOE,EAAO,EAAGnJ,KAAKvB,MAAMyK,KAAMlJ,KAAKhD,KAAM1B,EAAOD,EAAQkK,GACtFvF,KAAKV,SACRU,KAAKV,OAASL,GAAU,M,8BAIpBkK,EAAOqB,GACTxK,KAAK4kB,gBACP5kB,KAAKhD,KAAOuN,GAAcpB,EAAOqB,GACjC3K,GAAWG,KAAKhD,MAChBgD,KAAK4kB,eAAgB,K,qCAIVnoB,EAAMwO,GACnB,OACGxO,EAAK8I,OAAS,GACd9I,EAAKwO,IACLxO,EAAK8I,SAAWvF,KAAKyK,YACF,cAAnBhO,EAAKwO,GAAKjO,O,oCAIDyB,GACZ,GAAIsM,GAAgBtM,EAAOuB,KAAKmJ,MAAM5D,QAAS,CAC7C,IAAI0F,EAAMjL,KAAKyrB,OAAOhtB,EAAMhC,KAAK8I,QAC3B4D,EAAQ1K,EAAMhC,KACpB,GACEuO,GAAc7B,EAAO8B,EAAKjL,KAAKyK,YAC/B,CACA,IAAMhO,EAAO0M,EAAM8B,GACb3P,EAAQmB,EAAKmB,MAAMtC,MACnBD,EAASoB,EAAKmB,MAAMvC,OACpBoP,EAAatB,EAAM5D,OACnBmF,EAAajO,EAAKiN,MAAMnE,OAE9BvF,KAAKmlB,eAAehc,GACpBnJ,KAAK+kB,QAAQ5b,EAAO1M,EAAK+N,UACzBxK,KAAK0rB,aAAajhB,EAAYC,GAC9B1K,KAAKglB,UAAU7b,EAAO7N,EAAOD,EAAQqP,GACrC1K,KAAKyK,WAAazK,KAAKmJ,MAAM5D,OAC7BvF,KAAKvD,KAAOA,EAEZ2O,GAAYjC,EAAM1K,EAAMvC,UAAW8D,KAAKsH,MAAMT,SAC9C4E,GAAmBX,SAAS9K,KAAKsH,MAAMT,SAAS,EAAI7G,KAAKuF,aAGzDvF,KAAKklB,eAAe/b,EAAO8B,KAE3BjL,KAAKmlB,eAAehc,GACpBnJ,KAAKhD,KAAO,EACZgD,KAAK0rB,aAAaviB,EAAM5D,OAAQ,GAEhC6F,GAAYpL,KAAKmJ,MAAMnJ,KAAKqb,UAAWrb,KAAKsH,MAAMT,SAClD4E,GAAmBX,SAAS9K,KAAKsH,MAAMT,SAAS,EAAI7G,KAAKuF,SAG7DvF,KAAKwiB,gB,wCAEW/jB,GAChB,IAAMF,EAAUE,EAAMxC,SAAS+D,KAAKsH,MAAMT,QAAQ,GAAG9I,SAASH,MAAMK,MAChEM,GAAYyB,KAAKzB,UAAYA,IAC/ByB,KAAKzB,QAAUA,EACfyB,KAAKwiB,iB,qCAGM/jB,GACb,GAAIA,EAAO,CACT,IAAM4c,EAAW5c,EAAMK,aAAagM,SAAS9K,KAAKsH,MAAMT,SAAS,GAC7D7G,KAAKqb,WAAaA,IACpBrb,KAAKsrB,kBAAoBtrB,KAAK0lB,aAAa5a,SAASuQ,IAEhDrb,KAAKhD,KAAO,GACdgD,KAAKilB,cACLjlB,KAAKqoB,YAEgB,IAAdroB,KAAKhD,MACZoO,GAAYpL,KAAKmJ,MAAM2B,SAASuQ,IAAYrb,KAAKsH,MAAMT,SAEzD7G,KAAKwiB,cACLxiB,KAAKqb,SAAWA,M,mCAKTpd,GACX,OAAkB,IAAd+B,KAAKhD,KACU,EAARiB,GAAc6M,SAAS9K,KAAKsH,MAAMT,SAAS,GAE/B,IAAd7G,KAAKhD,KACHiB,GAAU6M,SAAS9K,KAAKsH,MAAMT,SAAS,GAAK7G,KAAKuF,OAErC,IAAdvF,KAAKhD,MAGS,IAAdgD,KAAKhD,KAFK,EAARiB,GAAc6M,SAAS9K,KAAKsH,MAAMT,SAAS,GAK/B,IAAd7G,KAAKhD,KACLiB,OADJ,I,oCAMLsL,GACEvJ,KAAKvB,MAAMwK,MACXjJ,KAAKV,OACLU,KAAKsrB,kBACLtrB,KAAKvB,MAAMyK,KACXlJ,KAAK0kB,SACL,GAEF1kB,KAAKurB,gBAAiB,EACtBvrB,KAAKwiB,gB,qJAIAxiB,KAAKV,SACRU,KAAKV,OAASL,GAAU,KAEtBe,KAAKV,O,gCACcU,KAAKV,OAAOyG,e,OAAjC/F,KAAKwD,Q,6PAKPxD,KAAKzB,QAAUqN,GAAgB5L,KAAKwD,QAAQwC,KAAMhG,KAAKwD,QAAQlI,MAAO0E,KAAKwD,QAAQnI,QACnFmN,GAAcxI,KAAKvD,KAAMuD,KAAKzB,QAASyB,KAAKsH,MAAMT,S,oPAI7C7G,KAAKurB,iBACRvrB,KAAK2rB,eACD3rB,KAAKwD,SAAYxD,KAAKwD,QAAQwC,KAAKT,OAAS,IAC9CvF,KAAK4rB,aACL5rB,KAAKurB,gBAAiB,I,4IAO1B,OADAvrB,KAAKqoB,WACE/f,GAAUrL,WAAWmL,OAAOpI,KAAKsH,MAAMT,QAAU,K,+BAGhD,IAAD,OAYP,OAXAlI,GAAK0L,WAAU,SAAA5L,GACb,EAAKonB,cAAcpnB,GACnB,EAAK+jB,iBAEP5jB,GAAKyL,WAAU,SAAA5L,GACb,EAAKotB,kBAAkBptB,MAEzBO,GAAOqL,WAAU,SAAA5L,GACf,EAAKqtB,eAAertB,MAIpBuB,KAAK+rB,oB,GA3Qe/K,IAAM1W,W,6BC6DjB0hB,G,4MA7EbvtB,MAAQ,CACNwtB,oBAAoB,EACpB3tB,MAAO,CACLgI,EAAG,MACHC,EAAG,MACHC,EAAG,KACHnG,EAAG,M,EAIP6rB,YAAc,WACZ,EAAK3sB,SAAS,CAAE0sB,oBAAqB,EAAKxtB,MAAMwtB,sB,EAGlDE,YAAc,WACZ,EAAK5sB,SAAS,CAAE0sB,oBAAoB,K,EAGtCG,aAAe,SAAA9tB,GACb,EAAKiB,SAAS,CAAEjB,MAAOA,EAAM+sB,O,EAG/BgB,qBAAuB,SAAA/tB,GACrB,EAAKiB,SAAS,CAAEjB,MAAOA,EAAM+sB,MAC7B,EAAK/jB,MAAMuf,QAAQ,CAAEvoB,MAAOA,EAAMguB,O,uDAIlC,IAAMC,EAASC,KAAS,CACtBC,QAAS,CACPnuB,MAAO,CACLhD,MAAO,OACPD,OAAQ,OACRkgB,aAAc,MACdmR,WAAW,QAAD,OAAU1sB,KAAKvB,MAAMH,MAAMgI,EAA3B,aAAiCtG,KAAKvB,MAAMH,MAAMiI,EAAlD,aAAwDvG,KAAKvB,MAAMH,MAAMkI,EAAzE,aAA+ExG,KAAKvB,MAAMH,MAAM+B,EAAhG,MAEZssB,OAAQ,CACN/wB,QAAS,MACT8wB,WAAY,OACZnR,aAAc,MACdqR,UAAW,2BACX7vB,QAAS,eACT8vB,OAAQ,WAEVC,QAAS,CACPvxB,SAAU,WACVygB,OAAQ,KAEV+Q,MAAO,CACLxxB,SAAU,QACVwR,IAAK,MACLigB,MAAO,MACPC,OAAQ,MACRjgB,KAAM,UAKZ,OACE,6BACE,yBAAKlQ,MAAOyvB,EAAOI,OAAQ9F,QAAS7mB,KAAKksB,aACvC,yBAAKpvB,MAAOyvB,EAAOjuB,SAEpB0B,KAAKvB,MAAMwtB,mBACV,yBAAKnvB,MAAOyvB,EAAOO,SACjB,yBAAKhwB,MAAOyvB,EAAOQ,MAAOlG,QAAS7mB,KAAKmsB,cACxC,kBAAC,gBAAD,CACE7tB,MAAO0B,KAAKvB,MAAMH,MAClBimB,SAAUvkB,KAAKosB,aACfc,iBAAkBltB,KAAKqsB,wBAGzB,U,GAzEcrL,IAAM1W,WCsRjB6iB,G,4MAzPbC,gBAAkB,WAChBvN,GAAiB,EAAKvY,MAAMuB,IAC5BiX,GAAc,EAAKxY,MAAMuB,IACzB,EAAK2Z,e,kEAPLxiB,KAAK2kB,gBAAkB,EACvB3kB,KAAKqtB,gBAAkB,I,uCASRpvB,GACfmd,GAAiBtQ,SAAS9K,KAAKsH,MAAMuB,IAAM,EAAG5K,K,wCAG9BQ,GAChB,IAAMiN,EAAMjN,EAAMM,QAAQ+L,SAAS9K,KAAKsH,MAAMuB,IAAM,GAChD7I,KAAKqtB,kBAAoB3hB,IAC3B1L,KAAKqtB,gBAAkB3hB,EACvB1L,KAAKwiB,iB,oCAIKvkB,GACZqgB,GAAiBrgB,EAAO+B,KAAKsH,MAAMuB,M,oCAGvB5K,GACZugB,GAAevgB,EAAO+B,KAAKsH,MAAMuB,M,oCAGrB5K,GACZygB,GAAiBzgB,EAAO+B,KAAKsH,MAAMuB,M,oCAGvB5K,GACZ2gB,GAAiB3gB,EAAO+B,KAAKsH,MAAMuB,M,qCAGtB5K,GACb+gB,GAAc/gB,EAAO+B,KAAKsH,MAAMuB,M,iCAGvB5K,GACT6gB,GAAY7gB,EAAO+B,KAAKsH,MAAMuB,M,wCAI9ByV,GAAiB,MAAOte,KAAKsH,MAAMuB,M,sCAInC2V,GAAe,MAAOxe,KAAKsH,MAAMuB,M,wCAIjC6V,GAAiB,QAAS1e,KAAKsH,MAAMuB,M,wCAIrC+V,GAAiB,MAAO5e,KAAKsH,MAAMuB,M,qCAInCmW,GAAc,MAAOhf,KAAKsH,MAAMuB,M,+BAGxB,IAAD,OACP7J,GAAOqL,WAAU,SAAA5L,GACf,EAAK6uB,kBAAkB7uB,MAGzB,IAAI8uB,EAAgBvtB,KAAKutB,cACrBC,EAAgBxtB,KAAKwtB,cACrBC,EAAgBztB,KAAKytB,cACrBC,EAAgB1tB,KAAK0tB,cACrBC,EAAiB3tB,KAAK2tB,eACtBC,EAAa5tB,KAAK4tB,WAElB3H,EAAM,KAAOjmB,KAAKsH,MAAMuB,GAAK,aAC7BT,EACF,kBAAC,GAAD,CACEC,UAAU,aACV4d,IAAKA,EACL5qB,OAAO,QACPwL,QAAS7G,KAAKsH,MAAMuB,GACpB/L,MAAO6f,KAGPhG,EAAMpa,EAAYU,WAAWhB,SAAS+D,KAAKsH,MAAMuB,GAAK,GAAG3M,SAG7D,OADAiD,QAAQyB,IAAI,WAAaZ,KAAKsH,MAAMuB,GAAK,MAAQ8N,GAE/C,6BACE,kBAAC4Q,GAAA,EAAD,CACElf,UAAU,aACV4J,SAAO,EACP3T,MAAM,UACNuO,GAAG,cACHga,QAAS,WACP,EAAKuG,mBAEPxF,OAAQjR,GARV,qBAUc3W,KAAKsH,MAAMuB,KAX3B,OAcE,kBAAC0e,GAAA,EAAD,CACElf,UAAU,UACV4J,SAAO,EACP3T,MAAM,YACNuO,GAAE,cAAS7M,KAAKsH,MAAMuB,KAJxB,QAQA,kBAAC2e,GAAA,EAAD,CAAsBC,QAAO,eAAUznB,KAAKsH,MAAMuB,KAChD,kBAAC0d,EAAA,EAAD,CAAMzpB,MAAOsf,IACX,kBAACoK,EAAA,EAAD,CAAU1pB,MAAO2f,IACf,yBAAKpU,UAAU,kCACb,kBAAC,GAAD,CACEqE,MAAM,GACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAK3Z,KAAK2Z,IAAIzjB,KAAKqtB,gBAAkB,EAAG,GACxC3J,KAAK,IACLH,QAAQ,IACRe,WAAW,IACXD,IAAI,IACJD,YAAapkB,KAAK8lB,iBAAiB3E,KAAKnhB,SAG5C,wCAAcA,KAAK2kB,gBAAnB,KACA,8CACA,kBAAC,GAAD,CACErmB,MAAOsvB,EAAWzM,KAAKnhB,MACvB6mB,QAAS+G,EAAWzM,KAAKnhB,QAE3B,6BACA,yBAAKqI,UAAU,4BACb,kBAAC,GAAD,CACEqE,MAAM,UACNpR,MAAM,MACNkoB,IAAI,MACJC,IAAI,MACJC,KAAK,MACLH,QAAQ,IACRe,WAAW,MACXD,IAAI,IACJD,YAAauJ,EAAexM,KAAKnhB,QAEnC,4BACE6M,GAAG,cACHga,QAAS,WACP,EAAKgH,iBAHT,0BASF,6BACA,6BACA,yBAAKxlB,UAAU,+BACb,kBAAC,GAAD,CACEqE,MAAM,aACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAI,IACJC,KAAK,MACLH,QAAQ,IACRe,WAAW,MACXD,IAAI,IACJD,YAAamJ,EAAcpM,KAAKnhB,QAElC,4BACE6M,GAAG,aACHga,QAAS,WACP,EAAKiH,oBAHT,qBASF,yBAAKzlB,UAAU,6BACb,kBAAC,GAAD,CACEqE,MAAM,WACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAI,KACJC,KAAK,IACLH,QAAQ,IACRe,WAAW,KACXD,IAAI,IACJD,YAAaoJ,EAAcrM,KAAKnhB,QAElC,4BACE6M,GAAG,aACHga,QAAS,WACP,EAAKkH,kBAHT,mBASF,yBAAK1lB,UAAU,+BACb,kBAAC,GAAD,CACEqE,MAAM,aACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAI,MACJC,KAAK,IACLH,QAAQ,MACRe,WAAW,IACXD,IAAI,IACJD,YAAaqJ,EAActM,KAAKnhB,QAElC,4BACE6M,GAAG,aACHga,QAAS,WACP,EAAKmH,oBAHT,qBASF,yBAAK3lB,UAAU,+BACb,kBAAC,GAAD,CACEqE,MAAM,aACNpR,MAAM,MACNkoB,IAAI,IACJC,IAAI,MACJC,KAAK,IACLH,QAAQ,IACRe,WAAW,IACXD,IAAI,IACJD,YAAasJ,EAAcvM,KAAKnhB,QAElC,4BACE6M,GAAG,aACHga,QAAS,WACP,EAAKoH,oBAHT,qBASF,yBAAKnxB,MAAO4f,IAAqBtU,W,GAtPzB4Y,IAAM1W,WC4Bb4jB,G,uKA1CX,OACE,yBAAK7lB,UAAU,sBAAsBvL,MAAOqf,IAC1C,kBAACgS,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAKC,GAAG,KACN,kBAAC9H,EAAA,EAAD,CAAMzpB,MAAOsf,IACX,kBAACoK,EAAA,EAAD,CAAU1pB,MAAO2f,IACf,kBAACgK,EAAA,EAAD,KACG,IACD,2CAAqB,KAEvB,kBAAC,GAAD,CAAS5d,GAAG,SAIlB,kBAACulB,GAAA,EAAD,CAAKC,GAAG,KACN,kBAAC9H,EAAA,EAAD,CAAMzpB,MAAOsf,IACX,kBAACoK,EAAA,EAAD,CAAU1pB,MAAO2f,IACf,kBAACgK,EAAA,EAAD,KACG,IACD,2CAAqB,KAEvB,kBAAC,GAAD,CAAS5d,GAAG,SAIlB,kBAACulB,GAAA,EAAD,CAAKC,GAAG,KACN,kBAAC9H,EAAA,EAAD,CAAMzpB,MAAOsf,IACX,kBAACoK,EAAA,EAAD,CAAU1pB,MAAO2f,IACf,kBAACgK,EAAA,EAAD,KACG,IACD,2CAAqB,KAEvB,kBAAC,GAAD,CAAS5d,GAAG,e,GAlCAmY,IAAM1W,W,UCiDnBgkB,G,uKAzCX,OACE,yBAAKjmB,UAAU,OAAOvL,MAAO1B,GAC3B,kBAACmzB,GAAA,EAAD,CAAWzyB,OAAK,EAACgB,MAAOpB,GACtB,kBAACyyB,GAAA,EAAD,CAAKrxB,MAAO,CAAEnB,eAAgB,kBAC5B,kBAACyyB,GAAA,EAAD,CAAKI,GAAG,QACN,kBAAC,GAAD,OAEF,kBAACJ,GAAA,EAAD,CAAKI,GAAG,QACN,wBACE1xB,MAAO,CACLwB,MAAO,OACPmwB,cAAe,SACf7yB,QAAS,aAJb,aAaN,kBAAC2yB,GAAA,EAAD,CAAWzxB,MAAOjB,GAChB,kBAACsyB,GAAA,EAAD,CAAKrxB,MAAOtB,GACV,kBAAC4yB,GAAA,EAAD,CAAKI,GAAG,KACN,kBAAC,GAAD,MACA,kBAAC,GAAD,OAGF,kBAACJ,GAAA,EAAD,CAAKI,GAAG,KACN,kBAAC,GAAD,MACA,kBAAC,GAAD,MACA,kBAAC,GAAD,SAIN,kBAAC,GAAD,W,GArCSxN,IAAM1W,WCVvB,SAASokB,KACP,OACE,6BACE,kBAAC,GAAD,OAKN,IAAMC,GAAc1O,SAAS2O,eAAe,QAC5CC,IAASC,OAAO,kBAACJ,GAAD,MAAiBC,M","file":"static/js/main.a512f949.chunk.js","sourcesContent":["export const mainStyle = {\n  height: '100%',\n  width: '100%',\n  position: 'relative',\n};\nexport const rowStyle = {\n  flex: 1.0,\n  position: 'relative',\n};\nexport const cardStyle = {\n  flex: 0.1,\n  position: 'relative',\n};\n\nexport const buttonGroupStyle = {\n  size: 'sm',\n  vertical: false,\n  flex: 1.0,\n  padding: '0px 7px 7px 7px',\n};\n\nexport const mainMenuStyle = {\n  width: '100%',\n  flex: 0.1,\n  justifyContent: 'space-between',\n  padding: 0,\n  position: 'relative',\n};\n\nexport const containerStyle = {\n  fluid: true,\n  maxWidth: '100%',\n};\n\nexport const canvasThumbnail = {\n  position: 'center',\n  height: '100px',\n  width: '88px',\n  zIndex: '3',\n};\n","import create from 'zustand';\n\nexport const initState = {\n  channels: [\n    {\n      selected: false,\n    },\n    {\n      selected: false,\n    },\n    {\n      selected: false,\n    },\n  ],\n  lastSelected: 1,\n  dev: 0,\n};\n\nexport const [useMainSettings, settingsApi] = create(set => ({\n  ...initState,\n}));\n\nexport function updateChannelSel(channel) {\n  settingsApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.selected = !prevState.channels[j].selected;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nexport function updateLastSel(channel) {\n  settingsApi.setState(prevState => ({\n    ...prevState,\n    lastSelected: channel,\n  }));\n}\n","import create from 'zustand';\nimport { settingsApi } from '../mainSettings.js';\n// import {\n//   settingsApi,\n// } from './index.js';\n\nexport const initState = () => {\n  return settingsApi.getState().dev ? devState : prodState;\n};\n\nexport const prodState = {\n  file: [],\n  size: 0,\n  selected: 0,\n  total: 0,\n};\n\nexport const devState = {\n  file: [\n    {\n      name: 'brom.jpeg',\n      // image: require('./../ui/assets/images/brom.jpeg'),\n      style: {\n        display: 'block',\n        width: 'auto',\n        height: '100%',\n      },\n      type: 'image/png',\n    },\n  ],\n  size: 1,\n  selected: 0,\n  total: 0,\n};\n\nexport const [useFileStore, fileApi] = create(set => ({\n  ...initState(),\n}));\n","import create from 'zustand';\n\nconst initState = {\n  annotations: [],\n};\n\nconst redoState = {\n  redoAnnotations: [],\n};\n\nconst undoState = {\n  undoAnnotations: [],\n};\n\nexport const [useAnnotStore, annotApi] = create(set => ({\n  ...initState,\n}));\n\nexport const [useRedoStore, redoApi] = create(set => ({\n  ...redoState,\n}));\n\nexport const [useCacheStore, undoApi] = create(set => ({\n  ...undoState,\n}));\n","import create from 'zustand';\nimport * as THREE from 'three';\n\nexport const createTexture = image => {\n  return new THREE.TextureLoader().load(image);\n};\n\nexport const createTextureFromTiff = (imagedata, width, height) => {\n  const data = new Uint8Array(imagedata)\n\n  var texture =  new THREE.DataTexture(data, width, height, THREE.RGBAFormat)\n  texture.needsUpdate = true;\n  // console.log(\"imageStore::createTextureFromTiff() - texture generated from imagedata with width and height: \", texture, imagedata, width, height)\n  return texture\n};\n\nconst initState = {\n  channels: [\n    {\n      uniforms: {\n        brightness: {\n          value: '0.0',\n        },\n        contrast: {\n          value: '0.0',\n        },\n        whitepoint: {\n          value: '255.0',\n        },\n        blackpoint: {\n          value: '0.0',\n        },\n        opacity: {\n          value: '0.0',\n        },\n        color: {\n          value: '',\n        },\n        image: {\n          value: '',\n        },\n      },\n      texture: null,\n      name: '',\n      type: '',\n    },\n    {\n      uniforms: {\n        brightness: {\n          value: '0.0',\n        },\n        contrast: {\n          value: '0.0',\n        },\n        whitepoint: {\n          value: '235.0',\n        },\n        blackpoint: {\n          value: '16.0',\n        },\n        opacity: {\n          value: '0.0',\n        },\n        color: {\n          value: '',\n        },\n        image: {\n          value: '',\n        },\n      },\n      texture: null,\n      name: '',\n      type: '',\n    },\n    {\n      uniforms: {\n        brightness: {\n          value: '0.0',\n        },\n        contrast: {\n          value: '0.0',\n        },\n        whitepoint: {\n          value: '235.0',\n        },\n        blackpoint: {\n          value: '16.0',\n        },\n        opacity: {\n          value: '0.0',\n        },\n        color: {\n          value: '',\n        },\n        image: {\n          value: '',\n        },\n      },\n      texture: null,\n      name: '',\n      type: '',\n    },\n    {\n      uniforms: {\n        brightness: {\n          value: '0.0',\n        },\n        contrast: {\n          value: '0.0',\n        },\n        whitepoint: {\n          value: '235.0',\n        },\n        blackpoint: {\n          value: '16.0',\n        },\n        opacity: {\n          value: '0.0',\n        },\n        color: {\n          value: '',\n        },\n        image: {\n          value: '',\n        },\n      },\n      texture: null,\n      name: '',\n      type: '',\n    },\n  ],\n};\n\nexport const [useUniformStore, uniApi] = create(set => ({\n  ...initState,\n  update: (\n    brightness,\n    contrast,\n    whitepoint,\n    blackpoint,\n    opacity,\n    color,\n    image\n  ) =>\n    set(state => ({\n      ...state,\n      uniforms: {\n        ...state.uniforms,\n        brightness: {\n          ...state.uniforms.brightness,\n          value: brightness,\n        },\n        contrast: {\n          ...state.uniforms.contrast,\n          value: contrast,\n        },\n        whitepoint: {\n          ...state.uniforms.whitepoint,\n          value: whitepoint,\n        },\n        blackpoint: {\n          ...state.uniforms.blackpoint,\n          value: blackpoint,\n        },\n        opacity: {\n          ...state.uniforms.opacity,\n          value: opacity,\n        },\n        color: {\n          ...state.uniforms.color,\n          value: color,\n        },\n        image: {\n          ...state.uniforms.image,\n        },\n      },\n      texture: image,\n      brightness: brightness,\n    })),\n}));\n","import React from 'react';\n\nimport { fileApi } from '../fileuploader/fileStore.js';\nimport { uniApi } from '../imagecanvas/ImageStore.js';\n\nexport const fApi = fileApi;\nexport const uApi = uniApi;\n\nexport const withFileStore = (Component: any) => {\n  return (props: any) => {\n    return <Component api={fApi} {...props} />;\n  };\n};\n\nexport const withUniformStore = (Component: any) => {\n  return (props: any) => {\n    return <Component api={uApi} {...props} />;\n  };\n};\n\nexport const withStore = (Component: any) => {\n  return (props: any) => {\n    return <Component uApi={uApi} fApi={fApi} {...props} />;\n  };\n};\n","import create from 'zustand';\n\n// 0, 1, 2: axes\n// 3: main\n// 4, 5, 6: channels\n// 7: test\n// possible to share the same volumea cross views?\nconst initState = {\n\n  volumes: [\n    null,\n    null,\n    null,\n    null,\n    null,\n    null,\n    null,\n    null,\n  ],\n  sliceIndices: [\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n  ],\n  lengths: [\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n  ],\n  type: 1\n}\n\nexport const [useVolumeStore, volApi] = create(set => ({\n  ...initState,\n}))\n","import {volApi} from './volumeStore.js'\n\nexport function getVolume(index) {\n  console.debug(\"getVolume - index: %d, all volumes: {\", index, volApi.getState().volumes, \"}\")\n  return volApi.getState().volumes[index]\n}\n\nexport function addVolume(index, volume) {\n  volApi.setState(prevState => ({\n    ...prevState,\n    volumes: [\n      ...prevState.volumes,\n      volume\n    ],\n  }));\n}\n\nexport function updateVolume(index, volume) {\n  volApi.setState(prevState => {\n    const volumes = prevState.volumes.map((vol, j) => {\n      if (j === index) {\n        return volume;\n      } else {\n        return vol;\n      }\n    });\n    return {\n      volumes,\n    };\n  });\n}\n\nexport function saveVolume(index, volume) {\n  updateVolume(index, volume)\n}\n\nexport function updateSliceIndex(channel, idx) {\n  volApi.setState(prevState => {\n    const sliceIndices = prevState.sliceIndices.map((sliceIdx, j) => {\n      if (j === channel) {\n        return idx;\n      } else {\n        return sliceIdx;\n      }\n    });\n    return {\n      sliceIndices,\n    };\n  });\n}\n\nexport function updateSliceLength(channel, length) {\n  volApi.setState(prevState => {\n    const lengths = prevState.lengths.map((len, j) => {\n      if (j === channel) {\n        return length;\n      } else {\n        return len;\n      }\n    });\n    return {\n      lengths,\n    };\n  });\n}\n\nexport function updateType(type) {\n  volApi.setState(prevState => ({\n    ...prevState,\n    type: type\n  }))\n}\n\nexport function getType() {\n  return volApi.getState().type\n}\n\n\n","class CachedImageData {\n  constructor(context) {\n    this.context = context;\n    this.cache = null;\n  }\n\n  getImageData(width, height) {\n    if (\n      !this.cache ||\n      this.cache.width !== width ||\n      this.cache.height !== height\n    ) {\n      this.cache = this.context.createImageData(width, height);\n    }\n\n    return this.cache;\n  }\n}\n\nexport default CachedImageData;\n","\nexport function registerWorker() {\n  const sw = navigator.serviceWorker;\n\n  if (sw) {\n    window.addEventListener(\"load\", function() {\n      sw.register(\"/sw.js\")\n        .then(() => sw.ready)\n        .then(() => {\n          console.log(\"[Cache] Service Worker Ready\")\n        })\n        .catch( error => {\n          console.log(\"[Cache] Service Worker ERROR\", error)\n        })\n    })\n  }\n\n  return sw\n}\n\nasync function getFiles(filename) {\n  let cacheObj;\n  let resp;\n  await caches.open('file-cache').then((cache) => {\n    cacheObj = cache;\n  })\n  if (cacheObj) {\n    await cacheObj.match(filename)\n      .then(function(response) {\n        console.log(\"[Cache] response: \", response)\n        resp = response\n      })\n  }\n  return resp\n}\n\nexport async function getText(filename) {\n  let content\n  const resp = await getFiles(filename)\n  if (resp) {\n    await resp.text().then((text) => {\n      content = text\n    })\n  }\n  console.log(\"[Cache] text: \", content)\n\n  return content\n}\n\nexport async function getJson(filename) {\n  let content\n  const resp = await getFiles(filename)\n  if (resp) {\n    await resp.json().then((json) => {\n      content = json\n    })\n  }\n  console.log(\"[Cache] json: \", content)\n\n  return content\n}\n\nexport async function getArrayBuffer(filename) {\n  let content\n  const resp = await getFiles(filename)\n  if (resp) {\n    await resp.arrayBuffer()\n      .then((arrayBuffer) => {\n        content = arrayBuffer\n    })\n  }\n  console.log(\"[Cache] array buffer: \", content)\n\n  return content\n}\n\nexport async function getBlob(filename) {\n  let content\n  const resp = await getFiles(filename)\n  if (resp) {\n    await resp.blob()\n      .then((blob) => {\n        content = blob\n    })\n  }\n  console.log(\"[Cache] blob: \", content)\n  return content\n}\n\n\nexport function saveFiles(sw, filename, text) {\n\n  if (sw && navigator.storage) {\n    navigator.storage.estimate().then((quota) => {\n      const tQuota = quota.quota\n      const usage = quota.usage\n      console.debug(\"[Cache] storage - total available: %d, used: %d (%d)\", tQuota, usage, (usage/tQuota * 100))\n    })\n      .catch((err) => {\n        console.error('*** Unable to update quota ***', err);\n      })\n      .then(() => {\n        setTimeout(() => {\n          console.log(\".\")\n        }, 500);\n      });\n  }\n\n  let cacheObj;\n  caches.open('file-cache').then((cache) => {\n    cacheObj = cache;\n    if (cacheObj) {\n      const response = new Response(text)\n\n      console.log(\"[Cache] cache: \", cacheObj, response, text)\n      cacheObj.put(filename, response)\n        .catch((err) => {\n          console.error(`*** Cache API: '${err.name}' ***`, err);\n          alert('Oops: Error writing to Cache API, check console.');\n        })\n    }\n  })\n  return cacheObj\n}\n","import CachedImageData from './cachedImageData.js';\nimport { registerWorker, saveFiles, getArrayBuffer } from '../cache/cache.js'\n\nclass DataCube {\n  constructor (args) {\n    this.bytes = args.bytes || 1;\n    this.size = args.size || { x: 256, y: 256, z: 256 };\n    this.canvas_context = args.context;\n    this.cube = this.materialize();\n\n    this.cached_imgdata = new CachedImageData(this.canvas_context);\n    this.clean = true;\n    this.loaded = false;\n\n    this.faces = {\n      x: [ 'y', 'z' ],\n      y: [ 'x', 'z' ],\n      z: [ 'x', 'y' ],\n    };\n    this.sw = registerWorker()\n  }\n\n  faceDimensions (axis) {\n    let face = this.faces[axis];\n    return [\n      this.size[face[0]],\n      this.size[face[1]]\n    ];\n  }\n\n  materialize () {\n    let ArrayType = this.arrayType();\n\n    let size = this.size;\n\n    return new ArrayType(size.x * size.y * size.z);\n  }\n\n  async insertImageData (imgdata, width, offsetx, offsety, offsetz) {\n\n    let _this = this;\n\n    let pixels = imgdata;\n\n    // This viewing of the Uint8 as a Uint32 allows for\n    // a memory stride of 4x larger, making reading and writing cheaper\n    // as RAM is the slow thing here.\n    let data32 = new Uint32Array(pixels.buffer); // creates a view, not an array\n\n    // Note: on little endian machine, data32 is 0xaabbggrr, so it's already flipped\n    // from the Uint8 RGBA\n\n    let masks = {\n      true: {\n        1: 0x000000ff,\n        2: 0x0000ffff,\n        4: 0xffffffff,\n      },\n      false: {\n        1: 0xff000000,\n        2: 0xffff0000,\n        4: 0xffffffff,\n      },\n    };\n\n    const mask = masks[this.isLittleEndian()][this.bytes];\n\n    let x = 0, y = 0;\n\n    const sizex = _this.size.x | 0,\n      zadj = (offsetz * _this.size.x * _this.size.y) | 0;\n\n    for (y = width - 1; y >= 0; y--) {\n      for (x = width - 1; x >= 0; x--) {\n\n        _this.cube[\n          (offsetx + x) + sizex * (offsety + y) + zadj\n        ] = data32[ x + y * width ] & mask;\n      }\n    }\n\n    _this.clean = false;\n\n    return this;\n  }\n\n  async slice (axis, index, invertV, copy = true) {\n    let _this = this;\n\n    let _cube\n    if (this.cube) {\n      _cube = this.cube\n    }\n    else {\n      let _cached_cube = await this.getCube()\n      _cube = new Uint8ClampedArray(_cached_cube)\n    }\n    if (index < 0 || index >= this.size[axis]) {\n      throw new Error(index + ' is out of bounds.');\n    }\n\n    const xsize = _this.size.x,\n      ysize = _this.size.y,\n      zsize = _this.size.z;\n\n    const xysize = xsize * ysize;\n\n    let face = this.faces[axis];\n    let ArrayType = this.arrayType();\n\n    let square = new ArrayType(this.size[face[0]] * this.size[face[1]]);\n    let byteoffset = index * xysize * this.bytes;\n\n    // Note: order of loops is important for efficient memory access\n    // and correct orientation of images. Consecutive x access is most efficient.\n\n    let i = square.length - 1;\n    if (invertV) {\n      if (axis === 'z') {\n        if (copy) {\n          let buf = _cube.buffer.slice(byteoffset, byteoffset + xysize * this.bytes);\n          return new ArrayType(buf);\n        }\n        else {\n          let i = square.length - 1;\n          const zoffset = xysize * index;\n          for (let y = 0; y < ysize - 1; y++) {\n            for (let x = xsize - 1; x >= 0; --x) {\n              square[i] = _cube[x + xsize * y + zoffset];\n              --i;\n            }\n          }\n        }\n      }\n      if (axis === 'x') {\n        for (let z = 0; z < zsize - 1; z++) {\n          for (let y = ysize - 1; y >= 0; --y) {\n            square[i] = _cube[index + xsize * y + xysize * z];\n            --i;\n          }\n        }\n      }\n      else if (axis === 'y') {\n        // possible to make this more efficient with an array memcpy\n        // as 256 x are consecutive, but no memcpy in browser.\n        const yoffset = xsize * index;\n        for (let z = 0; z < zsize - 1; z++) {\n          for (let x = xsize - 1; x >= 0; --x) {\n            square[i] = _cube[x + yoffset + xysize * z];\n            --i;\n          }\n        }\n      }\n    }\n    else {\n      if (axis === 'z') {\n        return new ArrayType(_cube.buffer, byteoffset, xysize);\n      }\n      if (axis === 'x') {\n        for (let z = zsize - 1; z >= 0 ; --z) {\n          for (let y = ysize - 1; y >= 0; --y) {\n            square[i] = _cube[index + xsize * y + xysize * z];\n            --i;\n          }\n        }\n      }\n      else if (axis === 'y') {\n        // possible to make this more efficient with an array memcpy\n        // as 256 x are consecutive, but no memcpy in browser.\n        const yoffset = xsize * index;\n          for (let z = zsize - 1; z >= 0 ; --z) {\n          for (let x = xsize - 1; x >= 0; --x) {\n            square[i] = _cube[x + yoffset + xysize * z];\n            --i;\n          }\n        }\n      }\n    }\n    return square;\n  }\n\n  async grayImageSlice (axis, index, invertV, transparency=false, copy=true) {\n\n    let square = await this.slice(axis, index, invertV, /*copy=*/false);\n\n    let sizes = await this.faceDimensions(axis);\n\n    let imgdata = copy\n      ? await this.canvas_context.createImageData(sizes[0], sizes[1])\n      : await this.cached_imgdata.getImageData(sizes[0], sizes[1]);\n\n    let data32 = new Uint32Array(imgdata.data.buffer);\n\n    const alpha = this.isLittleEndian()\n      ? 0xff000000\n      : 0x000000ff;\n\n    let i = 0;\n\n    if (transparency) {\n      for (i = square.length - 1; i >= 0; i--) {\n        data32[i] = (square[i] | (square[i] << 8) | (square[i] << 16) | (square[i] && alpha));\n      }\n    }\n    else {\n      for (i = square.length - 1; i >= 0; i--) {\n        data32[i] = (square[i] | (square[i] << 8) | (square[i] << 16) | alpha);\n      }\n    }\n\n    return imgdata;\n  }\n\n  // http://stackoverflow.com/questions/504030/javascript-endian-encoding\n  isLittleEndian () {\n    var arr32 = new Uint32Array(1);\n    var arr8 = new Uint8Array(arr32.buffer);\n    arr32[0] = 255;\n\n    let islittle = (arr8[0] === 255);\n\n    this.isLittleEndian = () => islittle;\n\n    return islittle;\n  }\n\n  // For internal use, return the right bitmask for rgba image slicing\n  // depending on CPU endianess.\n  getRenderMaskSet () {\n    let bitmasks = {\n      true: { // little endian, most architectures\n        r: 0x000000ff,\n        g: 0x0000ff00,\n        b: 0x00ff0000,\n        a: 0xff000000,\n      },\n      false: { // big endian, mostly ARM and some specialized equipment\n        r: 0xff000000,\n        g: 0x00ff0000,\n        b: 0x0000ff00,\n        a: 0x000000ff,\n      },\n    };\n\n    return bitmasks[this.isLittleEndian()];\n  }\n  arrayType () {\n    let choices = {\n      1: Uint8ClampedArray,\n      2: Uint16Array,\n      4: Uint32Array,\n    };\n\n    let ArrayType = choices[this.bytes];\n\n    if (ArrayType === undefined) {\n      throw new Error(this.bytes + ' is not a valid typed array byte count.');\n    }\n\n    return ArrayType;\n  }\n\n  async getImageData() {\n    let sizes = await this.faceDimensions('z');\n    return await this.cached_imgdata.getImageData(sizes[0], sizes[1]);\n  }\n\n  async cacheCube() {\n    let buf\n    if (this.cube.buffer) {\n      buf = this.cube.buffer\n    }\n    else {\n      buf = this.cube\n    }\n    await saveFiles(this.sw, \"samplecube-1.buf\", buf)\n    this.cube = null\n  }\n\n  async getCube() {\n    let content\n    await getArrayBuffer(\"samplecube-1.buf\").then((ctnt) => {\n      content = ctnt\n    })\n    return content\n  }\n}\n\nexport default DataCube\n","\nexport class Volume {\n  constructor (args) {\n    console.debug(\"Volume() - args:\", args)\n    this.channel = args.channel;\n  }\n\n  async renderChannelSlice (ctx, axis, slice, invertV) {\n    let _this = this;\n\n    let pixels = await _this.channel.grayImageSlice(axis, slice, invertV, /*transparency=*/false, /*copy=*/false);\n    let slice32 = await new Uint32Array(pixels.data.buffer); // creates a view, not an array\n\n    for (let i = slice32.length - 1; i >= 0; i--) {\n      slice32[i] = ((slice32[i] & 0x00ffff00) && slice32[i]);\n    }\n\n    await ctx.putImageData(pixels, 0, 0);\n    return this;\n  }\n  async load (buffer, width, slice) {\n    await this.loadVolume(this.channel, buffer, width, slice)\n  }\n  async loadVolume (cube, buffer, width, slice) {\n    await cube.insertImageData(buffer, width, 0, 0, slice)\n}\n\n  async getImageData() {\n    return await this.channel.getImageData()\n  }\n}\n","import React, { useRef, useMemo } from 'react';\nimport { useFrame } from 'react-three-fiber';\n\nimport {\n  uApi\n} from './index.js';\n\nconst fragmentShader = `\n  uniform sampler2D image;\n\n  uniform float brightness;\n  uniform float contrast;\n\n  uniform float blackpoint;\n  uniform float whitepoint;\n  uniform float opacity;\n  uniform vec3 color;\n\n  varying vec2 vUv;\n\n  vec4 setBrightness(in vec4 clr, in float br) {\n    clr.rgb += br;\n    return clr;\n  }\n\n  vec4 setContrast(in vec4 clr, in float ct) {\n    if (ct > 0.0) {\n      clr.rgb = (clr.rgb - 0.5) / (1.0 - ct) + 0.5;\n    } else {\n      clr.rgb = (clr.rgb - 0.5) * (1.0 + ct) + 0.5;\n    }\n    return clr;\n  }\n\n  vec4 setWpBp(in vec4 clr, in float bp, in float wp) {\n    float _blackpoint = bp / 255.0;\n    float _whitepoint = bp == wp ? (255.0 / 0.00025) : (255.0 / (wp - bp));\n    clr.rgb = clr.rgb * _whitepoint - (_whitepoint * _blackpoint);\n    return clr;\n  }\n\n  vec4 setOpacity(in vec3 clr, in float opc) {\n    vec4 _color = vec4(clr, opc);\n    return _color;\n  }\n\n  vec4 sampleColor() {\n    // red with 50% opacity\n    return vec4(1.0, 0.0, 0.0, 0.5);\n  }\n\n  vec4 toGrayscale(in vec4 color)\n  {\n    float average = (color.r + color.g + color.b) / 3.0;\n    return vec4(average, average, average, 1.0);\n  }\n\n  vec4 colorize(in vec4 grayscale, in vec4 color)\n  {\n    return (grayscale * color);\n  }\n\n  vec4 applyColorize(in vec4 color, in vec4 overlay) {\n    vec4 grayscale = toGrayscale(color);\n    vec4 colorizedOutput = colorize(grayscale, overlay);\n    return colorizedOutput;\n  }\n\n  vec4 applyOverlay(in vec4 color, in vec4 overlay) {\n    return (vec4(mix(color.rgb, overlay.rgb, overlay.a), color.a));\n  }\n\n  void main() {\n    vec4 tColor = texture2D(image, vUv);\n    tColor = setBrightness(tColor, brightness);\n    tColor = setContrast(tColor, contrast);\n    tColor = setWpBp(tColor, blackpoint, whitepoint);\n\n    vec4 oColor = setOpacity(color, opacity);\n\n    // tColor = applyColorize(tColor, oColor);\n    tColor = applyOverlay(tColor, oColor);\n    gl_FragColor = tColor;\n  }\n`;\n\nconst vertexShader = `\n  varying vec2 vUv;\n\n  void main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n`;\n\nfunction Mesh(props) {\n  const ref = useRef();\n  const material = useRef();\n  var uniforms = useMemo(\n    () => uApi.getState().channels[props.channel - 1].uniforms,\n    [props]\n  );\n\n  function setUniforms() {\n    material.current.uniforms.brightness.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.brightness.value;\n    material.current.uniforms.contrast.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.contrast.value;\n    material.current.uniforms.whitepoint.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.whitepoint.value;\n    material.current.uniforms.blackpoint.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.blackpoint.value;\n    material.current.uniforms.opacity.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.opacity.value;\n    material.current.uniforms.image.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.image.value;\n    material.current.uniforms.color.value = uApi.getState().channels[\n      props.channel - 1\n    ].uniforms.color.value;\n  }\n\n  useFrame(state => {\n    setUniforms()\n  });\n\n  return (\n    <mesh ref={ref} scale={[1.0, 1.0, 1.0]}>\n      <planeBufferGeometry attach=\"geometry\" args={[5.0, 5.0]} />\n      <shaderMaterial\n        attach=\"material\"\n        ref={material}\n        fragmentShader={fragmentShader}\n        vertexShader={vertexShader}\n        uniforms={uniforms}\n      />\n    </mesh>\n  );\n}\n\nexport default Mesh;\n","import React from 'react';\nimport create from 'zustand';\nimport Mesh from './Mesh.js';\nimport { Canvas } from 'react-three-fiber';\n\nexport const meshState = {\n  mesh: [<Mesh channel=\"1\" />, <Mesh channel=\"2\" />, <Mesh channel=\"3\" />, <Mesh channel=\"4\" />],\n};\n\nexport const [useMeshStore, meshApi] = create(set => ({\n  ...meshState,\n}));\n\nexport const canvasState = {\n  canvas: [\n    <Canvas className={'image-canvas-1'}>{meshState.mesh[0]}</Canvas>,\n    <Canvas className={'image-canvas-2'}>{meshState.mesh[1]}</Canvas>,\n    <Canvas className={'image-canvas-3'}>{meshState.mesh[2]}</Canvas>,\n    <Canvas className={'main-image-canvas'}>{meshState.mesh[3]}</Canvas>,\n  ],\n};\n\nexport const [useCanvasStore, canvasApi] = create(set => ({\n  ...canvasState,\n}));\n","import * as THREE from 'three';\n\nimport {\n  uApi,\n  createTexture,\n} from './index.js'\n\nfunction isValidChannel(channel) {\n  return (\n    uApi.getState() &&\n    uApi.getState().channels.length > 0 &&\n    channel >= 1 &&\n    uApi.getState().channels[channel - 1] &&\n    uApi.getState().channels[channel - 1].uniforms.contrast &&\n    uApi.getState().channels[channel - 1].uniforms.brightness &&\n    uApi.getState().channels[channel - 1].uniforms.color\n  );\n}\n\nfunction updateUniformBrightness(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.brightness.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nfunction updateUniformContrast(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.contrast.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nfunction updateUniformWhitepoint(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.whitepoint.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nfunction updateUniformBlackpoint(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.blackpoint.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nfunction updateUniformOpacity(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.opacity.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nfunction updateUniformColor(value, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n        newChannel.uniforms.color.value = value;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nexport function updateImage(file, channel) {\n  let name = file.name;\n  let blob = file.image;\n  let texture = file.texture;\n\n  if (texture === '') {\n    if (file.type === 'image/tiff') {\n      //\n    } else {\n      texture = createTexture(blob);\n    }\n  }\n  const prevStateCh = uApi.getState().channels[channel - 1];\n\n  if (\n    prevStateCh.name !== name ||\n    prevStateCh.imagepath !== blob ||\n    prevStateCh.uniforms.image.value !== texture\n  ) {\n    updateUniformImage(texture, name, blob, channel);\n  }\n}\n\nexport function updateTexture(file, texture, channel) {\n  let name = file.name;\n  let blob = file.image;\n\n  const prevStateCh = uApi.getState().channels[channel - 1];\n\n  if (\n    prevStateCh.name !== name ||\n    prevStateCh.imagepath !== blob ||\n    prevStateCh.uniforms.image.value !== texture\n  ) {\n    updateUniformImage(texture, name, blob, channel);\n  }\n}\n\nexport function updateUniformImage(texture, name, imagepath, channel) {\n  uApi.setState(prevState => {\n    const channels = prevState.channels.map((ch, j) => {\n      if (j === channel - 1) {\n        var newChannel = ch;\n\n        newChannel.name = name;\n        newChannel.imagepath = imagepath;\n        newChannel.uniforms.image.value = texture;\n        return newChannel;\n      } else {\n        return ch;\n      }\n    });\n    return {\n      channels,\n    };\n  });\n}\n\nexport function updateBrightness(value, channel) {\n  if (isValidChannel(channel)) {\n    if (\n      value !== uApi.getState().channels[channel - 1].uniforms.brightness.value\n    ) {\n      updateUniformBrightness(value, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::UpdateBrighness() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n\nexport function updateContrast(value, channel) {\n  if (isValidChannel(channel)) {\n    if (\n      value !== uApi.getState().channels[channel - 1].uniforms.contrast.value\n    ) {\n      updateUniformContrast(value, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::updateContrast() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n\nexport function updateWhitepoint(value, channel) {\n  if (isValidChannel(channel)) {\n    if (\n      value !== uApi.getState().channels[channel - 1].uniforms.whitepoint.value\n    ) {\n      updateUniformWhitepoint(value, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::updateWhitepoint() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n\nexport function updateBlackpoint(value, channel) {\n  if (isValidChannel(channel)) {\n    if (\n      value !== uApi.getState().channels[channel - 1].uniforms.blackpoint.value\n    ) {\n      updateUniformBlackpoint(value, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::updateBlackpoint() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n\nexport function updateOpacity(value, channel) {\n  if (isValidChannel(channel)) {\n    if (\n      value !== uApi.getState().channels[channel - 1].uniforms.opacity.value\n    ) {\n      updateUniformOpacity(value, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::updateOpacity() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n\nexport function updateColor(value, channel) {\n  var color = new THREE.Color(value.color);\n\n  if (isValidChannel(channel)) {\n    if (value !== uApi.getState().channels[channel - 1].uniforms.color.value) {\n      updateUniformColor(color, channel);\n    }\n    return true;\n  } else {\n    console.log(\n      'CanvasControl::updateColor() - null state',\n      uApi.getState(),\n      ' channel: ',\n      channel,\n      ' value: ',\n      value\n    );\n  }\n  return false;\n}\n","import React, { Component } from 'react';\nimport create from 'zustand';\nimport {\n  Progress\n} from 'reactstrap';\n\nconst state = {\n  loaded: 0\n}\nconst [useState, stateApi] = create (set => ({\n  ...state\n}))\n\nexport async function loadSlices(cntxt, volume, axes, axis, files, type, fileIdx) {\n  if (type === 1) {\n    await _loadSlicesFromMultipageFile(cntxt, volume, axes, axis, files[fileIdx])\n  }\n  else {\n    await _loadSlicesFromMultipleFiles(cntxt, volume, axes, axis, files)\n  }\n}\n\nexport async function updateChannelSlice(cntxt, volume, slice, axes, axis, invertV) {\n  if (cntxt && volume && axes) {\n    await volume.renderChannelSlice(cntxt, axes[axis], slice, invertV)\n  }\n}\n\nasync function _loadVolumes(volume, pages, width) {\n  for (var pIdx = 0; pIdx < pages.length; pIdx++) {\n    const page = pages[pIdx]\n\n    const pct = Math.round((pIdx/(pages.length-1))*100)\n    if ((pct % 10) === 0) {\n      stateApi.setState({\n        loaded: pct\n      })\n    }\n\n    // console.log(\"loading \", pIdx , \"/\", pages.length-1)\n    await volume.load(page, width, pIdx)\n  }\n}\n\nasync function _loadSlicesFromMultipageFile(cntxt, volume, axes, axis, file) {\n  if (file && (file.pages) && (file.pages.length > 0)) {\n    await _loadVolumes(volume, file.pages, file.image.width)\n  }\n\n  updateChannelSlice(cntxt, volume, 0, axes, axis, false);\n}\n\nasync function _loadSlicesFromMultipleFiles(cntxt, volume, axes, axis, files) {\n  for (var fIdx = 0; fIdx < files.length; fIdx++) {\n    const file = files[fIdx]\n    if (file && (file.pages) && (file.pages.length > 0)) {\n      const pages = file.pages\n      for (var pIdx = 0; pIdx < pages.length; pIdx++) {\n        const page = pages[pIdx]\n        const zoffset =  fIdx * (pages.length) + pIdx;\n        await volume.load(page, file.image.width, zoffset)\n      }\n      updateChannelSlice(cntxt, volume, 0, axes, axis, false);\n    }\n  }\n}\n\nclass ProgressBar extends Component {\n\n  state = {\n    loaded: 0\n  }\n\n  display = () => {\n    if (this.state.loaded !== 100) {\n      return (\n        <Progress striped bar value={this.state.loaded}> {this.state.loaded}% </Progress>\n      )\n    }\n    else {\n      return (\n        <div> </div>\n      )\n    }\n  }\n\n  render() {\n    stateApi.subscribe(state => {\n      this.state.loaded = state.loaded\n    })\n    return (\n      this.display()\n    )\n  }\n}\n\nexport default ProgressBar;\n","function determineType(fileLength, pageLength, channelLength) {\n  var tType = 0\n\n  if      ( (fileLength === 1) && (channelLength === 3) && (pageLength >   1) ) tType = 1\n  else if ( (fileLength === 3) && (channelLength === 1) && (pageLength >   1) ) tType = 2\n  else if ( (fileLength >   1)                          && (pageLength === 3) ) tType = 3\n  else if ( (fileLength >   1)                          && (pageLength === 1) ) tType = 4\n\n  console.log(\"determineType() - type, file, page, channel lengths: \", tType, fileLength, pageLength, channelLength)\n  return tType\n}\n\nexport function parseMetadata(file, metadata) {\n  const {\n    // images,\n    channels,\n    // slices,\n  } = metadata\n\n  const fileLength = file.length\n  const pageLength = file[0].pages.length\n  const channelLength = parseInt(channels || 1)\n  // Case 1: (60 z planes, 3 channels, 1)\n  //   images = 180\n  //   channels = 3\n  //   slices = 60\n  //   hyperstack = true\n  //   pages = 180\n  // Case 2: (60 z planes, 1 channel, 3)\n  //   images = 60\n  //   channels = n/a\n  //   slices = 60\n  //   hyperstack = n/a\n  //   pages = 60\n  // Case 3: (1 z planes, 3 channels, 60)\n  //   images = 3\n  //   channels = n/a\n  //   slices = 3\n  //   hyperstack = n/a\n  //   pages = 3\n  // Case 4: (1 z planes, 1 channel, 180)\n  //   pages = 1\n  //   n/a\n\n  return determineType(fileLength, pageLength, channelLength)\n}\n\nexport function filesNeedUpdate(state, length) {\n  return (\n    state\n    && (state.file.length > 0)\n    && (state.file.length !== length)\n    && (state.total === state.size)\n  )\n}\n\nexport function areFilesValid(files, idx, length) {\n  return (\n    (files.length > 0) &&\n    (files[idx]) &&\n    (files[idx].pages) &&\n    (files[idx].pages.length > 0) &&\n    (files.length !== length)\n  )\n}\n","import {\n  uApi as uniApi,\n  fApi as fileApi,\n} from '../utils/index.js';\n\nimport {\n  canvasApi as cvsApi,\n} from './canvasStore.js';\n\nimport {\n  volApi as vApi,\n} from './../datacube/volumeStore.js';\n\nimport {\n  updateImage as updIm,\n  updateTexture as updText,\n} from './CanvasControl.js';\n\nimport {\n  createTexture as createT,\n  createTextureFromTiff as createTFrTiff,\n} from './ImageStore.js';\n\nimport {\n  saveVolume as saveVol,\n  getVolume  as getVol,\n  updateSliceLength  as updSliceLen,\n  updateType         as updType,\n} from '../datacube/volumeControl.js';\n\nimport {\n  loadSlices as ldSlices,\n  updateChannelSlice as updSlice,\n} from '../datacube/datacubeControls.js';\n\nimport {\n  parseMetadata as parseMd,\n  filesNeedUpdate  as filesNeedUpd,\n  areFilesValid    as areFilesVal,\n} from '../fileuploader/fileParser.js';\n\nimport {\n  initializeVolume as initVol,\n  generateTexture  as genText,\n  getImageData     as getImgDt,\n} from './canvasUtils.js';\n\nexport const uApi                  = uniApi\nexport const fApi                  = fileApi\nexport const canvasApi             = cvsApi\nexport const volApi                = vApi\nexport const updateImage           = updIm\nexport const updateTexture         = updText\nexport const createTexture         = createT\nexport const createTextureFromTiff = createTFrTiff\nexport const saveVolume            = saveVol\nexport const getVolume             = getVol\nexport const updateSliceLength     = updSliceLen\nexport const updateType            = updType\nexport const generateTexture       = genText\nexport const getImageData          = getImgDt\nexport const initializeVolume      = initVol\nexport const loadSlices            = ldSlices\nexport const updateChannelSlice    = updSlice\nexport const parseMetadata         = parseMd\nexport const filesNeedUpdate       = filesNeedUpd\nexport const areFilesValid         = areFilesVal\n","\nimport DataCube from '../datacube/datacube.js';\nimport * as THREE from 'three';\n\nimport {\n  Volume,\n} from '../datacube/volume.js'\n\nimport {\n  saveVolume,\n  getVolume,\n  loadSlices,\n} from './index.js'\n\nexport async function initializeVolume(idx, cntxt, files, fileIdx, axes, type, width, height, length) {\n\n  if (!getVolume(idx)) {\n    var cube = {\n      x: 256,\n      y: 256,\n      z: 256,\n    };\n    cube.x = width\n    cube.y = height\n    cube.z = length\n\n    var volume = new Volume({\n      channel: new DataCube({\n        bytes: 1,\n        size: cube,\n        context: cntxt,\n      }),\n    });\n    saveVolume(idx, volume)\n\n    await loadSlices(\n      cntxt,\n      volume,\n      axes,\n      2,\n      files,\n      type,\n      fileIdx,\n    );\n\n    await volume.channel.cacheCube()\n    console.debug(\"initializeVolume: volume initialized with params: idx: %d fileIdx: %d type: %d width: %d height: %d length: %d\", idx, fileIdx, type, width, height, length)\n  }\n}\n\nexport async function getImageData(idx) {\n  const vol = getVolume(idx)\n  if (vol) {\n    return await vol.getImageData()\n  }\n}\n\nexport function generateTexture(imageData, width, height) {\n  const data = new Uint8Array(imageData)\n\n  var texture =  new THREE.DataTexture(data, width, height, THREE.RGBAFormat)\n  texture.needsUpdate = true\n  return texture\n}\n\nexport function generateSampleData() {\n  var data = [];\n  var N = 4;\n\n  for (var i = 0; i < N*N; ++i) {\n    data.push(255);\n    data.push(0);\n    data.push(0);\n    data.push(255);\n  }\n  return data\n}\n\nexport function shrinkTiff(context, imageData, idx) {\n  const cw = 200\n  const ch = 200\n  const imgW = imageData.width\n  const imgH = imageData.height\n\n  var newC = document.createElement('canvas')\n  newC.width = imgW\n  newC.height = imgH\n  newC.getContext('2d').putImageData(imageData, 0, 0)\n\n  var x = (cw+10) * idx\n  var y = 0\n  context.drawImage(newC, x, y, cw, ch)\n}\n","import {\n  annotApi,\n  undoApi,\n  redoApi,\n  drawRect,\n  getCanvas,\n  fabricApi,\n} from './index.js';\n\nexport function createAnnotation(group, label, classLabel, rect, id) {\n  const default_class = 'class1';\n  return {\n    id: id,\n    group: group,\n    label: label,\n    class: classLabel || default_class,\n    rect: {\n      top: rect.top,\n      left: rect.left,\n      width: rect.width,\n      height: rect.height,\n      scaleX: group.scaleX,\n      scaleY: group.scaleY,\n    },\n  };\n}\n\nexport function createDummyAnnotation(id) {\n  return { id: id };\n}\n\nexport function addAnnotation(annotation) {\n  annotApi.setState(prevState => ({\n    ...prevState,\n    annotations: [...prevState.annotations, annotation],\n  }));\n}\n\nexport function addAnnotationFromJson(json) {\n  for (var i = 0; i < json.length; i++) {\n    if (_isAnnotValid(json[i])) {\n      const rect = drawRect(\n        getCanvas(),\n        json[i].rect,\n        json[i].label,\n        json[i].class\n      );\n      let nextId = fabricApi.getState().nextId;\n      addDummyUndoAnnotation(createDummyAnnotation(nextId));\n      addAnnotation(\n        createAnnotation(\n          rect,\n          json[i].label,\n          json[i].class,\n          json[i].rect,\n          nextId\n        )\n      );\n\n      fabricApi.setState(prevState => ({\n        ...prevState,\n        nextId: nextId + 1,\n      }));\n    }\n  }\n  console.log(annotApi.getState().annotations);\n}\n\nexport function addDummyUndoAnnotation(annotation) {\n  addAnnotationToUndoState(annotation);\n}\n\nexport function addAnnotationToUndoState(annotation) {\n  undoApi.setState(prevState => ({\n    ...prevState,\n    undoAnnotations: [...prevState.undoAnnotations, annotation],\n  }));\n}\n\nexport function addAnnotationToRedoState(annotation) {\n  redoApi.setState(prevState => ({\n    ...prevState,\n    redoAnnotations: [...prevState.redoAnnotations, annotation],\n  }));\n}\n\nexport function deleteAnnotation(index) {\n  annotApi.setState(prevState => {\n    return prevState.annotations.splice(index, 1);\n  });\n}\n\nexport function deleteUndoAnnotation(index) {\n  undoApi.setState(prevState => {\n    return prevState.undoAnnotations.splice(index, 1);\n  });\n}\n\nexport function deleteRedoAnnotation(index) {\n  redoApi.setState(prevState => {\n    return prevState.redoAnnotations.splice(index, 1);\n  });\n}\n\nexport function undoAnnotation(index) {\n  const annotation = annotApi.getState().annotations[index];\n  addAnnotationToRedoState(annotation);\n  deleteAnnotation(index);\n\n  const lastUndoAnno = getLastUndoAnnot();\n  const lastUndoAnnoIdx = getLastUndoAnnotIdx();\n  deleteUndoAnnotation(lastUndoAnnoIdx);\n  addAnnotation(lastUndoAnno);\n}\n\nexport function redoAnnotation(index) {\n  const redoAnnotation = redoApi.getState().redoAnnotations[index];\n  const annotations = annotApi.getState().annotations;\n  for (let i = 0; i < annotations.length; i++) {\n    if (annotations[i].id === redoAnnotation.id) {\n      addAnnotationToUndoState(annotations[i]);\n      deleteAnnotation(i);\n    }\n  }\n\n  addAnnotation(redoAnnotation);\n  deleteRedoAnnotation(index);\n}\n\nexport function getLastAnnotIdx() {\n  return annotApi.getState().annotations.length - 1;\n}\n\nexport function getLastUndoAnnot() {\n  return undoApi.getState().undoAnnotations[\n    undoApi.getState().undoAnnotations.length - 1\n  ];\n}\n\nexport function getLastUndoAnnotIdx() {\n  return undoApi.getState().undoAnnotations.length - 1;\n}\n\nexport function getLastRedoAnnot() {\n  return redoApi.getState().redoAnnotations[\n    redoApi.getState().redoAnnotations.length - 1\n  ];\n}\n\nexport function getLastRedoAnnotIdx() {\n  return redoApi.getState().redoAnnotations.length - 1;\n}\n\nexport function updateAnnotationCoords(annotationGroup) {\n  const annotations = annotApi.getState().annotations;\n  for (let i = 0; i < annotations.length; i++) {\n    if (annotationGroup === annotations[i].group) {\n      addAnnotationToUndoState(annotations[i]);\n      const rect = {\n        width: annotationGroup.width,\n        height: annotationGroup.height,\n        top: annotationGroup.top,\n        left: annotationGroup.left,\n      };\n\n      addAnnotation(\n        createAnnotation(\n          annotationGroup,\n          annotationGroup._objects[1].text,\n          annotationGroup._objects[2].text,\n          rect,\n          annotations[i].id\n        )\n      );\n\n      deleteAnnotation(i);\n    }\n  }\n}\n\nexport function updateAnnotationLabel(oldLabel, label) {\n  annotApi.setState(prevState => {\n    const annotations = prevState.annotations.map((annot, j) => {\n      if (annot.label === oldLabel) {\n        var newAnnot = annot;\n        newAnnot.label = label;\n        return newAnnot;\n      } else {\n        return annot;\n      }\n    });\n    return {\n      annotations,\n    };\n  });\n}\n\nexport function updateAnnotClassLabel(oldLabel, label) {\n  annotApi.setState(prevState => {\n    const annotations = prevState.annotations.map((annot, j) => {\n      if (annot && (annot.class === oldLabel)) {\n        var newAnnot = annot;\n        newAnnot.class = label;\n        return newAnnot;\n      } else {\n        return annot;\n      }\n    });\n    return {\n      annotations,\n    };\n  });\n}\n\nexport function getAnnotationClasses() {\n  var classes = [];\n  const annotations = annotApi.getState().annotations;\n  for (var i = 0; i < annotations.length; i++) {\n    classes.push(annotations[i].class);\n  }\n  return classes;\n}\n\nexport function getAnnotationByLabel(label) {\n  const annotations = annotApi.getState().annotations;\n  for (var i = 0; i < annotations.length; i++) {\n    if (annotations[i] && (annotations[i].label === label)) {\n      return annotations[i]\n    }\n  }\n}\n\nfunction _isAnnotValid(annotation) {\n  return (\n    annotation &&\n    annotation.rect.left > 0 &&\n    annotation.rect.left < 1000 &&\n    annotation.rect.top > 0 &&\n    annotation.rect.top < 1000 &&\n    annotation.rect.width > 0 &&\n    annotation.rect.width < 1000 &&\n    annotation.rect.height > 0 &&\n    annotation.rect.height < 1000 &&\n    annotation.label.length > 0\n  );\n}\n","import create from 'zustand';\n\nimport { editAnnotationOption, editClassOption, deleteAnnotationOption } from './index.js';\n\nexport const initState = {\n  menu: {\n    displayon: false,\n    coords: {\n      x: 0,\n      y: 0,\n    },\n    items: [\n      {\n        label: 'Edit Annotation',\n        callback: editAnnotationOption,\n      },\n      {\n        label: 'Edit Class',\n        callback: editClassOption,\n      },\n      {\n        label: 'Delete',\n        callback: deleteAnnotationOption,\n      },\n    ],\n    objects: [],\n    select: 0,\n    canvas: null,\n  },\n};\n\nexport const [useAnnotationMenu, AnnotationMenuApi] = create(set => ({\n  ...initState,\n}));\n\nexport function isDisplayOn() {\n  return AnnotationMenuApi.getState().menu.displayon;\n}\n\nexport function setCanvas(canvas) {\n  AnnotationMenuApi.setState(prevState => ({\n    ...prevState,\n    canvas: canvas,\n  }));\n}\n\nexport function getCanvas() {\n  return AnnotationMenuApi.getState().canvas;\n}\n\nexport function setDisplay(value) {\n  AnnotationMenuApi.setState(prevState => ({\n    ...prevState,\n    menu: {\n      ...prevState.menu,\n      displayon: value,\n    },\n  }));\n}\n\nexport function getMenuCoords() {\n  return AnnotationMenuApi.getState().menu.coords;\n}\n\nexport function setMenuCoords(x, y) {\n  AnnotationMenuApi.setState(prevState => ({\n    ...prevState,\n    menu: {\n      ...prevState.menu,\n      coords: {\n        x: x,\n        y: y,\n      },\n    },\n  }));\n}\n\nexport function getItems() {\n  return AnnotationMenuApi.getState().menu.items;\n}\n\nexport function setSelectedObjects(objects) {\n  AnnotationMenuApi.setState(prevState => ({\n    ...prevState,\n    menu: {\n      ...prevState.menu,\n      objects: objects,\n    },\n  }));\n}\n\nexport function getSelectedObjects() {\n  return AnnotationMenuApi.getState().menu.objects;\n}\n\nexport function updateSelect(sel) {\n  AnnotationMenuApi.setState(prevState => ({\n    ...prevState,\n    menu: {\n      ...prevState.menu,\n      select: sel,\n    },\n  }));\n}\n","import { fileApi as fApi } from '../fileuploader/fileStore.js';\n\nimport {\n  annotApi as aApi,\n  undoApi as unApi,\n  redoApi as reApi,\n} from './annotationStore.js';\n\nimport {\n  addAnnotation as addAnnot,\n  addAnnotationFromJson as addAnnotJson,\n  undoAnnotation as undoAnnot,\n  getLastAnnotIdx as getLstAntIdx,\n  getLastUndoAnnot as getLstCdAnt,\n  getLastUndoAnnotIdx as getLstCdAntIdx,\n  deleteUndoAnnotation as delCdAnt,\n  updateAnnotationLabel as updAntLbl,\n  updateAnnotClassLabel as updAntClsLbl,\n  getAnnotationClasses as getAnnotCls,\n  redoAnnotation as redoAnno,\n  getAnnotationByLabel as getAnnotByLbl,\n} from './annotationControl.js';\n\nimport { getDisabledClasses as getDisCls } from './annotationClass.js';\n\nimport {\n  getItems as getIts,\n  AnnotationMenuApi as aMenuApi,\n  setDisplay as setDisp,\n  getSelectedObjects as getSelObjs,\n  updateSelect as updSel,\n  getCanvas as getCvs,\n} from './annotationSettings.js';\n\nimport {\n  updateLabel as updLbl,\n  updateClassLabel as updClsLbl,\n  drawRect as drawR,\n  delAnnot as dlAnnot,\n} from './annotationEditor.js';\n\nimport {\n  editAnnotationOption as editAnnotOpt,\n  editClassOption as editClsOpt,\n  deleteAnnotationOption as delAnnotOpt,\n  editAnnotationLabel as editAnnotLbl,\n  editAnnotationClass as editAnnotCls,\n  deleteAnnotation as deleteAnnot,\n} from './annotationMenuOptions.js';\n\nimport { fabricApi as fabApi } from '../fabric/fabricControl.js';\n\nexport const fileApi = fApi;\nexport const annotApi = aApi;\nexport const undoApi = unApi;\nexport const redoApi = reApi;\nexport const addAnnotation = addAnnot;\nexport const addAnnotationFromJson = addAnnotJson;\nexport const undoAnnotation = undoAnnot;\nexport const getLastAnnotIdx = getLstAntIdx;\nexport const getLastUndoAnnot = getLstCdAnt;\nexport const getLastUndoAnnotIdx = getLstCdAntIdx;\nexport const deleteUndoAnnotation = delCdAnt;\nexport const updateAnnotationLabel = updAntLbl;\nexport const updateAnnotClassLabel = updAntClsLbl;\nexport const getAnnotationClasses = getAnnotCls;\nexport const redoAnnotation = redoAnno;\nexport const getAnnotationByLabel = getAnnotByLbl;\nexport const getDisabledClasses = getDisCls;\nexport const getItems = getIts;\nexport const AnnotationMenuApi = aMenuApi;\nexport const setDisplay = setDisp;\nexport const getSelectedObjects = getSelObjs;\nexport const updateSelect = updSel;\nexport const getCanvas = getCvs;\nexport const updateLabel = updLbl;\nexport const updateClassLabel = updClsLbl;\nexport const drawRect = drawR;\nexport const delAnnot = dlAnnot;\nexport const editAnnotationLabel = editAnnotLbl;\nexport const editAnnotationClass = editAnnotCls;\nexport const deleteAnnotation = deleteAnnot;\nexport const fabricApi = fabApi;\n\nexport function editAnnotationOption() {\n  editAnnotOpt();\n}\nexport function editClassOption() {\n  editClsOpt();\n}\nexport function deleteAnnotationOption() {\n  delAnnotOpt();\n}\n","import {\n  setDisplay,\n  getSelectedObjects,\n  updateSelect,\n  updateLabel,\n  updateClassLabel,\n  delAnnot,\n  getAnnotationByLabel,\n} from './index.js';\n\nexport function editAnnotationOption() {\n  setDisplay(false);\n  updateSelect(1);\n}\nexport function editClassOption() {\n  setDisplay(false);\n  updateSelect(2);\n}\n\nexport function deleteAnnotationOption() {\n  setDisplay(false);\n  updateSelect(3);\n}\n\nexport function editAnnotationLabel(label) {\n  const obj = getSelectedObjects();\n  if (obj && obj._objects.length > 0) {\n    updateLabel(obj, label);\n    updateSelect(0);\n  }\n}\n\nexport function editAnnotationClass(className) {\n  const obj = getSelectedObjects();\n  if (obj && obj._objects.length > 0) {\n    updateClassLabel(obj, className);\n    updateSelect(0);\n  }\n}\n\nexport function deleteAnnotation(label) {\n  const obj = getSelectedObjects();\n  if (obj && obj._objects.length > 0) {\n    const label = obj._objects[1].text\n    const annot = getAnnotationByLabel(label)\n    if (annot) {\n      delAnnot({\"id\": annot.id});\n    }\n    updateSelect(0);\n  }\n}\n","import { fabric } from 'fabric';\n\nimport {\n  redoAnnotation,\n  undoAnnotation,\n  addAnnotation,\n  getLastUndoAnnot,\n  updateAnnotationLabel,\n  updateAnnotClassLabel,\n  getCanvas,\n  getDisabledClasses,\n  getSelectedObjects,\n  getAnnotationByLabel,\n} from './index.js';\n\nimport {\n  getLastRedoAnnot,\n  getLastRedoAnnotIdx,\n  deleteAnnotation,\n  addAnnotationToUndoState,\n  deleteUndoAnnotation,\n} from './annotationControl.js';\n\nimport { annotApi, undoApi } from './annotationStore.js';\n\nexport const colors = [\n  'rgb(200, 140, 140, 0.85)', //channel 1\n  'rgb(140, 200, 140, 0.85)', //channel 2\n  'rgb(140, 140, 200, 0.85)', //channel 3\n  'rgb(100, 100, 100, 0.85)', //dark grey\n  'rgb(255, 255, 255, .01)', //transparent (almost)\n  'rgb(240, 240, 240, 1)', //light grey\n];\n\nexport function drawFreeStyle(canvas, color) {\n  window.canvas = canvas;\n  canvas.isMouseDown = false;\n\n  canvas.isDrawingMode = true;\n  canvas.freeDrawingBrush.color = colors[0];\n  canvas.freeDrawingBrush.width = 10;\n}\n\nexport function drawRect(canvas, rect, label, classLabel) {\n  if (rect.top <= 0 || rect.left <= 0 || rect.width <= 0 || rect.height <= 0) {\n    return;\n  }\n\n  var fRect = new fabric.Rect({\n    left: parseInt(rect.left),\n    top: parseInt(rect.top),\n    width: parseInt(rect.width),\n    height: parseInt(rect.height),\n    fill: colors[4],\n    stroke: colors[0],\n    strokeLineJoin: 'round',\n    strokeWidth: 2,\n    objectCaching: false,\n  });\n\n  var outerRect = fabric.util.object.clone(fRect);\n  outerRect.set({\n    left: fRect.left - 1,\n    top: fRect.top - 1,\n    width: fRect.width + (fRect.strokeWidth * 2 - 1),\n    height: fRect.height + (fRect.strokeWidth * 2 - 1),\n    stroke: colors[5],\n    strokeWidth: 1,\n  });\n\n  var group = new fabric.Group([outerRect]);\n  group.on('moving', function(e) {\n    constrain(e, canvas);\n  });\n\n  var text = new fabric.IText(label, {\n    fontSize: 14,\n    originX: 'left',\n    originY: 'top',\n    fontFamily: 'Arial',\n    fontWeight: 'bold',\n    fill: 'white',\n    textBackgroundColor: colors[0],\n    top: group.top + fRect.strokeWidth,\n    left: group.left + fRect.strokeWidth,\n  });\n\n  const default_class = 'class1';\n  var classText = new fabric.IText(classLabel || default_class, {\n    fontSize: 16,\n    originX: 'left',\n    originY: 'bottom',\n    fontFamily: 'Arial',\n    fontWeight: 'bold',\n    fill: 'white',\n    textBackgroundColor: colors[0],\n    top: group.top + group.height - outerRect.strokeWidth,\n    left: group.left + fRect.strokeWidth,\n  });\n\n  if (canvas) {\n    fRect.perPixelTargetFind = true;\n    canvas.add(group);\n    canvas.setActiveObject(group);\n    group.addWithUpdate(text);\n    group.addWithUpdate(classText);\n    group.addWithUpdate(fRect);\n  }\n\n  return group;\n}\n\nfunction constrain(o, canvas) {\n  const group = o.target;\n  const outerRect = group._objects[3];\n\n  if (group.left < 0) {\n    group.set('left', outerRect.strokeWidth / 2);\n    group.setCoords();\n  } else if (group.left + group.width > canvas.width) {\n    group.set('left', canvas.width - group.width - outerRect.strokeWidth / 2);\n    group.setCoords();\n  }\n\n  if (group.top < 0) {\n    group.set('top', outerRect.strokeWidth / 2);\n    group.setCoords();\n  } else if (group.top + group.height > canvas.height) {\n    group.set('top', canvas.height - group.height - outerRect.strokeWidth / 2);\n    group.setCoords();\n  }\n}\n\nexport function updateLabel(obj, label) {\n  var object = obj\n  if (!object) {\n    object = getSelectedObjects();\n  }\n\n  var oldLabel = '';\n  if (object && label) {\n    ungroup(object);\n\n    if (object) {\n      var objs = object._objects;\n      if (objs && objs.length > 0) {\n        for (var i = 0; objs.length; i++) {\n          if (objs[i]) {\n            if (i === 1) {\n              if (objs[i].text) {\n                oldLabel = objs[i].text;\n                objs[i].text = label;\n                updateAnnotationLabel(oldLabel, label);\n                getCanvas().renderAll();\n                const newGroup = regroup(object);\n                updateGroup(newGroup, label);\n                return;\n              }\n            }\n          } else {\n            return;\n          }\n        }\n      }\n    }\n  }\n}\n\nexport function updateClassLabel(obj, label) {\n  var object = obj\n  if (!object) {\n    object = getSelectedObjects();\n  }\n\n  var oldLabel = '';\n  if (object && label) {\n    ungroup(object);\n\n    if (object) {\n      var objs = object._objects;\n      if (objs && objs.length > 0) {\n        for (var i = 0; objs.length; i++) {\n          if (objs[i]) {\n            if (i === 2) {\n              if (objs[i].text) {\n                oldLabel = objs[i].text;\n                objs[i].text = label;\n                updateAnnotClassLabel(oldLabel, label);\n                getCanvas().renderAll();\n                const newGroup = regroup(object);\n                updateGroup(newGroup, objs[1].text);\n                return;\n              }\n            }\n          } else {\n            return;\n          }\n        }\n      }\n    }\n  }\n}\n\nexport function ungroup(object) {\n  var canvas = getCanvas();\n  var items = object._objects;\n  if (items && (items.length >= 2)) {\n    object._restoreObjectsState();\n    canvas.remove(object);\n    for (var i = 0; i < items.length; i++) {\n      canvas.add(items[i]);\n      canvas.item(canvas.size() - 1).hasControls = true;\n    }\n    canvas.renderAll();\n  }\n}\n\nexport function regroup(object) {\n  if (object && object._objects.length === 4) {\n    var objs = object._objects;\n\n    var outline = objs[0];\n    var label = objs[1];\n    var classLabel = objs[2];\n    var rect = objs[3];\n\n    var group = new fabric.Group([outline, label, classLabel, rect]);\n    var canvas = getCanvas();\n    if (canvas) {\n      canvas.add(group);\n      canvas.remove(outline);\n      canvas.remove(label);\n      canvas.remove(classLabel);\n      canvas.remove(rect);\n      canvas.setActiveObject(group);\n    }\n    return group;\n  }\n}\n\nexport function filterClasses(cls) {\n  filterAnnotations(cls.name, cls.enabled);\n}\n\nexport function filterAnnotations(classLabel, enabled) {\n  var canvas = getCanvas();\n  var objs = canvas.getObjects();\n  for (var i = 0; i < objs.length; i++) {\n    var group = objs[i];\n    if (group) {\n      var group_elements = group._objects;\n      if (group_elements) {\n        var class_element = group._objects[2];\n        var label_element = group._objects[1];\n        if (class_element && class_element.text) {\n          if (class_element.text === classLabel) {\n            if (enabled) {\n              markGroupVisible(group, label_element.text);\n            } else {\n              markGroupInvisible(group);\n              canvas.discardActiveObject();\n            }\n          }\n        }\n      }\n    }\n  }\n  canvas.renderAll();\n}\n\nexport function filterDisabledClasses() {\n  const classes = getDisabledClasses();\n  for (var i = 0; i < classes.length; i++) {\n    filterAnnotations(classes[i]);\n  }\n  getCanvas().renderAll();\n}\n\nexport function showAll() {\n  var canvas = getCanvas();\n  var objs = canvas.getObjects();\n  for (var i = 0; i < objs.length; i++) {\n    var group = objs[i];\n    if (group) {\n      markGroupVisible(group);\n    }\n  }\n}\n\nexport function markGroupVisible(group, label) {\n  ungroup(group);\n\n  var objs = group._objects;\n  for (var i = 0; i < objs.length; i++) {\n    var obj = objs[i];\n    markVisible(obj, true);\n  }\n\n  const newGroup = regroup(group);\n  updateGroup(newGroup, label);\n}\n\nexport function markGroupInvisible(group) {\n  ungroup(group);\n\n  var objs = group._objects;\n  for (var i = 0; i < objs.length; i++) {\n    var obj = objs[i];\n    markVisible(obj, false);\n  }\n  regroup(group);\n}\n\nfunction updateGroup(group, label) {\n  var annotations = annotApi.getState().annotations;\n  for (let i = 0; i < annotations.length; i++) {\n    if (annotations[i].label === label) {\n      annotations[i].group = group;\n    }\n  }\n}\n\nfunction markVisible(obj, visible) {\n  obj.visible = visible;\n  obj.dirty = true;\n  getCanvas().renderAll();\n}\n\nexport function delAnnot(annotation) {\n  var annot = annotation\n  if (!annotation) {\n    const obj = getSelectedObjects();\n    if (obj && obj._objects.length > 0) {\n      const label = obj._objects[1].text\n      const tAnnot = getAnnotationByLabel(label)\n      if (tAnnot) {\n        annot = {\"id\": tAnnot.id}\n      }\n    }\n  }\n\n  const annotations = annotApi.getState().annotations;\n  const undoAnnotations = undoApi.getState().undoAnnotations;\n  let idxToRemoveFromUndo = null;\n  let idxToRemoveFromAnnotations = null;\n\n  for (let i = 0; i < annotations.length; i++) {\n    if (annot && annotations[i] && (annotations[i].id === annot.id)) {\n      removeFromCanvas(annotations[i]);\n      idxToRemoveFromUndo = i;\n    }\n    if (annot && undoAnnotations[i] && (undoAnnotations[i].id === annot.id)) {\n      idxToRemoveFromAnnotations = i;\n    }\n  }\n\n  addAnnotationToUndoState(annotations[idxToRemoveFromUndo]);\n  addAnnotation(undoAnnotations[idxToRemoveFromAnnotations]);\n  deleteAnnotation(idxToRemoveFromUndo);\n  deleteUndoAnnotation(idxToRemoveFromAnnotations);\n  return null;\n}\n\nfunction moveAnnotation(annotationTo, annotationFrom) {\n  var canvas = getCanvas();\n\n  annotationTo.group.set({\n    top: annotationFrom.rect.top,\n    left: annotationFrom.rect.left,\n    width: annotationFrom.rect.width,\n    height: annotationFrom.rect.height,\n    scaleX: annotationFrom.rect.scaleX,\n    scaleY: annotationFrom.rect.scaleY,\n  });\n  annotationTo.group.setCoords();\n  canvas.requestRenderAll();\n  canvas.setActiveObject(annotationTo.group);\n}\n\nfunction removeFromCanvas(annotation) {\n  var canvas = getCanvas();\n  canvas.remove(annotation.group);\n  canvas.requestRenderAll();\n}\n\nexport function undo() {\n  var canvas = getCanvas();\n  const annotations = annotApi.getState().annotations;\n  let lastUndoAnno = getLastUndoAnnot();\n\n  if (!lastUndoAnno) {\n    return null;\n  }\n\n  for (let i = 0; i < annotations.length; i++) {\n    if (annotations[i] && lastUndoAnno && annotations[i].id === lastUndoAnno.id) {\n      if (annotations[i].group && lastUndoAnno.group) {\n        moveAnnotation(annotations[i], lastUndoAnno);\n      } else if (lastUndoAnno.group && !annotations[i].group) {\n        canvas.add(lastUndoAnno.group);\n      } else {\n        removeFromCanvas(annotations[i]);\n      }\n      undoAnnotation(i);\n    }\n  }\n}\n\nexport function redo() {\n  var canvas = getCanvas();\n  const idx = getLastRedoAnnotIdx();\n  const annotations = annotApi.getState().annotations;\n\n  if (idx >= 0) {\n    // get last from cache\n    const redoAnnot = getLastRedoAnnot();\n\n    if (!redoAnnot) {\n      return null;\n    }\n\n    if (redoAnnot.group) {\n      redoAnnot.group.set({\n        top: redoAnnot.rect.top,\n        left: redoAnnot.rect.left,\n        width: redoAnnot.rect.width,\n        height: redoAnnot.rect.height,\n        scaleX: redoAnnot.rect.scaleX,\n        scaleY: redoAnnot.rect.scaleY,\n      });\n      // remove previous annotation before adding back (if any)\n      const objs = getCanvas()._objects\n      for (var j = 0; j < objs.length; j++) {\n        if (objs[j] && objs[j]._objects && objs[j]._objects[1].text && (objs[j]._objects[1].text === redoAnnot.label)) {\n          canvas.remove(objs[j])\n        }\n      }\n      canvas.add(redoAnnot.group);\n      canvas.requestRenderAll();\n      canvas.setActiveObject(redoAnnot.group);\n    } else {\n      for (let i = 0; i < annotations.length; i++) {\n        if (annotations[i].id === redoAnnot.id) {\n          canvas.add(annotations[i].group);\n          canvas.requestRenderAll();\n        }\n      }\n    }\n\n    // remove from cache\n    redoAnnotation(idx);\n  }\n}\n","import {\n  drawRect as dRect,\n  drawFreeStyle as dFreeSty,\n} from '../annotator/annotationEditor.js';\nimport {\n  isDisplayOn as isDispOn,\n  setDisplay as setDisp,\n  setMenuCoords as setMenuCrds,\n  setSelectedObjects as setSelObjs,\n} from '../annotator/annotationSettings.js';\nimport {\n  addAnnotation as addAnnot,\n  getLastAnnotIdx as getLastAnnot,\n} from '../annotator/annotationControl.js';\nimport {\n  getLastSelectedClass as getLstSelCls\n} from '../annotator/annotationClass.js';\n\nexport const drawRect = dRect;\nexport const drawFreeStyle = dFreeSty;\nexport const isDisplayOn = isDispOn;\nexport const setDisplay = setDisp;\nexport const setMenuCoords = setMenuCrds;\nexport const setSelectedObjects = setSelObjs;\nexport const addAnnotation = addAnnot;\nexport const getLastAnnotIdx = getLastAnnot;\nexport const getLastSelectedClass = getLstSelCls;\n","import create from 'zustand';\n\nimport { getAnnotationClasses } from './index.js';\n\nconst initState = {\n  classes: [\n    {\n      name: 'Annotation Class 1',\n      enabled: false,\n    },\n  ],\n  lastSel: 'class1',\n};\n\nfunction addClass(classLabel) {\n  const default_class = 'class1';\n  annotClassApi.setState(prevState => ({\n    ...prevState,\n    classes: [\n      ...prevState.classes,\n      {\n        name: classLabel || default_class,\n        enabled: false,\n      },\n    ],\n  }));\n}\n\nexport const [useAnnotClass, annotClassApi] = create(set => ({\n  ...initState,\n}));\n\nexport function updateClasses() {\n  const classes = getAnnotationClasses();\n  for (var i = 0; i < classes.length; i++) {\n    const cls = classes[i];\n    if (cls && !isDuplicateClass(cls)) {\n      addClass(cls);\n      enableClass(cls);\n    }\n  }\n}\n\nexport function enableClass(label) {\n  annotClassApi.setState(prevState => {\n    const classes = prevState.classes.map((cls, j) => {\n      if (cls.name === label) {\n        var newCls = cls;\n        newCls.enabled = true;\n        return newCls;\n      } else {\n        return cls;\n      }\n    });\n    return {\n      classes,\n    };\n  });\n}\n\nexport function toggleClassEnable(num) {\n  annotClassApi.setState(prevState => {\n    const classes = prevState.classes.map((cls, j) => {\n      if (j === num) {\n        var newCls = cls;\n        newCls.enabled = !cls.enabled;\n        return newCls;\n      } else {\n        return cls;\n      }\n    });\n    return {\n      classes,\n    };\n  });\n  const cls = annotClassApi.getState().classes[num];\n  if (cls.enabled) {\n    annotClassApi.setState(prevState => ({\n      ...prevState,\n      lastSel: cls.name,\n    }));\n  }\n}\n\nexport function isDuplicateClass(name) {\n  const classes = annotClassApi.getState().classes;\n  if (classes) {\n    const x = classes.filter(cls => cls.name === name);\n    if (x.length !== 0) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function getClasses() {\n  return annotClassApi.getState().classes;\n}\n\nexport function getDisabledClasses() {\n  var enabledClasses = [];\n  const classes = annotClassApi.getState().classes;\n  if (classes) {\n    for (var i = 0; i < classes.length; i++) {\n      const cls = classes[i];\n      if (!cls.enabled) {\n        enabledClasses.push(cls.name);\n      }\n    }\n  }\n  return enabledClasses;\n}\n\nexport function getLastSelectedClass() {\n  return annotClassApi.getState().lastSel;\n}\n","import create from 'zustand';\nimport React from 'react';\nimport FabricLayer from '../ui/components/FabricLayer';\n\nimport {\n  drawRect,\n  drawFreeStyle,\n  isDisplayOn,\n  setDisplay,\n  setMenuCoords,\n  setSelectedObjects,\n  addAnnotation,\n  getLastAnnotIdx,\n  getLastSelectedClass,\n} from './index.js';\nimport {\n  createDummyAnnotation,\n  updateAnnotationCoords,\n  createAnnotation,\n  addDummyUndoAnnotation,\n} from '../annotator/annotationControl';\nimport { redoApi } from '../annotator/annotationStore';\n\nexport const modes = {\n  RECT: 'rectangle',\n  FREE: 'free draw',\n  SELECT: 'select',\n  NONE: 'none',\n};\n\nconst initState = {\n  layers: [],\n  mouse: {\n    x: 0,\n    y: 0,\n    down: false,\n  },\n  origin: {\n    x: 0,\n    y: 0,\n  },\n  drawMode: modes.RECT,\n  nextId: 1,\n  canvas: null,\n};\n\nexport const [useFabric, fabricApi] = create(set => ({\n  ...initState,\n}));\n\nexport function initFabricLayers(zIndex, channel) {\n  const newFabricLayer = <FabricLayer zIndex={zIndex} channel={channel} />;\n  fabricApi.setState(prevState => ({\n    ...prevState,\n    layers: [...prevState.layers, newFabricLayer],\n  }));\n}\n\nexport function setFabricCanvas(canvas) {\n  fabricApi.setState(prevState => ({\n    canvas: canvas,\n  }));\n}\n\nexport function setMode(newMode) {\n  fabricApi.setState(prevState => ({\n    ...prevState,\n    drawMode: newMode,\n  }));\n\n  if (newMode === modes.FREE) {\n    fabricApi.getState().canvas.isDrawingMode = true;\n  } else {\n    fabricApi.getState().canvas.isDrawingMode = false;\n  }\n}\n\nexport function finishMoving(selection) {\n  const objs = selection._objects;\n  for (let i = 0; i < objs.length; i++) {\n    let subObjs = objs[i]._objects;\n    if (subObjs) {\n      finishMoving(objs[i]);\n    } else {\n      selection.setCoords();\n      updateAnnotationCoords(selection);\n      break;\n    }\n  }\n\n  redoApi.setState({\n    redoAnnotations: [],\n  });\n}\n\nexport function startSelecting() {\n  setMode(modes.SELECT);\n}\n\nexport function finishSelecting() {\n  setMode(modes.RECT);\n}\n\nexport function startDrawing(x, y) {\n  if (fabricApi.getState().canvas.isDrawingMode) {\n    startDrawingFree(x, y);\n  } else {\n    startDrawingRect(x, y);\n  }\n}\n\nexport function startDrawingFree(x, y) {\n  drawFreeStyle(fabricApi.getState().canvas);\n}\n\nexport function finish(x, y) {\n  if (fabricApi.getState().drawMode === modes.SELECT) {\n    finishSelecting();\n  } else if (fabricApi.getState().drawMode === modes.RECT) {\n    finishDrawingRect(x, y);\n  }\n}\n\nexport function startDrawingRect(x, y) {\n  setOrigin(x, y);\n}\n\nexport function finishDrawing(x, y) {\n  if (fabricApi.getState().drawMode === modes.RECT) {\n    finishDrawingRect(x, y);\n  }\n  setFabricCoords(x, y);\n}\n\nexport function finishDrawingRect(x, y) {\n  setFabricCoords(x, y);\n  const state = fabricApi.getState();\n  if (state.origin.x && state.origin.y && x && y) {\n    const width = state.mouse.x - state.origin.x;\n    const height = state.mouse.y - state.origin.y;\n\n    if (Math.abs(width) >= 10) {\n      const rect = {\n        width: width >= 0 ? width : -width,\n        height: height >= 0 ? height : -height,\n        top: height >= 0 ? state.origin.y : state.mouse.y,\n        left: width >= 0 ? state.origin.x : state.mouse.x,\n      };\n      const label = 'label' + (getLastAnnotIdx() + 1);\n      const classLabel = getLastSelectedClass() || 'class1';\n      const fRect = drawRect(\n        fabricApi.getState().canvas,\n        rect,\n        label,\n        classLabel\n      );\n\n      let nextId = fabricApi.getState().nextId;\n      addDummyUndoAnnotation(createDummyAnnotation(nextId));\n      addAnnotation(createAnnotation(fRect, label, classLabel, rect, nextId));\n\n      fabricApi.setState(prevState => ({\n        ...prevState,\n        nextId: nextId + 1,\n      }));\n    }\n\n    redoApi.setState({\n      redoAnnotations: [],\n    });\n\n    setSelectedObjects(fabricApi.getState().canvas.getActiveObjects()[0]);\n  }\n}\n\nexport function deleteAnnotations(rects) {\n  console.log(rects);\n}\n\nexport function setOrigin(x, y) {\n  fabricApi.setState(prevState => ({\n    ...prevState,\n    origin: {\n      x: x - fabricApi.getState().canvas._offset.left,\n      y: y - fabricApi.getState().canvas._offset.top,\n    },\n  }));\n}\n\nexport function setFabricCoords(x, y) {\n  let canvasLeft = fabricApi.getState().canvas._offset.left;\n  let canvasRight =\n    fabricApi.getState().canvas._offset.left +\n    fabricApi.getState().canvas.width;\n  let canvasTop = fabricApi.getState().canvas._offset.top;\n  let canvasBottom =\n    fabricApi.getState().canvas._offset.top +\n    fabricApi.getState().canvas.height;\n  let relX =\n    x < canvasLeft\n      ? canvasLeft\n      : x > canvasRight\n      ? canvasRight\n      : x - canvasLeft;\n  let relY =\n    y < canvasTop ? canvasTop : y > canvasBottom ? canvasBottom : y - canvasTop;\n\n  fabricApi.setState(prevState => ({\n    mouse: {\n      x: relX,\n      y: relY,\n    },\n  }));\n}\n\nexport function openMenu(x, y) {\n  if (!isDisplayOn()) {\n    setDisplay(true);\n    let canvas = fabricApi.getState().canvas;\n    setMenuCoords(x - canvas._offset.left, y - canvas._offset.top);\n  }\n}\n\nexport function addToFabric() {\n  let annots = fabricApi.getState().annotations;\n\n  if (annots.length > fabricApi.getState().canvas.getObjects().length) {\n    let lastAnnotIdx = annots.length - 1;\n    let annot = annots[lastAnnotIdx];\n\n    var newAnnot = {\n      left: parseInt(annot.rect.left),\n      top: parseInt(annot.rect.top),\n      width: parseInt(annot.rect.width),\n      height: parseInt(annot.rect.height),\n    };\n\n    drawRect(fabricApi.getState().canvas, newAnnot, annot.label, annot.class);\n  }\n}\n","import {\n  fileApi,\n  createTexture,\n  importCsv,\n  importJson,\n  importTiff,\n} from './index.js'\n\nconst img = {\n  display: 'block',\n  width: 'auto',\n  height: '100%',\n};\n\nvar idx = 0;\n\nexport function isFirstFile() {\n  return fileApi.getState().size === 0;\n}\n\nexport function isValidFile(name) {\n  // check if file is already uploaded\n  var validFile = false;\n\n  const files = fileApi.getState().file\n  if (files) {\n    const x = files.filter(file => file.name === name);\n    if (x.length === 0) {\n      validFile = true;\n    }\n  }\n  return validFile;\n}\n\nexport function initPng(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      {\n        name: file.name,\n        image: file.preview,\n        style: img,\n        type: file.type,\n        texture: createTexture(file.preview),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function addPng(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      ...prevState.file,\n      {\n        name: file.name,\n        image: file.preview,\n        style: img,\n        type: file.type,\n        texture: createTexture(file.preview),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function initTiff(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      ...prevState.file,\n      {\n        name: file.name,\n        image: file.preview,\n        style: img,\n        type: file.type,\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  importTiff(file);\n  idx = fileApi.getState().size - 1;\n}\n\nexport function addTiff(file) {\n  fileApi.setState( prevState => ({\n    ...prevState,\n    file: [...prevState.file, {\n        name: file.name,\n        image: file.preview,\n        style: img,\n      type: file.type\n    }],\n    size: prevState.size + 1\n  }))\n  importTiff(file);\n  idx = fileApi.getState().size - 1;\n}\n\nexport function updateTiffPages(name, pages, image, metadata) {\n  const index = fileApi.getState().file.findIndex(file => file.name === name)\n  var files = [...fileApi.getState().file]\n  const newFile = files[index]\n  newFile.pages = pages\n  newFile.image = image\n  newFile.metadata = metadata\n  files[index] = newFile\n}\n\nexport function initCsv(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      {\n        name: file.name,\n        type: file.type,\n        json: importCsv(file),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function addCsv(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      ...prevState.file,\n      {\n        name: file.name,\n        type: file.type,\n        json: importCsv(file),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function initJson(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      {\n        name: file.name,\n        type: file.type,\n        json: importJson(file),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function addJson(file) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    file: [\n      ...prevState.file,\n      {\n        name: file.name,\n        type: file.type,\n        json: importJson(file),\n      },\n    ],\n    size: prevState.size + 1,\n  }));\n  idx = fileApi.getState().size - 1;\n}\n\nexport function saveJson(result) {\n  fileApi.setState(prevState => {\n    const file = prevState.file.map((f, i) => {\n      if (i === idx) {\n        var newFile = f;\n        f.json = result;\n        return newFile;\n      } else {\n        return f;\n      }\n    });\n    return file;\n  });\n}\n\nexport function saveTotalNumOfFiles(total) {\n  fileApi.setState(prevState => ({\n    ...prevState,\n    total: total\n  }));\n}\n","import {\n  fileApi as fApi,\n} from './fileStore.js';\n\nimport {\n  settingsApi as sApi,\n} from '../mainSettings.js';\n\nimport {\n  initPng         as iPng,\n  addPng          as aPng,\n  initTiff        as iTiff,\n  addTiff         as aTiff,\n  initCsv         as iCsv,\n  addCsv          as aCsv,\n  initJson        as iJson,\n  addJson         as aJson,\n  isFirstFile     as isFstFl,\n  isValidFile     as isValFl,\n  saveJson        as svJson,\n  updateTiffPages as updTP,\n  saveTotalNumOfFiles as saveTotal,\n} from './fileControl.js';\n\nimport {\n  importCsv  as impCsv,\n  importJson as impJson,\n  importTiff as impTiff,\n} from './fileImporter.js';\n\nimport {\n  exportFile as expF,\n} from './fileExporter.js';\n\nimport {\n  annotApi as aApi,\n} from '../annotator/annotationStore.js';\n\nimport {\n  addAnnotation as addAnnot,\n} from '../annotator/annotationControl.js';\n\nimport {\n  createTexture as createT,\n  createTextureFromTiff as createTFrTiff,\n} from '../imagecanvas/ImageStore.js';\n\nexport const fileApi               = fApi\nexport const initPng               = iPng\nexport const addPng                = aPng\nexport const initTiff              = iTiff\nexport const addTiff               = aTiff\nexport const initCsv               = iCsv\nexport const addCsv                = aCsv\nexport const initJson              = iJson\nexport const addJson               = aJson\nexport const isFirstFile           = isFstFl\nexport const isValidFile           = isValFl\nexport const saveJson              = svJson\nexport const exportFile            = expF\nexport const updateTiffPages       = updTP\nexport const saveTotalNumOfFiles   = saveTotal\nexport const importCsv             = impCsv\nexport const importJson            = impJson\nexport const importTiff            = impTiff\nexport const settingsApi           = sApi\nexport const annotApi              = aApi\nexport const addAnnotation         = addAnnot\nexport const createTexture         = createT\nexport const createTextureFromTiff = createTFrTiff\n","import csv from 'csvtojson';\nimport UTIF from 'utif';\nimport {\n  saveJson,\n  updateTiffPages,\n} from './index.js';\n\nexport function importCsv(file) {\n  const reader = new FileReader();\n\n  reader.onload = () => {\n    const fileAsBinaryString = reader.result;\n\n    csv({\n      noheader: true,\n      output: 'json',\n    })\n      .fromString(fileAsBinaryString)\n      .then(csvRows => {\n        const toJson = [];\n        csvRows.forEach((aCsvRow, i) => {\n          if (i !== 0) {\n            const builtObject = {};\n\n            Object.keys(aCsvRow).forEach(aKey => {\n              const valueToAddInBuiltObject = aCsvRow[aKey];\n              const keyToAddInBuiltObject = csvRows[0][aKey];\n              builtObject[keyToAddInBuiltObject] = valueToAddInBuiltObject;\n            });\n\n            toJson.push(builtObject);\n          }\n        });\n        saveJson(toJson);\n      });\n  };\n\n  reader.onabort = () => console.log('file reading was aborted');\n  reader.onerror = () => console.log('file reading has failed');\n\n  reader.readAsText(file, 'ISO-8859-1');\n}\n\nexport function importJson(file) {\n  const reader = new FileReader();\n  let json;\n  reader.onload = () => {\n    json = JSON.parse(reader.result);\n    saveJson(json.annotations);\n  };\n  reader.readAsText(file);\n}\n\nexport function importTiff(file) {\n  const reader = new FileReader();\n\n  if (file) {\n    reader.onload = () => {\n      var success = file.type === 'image/tiff';\n      if (success) {\n        console.debug(\n          'importer::importTiff() - Loading TIFF image...',\n          file.name\n        );\n      }\n    };\n    reader.onloadend = event => {\n      console.debug(\n        'importer::importTiff() - Parsing TIFF image...',\n        file.name\n      );\n      parseMultiTiff(file.name, event.target.result);\n    };\n    reader.onprogress = () => {\n      console.log('importer::importTiff()', 'Still Loading...', file.name);\n    };\n    reader.readAsArrayBuffer(file);\n  }\n}\n\nexport function parseMultiTiff(name, buffer) {\n  var pages = [];\n  const ifds = UTIF.decode(buffer);\n\n  for (var i = 0; i < ifds.length; i++) {\n    const idx = i;\n    UTIF.decodeImage(buffer, ifds[idx]);\n    var rgba = UTIF.toRGBA8(ifds[idx]);\n    pages.push(rgba);\n  }\n\n  var image = new Image(ifds[0].width, ifds[0].height);\n  const tlines = String(ifds[0].t270).split(/\\s+/)\n\n  var metadata = {}\n  for (var j = 0; j < tlines.length; j++) {\n    const tSpl = tlines[j].split(/=/)\n    const key = tSpl[0]\n    const value = tSpl[1]\n    metadata[key] = value\n  }\n\n  // exportFile(\"pages.txt\", pages)\n  updateTiffPages(name, pages, image, metadata);\n}\n","import {\n  fileApi,\n} from '../../fileuploader/fileStore.js';\n\nimport {\n  annotApi as aApi,\n} from '../../annotator/annotationStore.js';\n\nimport {\n  uApi as uniApi,\n} from '../../utils/index.js';\n\nimport {\n  volApi as vApi,\n} from  '../../datacube/volumeStore.js';\n\nimport {\n  saveVolume         as saveVol,\n  getVolume          as getVol,\n  updateSliceIndex   as updSliceIdx,\n  updateType         as updType,\n} from '../../datacube/volumeControl.js';\n\nimport {\n  initializeVolume   as initVol,\n  generateTexture    as genText,\n  getImageData       as getImgDt,\n  generateSampleData as genSmpDat,\n  shrinkTiff         as shrTiff,\n} from '../../imagecanvas/canvasUtils.js';\n\nimport {\n  buttonGroupStyle as btnGrpStyle,\n  cardStyle        as cdStyle,\n} from '../styles/style.js';\n\nimport {\n  mainViewStyle     as mViewStyle,\n  mainCardBodyStyle as mCdBodyStyle,\n  mainCardStyle     as mCdStyle,\n  mainCanvasStyle0  as mCvsStyle0,\n  mainCanvasStyle1  as mCvsStyle1,\n  mainCanvasStyle2  as mCvsStyle2,\n  mainCanvasStyle3  as mCvsStyle3,\n  mainImgStyle      as mImgStyle,\n} from '../styles/mainStyle.js';\n\nimport {\n  axisViewStyle     as axVwStyle,\n  axisCardStyle     as axCdStyle,\n  axisCardBodyStyle as axCdBodyStyle,\n} from '../styles/axisStyle.js';\n\nimport {\n  channelViewStyle        as chVwStyle,\n  channelCardStyle        as chCardStyle,\n  channelCardBodyStyle    as chCardBodyStyle,\n  channelCanvasStyle      as chCanvasStyle,\n  channelImageCanvasStyle as chImgCanvasStyle,\n} from '../styles/channelStyle.js';\n\nimport {\n  annotViewStyle as annotVwStyle,\n  annotCardStyle as annotCdStyle,\n  annotLayerStyle as annotLrStyle,\n} from '../styles/annotatorStyle.js';\n\nimport {\n  thumbStyle      as thbStyle,\n  thumbInnerStyle as thbInStyle,\n} from '../styles/thumbnailStyle.js';\n\nimport {\n  updateClasses     as updCls,\n  getClasses        as getCls,\n  toggleClassEnable as toggleClsEn,\n  annotClassApi     as annotClsApi,\n} from '../../annotator/annotationClass.js'\n\nimport {\n  filterClasses     as filterCls,\n  filterAnnotations as filtAnnot,\n  showAll           as shAll,\n  drawFreeStyle     as drawFr,\n  colors            as clrs,\n  undo              as undoAnnot,\n  redo              as redoAnnot,\n  delAnnot          as del,\n  updateLabel       as updLbl,\n  updateClassLabel  as updClsLbl,\n} from '../../annotator/annotationEditor.js'\n\nimport {\n  setCanvas         as setCvs,\n  AnnotationMenuApi as aMenuApi,\n} from '../../annotator/annotationSettings.js';\n\nimport {\n  Volume as Vol,\n} from '../../datacube/volume.js';\n\nimport {\n  loadSlices         as ldSlices,\n  updateChannelSlice as updSlice,\n} from '../../datacube/datacubeControls.js';\n\nimport {\n  updateBrightness as updBrightness,\n  updateContrast   as updContrast,\n  updateWhitepoint as updWhitepoint,\n  updateBlackpoint as updBlackpoint,\n  updateColor      as updColor,\n  updateOpacity    as updOpacity,\n  updateTexture    as updText,\n} from '../../imagecanvas/CanvasControl.js';\nimport {\n  openMenu         as opMenu,\n  startDrawing     as strDr,\n  startSelecting   as strSel,\n  finish           as fin,\n  addToFabric      as addToFab,\n  setFabricCanvas  as setFabCvs,\n  setMode          as setMd,\n  fabricApi        as fabApi,\n  initFabricLayers as initFabLyrs,\n  modes            as mds,\n} from '../../fabric/fabricControl.js';\n\nimport {\n  updateChannelSel as updChannelSel,\n  updateLastSel    as updLastSel,\n} from '../../mainSettings.js';\n\nimport {\n  exportJson as expJson,\n} from '../../fileuploader/fileExporter.js';\n\nimport {\n  parseMetadata as parseMd,\n  filesNeedUpdate  as filesNeedUpd,\n  areFilesValid    as areFilesVal,\n} from '../../fileuploader/fileParser.js';\n\nexport const fApi                    = fileApi\nexport const annotApi                = aApi\nexport const volApi                  = vApi\nexport const saveVolume              = saveVol\nexport const getVolume               = getVol\nexport const generateTexture         = genText\nexport const getImageData            = getImgDt\nexport const initializeVolume        = initVol\nexport const generateSampleData      = genSmpDat\nexport const shrinkTiff              = shrTiff\nexport const updateSliceIndex        = updSliceIdx\nexport const updateType              = updType\nexport const buttonGroupStyle        = btnGrpStyle\nexport const cardStyle               = cdStyle\nexport const thumbStyle              = thbStyle\nexport const thumbInnerStyle         = thbInStyle\nexport const mainCanvasStyle0        = mCvsStyle0\nexport const mainCanvasStyle1        = mCvsStyle1\nexport const mainCanvasStyle2        = mCvsStyle2\nexport const mainCanvasStyle3        = mCvsStyle3\nexport const channelViewStyle        = chVwStyle\nexport const channelCardStyle        = chCardStyle\nexport const channelCardBodyStyle    = chCardBodyStyle\nexport const channelCanvasStyle      = chCanvasStyle\nexport const channelImageCanvasStyle = chImgCanvasStyle\nexport const annotViewStyle          = annotVwStyle\nexport const annotCardStyle          = annotCdStyle\nexport const annotLayerStyle         = annotLrStyle\nexport const mainViewStyle           = mViewStyle\nexport const mainCardBodyStyle       = mCdBodyStyle\nexport const mainCardStyle           = mCdStyle\nexport const mainImgStyle            = mImgStyle\n\nexport const axisViewStyle      = axVwStyle\nexport const axisCardStyle      = axCdStyle\nexport const axisCardBodyStyle  = axCdBodyStyle\nexport const updateClasses      = updCls\nexport const getClasses         = getCls\nexport const toggleClassEnable  = toggleClsEn\nexport const annotClassApi      = annotClsApi\nexport const filterClasses      = filterCls\nexport const filterAnnotations  = filtAnnot\nexport const showAll            = shAll\nexport const drawFreeStyle      = drawFr\nexport const colors             = clrs\nexport const undo               = undoAnnot\nexport const redo               = redoAnnot\nexport const delAnnot           = del\nexport const updateLabel        = updLbl\nexport const updateClassLabel   = updClsLbl\nexport const setCanvas          = setCvs\nexport const AnnotationMenuApi  = aMenuApi\nexport const Volume             = Vol\nexport const loadSlices         = ldSlices\nexport const updateChannelSlice = updSlice\nexport const updateBrightness   = updBrightness\nexport const updateContrast     = updContrast\nexport const updateWhitepoint   = updWhitepoint\nexport const updateBlackpoint   = updBlackpoint\nexport const updateColor        = updColor\nexport const updateOpacity      = updOpacity\nexport const updateTexture        = updText\nexport const openMenu           = opMenu\nexport const startDrawing       = strDr\nexport const startSelecting     = strSel\nexport const finish             = fin\nexport const addToFabric        = addToFab\nexport const setFabricCanvas    = setFabCvs\nexport const setMode            = setMd\nexport const fabricApi          = fabApi\nexport const initFabricLayers   = initFabLyrs\nexport const modes              = mds\nexport const updateChannelSel   = updChannelSel\nexport const updateLastSel      = updLastSel\nexport const exportJson         = expJson\nexport const parseMetadata      = parseMd\nexport const filesNeedUpdate       = filesNeedUpd\nexport const areFilesValid         = areFilesVal\n\nexport const uApi = uniApi","import React from 'react';\nimport { fabric } from 'fabric';\n\nimport {\n  filterAnnotations,\n  showAll,\n  drawFreeStyle,\n  annotApi,\n  setCanvas,\n  openMenu,\n  startDrawing,\n  startSelecting,\n  finish,\n  addToFabric,\n  setFabricCanvas,\n  setMode,\n  fabricApi,\n  modes,\n  annotLayerStyle,\n} from './index.js';\n\nimport { finishMoving } from '../../fabric/fabricControl.js';\n\nvar canvas;\n\nclass FabricLayer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = React.createRef();\n\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleMouseDoubleClick = this.handleMouseDoubleClick.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n    this.selectClass1 = this.selectClass1.bind(this);\n    this.showAll = this.showAllClasses.bind(this);\n    this.handleMoveAnnotation = this.handleMoveAnnotation.bind(this);\n    this.handleModifyAnnotation = this.handleModifyAnnotation.bind(this);\n  }\n\n  componentDidMount() {\n    canvas = new fabric.Canvas(this.canvasRef.current, {\n      fireRightClick: true,\n    });\n    canvas.on({\n      'mouse:down': this.handleMouseDown,\n      'mouse:up': this.handleMouseUp,\n      'mouse:dblclick': this.handleMouseDoubleClick,\n      'object:modified': this.handleModifyAnnotation,\n      'object:moving': this.handleMoveAnnotation,\n      'object:rotating': this.handleDrag,\n      'object:scaling': this.handleDrag,\n    });\n    setCanvas(canvas);\n    setFabricCanvas(canvas);\n  }\n\n  handleDrag(e) {\n    startSelecting();\n  }\n\n  handleMoveAnnotation(e) {\n    setMode(modes.SELECT);\n  }\n\n  handleModifyAnnotation(options) {\n    finishMoving(options.target);\n  }\n\n  handleLeftMouseDown(options) {\n    const mode = fabricApi.getState().drawMode;\n    if (mode === modes.RECT) {\n      startDrawing(options.e.clientX, options.e.clientY);\n    } else if (mode === modes.FREE) {\n      drawFreeStyle(canvas);\n    }\n  }\n\n  handleRightMouseDown(options) {\n    openMenu(options.e.clientX, options.e.clientY);\n  }\n\n  handleLeftMouseUp(options) {\n    finish(options.e.clientX, options.e.clientY);\n  }\n\n  handleRightMouseUp(options) {}\n\n  handleMouseDown(options) {\n    if (options.button === 3) {\n      this.handleRightMouseDown(options);\n    } else {\n      this.handleLeftMouseDown(options);\n    }\n  }\n\n  handleMouseUp(options) {\n    if (options.button === 3) {\n      this.handleRightMouseUp(options);\n    } else {\n      this.handleLeftMouseUp(options);\n    }\n  }\n\n  handleObjectSelect(e) {\n    // if more than one object is selected\n    // if Delete button is selected\n    // delete all objects from canvas\n    // remove from annotations\n  }\n\n  handleObjectResize(e) {\n    // if an object is selected, and resized\n    // updateRect(rect)\n  }\n\n  handleMouseDoubleClick(e) {\n    // if an object is selected\n    // updateLabel (label)\n    startSelecting();\n  }\n\n  displayMenu() {\n    // if (canvas && canvas.getActiveObjects().length > 0) {\n    //   return <AnnotationMenu />;\n    // }\n  }\n  selectClass1() {\n    filterAnnotations('class1');\n    this.forceUpdate();\n  }\n  showAllClasses() {\n    showAll();\n    this.forceUpdate();\n  }\n\n  render() {\n    annotApi.subscribe(state => {\n      if (state) {\n        addToFabric(state.annotations, canvas);\n      }\n    });\n    // AnnotationMenuApi.subscribe(state => {\n    //   this.forceUpdate();\n    // });\n\n    return (\n      <div\n        id=\"annotationLayer\"\n        style={annotLayerStyle}\n        onContextMenu={e => e.preventDefault()}\n      >\n        <canvas\n          ref={this.canvasRef}\n          width={window.innerWidth * 0.6}\n          height={window.innerHeight * 0.48}\n        />\n        {this.displayMenu()}\n      </div>\n    );\n  }\n}\n\nexport default FabricLayer;\n","export const thumbStyle = {\n  display: 'inline-flex',\n  borderRadius: 2,\n  border: '1px solid #eaeaea',\n  marginBottom: 8,\n  marginRight: 8,\n  width: 50,\n  height: 50,\n  padding: 4,\n  boxSizing: 'border-box',\n};\n\nexport const thumbInnerStyle = {\n  display: 'flex',\n  minWidth: 0,\n  overflow: 'hidden',\n};","export const mainViewStyle = {\n  flex: 0.1,\n  position: 'relative',\n};\n\nexport const mainCardBodyStyle = {\n  width: '100%',\n  height: '100%',\n};\n\nexport const mainCardStyle = {\n  justify: 'center',\n  alignContent: 'center',\n  alignItems: 'center',\n  textAlign: 'center',\n  width: '100%',\n  fluid: true,\n  fontSize: '12px',\n  marginBottom: '15px',\n};\n\nexport const mainImgStyle = {\n  width: '100%',\n};\n\nexport const mainCanvasStyle0 = {\n  position: 'absolute',\n  zIndex: '3',\n  marginLeft: '0px',\n  opacity: '1.0',\n};\n\nexport const mainCanvasStyle1 = {\n  position: 'absolute',\n  height: '100%',\n  width: '100%',\n  zIndex: '3',\n  opacity: '0.5',\n};\nexport const mainCanvasStyle2 = {\n  position: 'absolute',\n  height: '100%',\n  width: '100%',\n  zIndex: '5',\n  opacity: '0.5',\n};\nexport const mainCanvasStyle3 = {\n  position: 'absolute',\n  height: '100%',\n  width: '100%',\n  zIndex: '7',\n  opacity: '0.5',\n};\n","export const channelViewStyle = {\n  flex: 0.1,\n  position: 'relative',\n};\n\nexport const channelCardStyle = {\n  justify: 'center',\n  alignContent: 'center',\n  alignItems: 'center',\n  textAlign: 'center',\n  width: '100%',\n  fluid: true,\n  fontSize: '12px',\n  height: '100%',\n};\n\nexport const channelCardBodyStyle = {\n  width: '95%',\n  height: '100%',\n};\n\nexport const channelCanvasStyle = {\n  position: 'center',\n  height: '100px',\n  width: '100%',\n  zIndex: '3',\n};\n\nexport const channelImageCanvasStyle = {};\n","export const annotViewStyle = {\n  flex: 0.1,\n  position: 'relative',\n};\n\nexport const annotCardStyle = {\n  justify: 'center',\n  alignContent: 'center',\n  alignItems: 'center',\n  textAlign: 'center',\n  width: '100%',\n  fluid: true,\n  marginBottom: '15px',\n  overflowX: 'scroll',\n};\n\nexport const annotLayerStyle = {};\n","export const axisViewStyle = {\n  flex: 0.1,\n  position: 'relative',\n};\n\nexport const axisCardStyle = {\n  justify: 'center',\n  alignContent: 'center',\n  alignItems: 'center',\n  textAlign: 'center',\n  width: '100%',\n  fluid: true,\n  fontSize: '12px',\n  flexWrap: 'wrap',\n  marginBottom: '15px',\n};\n\nexport const axisCardBodyStyle = {\n  width: '95%',\n  height: '100%',\n};\n","import {\n  annotApi,\n} from './index.js';\n\nexport function exportJson() {\n  const element = document.createElement('a');\n\n  const json = convertToExportableJson()\n\n  const file = new Blob([json], {\n    type: 'text/plain',\n  });\n  element.href = URL.createObjectURL(file);\n  element.download = 'annotations.json';\n  document.body.appendChild(element); // Required for this to work in FireFox\n  element.click();\n}\n\nfunction convertToExportableJson() {\n  const annots = annotApi.getState().annotations\n  var newAnnots = {\"annotations\": [] }\n\n  for (var i = 0; i < annots.length; i++) {\n    const annot = annots[i]\n    const newAnnot = {\n      \"class\": annot.class,\n      \"id\": annot.id,\n      \"label\": annot.label,\n      \"rect\": annot.rect,\n    }\n    newAnnots.annotations[i] = newAnnot\n  }\n\n  return JSON.stringify(newAnnots, null, 2)\n}\n\nexport function exportFile(filename, json) {\n  const element = document.createElement('a');\n\n  const file = new Blob([JSON.stringify(json, null, 2)], {\n    type: 'text/plain',\n  });\n  element.href = URL.createObjectURL(file);\n  element.download = filename;\n  document.body.appendChild(element); // Required for this to work in FireFox\n  element.click();\n}\n","import create from 'zustand';\n\nexport const zoomState = {\n  views: [\n    {\n      name: 'main',\n      zoomPct: '1',\n      zoomZppPct: '1',\n      reset: '0',\n    },\n    {\n      name: 'xy',\n      zoomPct: '1',\n      zoomZppPct: '1',\n      reset: '0',\n    },\n    {\n      name: 'yz',\n      zoomPct: '1',\n      zoomZppPct: '1',\n      reset: '0',\n    },\n    {\n      name: 'xz',\n      zoomPct: '1',\n      zoomZppPct: '1',\n      reset: '0',\n    },\n  ],\n  last: '0',\n};\n\nexport const [useZoomStore, useZoomApi] = create(set => ({\n  ...zoomState,\n}));\n","import React, { Component } from 'react';\nimport { useZoomApi } from './zoom/zoomSettings.js';\n\nclass Slider extends Component {\n  initSlider = {\n    initial: 0,\n    min: 0,\n    max: 0,\n    step: 0,\n    value: 0,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      updated: false,\n      slider: this.initSlider,\n      setSlider: null,\n      sync: true,\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.state.updated) {\n      return true;\n    }\n    return false;\n  }\n\n  updateStatus(status) {\n    let updated = true;\n    this.setState({ updated: updated });\n  }\n\n  notifyValue() {\n    var sliderValue = this.props.sliderValue;\n    const type = this.props.type;\n    sliderValue(this.state.slider.value, type);\n  }\n\n  displayValue() {\n    if (this.props.raw === '1') {\n      return (\n        <span>\n          {' '}\n          {Math.round(this.state.slider.value * this.props.multiplier)}\n        </span>\n      );\n    } else {\n      return (\n        <span>\n          {' '}\n          {Math.round(this.state.slider.value * this.props.multiplier)}%\n        </span>\n      );\n    }\n  }\n\n  handleSliderChange = e => {\n    e.persist();\n\n    let slider = this.state.slider;\n    slider.value = e.target.value;\n    this.setState({ slider: slider });\n\n    this.updateStatus(true);\n    this.notifyValue();\n  };\n\n  render() {\n    useZoomApi.subscribe(state => {\n      if (this.props.type >= 0 && this.props.type < state.views.length) {\n        let slider = this.state.slider;\n        slider.value = state.views[this.props.type].zoomPct;\n        this.setState({ slider: slider });\n      }\n    });\n\n    const slider = this.state.slider;\n    const { label, min, max, initial, step } = this.props;\n\n    return (\n      <div className=\"slider-settings\">\n        <span>{label}</span> <br></br>\n        <span>{min} </span>\n        <input\n          type=\"range\"\n          className=\"slider\"\n          value={slider.value || initial}\n          id=\"customRange1\"\n          initial={initial}\n          min={min}\n          max={max}\n          step={step}\n          onChange={e => this.handleSliderChange(e)}\n        />\n        <span> {max}</span>\n        <span> {this.displayValue()}</span>\n      </div>\n    );\n  }\n}\n\nexport default Slider;\n","import React, { Component } from 'react';\nimport ProgressBar from '../../datacube/datacubeControls.js';\nimport Slider from './slider.js';\n\nimport {\n  fApi,\n  updateChannelSlice,\n  initializeVolume,\n  getVolume,\n  updateType,\n  parseMetadata,\n  filesNeedUpdate,\n} from './index.js';\n\nclass mainTiffViewer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.canvas = React.createRef();\n    this.state = {\n      axes: ['x', 'y', 'z'],\n      cntxt: null,\n    };\n    this.fileLength      = 0;\n    this.length          = 0;\n    this.sliceIdx        = 0;\n    this.axisIdx         = props.axis;\n    this.channel         = 1;\n    this.channelSliceIdx = 0;\n\n    // Case 1: (60 z planes, 3 channels, 1)\n    // Case 2: (60 z planes, 1 channel, 3)\n    // Case 3: (1 z planes, 3 channels, 60)\n    // Case 4: (1 z planes, 1 channel, 180)\n    // Case 5: (1 z planes, 3 channels, 180) (PNG)\n    this.type = 1;\n    this.typeIsDefault = true;\n    this.files = props.files;\n  }\n\n  componentDidMount() {\n    this.cntxt = this.canvas.current.getContext('2d')\n\n    if (this.files) {\n      const idx = Math.max((this.files.length - 1), 0);\n      if (\n        this.isValidTiffFile(this.files, idx)\n      ) {\n        const file = this.files[idx]\n        const width = file.image.width\n        const height = file.image.height\n        const fileLength = this.files.length\n        const pageLength = file.pages.length\n\n        this.setType(this.files, file.metadata)\n        this.setSlider(width, height, fileLength, pageLength)\n        this.setVolume(this.files, width, height, pageLength * fileLength)\n        this.updateSlice()\n        this.fileLength = fileLength\n        this.forceUpdate();\n      }\n      else if (\n        this.isValidPNGFile(this.files, idx)\n      ) {\n        this.updateFileList(this.files)\n        this.drawPNG(this.files[idx].image)\n        this.type = 5\n        this.setSlider(0, 0, this.files.length, 0)\n        // this.fileLength = files.length\n        this.forceUpdate()\n      }\n    }\n  }\n\n  isValidTiffFile(file, idx) {\n\n    return (\n      (file.length > 0) &&\n      (file[idx]) &&\n      (file[idx].pages) &&\n      (file[idx].pages.length > 0) &&\n      (file.length !== this.fileLength)\n    )\n  }\n\n  isValidPNGFile(file, idx) {\n    return (\n      (file.length > 0) &&\n      (file[idx]) &&\n      (file.length !== this.fileLength) &&\n      (file[idx].type === 'image/png')\n    )\n  }\n\n  drawPNG(src) {\n    var image = new Image()\n    image.src = src\n    this.cntxt.drawImage(image, 0, 0)\n  }\n\n  setSlider(width, height, length, pageLength) {\n    // if (this.props.axis === \"0\") this.length = width\n    // if (this.props.axis === \"1\") this.length = height\n    if (this.props.axis === \"2\") {\n      if (this.type === 1) {\n        this.length = pageLength / 3\n      }\n      else if (this.type === 2) {\n        this.length = pageLength\n      }\n      else if (this.type === 3) {\n        this.length = length\n      }\n      else if (this.type === 4) {\n        this.length = length / 3\n      }\n      else if (this.type === 5) {\n        this.length = length\n      }\n    }\n  }\n\n  setVolume(files, width, height, length) {\n    initializeVolume(0, this.cntxt, files, 0, this.state.axes, this.type, width, height, length)\n    if (!this.volume) {\n      this.volume = getVolume(0)\n    }\n  }\n\n  setType(files, metadata) {\n    if (this.typeIsDefault) {\n      this.type = parseMetadata(files, metadata)\n      updateType(this.type)\n      this.typeIsDefault = false\n    }\n  }\n\n  async refreshImage() {\n    this.cntxt.clearRect(0, 0, this.canvas.current.width, this.canvas.current.height)\n    if (!this.volume) {\n      this.volume = getVolume(0)\n    }\n  }\n\n  updateFileList(files) {\n    const pngFiles = files.filter(file => file.type === \"image/png\")\n    for (var i = this.files.length; i < pngFiles.length; i++) {\n      this.files.push(pngFiles[i])\n    }\n  }\n\n  async updateForFile(state) {\n    if (filesNeedUpdate(state, this.fileLength)) {\n      const files = state.file\n      if (state && files) {\n        const idx = Math.max((files.length - 1), 0);\n        if (\n          this.isValidTiffFile(state.file, idx)\n        ) {\n          const file = files[idx]\n          const width = file.image.width\n          const height = file.image.height\n          const fileLength = files.length\n          const pageLength = file.pages.length\n\n          this.setType(files, file.metadata)\n          this.setSlider(width, height, fileLength, pageLength)\n          this.setVolume(files, width, height, pageLength * fileLength)\n          this.updateSlice()\n          this.fileLength = fileLength\n          this.forceUpdate();\n        }\n        else if (\n          this.isValidPNGFile(state.file, idx)\n        ) {\n          this.updateFileList(state.file)\n          this.drawPNG(state.file[idx].image)\n          this.type = 5\n          this.setSlider(0, 0, files.length, 0)\n          // this.fileLength = files.length\n          this.forceUpdate()\n        }\n      }\n    }\n  }\n\n  computeSlice(value) {\n    // select every third\n    if (this.type === 1) {\n      return ((value * 3) + (this.channel-1) )\n    }\n    // select slice in [0-length) for channel 1, [length-2*length) for channel 2, [2*length-3*length) for channel 3\n    else if (this.type === 2) {\n      return ((value + ((this.channel-1) * this.length)))\n    }\n    // select every third\n    else if (this.type === 3) {\n      return ((value * 3) + (this.channel-1) )\n    }\n    // select every third\n    else if (this.type === 4) {\n      return ((value * 3) + (this.channel-1) )\n    }\n    else if (this.type === 5) {\n      return value\n    }\n  }\n\n  updateSlice() {\n    if (this.type < 5 ) {\n      this.refreshImage();\n      updateChannelSlice(\n        this.cntxt,\n        this.volume,\n        this.sliceIdx,\n        this.state.axes,\n        this.axisIdx,\n        false\n      );\n    }\n    else if (this.type === 5) {\n      this.drawPNG(this.files[this.sliceIdx].image)\n    }\n    this.forceUpdate();\n  }\n\n  sliderValueSlice(value) {\n    this.channelSliceIdx = parseInt(value)\n    this.sliceIdx = this.computeSlice(this.channelSliceIdx)\n    this.updateSlice()\n  }\n\n  sliderValueChannel(value) {\n    this.channel = parseInt(value)\n    this.sliceIdx = this.computeSlice(this.channelSliceIdx)\n    this.updateSlice()\n  }\n\n  clamp(val, min, max) {\n    return Math.min(Math.max(val, min), max);\n  }\n\n  drawChannelSlider() {\n    if (this.type < 5 ) {\n      return (\n        <div>\n          <div className=\"channel-slider-container\">\n            <Slider\n              label=\"\"\n              width=\"40%\"\n              min=\"1\"\n              max=\"3\"\n              step=\"1\"\n              initial=\"0\"\n              multiplier=\"1\"\n              raw=\"1\"\n              sliderValue={this.sliderValueChannel.bind(this)}\n            />\n            <div> Channel: {this.channel} </div>\n          </div>\n        </div>\n      )\n    }\n    else if (this.type === 5) {\n      return (\n        <div>\n        </div>\n      )\n    }\n  }\n\n  render() {\n    fApi.subscribe(state => {\n      this.updateForFile(state);\n    });\n\n    let width = window.innerWidth * 1.0;\n    let height = window.innerHeight * 1.0;\n    // let width = \"100%\";\n    // let height = \"100%\";\n    return (\n      <div style={{\"color\": \"black\", \"height\": \"100%\"}}>\n        <canvas\n          id=\"canvas-1\"\n          ref={this.canvas}\n          width={width}\n          height={height}\n        ></canvas>\n        <ProgressBar />\n        <div className=\"slice-slider-container\">\n          <Slider\n            label=\"\"\n            width=\"40%\"\n            min=\"0\"\n            max={Math.max(this.length - 1, 0)}\n            step=\"1\"\n            initial=\"0\"\n            multiplier=\"1\"\n            raw=\"1\"\n            sliderValue={this.sliderValueSlice.bind(this)}\n          />\n          <div> Slice: {this.channelSliceIdx} </div>\n        </div>\n        {this.drawChannelSlider()}\n      </div>\n    );\n  }\n}\n\nexport default mainTiffViewer;\n","import React from 'react';\nimport { Card, CardTitle, CardBody } from 'reactstrap';\n\nimport FabricLayer from './FabricLayer.js';\nimport MainTiffViewer from './mainTiffViewer.js';\n\nimport { canvasApi } from '../../imagecanvas/canvasStore.js';\nimport { settingsApi } from '../../mainSettings.js';\n\nimport {\n  fApi,\n  mainViewStyle,\n  mainCanvasStyle1,\n  mainCanvasStyle2,\n  mainCanvasStyle3,\n  mainCardStyle,\n} from './index.js';\n\nclass mainViewer extends React.Component {\n  canvasView() {\n    var canvas = (\n      <MainTiffViewer\n        axis=\"2\"\n        className=\"annot-view\"\n        alt=\"main-canvas\"\n        width={window.innerWidth * 0.6}\n        height=\"100%\"\n        channel=\"4\"\n        files={this.files}\n      />\n    );\n\n    let width = window.innerWidth * 0.6;\n    let height = window.innerHeight * 0.6;\n\n    return (\n      <div id=\"main-canvas-view\" style={{ width: width, height: height }}>\n        {canvas}\n      </div>\n    );\n  }\n\n  channelViews() {\n    var view1;\n    var view2;\n    var view3;\n\n    if (settingsApi.getState().channels[0].selected) {\n      console.log('displaying 1');\n      view1 = canvasApi.getState().canvas[0];\n    }\n    if (settingsApi.getState().channels[1].selected) {\n      console.log('displaying 2');\n      view2 = canvasApi.getState().canvas[1];\n    }\n    if (settingsApi.getState().channels[2].selected) {\n      console.log('displaying 3');\n      view3 = canvasApi.getState().canvas[2];\n    }\n    return (\n      <div>\n        <div style={mainCanvasStyle1}>{view1}</div>\n        <div style={mainCanvasStyle2}>{view2}</div>\n        <div style={mainCanvasStyle3}>{view3} </div>\n      </div>\n    );\n  }\n\n  updateForFile(state) {\n    this.files = state.file\n  }\n\n  display() {\n    if (\n      !settingsApi.getState().channels[0].selected &&\n      !settingsApi.getState().channels[1].selected &&\n      !settingsApi.getState().channels[2].selected\n    ) {\n      return this.canvasView();\n    } else {\n      return this.channelViews();\n    }\n  }\n\n  render() {\n    settingsApi.subscribe(state => {\n      this.forceUpdate();\n    });\n    fApi.subscribe(state => {\n      this.updateForFile(state);\n    });\n\n    let width = window.innerWidth * 0.6;\n    let height = window.innerHeight * 0.6;\n\n    return (\n      <div className=\"main-view\" style={mainViewStyle}>\n        <Card className=\"main-card\" style={mainCardStyle}>\n          <CardBody className=\"main-card-body\">\n            <CardTitle>\n              {' '}\n              <h5> Image View </h5>{' '}\n            </CardTitle>\n            <div\n              id=\"main-canvas-container\"\n              style={{ width: width, height: height, position: 'relative' }}\n            >\n              {this.display()}\n              <FabricLayer />\n            </div>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n}\n\nexport default mainViewer;\n","import React, { Component } from 'react';\nimport ProgressBar from '../../datacube/datacubeControls.js';\nimport Slider from './slider.js';\n\nimport {\n  fApi,\n  updateChannelSlice,\n  initializeVolume,\n  getVolume,\n  updateType,\n  parseMetadata,\n  filesNeedUpdate,\n} from './index.js';\n\nclass TiffViewer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.canvas = React.createRef();\n    this.state = {\n      axes: ['x', 'y', 'z'],\n      cntxt: null,\n    };\n    this.fileLength = 0;\n    this.length = 0;\n    this.sliceIdx = 0;\n    this.axisIdx = props.axis;\n    this.channel = 1;\n    this.channelSliceIdx = 0;\n\n    // Case 1: (60 z planes, 3 channels, 1)\n    // Case 2: (60 z planes, 1 channel, 3)\n    // Case 3: (1 z planes, 3 channels, 60)\n    // Case 4: (1 z planes, 1 channel, 180)\n    this.type = 1;\n    this.typeIsDefault = true;\n  }\n\n  componentDidMount() {\n    this.setState(prevState => ({\n      cntxt: this.canvas.current.getContext('2d'),\n    }));\n  }\n\n  isValidFile(file, idx) {\n    return (\n      file.length > 0 &&\n      file[idx] &&\n      file[idx].pages &&\n      file[idx].pages.length > 0 &&\n      file.length !== this.fileLength\n    );\n  }\n\n  setSlider(width, height, length, pageLength) {\n    if (this.props.axis === '0') this.length = width;\n    if (this.props.axis === '1') this.length = height;\n    if (this.props.axis === '2') {\n      if (this.type === 1) {\n        this.length = pageLength;\n      } else if (this.type === 2) {\n        this.length = pageLength * length;\n      } else if (this.type === 3) {\n        this.length = pageLength * length;\n      } else if (this.type === 4) {\n        this.length = pageLength * length;\n      }\n    }\n  }\n\n  setVolume(files, width, height, length) {\n    initializeVolume(\n      0,\n      this.state.cntxt,\n      files,\n      0,\n      this.state.axes,\n      this.type,\n      width,\n      height,\n      length\n    );\n    if (!this.volume) {\n      this.volume = getVolume(0);\n    }\n  }\n\n  setType(files, metadata) {\n    if (this.typeIsDefault) {\n      this.type = parseMetadata(files, metadata);\n      updateType(this.type);\n      this.typeIsDefault = false;\n    }\n  }\n\n  async updateForFile(state) {\n    if (filesNeedUpdate(state, this.fileLength)) {\n      const files = state.file;\n      if (state && files) {\n        const idx = Math.max(files.length - 1, 0);\n        if (this.isValidFile(files, idx)) {\n          const file = files[idx];\n          const width = file.image.width;\n          const height = file.image.height;\n          const fileLength = files.length;\n          const pageLength = file.pages.length;\n          this.setType(files, file.metadata);\n          this.setSlider(width, height, fileLength, pageLength);\n          this.setVolume(files, width, height, pageLength * fileLength);\n          this.updateSlice();\n          this.fileLength = fileLength;\n          this.forceUpdate();\n        }\n      }\n    }\n  }\n\n  async updateSlice() {\n    await updateChannelSlice(\n      this.state.cntxt,\n      this.volume,\n      this.sliceIdx,\n      this.state.axes,\n      this.axisIdx,\n      false\n    );\n    this.forceUpdate();\n  }\n\n  nextSlice(dec) {\n    if (dec)\n      this.slice(this.sliceIdx-1)\n      // this.sliceIdx = this.clamp(\n      //   parseInt(this.sliceIdx) - 1,\n      //   0,\n      //   Math.max(0, this.length - 1)\n      // );\n    else\n      this.slice(this.sliceIdx+1)\n      // this.sliceIdx = this.clamp(\n      //   parseInt(this.sliceIdx) + 1,\n      //   0,\n      //   Math.max(0, this.length - 1)\n      // );\n    this.updateSlice();\n  }\n\n  slice(value) {\n    this.sliceIdx = this.clamp(\n      parseInt(value),\n      0,\n      Math.max(0, this.length - 1)\n    );\n    this.updateSlice();\n  }\n\n  clamp(val, min, max) {\n    return Math.min(Math.max(val, min), max);\n  }\n\n  render() {\n    fApi.subscribe(state => {\n      this.updateForFile(state);\n    });\n    return (\n      <div>\n        <canvas\n          id=\"canvas-1\"\n          ref={this.canvas}\n          // width={window.innerWidth}\n          height=\"280\"\n        ></canvas>\n        <ProgressBar />\n        <div className=\"axis-slice-slider-container\">\n          <Slider\n            label=\"\"\n            width=\"40%\"\n            min=\"0\"\n            max={Math.max(this.length - 1, 0)}\n            step=\"1\"\n            initial=\"0\"\n            multiplier=\"1\"\n            raw=\"1\"\n            sliderValue={this.slice.bind(this)}\n          />\n          <button\n            id=\"prevSliceBtn\"\n            onClick={() => {\n              this.nextSlice(true);\n            }}\n          >\n            {'<<'}\n          </button>\n          <button\n            id=\"resetSliceBtn\"\n            onClick={() => {\n              this.slice(0);\n            }}\n          >\n            Go to Slice 0\n          </button>\n          <button\n            id=\"nextSliceBtn\"\n            onClick={() => {\n              this.nextSlice(false);\n            }}\n          >\n            {'>>'}\n          </button>\n          &nbsp;\n          <label>\n            Page #: &nbsp;\n            <input\n              type=\"text\"\n              style={{ width: '30px' }}\n              value={this.sliceIdx}\n              onChange={event => this.slice(event.target.value)}\n            />\n          </label>\n          <div> Slice: {this.sliceIdx} </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default TiffViewer;\n","import React from 'react';\nimport { Card, CardTitle, CardBody } from 'reactstrap';\n\nimport AxisTiffViewer from './axisTiffViewer.js';\n\nimport { axisViewStyle, axisCardStyle, axisCardBodyStyle } from './index.js';\n\nclass AxesViewer extends React.Component {\n  view1 = (<AxisTiffViewer axis=\"2\" />);\n  view2 = (<AxisTiffViewer axis=\"0\" />);\n  view3 = (<AxisTiffViewer axis=\"1\" />);\n\n  render() {\n    return (\n      <div>\n        <div className=\"card-axis-xy\" style={axisViewStyle}>\n          <Card style={axisCardStyle}>\n            <CardBody style={axisCardBodyStyle}>\n              <CardTitle>\n                {' '}\n                <h5> Axis XY </h5>{' '}\n              </CardTitle>\n              {this.view1}\n            </CardBody>\n          </Card>\n        </div>\n\n        <div className=\"card-axis-yz\" style={axisViewStyle}>\n          <Card style={axisCardStyle}>\n            <CardBody style={axisCardBodyStyle}>\n              <CardTitle>\n                {' '}\n                <h5> Axis YZ </h5>{' '}\n              </CardTitle>\n              {this.view2}\n            </CardBody>\n          </Card>\n        </div>\n\n        <div className=\"card-axis-xz\" style={axisViewStyle}>\n          <Card style={axisCardStyle}>\n            <CardBody style={axisCardBodyStyle}>\n              <CardTitle>\n                {' '}\n                <h5> Axis XZ </h5>{' '}\n              </CardTitle>\n              {this.view3}\n            </CardBody>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default AxesViewer;\n","import React from 'react';\nimport {\n  Button,\n  UncontrolledCollapse,\n  Card,\n  CardTitle,\n  CardBody,\n} from 'reactstrap';\n\nimport {\n  annotApi,\n  updateClasses,\n  getClasses,\n  toggleClassEnable,\n  annotClassApi,\n  filterClasses,\n  annotCardStyle,\n  annotViewStyle,\n} from './index.js';\n\nclass AnnotatorViewer extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      classes: [],\n      annotClasses: [],\n    };\n    this.enables = [];\n  }\n\n  futureClass = [];\n  futureAnnotClass = [];\n\n  componentDidUpdate(prevState) {\n    for (var i = 0; i < prevState.classes; i++) {\n      const cls = prevState.classes[i];\n      if (\n        cls &&\n        this.state.classes[i] !== cls.name &&\n        this.enables[i] !== cls.enabled\n      ) {\n        return true;\n      }\n    }\n    for (i = 0; i < prevState.annotClasses; i++) {\n      const annotCls = prevState.annotClasses[i];\n      if (annotCls && this.state.annotClasses[i] !== annotCls) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  filter(sel) {\n    const classes = getClasses();\n    toggleClassEnable(sel);\n    filterClasses(classes[sel]);\n  }\n\n  updateAnnotClasses(annots) {\n    for (var i = 0; i < annots.length; i++) {\n      const cls = annots[i];\n      if (\n        !this.state.annotClasses.includes(cls.class) &&\n        !this.futureAnnotClass.includes(cls.class)\n      ) {\n        this.futureAnnotClass.push(cls.class);\n        this.setState(prevState => ({\n          ...prevState,\n          annotClasses: [...prevState.annotClasses, cls.class],\n        }));\n      }\n    }\n  }\n\n  updateClasses(classes) {\n    for (var i = 0; i < classes.length; i++) {\n      const idx = i;\n      const cls = classes[idx];\n      if (\n        !this.state.classes.includes(cls.name) &&\n        !this.futureClass.includes(cls.name)\n      ) {\n        this.futureClass.push(cls.name);\n        this.setState(prevState => ({\n          ...prevState,\n          classes: [...prevState.classes, cls.name],\n        }));\n      }\n    }\n  }\n\n  updateEnables(classes) {\n    for (var i = 0; i < classes.length; i++) {\n      const idx = i;\n      const cls = classes[idx];\n      if (this.enables.length !== classes.length) {\n        this.enables[i] = cls.enabled;\n      } else if (cls && this.enables[i] !== cls.enabled) {\n        this.enables[i] = cls.enabled;\n        this.forceUpdate();\n      }\n    }\n  }\n\n  display() {\n    return (\n      <div>\n        <div className=\"annotations-class\" style={annotViewStyle}>\n          <Card style={annotCardStyle}>\n            <CardBody>\n              <CardTitle>\n                {' '}\n                <h5> Annotation Classes </h5>{' '}\n              </CardTitle>\n            </CardBody>\n            <Button\n              className=\"viewBtn\"\n              outline\n              color=\"secondary\"\n              id=\"annotator-class-list\"\n            >\n              Class List\n            </Button>\n            <br />\n            <UncontrolledCollapse toggler={'annotator-class-list'}>\n              {this.displayClassList()}\n            </UncontrolledCollapse>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  displayClassList() {\n    const classes = getClasses();\n    var divs = [];\n    for (var i = 0; i < classes.length; i++) {\n      const sel = i;\n      const enabled = classes[sel].enabled;\n      divs.push(\n        <Button\n          outline\n          color=\"primary\"\n          id=\"annot1Btn\"\n          onClick={() => {\n            this.filter(sel);\n          }}\n          active={enabled}\n        >\n          {classes[sel].name}\n        </Button>\n      );\n    }\n    return <div>{divs}</div>;\n  }\n\n  render() {\n    annotApi.subscribe(state => {\n      if (state) {\n        updateClasses();\n        this.updateAnnotClasses(state.annotations);\n      }\n    });\n    annotClassApi.subscribe(state => {\n      if (state && this.state.classes.length !== state.classes.length) {\n        this.updateClasses(state.classes);\n      }\n      if (state && state.classes) {\n        this.updateEnables(state.classes);\n      }\n    });\n    return <div>{this.display()}</div>;\n  }\n}\n\nexport default AnnotatorViewer;\n","import React from 'react';\nimport { fabric } from 'fabric';\n\nimport {\n  fApi,\n  thumbStyle,\n  thumbInnerStyle\n} from './index.js';\n\nclass Thumbnails extends React.Component {\n  constructor(props) {\n    super(props);\n    this.selected = 0;\n    this.files = [];\n    this.canvasRef = React.createRef();\n    this.canvas = null;\n  }\n\n  componentDidMount() {\n    this.canvas = new fabric.Canvas(this.canvasRef.current);\n  }\n\n  setSelected(idx) {\n    if (this.selected !== idx) {\n      fApi.setState(prevState => ({\n        ...prevState,\n        selected: idx,\n      }));\n      this.selected = idx;\n    }\n  }\n\n  updateForFile(state) {\n    if (\n      state &&\n      state.file.length > 0 &&\n      state.file.length !== this.files.length\n    ) {\n      const tiffFiles = state.file.filter(file => file.type === 'image/tiff');\n      for (var i = this.files.length; i < tiffFiles.length; i++) {\n        const idx = tiffFiles.length - 1;\n        const file = tiffFiles[idx];\n\n        const newFile = {\n          rgba: file.rgba,\n          width: file.image.width,\n          height: file.image.height,\n          page: file.pages[0],\n          name: file.name,\n          type: file.type,\n        };\n\n        this.files.push(newFile);\n      }\n      this.forceUpdate();\n    }\n  }\n\n  classicImage = (file, idx) => {\n    return (\n      <div style={thumbStyle} key={file.name}>\n        <div style={thumbInnerStyle}>\n          <img\n            src={file.image}\n            style={file.style}\n            alt={file.name}\n            onClick={() => this.setSelected(idx)}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  allThumbs = () => {\n    var elements = [];\n\n    if (fApi.getState().file) {\n      fApi.getState().file.map((file, idx) => {\n        if (file.type === 'image/png') {\n          elements.push(this.classicImage(file, idx));\n        }\n        return null;\n      });\n    }\n\n    return <div>{elements}</div>;\n  };\n\n  shrinkTiff(context, imageData, idx) {\n    const cw = 50;\n    const ch = 50;\n    const imgW = imageData.width;\n    const imgH = imageData.height;\n\n    var newC = document.createElement('canvas');\n    newC.width = imgW;\n    newC.height = imgH;\n    newC.getContext('2d').putImageData(imageData, 0, 0);\n\n    var x = (cw + 10) * idx;\n    var y = 0;\n    context.drawImage(newC, x, y, cw, ch);\n  }\n\n  loadTiff(context) {\n    for (var f = 0; f < this.files.length; f++) {\n      const file = this.files[f];\n      var page = null;\n      if (file) {\n        page = file.page;\n      }\n      if (page && file.width > 0 && file.height > 0) {\n        const imageData = context.createImageData(file.width, file.height);\n\n        for (let idx = 0; idx < page.length; idx++) {\n          imageData.data[idx] = page[idx];\n        }\n\n        this.shrinkTiff(context, imageData, f);\n      }\n    }\n  }\n\n  allTiffsCanvas = () => {\n    if (this.canvas) this.loadTiff(this.canvas.getContext('2d'));\n    return (\n      <div>\n        <canvas\n          ref={this.canvasRef}\n          width=\"500px\"\n          height=\"500px\"\n          margin=\"0px\"\n          id=\"tiff-canvas\"\n        />\n      </div>\n    );\n  };\n\n  display() {\n    return (\n      <div>\n        {this.allThumbs()}\n        {this.allTiffsCanvas()}\n      </div>\n    );\n  }\n\n  render() {\n    fApi.subscribe(state => {\n      this.updateForFile(state);\n      this.forceUpdate();\n    });\n\n    return <div id=\"thumbsContainer\">{this.display()}</div>;\n  }\n}\n\nexport default Thumbnails;\n","import React, { useEffect, useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport {\n  initPng,\n  addPng,\n  initTiff,\n  addTiff,\n  initCsv,\n  addCsv,\n  initJson,\n  addJson,\n  isFirstFile,\n  isValidFile,\n  saveTotalNumOfFiles,\n} from './index.js';\n\nfunction addFile(file) {\n  if (file.type === 'image/png') {\n    addPng(file);\n  } else if (file.type === 'image/tiff') {\n    addTiff(file);\n  } else if (file.type === 'text/csv') {\n    addCsv(file);\n  } else if (file.type === 'application/json') {\n    addJson(file);\n  }\n}\n\nfunction initFile(file) {\n  if (file.type === 'image/png') {\n    initPng(file);\n  } else if (file.type === 'image/tiff') {\n    initTiff(file);\n  } else if (file.type === 'text/csv') {\n    initCsv(file);\n  } else if (file.type === 'application/json') {\n    initJson(file);\n  }\n}\n\nexport function FileUpload(props) {\n  const [files, setFiles] = useState([]);\n  const { getRootProps, getInputProps } = useDropzone({\n    accept: 'image/png, image/tiff, .csv, .json',\n    onDrop: acceptedFiles => {\n      setFiles(\n        acceptedFiles.map(file =>\n          Object.assign(file, {\n            preview: URL.createObjectURL(file),\n          })\n        )\n      );\n    },\n  });\n\n  const update = files.map(file => {\n    if (isValidFile(file.name)) {\n      if (isFirstFile()) {\n        initFile(file);\n      } else {\n        addFile(file);\n      }\n    }\n    return null;\n  });\n\n  useEffect(\n    () => () => {\n      // Make sure to revoke the data uris to avoid memory leaks\n      files.forEach(file => URL.revokeObjectURL(file.preview));\n    },\n    [files]\n  );\n\n  return (\n    <section className=\"container\">\n      <div {...getRootProps({ className: 'dropzone' })}>\n        <input {...getInputProps()} />\n        {props.name}\n        {saveTotalNumOfFiles(files.length)}\n        {update}\n      </div>\n    </section>\n  );\n}\n","import React from 'react';\n\nimport { Button, Navbar, Modal, ModalBody } from 'reactstrap';\n\nimport { FileUpload } from '../../fileuploader/fileUploader.js';\n\nimport { exportJson, modes, setMode, undo, redo, delAnnot, updateLabel, updateClassLabel } from './index.js';\n\nclass Menus extends React.Component {\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      labelModalOpen: false,\n      classModalOpen: false,\n      labelText: '',\n      classText: '',\n    }\n  }\n\n  displayFileMenu() {\n    return (\n      <div>\n        <Button color=\"primary\" className=\"import-btn\">\n          {' '}\n          <FileUpload name=\"Import File\" />{' '}\n        </Button>{' '}\n        &nbsp;\n        <Button color=\"primary\" className=\"export-btn\" onClick={exportJson}>\n          {' '}\n          Export Annotations{' '}\n        </Button>{' '}\n        &nbsp;\n      </div>\n    );\n  }\n\n  displayDrawMenu() {\n    return (\n      <div>\n        <Button\n          color=\"primary\"\n          className=\"draw-rectangle-btn\"\n          onClick={e => setMode(modes.RECT)}\n        >\n          Draw Rectangle\n        </Button>{' '}\n        &nbsp;\n        {/* <Button\n          color=\"primary\"\n          className=\"draw-rectangle-btn\"\n          onClick={e => setMode(modes.FREE)}\n        >\n          Draw Freehand\n        </Button>{' '}\n        &nbsp; */}\n      </div>\n    );\n  }\n\n  toggleLabel() {\n    this.setState(prevState => ({\n      ...prevState,\n      labelModalOpen: !prevState.labelModalOpen\n    }))\n  }\n\n  handleChangeLabel(event) {\n    if (event && event.target && event.target.value) {\n      var newStr = event.target.value;\n      this.setState(prevState => ({\n        ...prevState,\n        labelText: newStr\n      }))\n    }\n  }\n\n  changeLabel() {\n    updateLabel(null, this.state.labelText)\n    this.toggleLabel()\n  }\n\n  toggleClassLabel() {\n    this.setState(prevState => ({\n      ...prevState,\n      classModalOpen: !prevState.classModalOpen\n    }))\n  }\n\n  handleChangeClassLabel(event) {\n    if (event && event.target && event.target.value) {\n      var newStr = event.target.value;\n      this.setState(prevState => ({\n        ...prevState,\n        classText: newStr\n      }))\n    }\n  }\n\n  changeClassLabel() {\n    updateClassLabel(null, this.state.classText)\n    this.toggleClassLabel()\n  }\n\n  displayEditAnnotationLabel () {\n    return (\n      <Modal isOpen={this.state.labelModalOpen} toggle={() => this.toggleLabel()} className=\"label-modal\">\n        <ModalBody>\n          <input\n            type=\"text\"\n            value={this.state.labelText}\n            onChange={(e) => this.handleChangeLabel(e)}\n          /> &nbsp;\n          <Button onClick={() => this.changeLabel()}\n          >\n            {' '}\n            Change Label{' '}\n          </Button>\n        </ModalBody>\n      </Modal>\n    )\n  }\n\n  displayEditAnnotationClass () {\n    return (\n      <Modal isOpen={this.state.classModalOpen} toggle={() => this.toggleClassLabel()} className=\"class-label-modal\">\n        <ModalBody>\n          <input\n            type=\"text\"\n            value={this.state.classText}\n            onChange={(e) => this.handleChangeClassLabel(e)}\n          /> &nbsp;\n          <Button onClick={() => this.changeClassLabel()}\n          >\n            {' '}\n            Change Class Label{' '}\n          </Button>\n        </ModalBody>\n      </Modal>\n    )\n\n  }\n\n  displayEditMenu() {\n    return (\n      <div>\n        <Button\n          color=\"primary\"\n          className=\"undo-btn\"\n          onClick={e => undo()}\n        >\n          Undo\n        </Button>{' '}\n        &nbsp;\n        <Button\n          color=\"primary\"\n          className=\"redo-btn\"\n          onClick={e => redo()}\n        >\n          Redo\n        </Button>{' '}\n        &nbsp;\n        <Button\n          color=\"primary\"\n          className=\"delete-btn\"\n          onClick={e => delAnnot()}\n        >\n          Delete\n        </Button>{' '}\n        &nbsp;\n        <Button\n          color=\"primary\"\n          className=\"edit-label-btn\"\n          onClick={e => this.toggleLabel()}\n        >\n          Edit Label\n        </Button>{' '}\n        &nbsp;\n        <Button\n          color=\"primary\"\n          className=\"edit-class-btn\"\n          onClick={e => this.toggleClassLabel()}\n        >\n          Edit Class\n        </Button>{' '}\n        &nbsp;\n        {this.displayEditAnnotationLabel()}\n        {this.displayEditAnnotationClass()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div style={{ padding: '15px 7px' }}>\n        <Navbar\n          color=\"light\"\n          light\n          className=\"navbar shadow-sm p-3 mb-0 bg-white rounded\"\n          expand=\"md\"\n        >\n          {this.displayFileMenu()}\n          {this.displayDrawMenu()}\n          {this.displayEditMenu()}\n        </Navbar>\n      </div>\n    );\n  }\n}\n\nexport default Menus;\n","import React from 'react';\n\nimport { fileApi, annotApi, addAnnotationFromJson } from './index.js';\n\nclass Annotator extends React.Component {\n  file_size = 0;\n  annotations = {};\n\n  render() {\n    fileApi.subscribe(state => {\n      if (state && this.file_size !== state.size) {\n        for (var i = 0; i < state.file.length; i++) {\n          const json = state.file[i].json;\n          if (json) {\n            addAnnotationFromJson(json);\n            this.file_size = state.size;\n          }\n        }\n      }\n    });\n    annotApi.subscribe(state => {\n      if (this.annotations !== state.annotations) {\n        this.annotations = state.annotations;\n      }\n    });\n    return <div id=\"annotator-div\"></div>;\n  }\n}\n\nexport default Annotator;\n","import React from 'react';\nimport { fabric } from 'fabric';\n\nimport {\n  fApi,\n  uApi,\n  canvasApi,\n  volApi,\n  updateImage,\n  updateTexture,\n  getVolume,\n  generateTexture,\n  filesNeedUpdate,\n  areFilesValid,\n  initializeVolume,\n  updateChannelSlice,\n  updateSliceLength,\n  updateType,\n  parseMetadata,\n} from './index.js';\n\nclass ImageCanvas extends React.Component {\n  constructor (props) {\n    super(props)\n    this.files = [];\n    this.canvasRef = React.createRef();\n    this.state = {\n      axes: ['x', 'y', 'z'],\n    }\n    this.init()\n  }\n\n  init() {\n    this.setState(prevState => ({\n      ...prevState,\n      cntxt: null,\n      // rgb: 0 (red), 1 (green), 2 (blue)\n      rgb: 0,\n    }))\n    this.fileLength = 0;\n\n    // Case 1: (60 z planes, 3 channels, 1)\n    // Case 2: (60 z planes, 1 channel, 3)\n    // Case 3: (1 z planes, 3 channels, 60)\n    // Case 4: (1 z planes, 1 channel, 180)\n    // Case 5: (1 z planes, 3 channels, 180) (PNG)\n    this.type = 1;\n    this.typeIsDefault = true;\n\n    this.sliceIdx       = 0;\n    this.computedSlicedIdx = 0;\n    this.axisIdx        = 2;\n    this.length         = 0;\n\n    this.imgdata        = null;\n    this.updatedtexture = true;\n    this.volType = 0;\n    this.texture = null;\n  }\n\n  componentDidMount() {\n    const canvas = new fabric.Canvas(this.canvasRef.current);\n    const cntxt = canvas.getContext('2d');\n\n    this.setState(prevState => ({\n      cntxt: cntxt\n    }));\n  }\n\n  updateFileList(files) {\n    const tiffFiles = files.filter(file => file.type === \"image/tiff\")\n    for (var i = this.files.length; i < tiffFiles.length; i++) {\n      const idx = tiffFiles.length - 1\n      const file = tiffFiles[idx]\n\n      const newFile = {\n        rgba: file.rgba,\n        width: file.image.width,\n        height: file.image.height,\n        length: file.pages.length,\n        page: file.pages[0],\n        name: file.name,\n        type: file.type\n      }\n\n      this.files.push(newFile)\n    }\n    const pngFiles = files.filter(file => file.type === \"image/png\")\n    for (var j = this.files.length; j < pngFiles.length; j++) {\n      this.files.push(pngFiles[j])\n    }\n  }\n\n  updateLength(fileLength, pageLength) {\n    if (this.type === 1) {\n      this.length = pageLength/3\n    }\n    else if (this.type === 2 ) {\n      this.length = pageLength\n    }\n    else if (this.type === 3) {\n      this.length = fileLength\n    }\n    else if (this.type === 4) {\n      this.length = fileLength / 3\n    }\n    else if (this.type === 5) {\n      this.length = fileLength\n    }\n  }\n\n  getIdx(fileLength) {\n    if (this.type === 1) {\n      return Math.max((fileLength - 1), 0);\n    }\n    else if (this.type === 2) {\n      return (parseInt(this.props.channel)-1)\n    }\n    else if (this.type === 3) {\n      return Math.max((fileLength - 1), 0);\n    }\n    else if (this.type === 4) {\n      return Math.max((fileLength - 1), 0);\n    }\n    else if (this.type === 5) {\n      return Math.max((fileLength - 1), 0);\n    }\n  }\n\n  setVolume(files, width, height, length) {\n    initializeVolume(0, this.state.cntxt, files, 0, this.state.axes, this.type, width, height, length)\n    if (!this.volume) {\n      this.volume = getVolume(0)\n    }\n  }\n\n  setType(files, metadata) {\n    if (this.typeIsDefault) {\n      this.type = parseMetadata(files, metadata)\n      updateType(this.type)\n      this.typeIsDefault = false\n    }\n  }\n\n  isValidPNGFile(file, idx) {\n    return (\n      (file.length > 0) &&\n      (file[idx]) &&\n      (file.length !== this.fileLength) &&\n      (file[idx].type === 'image/png')\n    )\n  }\n\n  updateForFile(state) {\n    if (filesNeedUpdate(state, this.files.length)) {\n      var idx = this.getIdx(state.file.length)\n      const files = state.file\n      if (\n        areFilesValid(files, idx, this.fileLength)\n      ) {\n        const file = files[idx]\n        const width = file.image.width\n        const height = file.image.height\n        const fileLength = files.length\n        const pageLength = file.pages.length\n\n        this.updateFileList(files)\n        this.setType(files, file.metadata)\n        this.updateLength(fileLength, pageLength)\n        this.setVolume(files, width, height, pageLength)\n        this.fileLength = this.files.length\n        this.file = file\n\n        updateImage(files[state.selected], this.props.channel);\n        updateSliceLength((parseInt(this.props.channel)+3), this.length)\n      }\n      else if (\n        this.isValidPNGFile(files, idx)\n      ) {\n        this.updateFileList(files)\n        this.type = 5\n        this.updateLength(files.length, 0)\n\n        updateImage(this.files[this.sliceIdx], this.props.channel);\n        updateSliceLength((parseInt(this.props.channel)+3), this.length)\n      }\n    }\n    this.forceUpdate();\n  }\n  updateForControls(state) {\n    const texture = state.channels[this.props.channel-1].uniforms.image.value\n    if (texture && (this.texture !== texture)) {\n      this.texture = texture;\n      this.forceUpdate();\n    }\n  }\n  updateForSlice(state) {\n    if (state) {\n      const sliceIdx = state.sliceIndices[parseInt(this.props.channel)+3]\n      if (this.sliceIdx !== sliceIdx) {\n        this.computedSlicedIdx = this.computeSlice(parseInt(sliceIdx))\n\n        if (this.type < 5) {\n          this.updateSlice();\n          this.loadTiff();\n        }\n        else if (this.type === 5) {\n          updateImage(this.files[parseInt(sliceIdx)], this.props.channel);\n        }\n        this.forceUpdate();\n        this.sliceIdx = sliceIdx\n      }\n    }\n  }\n\n  computeSlice(value) {\n    if (this.type === 1) {\n      return ((value * 3) + (parseInt(this.props.channel)-1) )\n    }\n    else if (this.type === 2) {\n      return ((value + ((parseInt(this.props.channel)-1) * this.length)))\n    }\n    else if (this.type === 3) {\n      return ((value * 3) + (parseInt(this.props.channel)-1) )\n    }\n    else if (this.type === 4) {\n      return ((value * 3) + (parseInt(this.props.channel)-1) )\n    }\n    else if (this.type === 5) {\n      return value\n    }\n  }\n\n  updateSlice() {\n    updateChannelSlice(\n      this.state.cntxt,\n      this.volume,\n      this.computedSlicedIdx,\n      this.state.axes,\n      this.axisIdx,\n      true\n    );\n    this.updatedtexture = false;\n    this.forceUpdate();\n  }\n\n  async setImageData() {\n    if (!this.volume) {\n      this.volume = getVolume(0)\n    }\n    if (this.volume) {\n      this.imgdata = await this.volume.getImageData()\n    }\n  }\n\n  async setTexture() {\n    this.texture = generateTexture(this.imgdata.data, this.imgdata.width, this.imgdata.height)\n    updateTexture(this.file, this.texture, this.props.channel)\n  }\n\n  async loadTiff() {\n    if (!this.updatedtexture) {\n      this.setImageData()\n      if (this.imgdata && (this.imgdata.data.length > 0)) {\n        this.setTexture()\n        this.updatedtexture = true\n      }\n    }\n  }\n\n  displayCanvas() {\n    this.loadTiff()\n    return canvasApi.getState().canvas[this.props.channel - 1]\n  }\n\n  render() {\n    fApi.subscribe(state => {\n      this.updateForFile(state);\n      this.forceUpdate()\n    });\n    uApi.subscribe(state => {\n      this.updateForControls(state);\n    });\n    volApi.subscribe(state => {\n      this.updateForSlice(state);\n    });\n\n    return (\n      this.displayCanvas()\n    )\n  }\n}\n\nexport default ImageCanvas;\n","import React from 'react';\nimport { SketchPicker } from 'react-color';\nimport reactCSS from 'reactcss';\n\nclass ColorPicker extends React.Component {\n  state = {\n    displayColorPicker: false,\n    color: {\n      r: '241',\n      g: '112',\n      b: '19',\n      a: '1',\n    },\n  };\n\n  handleClick = () => {\n    this.setState({ displayColorPicker: !this.state.displayColorPicker });\n  };\n\n  handleClose = () => {\n    this.setState({ displayColorPicker: false });\n  };\n\n  handleChange = color => {\n    this.setState({ color: color.rgb });\n  };\n\n  handleChangeComplete = color => {\n    this.setState({ color: color.rgb });\n    this.props.onClick({ color: color.hex });\n  };\n\n  render() {\n    const styles = reactCSS({\n      default: {\n        color: {\n          width: '36px',\n          height: '14px',\n          borderRadius: '2px',\n          background: `rgba(${this.state.color.r}, ${this.state.color.g}, ${this.state.color.b}, ${this.state.color.a})`,\n        },\n        swatch: {\n          padding: '5px',\n          background: '#fff',\n          borderRadius: '1px',\n          boxShadow: '0 0 0 1px rgba(0,0,0,.1)',\n          display: 'inline-block',\n          cursor: 'pointer',\n        },\n        popover: {\n          position: 'absolute',\n          zIndex: '2',\n        },\n        cover: {\n          position: 'fixed',\n          top: '0px',\n          right: '0px',\n          bottom: '0px',\n          left: '0px',\n        },\n      },\n    });\n\n    return (\n      <div>\n        <div style={styles.swatch} onClick={this.handleClick}>\n          <div style={styles.color} />\n        </div>\n        {this.state.displayColorPicker ? (\n          <div style={styles.popover}>\n            <div style={styles.cover} onClick={this.handleClose} />\n            <SketchPicker\n              color={this.state.color}\n              onChange={this.handleChange}\n              onChangeComplete={this.handleChangeComplete}\n            />\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n}\nexport default ColorPicker;\n","import React from 'react';\n\nimport { Button, UncontrolledCollapse, Card, CardBody } from 'reactstrap';\n\nimport ImageCanvas from '../../imagecanvas/ImageCanvas.js';\nimport Slider from './slider.js';\nimport ColorPicker from './colorPicker.js';\n\nimport { settingsApi } from '../../mainSettings.js';\n\nimport {\n  volApi,\n  updateBrightness,\n  updateContrast,\n  updateWhitepoint,\n  updateBlackpoint,\n  updateColor,\n  updateOpacity,\n  updateChannelSel,\n  updateLastSel,\n  channelCardStyle,\n  channelCardBodyStyle,\n  channelCanvasStyle,\n  channelImageCanvasStyle,\n  updateSliceIndex,\n} from './index.js';\n\nclass Channel extends React.Component {\n  componentDidMount() {\n    this.channelSliceIdx = 0;\n    this.channelSliceLen = 0;\n  }\n\n  updateSelection = () => {\n    updateChannelSel(this.props.ch);\n    updateLastSel(this.props.ch);\n    this.forceUpdate();\n  };\n\n  sliderValueSlice(value) {\n    updateSliceIndex(parseInt(this.props.ch) + 3, value);\n  }\n\n  updateForSliceLen(state) {\n    const len = state.lengths[parseInt(this.props.ch) + 3];\n    if (this.channelSliceLen !== len) {\n      this.channelSliceLen = len;\n      this.forceUpdate();\n    }\n  }\n\n  sliderValueBr(value) {\n    updateBrightness(value, this.props.ch);\n  }\n\n  sliderValueCt(value) {\n    updateContrast(value, this.props.ch);\n  }\n\n  sliderValueWp(value) {\n    updateWhitepoint(value, this.props.ch);\n  }\n\n  sliderValueBp(value) {\n    updateBlackpoint(value, this.props.ch);\n  }\n\n  sliderValueOpc(value) {\n    updateOpacity(value, this.props.ch);\n  }\n\n  colorValue(value) {\n    updateColor(value, this.props.ch);\n  }\n\n  resetBrightness() {\n    updateBrightness('0.0', this.props.ch);\n  }\n\n  resetContrast() {\n    updateContrast('0.0', this.props.ch);\n  }\n\n  resetWhitepoint() {\n    updateWhitepoint('255.0', this.props.ch);\n  }\n\n  resetBlackpoint() {\n    updateBlackpoint('0.0', this.props.ch);\n  }\n\n  resetOpacity() {\n    updateOpacity('0.0', this.props.ch);\n  }\n\n  render() {\n    volApi.subscribe(state => {\n      this.updateForSliceLen(state);\n    });\n\n    var sliderValueBr = this.sliderValueBr;\n    var sliderValueCt = this.sliderValueCt;\n    var sliderValueWp = this.sliderValueWp;\n    var sliderValueBp = this.sliderValueBp;\n    var sliderValueOpc = this.sliderValueOpc;\n    var colorValue = this.colorValue;\n\n    var alt = 'Ch' + this.props.ch + ' Histogram';\n    var canvas = (\n      <ImageCanvas\n        className=\"annot-view\"\n        alt={alt}\n        height=\"200px\"\n        channel={this.props.ch}\n        style={channelImageCanvasStyle}\n      />\n    );\n    var sel = settingsApi.getState().channels[this.props.ch - 1].selected;\n\n    console.log('Channel ' + this.props.ch + ' : ' + sel);\n    return (\n      <div>\n        <Button\n          className=\"channelBtn\"\n          outline\n          color=\"primary\"\n          id=\"channel-btn\"\n          onClick={() => {\n            this.updateSelection();\n          }}\n          active={sel}\n        >\n          Channel {`${this.props.ch}`}\n        </Button>\n        &nbsp;\n        <Button\n          className=\"viewBtn\"\n          outline\n          color=\"secondary\"\n          id={`view${this.props.ch}`}\n        >\n          View\n        </Button>\n        <UncontrolledCollapse toggler={`#view${this.props.ch}`}>\n          <Card style={channelCardStyle}>\n            <CardBody style={channelCardBodyStyle}>\n              <div className=\"channel-slice-slider-container\">\n                <Slider\n                  label=\"\"\n                  width=\"40%\"\n                  min=\"0\"\n                  max={Math.max(this.channelSliceLen - 1, 0)}\n                  step=\"1\"\n                  initial=\"0\"\n                  multiplier=\"1\"\n                  raw=\"1\"\n                  sliderValue={this.sliderValueSlice.bind(this)}\n                />\n              </div>\n              <div> Slice: {this.channelSliceIdx} </div>\n              <div>Channel Color</div>\n              <ColorPicker\n                color={colorValue.bind(this)}\n                onClick={colorValue.bind(this)}\n              />\n              <br></br>\n              <div className=\"opacity-slider-container\">\n                <Slider\n                  label=\"Opacity\"\n                  width=\"40%\"\n                  min=\"0.0\"\n                  max=\"1.0\"\n                  step=\"0.1\"\n                  initial=\"0\"\n                  multiplier=\"100\"\n                  raw=\"0\"\n                  sliderValue={sliderValueOpc.bind(this)}\n                />\n                <button\n                  id=\"resetOpcBtn\"\n                  onClick={() => {\n                    this.resetOpacity();\n                  }}\n                >\n                  Reset Channel Opacity\n                </button>\n              </div>\n              <br></br>\n              <br></br>\n              <div className=\"brightness-slider-container\">\n                <Slider\n                  label=\"Brightness\"\n                  width=\"40%\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.1\"\n                  initial=\"0\"\n                  multiplier=\"100\"\n                  raw=\"0\"\n                  sliderValue={sliderValueBr.bind(this)}\n                />\n                <button\n                  id=\"resetBrBtn\"\n                  onClick={() => {\n                    this.resetBrightness();\n                  }}\n                >\n                  Reset Brightness\n                </button>\n              </div>\n              <div className=\"contrast-slider-container\">\n                <Slider\n                  label=\"Contrast\"\n                  width=\"40%\"\n                  min=\"0\"\n                  max=\"10\"\n                  step=\"1\"\n                  initial=\"0\"\n                  multiplier=\"10\"\n                  raw=\"0\"\n                  sliderValue={sliderValueCt.bind(this)}\n                />\n                <button\n                  id=\"resetCtBtn\"\n                  onClick={() => {\n                    this.resetContrast();\n                  }}\n                >\n                  Reset Contrast\n                </button>\n              </div>\n              <div className=\"whitepoint-slider-container\">\n                <Slider\n                  label=\"Whitepoint\"\n                  width=\"40%\"\n                  min=\"0\"\n                  max=\"255\"\n                  step=\"1\"\n                  initial=\"255\"\n                  multiplier=\"1\"\n                  raw=\"1\"\n                  sliderValue={sliderValueWp.bind(this)}\n                />\n                <button\n                  id=\"resetWpBtn\"\n                  onClick={() => {\n                    this.resetWhitepoint();\n                  }}\n                >\n                  Reset Whitepoint\n                </button>\n              </div>\n              <div className=\"blackpoint-slider-container\">\n                <Slider\n                  label=\"Blackpoint\"\n                  width=\"40%\"\n                  min=\"0\"\n                  max=\"255\"\n                  step=\"1\"\n                  initial=\"0\"\n                  multiplier=\"1\"\n                  raw=\"1\"\n                  sliderValue={sliderValueBp.bind(this)}\n                />\n                <button\n                  id=\"resetBpBtn\"\n                  onClick={() => {\n                    this.resetBlackpoint();\n                  }}\n                >\n                  Reset Blackpoint\n                </button>\n              </div>\n              <div style={channelCanvasStyle}>{canvas}</div>\n            </CardBody>\n          </Card>\n        </UncontrolledCollapse>\n      </div>\n    );\n  }\n}\n\nexport default Channel;\n","import React from 'react';\nimport { Row, Col, Card, CardTitle, CardBody } from 'reactstrap';\n\nimport Channel from './channel.js';\n\nimport {\n  channelViewStyle,\n  channelCardStyle,\n  channelCardBodyStyle,\n} from './index.js';\n\nclass ChannelViewer extends React.Component {\n  render() {\n    return (\n      <div className=\"annotations-channel\" style={channelViewStyle}>\n        <Row>\n          <Col sm=\"4\">\n            <Card style={channelCardStyle}>\n              <CardBody style={channelCardBodyStyle}>\n                <CardTitle>\n                  {' '}\n                  <h5> Channel 1 </h5>{' '}\n                </CardTitle>\n                <Channel ch=\"1\" />\n              </CardBody>\n            </Card>\n          </Col>\n          <Col sm=\"4\">\n            <Card style={channelCardStyle}>\n              <CardBody style={channelCardBodyStyle}>\n                <CardTitle>\n                  {' '}\n                  <h5> Channel 2 </h5>{' '}\n                </CardTitle>\n                <Channel ch=\"2\" />\n              </CardBody>\n            </Card>\n          </Col>\n          <Col sm=\"4\">\n            <Card style={channelCardStyle}>\n              <CardBody style={channelCardBodyStyle}>\n                <CardTitle>\n                  {' '}\n                  <h5> Channel 3 </h5>{' '}\n                </CardTitle>\n                <Channel ch=\"3\" />\n              </CardBody>\n            </Card>\n          </Col>\n        </Row>\n      </div>\n    );\n  }\n}\n\nexport default ChannelViewer;\n","import React from 'react';\nimport {\n  mainStyle,\n  mainMenuStyle,\n  rowStyle,\n  containerStyle,\n} from './styles/style.js';\nimport MainViewer from './components/mainViewer.js';\nimport AxesViewer from './components/axesViewer.js';\nimport AnnotatorViewer from './components/annotatorViewer.js';\nimport Thumbnails from './components/thumbnails.js';\nimport Menus from './components/menus.js';\nimport Annotator from './../annotator/annotator.js';\nimport ChannelViewer from './components/channelViewer.js';\n\nimport { Container, Row, Col } from 'reactstrap';\n\nclass UI extends React.Component {\n  render() {\n    return (\n      <div className=\"main\" style={mainStyle}>\n        <Container fluid style={mainMenuStyle}>\n          <Row style={{ justifyContent: 'space-between' }}>\n            <Col xs=\"auto\">\n              <Menus />\n            </Col>\n            <Col xs=\"auto\">\n              <h3\n                style={{\n                  color: '#fff',\n                  verticalAlign: 'center',\n                  padding: '15px 7px',\n                }}\n              >\n                BRMLIA\n              </h3>\n            </Col>\n          </Row>\n        </Container>\n\n        <Container style={containerStyle}>\n          <Row style={rowStyle}>\n            <Col xs=\"4\">\n              <AxesViewer />\n              <Thumbnails />\n            </Col>\n\n            <Col xs=\"8\">\n              <AnnotatorViewer />\n              <MainViewer />\n              <ChannelViewer />\n            </Col>\n          </Row>\n        </Container>\n        <Annotator />\n      </div>\n    );\n  }\n}\n\nexport default UI;\n","import 'bootstrap/dist/css/bootstrap.min.css';\nimport './styles.css';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport UI from './ui';\n\nfunction Application() {\n  return (\n    <div>\n      <UI />\n    </div>\n  );\n}\n\nconst rootElement = document.getElementById('root');\nReactDOM.render(<Application />, rootElement);\n"],"sourceRoot":""}